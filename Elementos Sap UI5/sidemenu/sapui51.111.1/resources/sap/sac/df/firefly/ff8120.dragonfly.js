/*!
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define(["sap/sac/df/firefly/ff4330.olap.catalog.impl","sap/sac/df/firefly/ff4340.olap.reference","sap/sac/df/firefly/ff4410.olap.ip.providers","sap/sac/df/firefly/ff8050.application.ui"],function(e){"use strict";e.Ui5GridExport=function(){};e.Ui5GridExport.prototype=new e.XObject;e.Ui5GridExport.prototype._ff_c="Ui5GridExport";e.Ui5GridExport.create=function(t,i){var r=new e.Ui5GridExport;r.m_table=t;r.m_tableDefinition=i;return r};e.Ui5GridExport.getDimensionMemberName=function(t){var i=null;var r=t.getDimension();if(r.isStructure()){var n=r.getStructureMember(t.getName());var o=n.getDimension().getDisplayKeyField();var a=n.getFieldValue(o);if(e.notNull(a)){i=a.getValue().getStringRepresentation()}}if(e.isNull(i)){i=t.getName()}return i};e.Ui5GridExport.prototype.m_table=null;e.Ui5GridExport.prototype.m_tableDefinition=null;e.Ui5GridExport.prototype._export=function(){var t=this.m_table.getRowList();var i=this.m_table.getColumnList();var r=t.size();var n=i.size();var o=r-1;var a=n-1;var l=e.PrFactory.createStructure();l.putInteger(e.Ui5GridExportConstants.TOTAL_ROWS,this.m_table.getRowsTotalCount());l.putInteger(e.Ui5GridExportConstants.TOTAL_COLUMNS,this.m_table.getColumnsTotalCount());var s=this.m_table.getHeaderRowList();var E=l.putNewList("Cells");var u=s.size();var p=e.XMath.min(i.size(),a+1);var d=e.XMath.min(t.size(),o+1);var C;var g=0;var _;for(_=0;_<u;_++){C=s.get(_);if(e.notNull(C)&&!C.isEffectivelyHidden()){this.renderRow(E,C,g++,p)}else if(e.isNull(C)){g++}}for(_=0;_<d;_++){C=t.get(_);if(e.notNull(C)&&!C.isEffectivelyHidden()){this.renderRow(E,C,g++,p)}else if(e.isNull(C)){g++}}return l};e.Ui5GridExport.prototype.renderRow=function(t,i,r,n){var o=0;var a=this.m_table.getPreColumnsAmount();for(var l=0;l<a+n;l++){var s=i.getCells().get(l);if(e.notNull(s)&&s.getParentColumn()!==null&&!s.getParentColumn().isEffectivelyHidden()){this.renderCell(t,s,r,o++)}else if(e.isNull(s)){o++}}};e.Ui5GridExport.prototype.renderCell=function(t,i,r,n){var o=t.addNewStructure();o.putInteger(e.Ui5GridExportConstants.ROW,r);o.putInteger(e.Ui5GridExportConstants.COLUMN,n);var a=i.getMergedColumns();var l=i.getMergedRows();if(a!==0||l!==0){var s=o.putNewStructure(e.Ui5GridExportConstants.MERGED);if(a>=0&&l>=0){if(i.getMergedColumns()>0){s.putInteger(e.Ui5GridExportConstants.MERGED_COLUMNS,i.getMergedColumns())}if(i.getMergedRows()>0){s.putInteger(e.Ui5GridExportConstants.MERGED_ROWS,i.getMergedRows())}}else{s.putInteger(e.Ui5GridExportConstants.ORIGINAL_COLUMN,n+i.getMergedColumns());s.putInteger(e.Ui5GridExportConstants.ORIGINAL_ROW,r+i.getMergedRows())}}if(i.getCommentDocumentId()!==null){o.putString(e.Ui5GridExportConstants.DOCUMENT_ID,i.getCommentDocumentId())}var E;if(!i.isRepeatedHeader()||i.isEffectiveRepetitiveHeaderCells()){o.putString(e.Ui5GridExportConstants.FORMATTED,i.getFormatted());E=i.getFormattingPattern()}else{o.putString(e.Ui5GridExportConstants.FORMATTED,"");E=""}if(!i.isHeaderCell()){o.putString(e.Ui5GridExportConstants.FORMAT_STRING,E)}if(i.getPlain()!==null){var u=i.getPlain().getValueType();o.putString(e.Ui5GridExportConstants.CELL_DATA_TYPE,u.getName());if(!i.isHeaderCell()){if(u===e.XValueType.BOOLEAN){o.putBoolean(e.Ui5GridExportConstants.CELL_PLAIN,e.XValueUtil.getBoolean(i.getPlain(),false,true))}else if(u===e.XValueType.DOUBLE){o.putDouble(e.Ui5GridExportConstants.CELL_PLAIN,e.XValueUtil.getDouble(i.getPlain(),false,true))}else if(u===e.XValueType.LONG){o.putLong(e.Ui5GridExportConstants.CELL_PLAIN,e.XValueUtil.getLong(i.getPlain(),false,true))}else if(u===e.XValueType.INTEGER){o.putInteger(e.Ui5GridExportConstants.CELL_PLAIN,e.XValueUtil.getInteger(i.getPlain(),false,true))}else{o.putString(e.Ui5GridExportConstants.CELL_PLAIN,i.getPlain().getStringRepresentation())}}}var p=i.getEffectiveCellType();var d=this.getCellType(p);o.putString(e.Ui5GridExportConstants.CELL_TYPE,d);var C;if(e.XString.isEqual(d,e.Ui5GridExportConstants.CT_DIM_MEMBER_COL)||e.XString.isEqual(d,e.Ui5GridExportConstants.CT_VALUE)){var g=i.getParentColumn();var _=g.getTupleIndex();o.putInteger("TupleIndexCol",_)}if(e.XString.isEqual(d,e.Ui5GridExportConstants.CT_DIM_MEMBER_ROW)||e.XString.isEqual(d,e.Ui5GridExportConstants.CT_VALUE)){var f=i.getParentRow();var m=f.getTupleIndex();o.putInteger("TupleIndexRow",m)}if(e.XString.isEqual(d,e.Ui5GridExportConstants.CT_DIM_MEMBER_COL)||e.XString.isEqual(d,e.Ui5GridExportConstants.CT_DIM_HEADER_COL)){var M=this.m_tableDefinition.getColumnDimension(r);o.putString("Dimension",this.getDimensionName(M))}if(e.XString.isEqual(d,e.Ui5GridExportConstants.CT_DIM_MEMBER_ROW)||e.XString.isEqual(d,e.Ui5GridExportConstants.CT_DIM_HEADER_ROW)){var D=this.m_tableDefinition.getRowDimension(n);o.putString("Dimension",this.getDimensionName(D))}if(e.XString.isEqual(d,e.Ui5GridExportConstants.CT_DIM_MEMBER_COL)){C=this.m_tableDefinition.getColumnTupleElement(n,r);var T=C.getDimensionMember();o.putString("Member",e.Ui5GridExport.getDimensionMemberName(T));o.putBoolean(e.Ui5GridExportConstants.REPEATED_MEMBER_NAME,i.isRepeatedHeader())}if(e.XString.isEqual(d,e.Ui5GridExportConstants.CT_DIM_MEMBER_ROW)){C=this.m_tableDefinition.getRowTupleElement(n,r);o.putString("Member",e.Ui5GridExport.getDimensionMemberName(C.getDimensionMember()));o.putBoolean(e.Ui5GridExportConstants.REPEATED_MEMBER_NAME,i.isRepeatedHeader())}if(i.isEffectiveTotalsContext()){o.putBoolean(e.Ui5GridExportConstants.TOTALS,true)}var R=i.isInHierarchy();o.putBoolean(e.Ui5GridExportConstants.IN_HIERARCHY,R);if(R){o.putInteger(e.Ui5GridExportConstants.HIERARCHY_LEVEL,i.getHierarchyLevel());o.putBoolean(e.Ui5GridExportConstants.HIERARCHY_NODE_EXPANDED,i.isExpanded())}this.fillSemanticObjects(o,i,r,n,e.XString.isEqual(d,e.Ui5GridExportConstants.CT_VALUE))};e.Ui5GridExport.prototype.fillSemanticObjects=function(t,i,r,n,o){var a=e.PrFactory.createList();this.addSemanticObjectFromTupleElement(a,this.m_tableDefinition.getColumnTupleElement(n,r));this.addSemanticObjectFromTupleElement(a,this.m_tableDefinition.getRowTupleElement(n,r));if(o){var l=this.m_tableDefinition.getColumnTuple(n);var s;for(s=0;s<l.size();s++){this.addSemanticObjectFromTupleElement(a,l.getTupleElementAt(s))}l=this.m_tableDefinition.getRowTuple(r);for(s=0;s<l.size();s++){this.addSemanticObjectFromTupleElement(a,l.getTupleElementAt(s))}}var E=i.getDataCellRef();if(e.notNull(E)){var u=this.m_tableDefinition.getQueryModel().getQueryDataCell(E);if(e.notNull(u)&&u.getSemanticObject()!==null){a.addString(u.getSemanticObject())}}if(a.hasElements()){t.put("SemanticObjects",a)}};e.Ui5GridExport.prototype.addSemanticObjectFromTupleElement=function(t,i){if(e.notNull(i)){var r=this.m_tableDefinition.getQueryModel().getDimensionByName(i.getDimension().getName());var n=r.getSemanticObject();if(e.notNull(n)){t.addString(n)}if(r.isStructure()){var o=i.getDimensionMember();if(e.notNull(o)){var a=r.getStructureMember(o.getName());n=a.getSemanticObject();if(e.notNull(n)){t.addString(n)}}}}};e.Ui5GridExport.prototype.getDimensionName=function(e){var t=this.m_tableDefinition.getQueryModel().getDimensionByName(e.getName());if(t.isMeasureStructure()){return"MeasureStructure"}if(t.isStructure()){return"NonMeasureStructure"}return t.getExternalName()!==null?t.getExternalName():e.getName()};e.Ui5GridExport.prototype.getCellType=function(t){if(t===e.SacTableConstants.CT_VALUE){return e.Ui5GridExportConstants.CT_VALUE}else if(t===e.SacTableConstants.CT_INPUT){return e.Ui5GridExportConstants.CT_VALUE}else if(t===e.SacTableConstants.CT_UNBOOKED){return e.Ui5GridExportConstants.CT_VALUE}else if(t===e.SacTableConstants.CT_HEADER){return e.Ui5GridExportConstants.CT_HEADER}else if(t===e.SacTableConstants.CT_ROW_DIM_HEADER){return e.Ui5GridExportConstants.CT_DIM_HEADER_ROW}else if(t===e.SacTableConstants.CT_COL_DIM_HEADER){return e.Ui5GridExportConstants.CT_DIM_HEADER_COL}else if(t===e.SacTableConstants.CT_COL_DIM_MEMBER){return e.Ui5GridExportConstants.CT_DIM_MEMBER_COL}else if(t===e.SacTableConstants.CT_ROW_DIM_MEMBER){return e.Ui5GridExportConstants.CT_DIM_MEMBER_ROW}else if(t===e.SacTableConstants.CT_EMPTY_AXIS_ROW_HEADER){return e.Ui5GridExportConstants.CT_EMPTY_AXIS_HEADER_ROW}else if(t===e.SacTableConstants.CT_EMPTY_AXIS_COLUMN_HEADER){return e.Ui5GridExportConstants.CT_EMPTY_AXIS_HEADER_COL}else{return e.XInteger.convertToString(t)}};e.Ui5GridExportConstants={TOTAL_ROWS:"TotalRows",TOTAL_COLUMNS:"TotalColumns",IN_HIERARCHY:"InHierarchy",HIERARCHY_LEVEL:"HierarchyLevel",HIERARCHY_NODE_EXPANDED:"HierarchyNodeExpanded",ROW:"Row",COLUMN:"Column",MERGED:"Merged",MERGED_COLUMNS:"MergedColumns",MERGED_ROWS:"MergedRows",ORIGINAL_COLUMN:"OriginalColumn",ORIGINAL_ROW:"OriginalRow",DOCUMENT_ID:"DocumentId",FORMATTED:"Value",FORMAT_STRING:"FormatString",REPEATED_MEMBER_NAME:"RepeatedMemberName",CELL_DATA_TYPE:"Type",CELL_PLAIN:"PlainValue",CELL_TYPE:"CellType",CT_VALUE:"Value",CT_HEADER:"Header",CT_DIM_HEADER_ROW:"DimHeaderRow",CT_DIM_HEADER_COL:"DimHeaderCol",CT_DIM_MEMBER_COL:"DimMemberCol",CT_DIM_MEMBER_ROW:"DimMemberRow",CT_EMPTY_AXIS_HEADER_ROW:"EmptyAxisHeaderRow",CT_EMPTY_AXIS_HEADER_COL:"EmptyAxisHeaderCol",DATA_ROW:"DataRow",DATA_COLUMN:"DataColumn",TOTALS:"Totals"};e.DragonflyModule=function(){};e.DragonflyModule.prototype=new e.DfModule;e.DragonflyModule.prototype._ff_c="DragonflyModule";e.DragonflyModule.s_module=null;e.DragonflyModule.getInstance=function(){if(e.isNull(e.DragonflyModule.s_module)){e.DfModule.checkInitialized(e.ProviderModule.getInstance());e.DfModule.checkInitialized(e.OlapReferenceModule.getInstance());e.DfModule.checkInitialized(e.OlapCatalogImplModule.getInstance());e.DfModule.checkInitialized(e.ApplicationUiModule.getInstance());e.DragonflyModule.s_module=e.DfModule.startExt(new e.DragonflyModule);e.DfModule.stopExt(e.DragonflyModule.s_module)}return e.DragonflyModule.s_module};e.DragonflyModule.prototype.getName=function(){return"ff8120.dragonfly"};e.DragonflyModule.getInstance();return sap.firefly});
//# sourceMappingURL=ff8120.dragonfly.js.map