/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel"],function(e,t,a,r,i,n,o){function l(a,r,i){var n=a.descriptorContent["sap.card"].configuration.parameters;var l=a.descriptorContent["sap.card"]["data"]["request"];var p=false,v={},m={};if(l&&l.batch){p=true;v=l.batch.header||{};m=l.batch.content||{}}var d=a&&n._headerDataUrl,T=a&&n._contentDataUrl;var E=new t;var D=n._relevantODataFilters.value;var g=n._relevantODataParameters.value;var h=n._semanticDateRangeSetting,S=[];if(h){h=JSON.parse(h.value);S=Object.keys(h)||[]}D.forEach(function(e){var a=new t(n[e].value);var r=a.getSelectOption(e);var i=[];if(r&&r.length){if(S.includes(e)){i=c(r[0],"Filter");if(i.length){r[0].Low=i[0];r[0].High=i[1]?i[1]:null;if(r[0].Low&&r[0].High&&r[0].Option!=="BT"){r[0].Option="BT"}E.massAddSelectOption(e,r)}else if(o&&o.prototype.formatValue&&r[0]){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}E.massAddSelectOption(e,r)}}else{if(o&&o.prototype.formatValue&&r[0]&&n[e].type==="datetime"){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}E.massAddSelectOption(e,r)}E.massAddSelectOption(e,r)}}});g.forEach(function(e){var t="";if(n[e].value&&typeof n[e].value==="string"){t=n[e].value.toString()}else if(n[e].value.value){t=n[e].value.value.toString()}else if(n[e].value&&n[e].value instanceof Date){t=n[e].value}if(n[e].type==="datetime"&&!S.includes(e)&&!t.includes("datetime")){if(o&&o.prototype.formatValue){t=o.prototype.formatValue(t,"Edm.DateTime");E.addParameter(e,t)}}else if(n[e].type==="datetime"&&S.includes(e)){t=typeof n[e].value==="string"&&Date.parse(n[e].value)?c(new Date(t),"Parameter"):c(t,"Parameter");E.addParameter(e,t[0])}else{E.addParameter(e,t)}});var y=n._entitySet.value;var A=y;if(g.length){var O={};g.forEach(function(e){O[e]=n[e].type});A+=e.getParameterQueryFromSV(E,O);var M=A;if(M&&Array.isArray(M.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&M.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){A=f(M)}}if(n._urlSuffix.value){A+=n._urlSuffix.value}var I={};D.forEach(function(e){I[e]=n[e].type});var H=e.getFilterQueryFromSV(E,I);var R=H;if(R&&Array.isArray(R.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&R.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){H=f(R)}var N="",L="",Q="",_="",F={header:"",content:""};if(p){N=s(n,"_header",H,a.descriptorContent["sap.card"].type);L=N?A+"?"+N:A;if(d&&d.value){var w=u(S,L);if(w){v.url="{= extension.formatters.formatHeaderDataUrlForSemanticDate() }";d.value=""}else{d.value=L;if(r){r._headerDataUrl=d.value}}}else if(d){F.header=L}}if(n._contentDataUrl){Q=s(n,"_content",H,a.descriptorContent["sap.card"].type);_=Q?A+"?"+Q:A;if(n._contentDataUrl.value){var x=u(S,_);if(x){if(p){m.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}else{l.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}T.value=""}else{T.value=_;if(r){r._contentDataUrl=T.value}}}else{F.content=_;return F}if(i){F.header=L;F.content=_;return F}}}function u(e,t){var a=e.length?e:[];if(a.length&&t){return a.some(function(e){return t&&t.indexOf(e)>-1})}}function s(e,t,a,r){var i=[];if(a){i.push(a)}if(e[t+"SelectQuery"]&&e[t+"SelectQuery"].value){i.push(e[t+"SelectQuery"].value)}if(e[t+"ExpandQuery"]&&e[t+"ExpandQuery"].value){i.push(e[t+"ExpandQuery"].value)}if(e[t+"SortQuery"]&&e[t+"SortQuery"].value){var n=e[t+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[t+"TopQuery"]&&e[t+"TopQuery"].value){i.push(e[t+"TopQuery"].value)}if(e[t+"SkipQuery"]&&e[t+"SkipQuery"].value){i.push(e[t+"SkipQuery"].value)}}return i.length?i.join("&"):null}function f(e){var t=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var a=function(){var t=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var a=t;a=a.replace("%27","");var r=a.lastIndexOf("%27");var i=a.substr(0,r)+a.substr(r+3,a.length-1);return i};for(var r=0;r<t;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],a)}return e}function c(e,t){var r,i=[],o=[],l=false;if(t==="Parameter"){r=e}else if(t==="Filter"){e=typeof e==="string"?JSON.parse(e):e;r=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(r)){i=e.High.split(",")}}var u;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(r)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(r)){if(t==="Filter"){u=a.toDates({values:i,operator:r});o.push(u[0].oDate);o.push(u[1].oDate)}else{u=a.toDates({values:i,operator:r});o.push(u[0].oDate)}}if(["DATETIMERANGE","FROMDATETIME","TODATETIME","DATETIME"].includes(r)){l=true}if(o.length){o=p(o,true,l);return o}else if(Date(e)instanceof Date||e instanceof Date||Date.parse(e)){return p([e],true,l)}return[]}function p(e,t,a){var n;e.forEach(function(o,l){if(o.match){if(o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm)&&o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm).length){o=new Date(o)}}o=r.localToUtc(o);if(!a){o=r.normalizeDate(o,true)}if(t){n=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[l]=n.format(o,true)}else{var u=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var s=o instanceof Date?o:new Date(o);var f=u.format(s);e[l]=String(f).replace(/'/g,"")}});return e}function v(e,t,r){var i=r;if(e&&t){var n=e.operator;if(n!=="DATE"){return n}else{return e.values[0]}}if(!t){var o=e.operator;var l=e.values;var u="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"DATETIMERANGE":case"DATETIME":u="";if(typeof i==="string"){u=i}var s=a.toDates(e);l=s;var f=p(l,false,o==="DATETIMERANGE"||o==="DATETIME");if(!f[1]){f[1]=""}var c={Low:f[0],High:f[1],Option:"BT",Text:u};if(c){c.Text=u;return c}break;case"FROM":case"TO":case"FROMDATETIME":case"TODATETIME":u="";if(typeof i==="string"){u=i}var v=p(l,false,o==="FROMDATETIME"||o==="TODATETIME"),m;m=o==="FROM"||o==="FROMDATETIME"?"GE":"LE";var d={Low:v[0],High:"",Option:m,Text:u};if(d){d.Text=u;return d}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":u="";if(typeof i==="string"){u=i}return{Low:o,High:l[0].toString(),Option:"BT",Text:u};case"TODAYFROMTO":u="";if(typeof i==="string"){u=i}var T=l&&l[0];var E=l&&l[1];return{Low:o,High:T.toString()+","+E.toString(),Option:"BT",Text:u};default:u="";if(typeof i==="string"){u=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:u}}}}}return{processPrivateParams:l,formatSemanticDateTime:c,getDateRangeValue:v}});
//# sourceMappingURL=UrlGenerateHelper.js.map