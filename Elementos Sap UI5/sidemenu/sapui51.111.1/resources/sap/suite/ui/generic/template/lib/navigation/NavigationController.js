/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/util/merge","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/util/UriParameters","sap/ui/core/ComponentContainer","sap/ui/core/routing/HashChanger","sap/ui/core/routing/History","sap/ui/core/library","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/genericUtilities/jsonHelper","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/suite/ui/generic/template/genericUtilities/ProcessObserver","sap/suite/ui/generic/template/genericUtilities/Queue","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/navigation/routingHelper","sap/suite/ui/generic/template/lib/navigation/startupParameterHelper","sap/suite/ui/generic/template/lib/TemplateComponent","sap/base/strings/whitespaceReplacer"],function(e,t,r,n,a,o,i,s,u,l,d,p,c,f,v,g,y,m,h,b,C,N,P){"use strict";var k="lib.navigation.NavigationController";var R=new p(k).getLogger();var H=u.routing.HistoryDirection;var S=s.getInstance();var T=function(){};function I(e){e=e||S.getDirection();return e===H.Backwards}var L=b.getCrossAppNavService();var B="sap-iapp-state--create";var A="sap-iapp-state--history";function x(e){var t=e.substring(e.length-5,e.length);if(t==="query"){return e.substring(0,e.length-5)}return e}function D(e){if(e.indexOf("/")===0){return e}return"/"+e}function w(e){var t="";var r="";var n=Object.keys(e).sort();n.forEach(function(n){var a=e[n];if(Array.isArray(a)){var o=a.sort();for(var i=0;i<o.length;i++){var s=o[i];r=r+t+n+"="+s;t="&"}}else{r=r+t+n+"="+a;t="&"}});return r}function O(e,t){e=e||"";var r=e.charAt(e.length-1)==="/"?"?":"/?";return e+(t?r+t:"")}function F(e,t){var a=[];var o=L.createEmptyAppState(e.oAppComponent,true);var s=o.getKey();var u;var d;var p;var k;var F,E;var M;var j;var U;var K;var z=Promise.resolve();var V=(new g).start();function _(t,r,n){var a=t.iHashChangeCount+1;E={iHashChangeCount:a,backTarget:t.iHashChangeCount,componentsDisplayed:Object.create(null),LeaveByBack:true,backSteps:1};if(r){M.followUpNeeded={mode:r.mode,displayMode:r.displayMode,identity:{treeNode:e.mRoutingTree[r.route],keys:r.keys,appStates:r.appStates}};xe(null)}if(n){e.oApplicationProxy.setNextFocus(function(){setTimeout(function(){l.focusControl(n)},0)})}}function q(n){j=false;e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true);U={};u=I();var o=[];if(u){e.oBusyHelper.getUnbusy().then(function(){u=false});M={mode:-1};if(a.length){var i=a.pop();p=i.isInitialNavigation;d=i.myIntentPromise;k=i.previousHashes;k.push(i.currentHash);_(i.currentHash,i.serializedBackOption,i.focus);return}}else if(L){var s=L.isInitialNavigationAsync().then(function(e){p=e});o.push(s)}else{p=true}var l=sap.ushell&&sap.ushell.renderers&&sap.ushell.Container&&new Promise(function(e){sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(t){var r=t.getCurrentApplication();var a=function(){r=r||t.getCurrentApplication();var a=n&&(r.disableKeepAliveAppRouterRetrigger&&r.disableKeepAliveAppRouterRetrigger.bind(r,false)||t.disableKeepAliveAppRouterRetrigger&&t.disableKeepAliveAppRouterRetrigger.bind(t,false));(a||Function.prototype)();var o=r.getIntent();e(o)};if(r){a()}else{t.attachAppLoaded(null,a)}})});d=l?Promise.all([l,sap.ushell.Container.getServiceAsync("URLParsing")]).then(function(e){var t=r({},e[0]);var n=e[1];t.appSpecificRoute="&/";var a=n.constructShellHash(t);return"#"+a}):Promise.resolve("");var c=e.oAppComponent.getComponentData();e.myIntentPromise=c&&c.feEnvironment&&c.feEnvironment.getIntent&&Promise.resolve(c.feEnvironment.getIntent())||l||Promise.resolve({semanticObject:"",action:""});Y();var f=n?t.initialize:Function.prototype;var v=!u&&!t.oHashChanger.getHash()&&c;var g=v&&v.startupParameters;if(g){C.parametersToNavigation(e,g).then(function(t){if(t){F={treeNode:e.mRoutingTree.root,keys:[],appStates:Object.create(null)};gt(t)}f(!!t)})}else{f()}return Promise.all(o)}var Q=Promise.resolve();var G=Promise.resolve();var W=new v;function J(){var e=I();if(!e){var t=X();a.push({isInitialNavigation:p,myIntentPromise:d,currentHash:E,previousHashes:k,serializedBackOption:t.serializedBackOption,focus:t.focus})}d=null;E=null;k=null;F=null;K=null;U=null}function X(e){var t=o.getData();if(t.focus){return t}if(!e){var r=l.getControlWithFocus();e=r&&r.getId()}if(e){t.focus=e;o.setData(t);o.save()}return t}function Y(){E={iHashChangeCount:0,backTarget:0,componentsDisplayed:Object.create(null)};F=null;k=[];if(!u){M=null}K=null}function Z(){Tt(e.mRoutingTree.root.sRouteName);return e.mRoutingTree.root.componentCreated}function $(){return t.oAppComponent.getManifestEntry("sap.app").title}function ee(){return t.oAppComponent.getProperty("draftDiscardConfirmationSettings").enabled}function te(){var e=sap.ushell&&sap.ushell.Container;return e&&e.getServiceAsync("URLParsing")}function re(t,n,a){if(!t){return Promise.resolve()}var o=t&&e.componentRegistry[t];var i=[];var s=o&&o.methods.getUrlParameterInfo;if(s){i.push(o.viewRegistered.then(function(){var e=n&&D(n);return s(e,E.componentsDisplayed[o.route]===1).then(function(e){r(a,e)})}))}i.push(o.oStatePreserverPromise.then(function(e){var t=n&&D(n);return e.getUrlParameterInfo(t,E.componentsDisplayed[o.route]===1).then(function(e){r(a,e)})}));return Promise.all(i)}function ne(e){var t=e.treeNode.componentId;var r=e.treeNode.getPath(2,e.keys);var n=e.appStates;return re(t,r,n)}function ae(t,r){if(t.treeNode===r.treeNode){r.appStates=t.appStates;return Promise.resolve()}r.appStates=Object.create(null);if(r.treeNode.fCLLevel===0||r.treeNode.fCLLevel===3){return ne(r)}return e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(F,r)}function oe(t,r,n){var a=e.mRoutingTree[t];return re(a.componentId,n,r)}function ie(t,r){var n;if(!t&&r instanceof N){var a=r&&e.componentRegistry[r.getId()];var o=a&&a.methods.getTitle;n=o&&o()}else if(!t&&r&&r.title){n=r.title}n=n||$();e.oShellServicePromise.then(function(e){e.setTitle(n)}).catch(function(){R.warning("No ShellService available")})}function se(t){var r=[e.oPagesDataLoadedObserver.getProcessFinished(true)];var a=null;var o=E.iHashChangeCount;delete F.componentsDisplayed;var i=-1;for(var s in e.componentRegistry){var u=e.componentRegistry[s];var l=u.oControllerUtils&&u.oControllerUtils.oServices.oTemplateCapabilities.oMessageButtonHelper;var d=E.componentsDisplayed[u.route]===1;var p=u.utils.getTemplatePrivateModel();p.setProperty("/generic/isActive",d);if(d){r.push(u.oViewRenderedPromise);if(u.viewLevel>i){i=u.viewLevel;a=u.oComponent}}else{u.utils.suspendBinding()}if(l){l.setEnabled(d)}}var c=n(E.componentsDisplayed)||e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.isAppTitlePrefered();ie(c,t||a);Promise.all(r).then(function(){if(o===E.iHashChangeCount&&n(U)){e.oAppComponent.firePageDataLoaded()}})}var ue=se.bind(null,null);y.testable(function(e){F=e;k.push(E);E={backTarget:0,componentsDisplayed:Object.create(null)}},"setCurrentIdentity");y.testable(function(e){s=e},"setHistoryKey");function le(){return F}function de(e,t){if(Array.isArray(e)&&e.length<2){e=e[0]}if(Array.isArray(t)&&t.length<2){t=t[0]}if(Array.isArray(e)){if(Array.isArray(t)){if(e.length===t.length){e=e.sort();t=t.sort();return e.every(function(e,r){return e===t[r]})}return false}return false}return t===e}function pe(t,a){if(!t||t.treeNode!==a.treeNode){return false}for(var o=a.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){if(!o.noKey&&a.keys[o.level]!==t.keys[o.level]){return false}}if(n(t.appStates)){return n(a.appStates)}var i=r(Object.create(null),a.appStates,t.appStates);for(var u in i){var l=u===A?s:a.appStates[u];if(!de(l,t.appStates[u])){return false}}return true}function ce(e){return pe(F,e)}function fe(t,r,a){var o=Object.create(null);for(var i=t;i.level>0;i=e.mRoutingTree[i.parentRoute]){if(!i.noKey){o["keys"+i.level]=r[i.level]}}var s=!n(a);var u=t.sRouteName+(s?"query":"");if(s){o["query"]=a}return{route:u,parameters:o}}function ve(r){var n=fe(M.identity.treeNode,M.identity.keys,M.identity.appStates);if(!e.ghostapp){t.oRouter.navTo(n.route,n.parameters,r)}}function ge(t){if(!t||!M.identity){return}var r=function(r,n,a){a=n?n.getId():a;var o=e.componentRegistry[a];(o.methods.presetDisplayMode||Function.prototype)(t,r)};for(var n=M.identity.treeNode;n;n=n.parentRoute&&e.mRoutingTree[n.parentRoute]){if(n.componentId){r(E.componentsDisplayed[n.sRouteName]===1,null,n.componentId)}else{n.componentCreated.then(r.bind(null,false))}if(n.fCLLevel===0||n.fCLLevel===3){break}}}function ye(e){if(!M||M.identity){return Promise.resolve(e)}var t=E;for(var r=0;r>e;r--){if(t.backTarget===0){return Promise.resolve(e)}t=k[t.backTarget]}M.mode=e;while(ce(t.identity)){M.mode--;if(t.backTarget===0){return Promise.resolve(M.mode)}t=k[t.backTarget]}if(t.identity.treeNode.level===0){M.identity=t.identity;return Promise.resolve(M.mode)}return Ht(t.identity).then(function(e){if(!e){M.identity=t.identity;return Promise.resolve(M.mode)}if(ce(e.identity)){M.mode--;return ye(M.mode)}M.identity=e.identity;M.followUpNeeded=true;return Promise.resolve(M.mode)})}function me(t){var r;if(t){if(t.identity){t.identity.appStates[A]=s}if(M){if(t.identity){M={identity:t.identity,followUpNeeded:true,mode:M?M.mode:0};ge(t.displayMode)}return}if(t.identity&&ce(t.identity)){return}r=t.mode;if(r===1&&t.identity&&E.backTarget&&pe(k[E.backTarget],t.identity)){r=-1}M={identity:t.identity,mode:r};ge(t.displayMode)}else{r=1}M.followUpNeeded=M.identity&&r<0;if(M.identity||r===-1&&E.backTarget){e.oBusyHelper.setBusyReason("HashChange",!e.ghostapp,undefined,undefined,true);V.stop()}else{M=null}if(r>=0){ve(r===1)}else if(!e.ghostapp){return ye(r).then(function(e){window.history.go(e)})}}function he(e,t){e.text=e.headerTitle!==t&&t||"";if(K&&K.linkInfos.length>e.level){K.adjustNavigationHierarchy()}}function be(r,n){var a=Object.create(null);if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(a,r)}var o={treeNode:r};var u={treeNode:r,keys:F.keys.slice(0,r.level+1),appStates:a};var l;var d=ne(u).then(function(){var e=fe(r,F.keys,a);l=t.oRouter.getURL(e.route,e.parameters);a[A]=s;e=fe(r,F.keys,a);o.fullLink=t.oRouter.getURL(e.route,e.parameters)});n.push(d);o.navigate=function(t,n){if(e.oFlexibleColumnLayoutHandler&&!n){var o;for(var i=k[E.backTarget];i.backTarget>0&&!o;i=k[i.backTarget]){if(i.identity.treeNode===r){o=i.identity}}e.oFlexibleColumnLayoutHandler.adaptPreferredLayout(a,r,o)}e.oBusyHelper.setBusy(d.then(function(){return Me(u,false,t)}),undefined,undefined,true)};o.adaptBreadCrumbLink=function(e){d.then(function(){var t=i.getInstance();var r=t.hrefForAppSpecificHash?t.hrefForAppSpecificHash(l):"#/"+l;e.setHref(r)})};return o}function Ce(e,t){var r={title:P(t.treeNode.headerTitle||""),icon:t.treeNode.titleIconUrl||"",subtitle:P(t.treeNode.text),intent:e+t.fullLink};return r}function Ne(){var t=[];var r=[d];var n=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.hasNavigationMenuSelfLink(F);for(var a=n?F.treeNode:e.mRoutingTree[F.treeNode.parentRoute];a;a=e.mRoutingTree[a.parentRoute]){var o=be(a,r);t[a.level]=o}var i=Promise.all(r);var s=function(){e.oShellServicePromise.then(function(e){e.setHierarchy([]);i.then(function(r){var n=r[0];var a=[];for(var o=t.length-1;o>=0;o--){a.push(Ce(n,t[o]))}e.setHierarchy(a)})}).catch(function(){R.warning("No ShellService available")})};K={linkInfos:t,adjustNavigationHierarchy:s};s()}function Pe(){return K.linkInfos}function ke(t,r){var n=Object.create(null);var a=x(t);n.treeNode=e.mRoutingTree[a];n.appStates=r["?query"]||Object.create(null);n.keys=[""];for(var o=n.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){n.keys[o.level]=o.noKey?"":r["keys"+o.level]}return n}function Re(e){var t=F;if(M&&M.identity&&!M.followUpNeeded){F=M.identity}else{var r=e.getParameter("config");F=ke(r.name,e.getParameter("arguments"))}F.previousIdentity=t;F.componentsDisplayed=Object.create(null);F.componentsDisplayed[F.treeNode.sRouteName]=1;if(F.treeNode.level===0){Se=null}Ne()}function He(t,n){var a={identity:{treeNode:F.treeNode,keys:F.keys,appStates:r(Object.create(null),F.appStates)},mode:1};if(Array.isArray(n)&&n.length<2){n=n[0]}if(n){a.identity.appStates[t]=n}else{delete a.identity.appStates[t]}var o=W.getProcessFinished(true).then(function(){me(a)});e.oBusyHelper.setBusy(o,undefined,undefined,true);return o}var Se;function Te(t,r,n,a,o,i){var s=t.then(function(t){t.appStates=i||Object.create(null);var s;if(t.treeNode.fCLLevel===0||t.treeNode.fCLLevel===3){s=ne(t)}else{s=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(F,t)}if(!r&&o&&o.bIsCreate&&o.bIsDraft&&!o.bIsDraftModified){Se={index:k.length,path:a.getPath(),identity:t,displayMode:Ye()}}return s.then(function(){return Me(t,r,n)})});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}function Ie(t,r,n,a,o){if(!t||Array.isArray(t)&&t.length===0){return ut(r)}var i=Array.isArray(t)?t:[t];var s=i.length===1&&(!F||F.treeNode.level>0)&&f.analyseContext(i[0]);var u=s&&e.mEntityTree[s.entitySet];var l=u&&(u.level===1?["",s.key]:e.oApplicationProxy.getIdentityKeyForContext(i[0]));var d=l?Promise.resolve({treeNode:u,keys:l}):new Promise(function(e,t){var r=0,n;var a=function(){if(r==i.length){e(n)}else{var t=i[r];var o=_e(n,t,true,true);o.promise.then(function(e){r++;n=e;a()})}};a()});var p=!u||Ve(u);e.oBusyHelper.setBusy(d,undefined,undefined,p);return Te(d,r,n,i[0],a,o)}function Le(t,r,n,a){var o=_e(null,t,true,true);var i=o.promise;e.oBusyHelper.setBusy(i,undefined,undefined,o.willShowPlaceholder);return Te(i,r,n,t,a).then(Function.prototype,Function.prototype)}function Be(t){var n=t.getPath();if(!Se||Se.path!==n){if(n===F.treeNode.getPath(2,F.keys)&&t.getObject().HasActiveEntity){return e.oApplicationProxy.getSiblingPromise(n).then(function(e){var t={treeNode:F.treeNode,keys:["",f.analyseContext(e).key],appStates:F.appStates};return{identity:t,mode:1,displayMode:1}},function(){var t={treeNode:e.mRoutingTree.root,keys:[""],appStates:Object.create(null)};var r=ne(t);return r.then(function(){return{identity:t,mode:1,displayMode:1}})})}return null}var a;var o=function(e,t){return e!==a.identity.keys[t]};for(var i=Se.index+1;i<k.length;i++){a=k[i];if(!a.identity.treeNode||a.identity.treeNode.level<Se.identity.treeNode.level||Se.identity.keys.some(o)){return null}}var s=0;for(var u=E;u.iHashChangeCount!==Se.index;u=k[u.backTarget]){if(u.iHashChangeCount<Se.index){return null}s--}var l=k[Se.index].identity;var d={treeNode:l.treeNode,keys:l.keys,appStates:Object.create(null)};var p={identity:d,mode:s,displayMode:Se.displayMode};if(l.treeNode.fCLLevel===0||l.treeNode.fCLLevel===3){r(d.appStates,l.appStates);return Promise.resolve(p)}return e.oFlexibleColumnLayoutHandler.getSpecialDraftCancelPromise(F,l,d.appStates).then(function(){return p})}function Ae(e){return me.bind(null,e)}function xe(e){var t=o.getData();if(!t){if(!e){return}t={}}t.serializedBackOption=e&&{mode:e.mode,displayMode:e.displayMode,route:e.identity.treeNode.sRouteName,keys:e.identity.keys,appStates:e.identity.appStates};o.setData(t);o.save()}function De(t){var r=[];var n=Object.create(null);return e.oApplicationProxy.fillSiblingKeyPromise(F.treeNode,F.keys,r,t).then(function(e){return qe(e,n,r).then(function(){return{treeNode:e,keys:r,appStates:n}})})}function we(e,t){var r=1+e;return De(t).then(function(e){return V.makeQueuable(Me.bind(null,e,true,r,false))})}function Oe(t,n,a,o){var i=f.analyseContext(t);var s={keys:["",i.key],appStates:Object.create(null)};var u=o?s:V.makeQueuable(Me.bind(null,s,true,n,false));if(F.treeNode.level===1){s.treeNode=F.treeNode;r(s.appStates,F.appStates);return Promise.resolve(u)}if(a){a.keys.forEach(function(e){if(e){s.keys.push(e)}});s.treeNode=a.treeNode}if(s.treeNode===F.treeNode){r(s.appStates,F.appStates);return Promise.resolve(u)}var l=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(F,s);return l.then(function(){return u})}function Fe(t,r){if((t&&t.treeNode)!==r.treeNode){return Promise.resolve(false)}if(e.oFlexibleColumnLayoutHandler&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(t,r)){return Promise.resolve(false)}var n=true;var a=t.treeNode.sRouteName;for(var o=t.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){var i=o.noKey||t.keys[o.level]===r.keys[o.level];if(!i&&o.noOData){return Promise.resolve(false)}n=n&&i;if(o.noOData){a=o.parentRoute}}if(n){return Promise.resolve(true)}var s=e.mRoutingTree[a];var u=t.keys.slice(0,s.level+1);var l=r.keys.slice(0,s.level+1);var d=s.getPath(2,u);var p=s.getPath(2,l);return e.oApplicationProxy.areTwoKnownPathesIdentical(d,p,s.level===1,t,r)}function Ee(t){var r=k[E.backTarget];var n=-1;if(r&&(t.level===0||e.oFlexibleColumnLayoutHandler&&t.fCLLevel===0)){for(;r.backTarget>0&&r.identity.treeNode&&r.identity.treeNode.level>t.level;n--){r=k[r.backTarget]}}return r&&{candidateHash:r,candidateCount:n}}function Me(t,r,n,a){var o=Ee(t.treeNode);var i=Fe(o&&o.candidateHash.identity,t);var s=i.then(function(e){var i=e?o.candidateCount:0+!!r;var s={identity:t,mode:i,displayMode:n};if(a){return s}me(s)});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}function je(e){if(u){return ut(true)}var t=Ue();gt({title:t.dataLoadFailedTitle,text:t.dataLoadFailedText,description:"",viewLevel:e.fCLLevel});return Promise.resolve()}function Ue(){return{dataLoadFailedTitle:e.getText("ST_ERROR"),dataLoadFailedText:e.getText("ST_GENERIC_ERROR_LOAD_DATA_TEXT")}}function Ke(t,r,n,a){if(!r){return{treeNode:e.mRoutingTree.root,key:""}}var o=f.analyseContext(r);var i=t.level&&t.entitySet===o.entitySet?t:t.children.indexOf(o.entitySet)>=0&&e.mEntityTree[o.entitySet];if(i){return{treeNode:i,key:o.key}}if(n){var s=e.oAppComponent.getModel();var u=s.getMetaModel();var l=u.getODataEntitySet(o.entitySet);var d=u.getODataEntityType(l.entityType);var p;var c=t.children.some(function(t){i=e.mEntityTree[t];p=i.navigationProperty;if(!p){return false}var r=u.getODataAssociationEnd(d,p);return!!r&&r.multiplicity.endsWith("1")});if(c){return{treeNode:i,navigationProperty:p}}}if(a&&t.level>0){var v=e.mRoutingTree[t.parentRoute];return Ke(v,r,n,true)}}function ze(e,t,r,n){if(n.navigationProperty){return new Promise(function(a,o){var i=r.getModel();i.createBindingContext(n.navigationProperty,r,null,function(r){var i=r&&ze(e,t,r,{treeNode:n.treeNode,key:f.analyseContext(r).key});if(i){i.then(a,o)}else{o()}})})}var a=t.slice(0,n.treeNode.level);a.push(n.key);return Promise.resolve({treeNode:n.treeNode,keys:a})}function Ve(e){return E.componentsDisplayed[e.sRouteName]!==1&&(e.level>0||!e.componentId)&&(e.behaviour&&e.behaviour.getPlaceholderInfo())}function _e(t,r,n,a){var o=t&&t.treeNode||F&&F.treeNode||e.mRoutingTree.root;var i=t&&t.keys||F&&F.keys||[""];var s=Ke(o,r,n,a);var u=s&&s.treeNode;return u?{promise:ze(o,i,r,s),targetNode:u,willShowPlaceholder:Ve(u)}:{promise:Promise.reject()}}function qe(t,r,n){var a={treeNode:t,keys:n||F.keys.slice(0,t.level+1),appStates:r};if(t.fCLLevel===0||t.fCLLevel===3){return ne(a)}return e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(F,a)}function Qe(t,r){var n=_e({treeNode:e.mRoutingTree.root},t,false,true);var a=n.promise;var o=a.then(function(e){e.appStates=Object.create(null);if(e.treeNode===F.treeNode){Object.assign(e.appStates,F.appStates);var t={identity:e,mode:1,displayMode:1};if(r){return t}me(t);return null}var n=qe(e.treeNode,e.appStates);return n.then(Me.bind(null,e,true,1,r))});e.oBusyHelper.setBusy(o,undefined,undefined,n.willShowPlaceholder);return o}function Ge(t){var r;var n=0;for(r=E;r.backTarget>0&&(!r.identity||!r.identity.treeNode||r.identity.treeNode.level>t);n++){r=k[r.backTarget]}if(!p&&(n===0||!r.identity.treeNode||r.identity.treeNode.level>t)){window.history.go(-n-1);return Promise.resolve()}var a=-n||1;var o=Ct(t);var i={treeNode:o,keys:F.keys.slice(0,o.level+1),appStates:Object.create(null)};var s=qe(i.treeNode,i.appStates).then(function(){if(a<0&&(i.treeNode.fCLLevel===1||i.treeNode.fCLLevel===2)&&r.identity.treeNode===i.treeNode){for(;r.backTarget>0&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(r.identity,i);a--){r=k[r.backTarget];if(r.identity.treeNode!==i.treeNode){break}}}var t={identity:i,mode:a,displayMode:i.treeNode.isDraft?6:1};me(t)});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}var We;function Je(t,r,n,a){var o=e.mEntityTree[t];var i=e.componentRegistry[o.componentId];var s;if(r){s=L.createEmptyAppStateAsync(e.oAppComponent).then(function(e){e.setData(c.getStringifiable(r));e.save();return e.getKey()})}else{s=Promise.resolve()}var u=F?F.keys.slice(0,o.level):[""];u.push("-");a=a||Object.create(null);var l=qe(o,a,u);var d=Promise.all([s,l]).then(function(e){var t=e[0];if(t){a[B]=t}var r={treeNode:o,keys:u,appStates:a};We=n;if(ce(r)){var s={componentsDisplayed:E.componentsDisplayed,isNonDraftCreate:true};return Pt("-",s,i.oComponent)}else{var l=!F||!!(i&&i.nonDraftCreateContext);return Me(r,l,4)}});e.oBusyHelper.setBusy(d,undefined,undefined,true);return d}function Xe(t){var n=_e(null,t,false,false);var a=n.promise;var o=a.then(function(e){e.appStates=Object.create(null);r(e.appStates,F.appStates);delete e.appStates[B];var t={identity:e,mode:1};me(t)});e.oBusyHelper.setBusy(o,undefined,undefined,n.willShowPlaceholder);return o}function Ye(){var t=e.componentRegistry[F.treeNode.componentId];var r=t.utils.getTemplatePrivateModel();var n=r.getProperty("/objectPage/displayMode")||0;return n}function Ze(t,r,n,a,o){var i=F.keys.slice(0,t.level);i.push(r?n:"");var s=Object.create(null);var u=qe(t,s,i);var l=u.then(function(){var e={treeNode:t,keys:i,appStates:s};return Me(e,a,o)});e.oBusyHelper.setBusy(l,undefined,undefined,true);return l}function $e(t,r,n,a,o,i){var s;var u=true;for(var l=0;l<t.children.length&&!s;l++){var d=t.children[l];var p=e.mEntityTree[d];if(p[t.level?"navigationProperty":"sRouteName"]===r){s=p.sRouteName;u=!p.noKey}}var c=!s&&n&&t.embeddedComponents[n];if(c){for(var f=0;f<c.pages.length&&!s;f++){var v=c.pages[f];if(v.navigationProperty===r){s=t.sRouteName+"/"+n+"/"+r;u=!(v.routingSpec&&v.routingSpec.noKey)}}}if(s){var g=e.mRoutingTree[s];if(!i){i=Ye()}return Ze(g,u,a,o,i)}if(!n&&t.level>0){return $e(e.mRoutingTree[t.parentRoute],r,null,a,o,i)}return Promise.reject()}function et(t,r,n,a){var o=_e({treeNode:t},r,true,false);var i=o.promise;var s=i.then(function(e){e.appStates=Object.create(null);var t=qe(e.treeNode,e.appStates,e.keys);return t.then(Me.bind(null,e,a,n,false))});e.oBusyHelper.setBusy(s,undefined,undefined,o.willShowPlaceholder);return s}function tt(t,n){var a=e.oAppComponent.getModel();var o;var i=n.lastIndexOf("/");if(i>0){var s=n.substring(i);if(s.indexOf("(")<0){o=n.substring(0,i)}else{o=n}}else{o=n}var u=[];var l,d;var p;var c;var v=function(){p=p.substring(0,p.length-c.length-2);p=p.substring(0,p.lastIndexOf("/"));d=d&&e.mRoutingTree[d.parentRoute]};for(p=o;p&&(!d||d.level>0);v()){var g=f.analyseContextPath(p,a);c=g.key||"";if(!l){l=e.mEntityTree[g.entitySet];d=l}if(d){if(d.noOData||d.noKey||!d.isDraft){return null}u.push(c)}}if(!l){return null}u.push("");u.reverse();var y=l.getPath(2,u);if(!n.startsWith(y)){return null}var m={treeNode:l,keys:u,appStates:Object.create(null)};var b={identity:m,mode:0,displayMode:6};var C;if(l===F.treeNode){if(u.every(function(e,t){return e===F.keys[t]})){return null}r(m.appStates,F.appStates);C=Promise.resolve()}else{C=ne(m).then(function(){if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(m.appStates,l)}})}var N=function(r,n){var a=sap.ui.getCore().getMessageManager();var o=a.getMessageModel();var i=o.bindList("/");var s=t.aTargets;var u;i.getAllCurrentContexts().some(function(e){var t=e.getObject();var r=t.aTargets;if(s.length===r.length&&s.every(function(e){return r.indexOf(e)>=0})){u=t;return true}});if(u){var d=e.componentRegistry[l.componentId];var p=d.oControllerUtils;h.prepareForMessageHandling([u],p);h.navigateFromMessageTitleEvent(p,u,d.oComponent,false,y);return}n()};var P=C.then(function(){me(b);return true});e.oBusyHelper.setBusy(Promise.all([P,l.componentCreated]));e.oApplicationProxy.setNextFocus(N);return P}function rt(){return!!M}function nt(t){R.info("Navigate back");if(E.backTarget&&D(S.getPreviousHash()||"")!==D(E.hash)){e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true)}E.LeaveByBack=!E.forwardingInfo;if(E.LeaveByBack){E.backSteps=t}window.history.go(-t)}function at(r,n){r=D(r||"");R.info("Navigate to hash: "+r);if(r===E.hash){R.info("Navigation suppressed since hash is the current hash");return}E.targetHash=r;if(E.backTarget&&D(S.getPreviousHash()||"")===r){t.navigateBack();return}e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true);E.LeaveByReplace=n;if(n){t.oHashChanger.replaceHash(r)}else{t.oHashChanger.setHash(r)}}function ot(t,r,n,a){var o=r.then(function(e){t=O(t,e);if(a){E.backwardingInfo={count:a.count,index:a.index,targetHash:D(t)};nt(a.count)}else{at(t,n)}return t});e.oBusyHelper.setBusy(o,undefined,undefined,true);return o}function it(e,t,r){var n=k[E.backTarget];return n&&n.hash&&D(n.hash.split("?")[0])===D(t)&&{count:1,index:E.backTarget}}function st(){var t={treeNode:e.mRoutingTree.root,keys:[""],appStates:Object.create(null)};var r=ne(t);return r.then(function(){return t})}function ut(t){if(F.treeNode.level===0){return Promise.resolve()}var r=st();var n=r.then(function(e){Me(e,t)});e.oBusyHelper.setBusy(n,undefined,undefined,true);return n}function lt(t,r){var n=E.componentsDisplayed;var a=function(t){var a=e.componentRegistry[t.getId()];(a.methods.presetDisplayMode||Function.prototype)(r,n[a.route]===1)};for(var o=0;o<t.length;o++){var i=t[o];i.then(a)}}function dt(t,r,n,a){var o={};var i=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.getFCLAppStatesPromise(t,o);var s=oe(t,o,r);var u=(i?Promise.all([i,s]):s).then(w.bind(null,o));var l=it(a,r,n);var d=ot(r,u,a,l);e.oBusyHelper.setBusy(d,undefined,undefined,true);return d}function pt(e,t,r,n){if(typeof e==="string"){var a=e;var o=D(a);if(o==="/"){return ut(r)}var i=o.split("/");var s=i.length-1;var u=[];var l;switch(s){case 1:l=i[1].split("(")[0];break;default:l="";var d="";for(var p=0;p<s;p++){var c=i[p+1];var f=c.indexOf("(");if(f>0){c=c.substring(0,f)}l=l+d+c;d="/"}l=l.replace(b.getEmbeddedComponentsPatternDelimiter(),"/")}lt(u,n||0);return dt(l,a,s,r)}return Ie(e,r,n)}function ct(t,r){E.componentsDisplayed[t]=r;var n=e.mRoutingTree[t];var a=n.componentId;if(a){var o=e.componentRegistry[a];var i=o.utils.getTemplatePrivateModel();i.setProperty("/generic/isActive",r===1)}}function ft(r){var n,a,o,i,s,u=null,l,d;if(r){n=r.entitySet;a=r.text;u=r.icon;d=r.description}if(n){l=e.oAppComponent.getModel().getMetaModel();if(l){o=l.getODataEntitySet(n);i=l.getODataEntityType(o.entityType);s=i["com.sap.vocabularies.UI.v1.HeaderInfo"]}if(s&&s.TypeImageUrl&&s.TypeImageUrl.String){u=s.TypeImageUrl.String}}e.oTemplatePrivateGlobalModel.setProperty("/generic/messagePage",{text:a,icon:u,description:d});if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.displayMessagePage(r,E.componentsDisplayed)}else{var p=t.oRouter.getTargets();if(!e.ghostapp){p.display("messagePage")}for(var c in E.componentsDisplayed){ct(c,5)}}se(r)}function vt(){if(!n(U)){var e=null;for(var t=0;!e;t++){e=U[t]}U={};ft(e)}}function gt(t){if(e.oAppComponent.isDestroyed()){return}if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.hidePlaceholder();t.viewLevel=t.viewLevel||0;U[t.viewLevel]=t;var r=Promise.all([G,e.oPagesDataLoadedObserver.getProcessFinished(true)]);r.then(vt);r.then(e.oBusyHelper.setBusyReason.bind(null,"HashChange",false,undefined,undefined,true));return}e.oNavigationHost.hidePlaceholder();ft(t);e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true)}function yt(){var t=[];if(F){var r=F.componentsDisplayed||E.componentsDisplayed;for(var n in e.componentRegistry){var a=e.componentRegistry[n];if(r[a.route]===1){t.push(n)}}}return t.sort(function(t,r){return e.componentRegistry[t].viewLevel-e.componentRegistry[r].viewLevel})}function mt(){var t=[];for(var r in e.componentRegistry){t.push(r)}return t}function ht(e){return F.keys.slice(0,e+1)}function bt(){var t=F.treeNode.componentId;var r=e.componentRegistry[t];var n=!!r.nonDraftCreateContext;if(n){var a=Object.assign({},E);a.isNonDraftCreate=n;return a}return E}function Ct(t){return e.oApplicationProxy.getAncestralNode(F.treeNode,t)}function Nt(t,r){return t?new Promise(function(n,a){var o=L.getAppState(e.oAppComponent,t);o.done(function(e){var t=e.getData();if(t===undefined){a(undefined);return}if(r){t=c.deStringify(t)}n(t)});o.fail(a.bind(null,undefined))}):Promise.reject()}function Pt(t,r,n){var a=n.getId();var o=e.componentRegistry[a];var i=ht(o.viewLevel);var s=o.route;var u=r.componentsDisplayed[s];var l=u===1;var d=function(t){o.sCurrentBindingPath=t;var r=function(){o.utils.bindComponent(o.sCurrentBindingPath,l);if(a===F.treeNode.componentId){var r=Object.create(null);r.root=true;for(var n=F.treeNode;n.level>0;n=e.mRoutingTree[n.parentRoute]){r[n.sRouteName]=true;n.bindElement(e.oNavigationHost,null,true);if(n.contextTargets){for(var i=0;i<n.contextTargets.length;i++){var s=n.contextTargets[i];n.bindElement(s,null,false)}}}for(var u in e.mRoutingTree){if(!r[u]){var d=e.mRoutingTree[u];d.unbindElement(e.oNavigationHost,true);if(d.contextTargets){d.contextTargets.forEach(d.unbindElement)}}}}o.utils.refreshBinding();o.oStatePreserverPromise.then(function(e){e.applyAppState(t,l)});return(o.methods.onActivate||Function.prototype)(t,l)};var n=o.fnViewRegisteredResolve?o.viewRegistered.then(r):r()||Promise.resolve();return Promise.all([n,o.viewRegistered]).then(function(){o.aKeys=i;var e=o.reactivate;if(e){delete o.reactivate;e.then(function(e){e()})}})};E.componentsDisplayed[s]=1;if(r.isNonDraftCreate&&t==="-"){var p=e.mRoutingTree[s];var c=e.mRoutingTree[p.parentRoute];var f=c.getPath(2,i);var v=e.oAppComponent.getModel();var g=f?new Promise(function(t){var r={canonicalRequest:!e.bCreateRequestsCanonical};v.createBindingContext(f,null,r,t)}):Promise.resolve();return g.then(function(t){var r=t?p.navigationProperty:"/"+n.getEntitySet();var a=F.appStates[B];var i=Nt(a,true);var s=function(n){o.nonDraftCreateContext=We||o.nonDraftCreateContext||m.createNonDraft(t,r,v,n,e.oApplicationProxy.mustRequireRequestsCanonical());We=null;return d(o.nonDraftCreateContext.getPath())};return i.then(s,s)})}delete o.nonDraftCreateContext;return d(t)}function kt(e,t,r){return Pt(e,t,r).then(ue)}function Rt(t,r,n){var a={};if(r||n){var o=t.level;for(var i=0;i<o;i++){a[i]=e.oPaginatorInfo[i]}}e.oPaginatorInfo=a}function Ht(t){return e.oApplicationProxy.getAlternativeIdentityPromise(t)}var St=Object.create(null);function Tt(r,n){if(St[r.sRouteName]||e.oAppComponent.isDestroyed()){return}R.debug("Prepare host view for route "+r.sRouteName);var a=t.createHostView();St[r.sRouteName]=a;var o=t.oRouter.getViews();o.setView(r.sRouteName,a);var i=a.byId("host");Vt(i,r.sRouteName,n)}function It(t){var r=e.mRoutingTree;if(r[t]){R.debug("Start preloading of component for route "+t);Tt(r[t],true)}}function Lt(t){j=false;V.stop();W.startProcess();Re(t);Tt(F.treeNode);F.treeNode.display();if(e.oFlexibleColumnLayoutHandler){z=e.oFlexibleColumnLayoutHandler.handleBeforeRouteMatched(F)}}function Bt(){var e={isInitialNavigation:p,historicalEntries:[]};for(var t=E;t.iHashChangeCount>0;t=k[t.backTarget]){var n=t===E?F:t.identity;var a=n.treeNode&&{sRouteName:n.treeNode.sRouteName,keys:n.keys,appStates:n.appStates};e.historicalEntries.push(a)}o.setData(e);o.save();var i=F.appStates[A];if(i===s||!(i||E.backTarget||p)){return false}M=null;me({identity:{treeNode:F.treeNode,keys:F.keys,appStates:r(Object.create(null),F.appStates)},mode:1});return true}function At(){W.stopProcess();var r=D(t.oHashChanger.getHash()||"");var n;if(M&&M.followUpNeeded){if(M.identity){if(!ce(M.identity)){me();return}}else{var a=M.followUpNeeded;n=E;n.LeaveByBack=M.mode===-1;k.push(n);E={iHashChangeCount:n.iHashChangeCount+1,identity:F,hash:r,backTarget:n.LeaveByBack?k[n.backTarget].backTarget:n.iHashChangeCount,componentsDisplayed:Object.create(null)};M=null;me(a);return}}e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true);var o=F.treeNode.level;R.info("Route matched with hash "+r);if(E.backwardingInfo){n=E;n.identity=F.previousIdentity;delete F.previousIdentity;k.push(n);var i=n.iHashChangeCount+1;E={iHashChangeCount:i,forwardingInfo:{bIsProgrammatic:true,bIsBack:true,iHashChangeCount:i,targetHash:n.backwardingInfo.targetHash,componentsDisplayed:n.componentsDisplayed},backTarget:k[n.backwardingInfo.index].backTarget,componentsDisplayed:Object.create(null)}}if(E.forwardingInfo&&E.forwardingInfo.targetHash&&E.forwardingInfo.targetHash!==r){E.hash=r;var s=E.forwardingInfo.targetHash;delete E.forwardingInfo.targetHash;at(s,true);return}var u=false;for(var l=0;l<e.aStateChangers.length;l++){var d=e.aStateChangers[l];if(d.isStateChange(F.appStates)){u=true}}if(u){M=null;E.hash=r;if(!Bt()){V.start()}return}e.oTemplatePrivateGlobalModel.setProperty("/generic/routeLevel",o);var p=E.forwardingInfo;delete E.forwardingInfo;if(!p){p={componentsDisplayed:E.componentsDisplayed,isNonDraftCreate:!F.treeNode.isDraft&&F.keys[F.treeNode.level]==="-"};var c=E.iHashChangeCount;p.iHashChangeCount=c+1;var f=S.getDirection();if(M){p.bIsProgrammatic=!!M.identity;p.bIsBack=M.mode<0;if(p.bIsBack){E.backSteps=0-M.mode}p.bIsForward=!p.bIsBack&&f===H.Forwards;E.LeaveByReplace=M.mode===1}else{p.bIsProgrammatic=r===E.targetHash;p.bIsBack=!!(E.LeaveByBack||!p.bIsProgrammatic&&f===H.Backwards);p.bIsForward=!p.bIsBack&&f===H.Forwards;E.LeaveByReplace=p.bIsProgrammatic&&E.LeaveByReplace;if(!p.bIsProgrammatic&&F.previousIdentity&&F.previousIdentity.treeNode.level>0&&!F.previousIdentity.treeNode.isDraft){var v=F.treeNode!==F.previousIdentity.treeNode;for(var g=1;!v&&g<F.keys.length;g++){v=F.keys[g]!==F.previousIdentity.keys[g]}if(v){var y=e.componentRegistry[F.previousIdentity.treeNode.componentId];var m=y.oComponent.getModel("ui");if(m.getProperty("/editable")){y.utils.cancelEdit()}}}}E.LeaveByBack=p.bIsBack;n=E;n.identity=F.previousIdentity;delete F.previousIdentity;k.push(n);E={iHashChangeCount:p.iHashChangeCount,componentsDisplayed:Object.create(null)};if(n.LeaveByReplace){E.backTarget=n.backTarget}else if(p.bIsBack){var h=n.backTarget;for(var b=n.backSteps||1;b>0;b--){h=k[h].backTarget}E.backTarget=h}else{E.backTarget=c}}E.hash=r;var C=function(t){M=null;if(t){var r,a;if(pe(n.identity,t.identity)){r=E.backTarget&&k[E.backTarget];a=-1}else if(t.identity.treeNode.level===0){ut();return}else{r=t.identity;var o=E.backTarget&&k[E.backTarget];a=o&&o.treeNode===r.treeNode?-1:1}var i={identity:r,mode:a,displayMode:t.displayMode};me(i);return}if(Bt()){return}Rt(F.treeNode,p.bIsProgrammatic,p.bIsBack);if(e.oFlexibleColumnLayoutHandler){G=e.oFlexibleColumnLayoutHandler.handleRouteMatched(p)}else{G=F.treeNode.componentCreated.then(function(e){return kt(p.isNonDraftCreate?"-":F.treeNode.getPath(2,F.keys),p,e)})}e.oBusyHelper.setBusy(G,undefined,undefined,true);G.then(V.start)};if(p.bIsBack&&!(M&&M.identity)){e.oBusyHelper.setBusy(Ht(F).then(C),undefined,undefined,true)}else{C()}}function xt(){var t=Promise.all([z,Q.then(function(){return e.oStatePreserversAvailablePromise})]);var r=t.then(At,e.oBusyHelper.setBusyReason.bind(null,"HashChange",false,undefined,undefined,true));e.oBusyHelper.setBusy(r,undefined,undefined,true);Et()}function Dt(t){k.push(E);var r;var n;var a;if(t){p=t.isInitialNavigation;n=t.serializedBackOption;a=t.focus;for(var o=t.historicalEntries.length;o>0;o--){var i=t.historicalEntries[o-1];r={iHashChangeCount:k.length,backTarget:k.length-1};if(i){r.identity={treeNode:e.mRoutingTree[i.sRouteName],keys:i.keys,appStates:i.appStates}}k.push(r)}}else{r={iHashChangeCount:1,backTarget:0,identity:F};k.push(r)}_(r,n,a);xt()}function wt(){if(I()){Ot()}if(u&&!k.length){var e=F.appStates[A];var t=Nt(e);t.then(Dt,Dt);return}xt()}function Ot(){if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.hidePlaceholder()}else{e.oNavigationHost.hidePlaceholder()}}function Ft(){F={appStates:Object.create(null),keys:[]};gt({title:e.getText("ST_ERROR"),text:e.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:""});e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true)}function Et(){var t=function(e){if(!e.selectionInfo){return false}for(var t=1;t<=e.level;t++){if(e.selectionInfo.keys[t]!==F.keys[t]){return false}}return true};var r=function(e,t,r,n){if(e.selectionInfo===t){r.setProperty("/generic/currentActiveChildContext",n)}};for(var n,a=F.treeNode;a;a=n){n=a.parentRoute&&e.mRoutingTree[a.parentRoute];if(n){n.selectionInfo={pageEntitySet:a.entitySet,path:a.getPath(3,F.keys),keys:F.keys.slice(0,a.level+1)}}var o=a.componentId&&e.componentRegistry[a.componentId];if(o){var i=o.utils.getTemplatePrivateModel();if(t(a)){var s=a.selectionInfo;i.setProperty("/generic/currentActiveChildContext",s.path);if(o.oController.onChildOpenedExtension){o.oController.onChildOpenedExtension(s,r.bind(null,a,s,i))}}else{a.selectionInfo=null;i.setProperty("/generic/currentActiveChildContext","")}}}}t.oRouter.attachBeforeRouteMatched(Lt);t.oRouter.attachRouteMatched(wt);t.oRouter.attachBypassed(Ft);var Mt=[];function jt(e,r){t[e]=r;Mt.push(e)}function Ut(){Mt.forEach(function(e){t[e]=V.makeQueuable(t[e])});t.routerInitialized=Function.prototype}function Kt(e){Q=Promise.all([Q,e.componentCreated])}function zt(e,t){for(var r in t){var n=t[r];e.setModel(n,r||undefined)}}function Vt(t,n,a){R.debug("Create TemplateComponent for route "+n);var o=e.mRoutingTree[n];var i=o.page.component.name;var s=o.entitySet;var u=o.fCLLevel-(o.fCLLevel===3||!e.oFlexibleColumnLayoutHandler);var l=u<0?e.oNavigationObserver:e.aNavigationObservers[u];var d=new v;var p=u<0?e.oHeaderLoadingObserver:e.aHeaderLoadingObservers[u];p.addObserver(d);var c=new T;var f={appComponent:e.oAppComponent,isLeaf:!o.page.pages||!o.page.pages.length,entitySet:s,navigationProperty:o.navigationProperty,componentData:{registryEntry:{oAppComponent:e.oAppComponent,route:n,routeConfig:o.page,viewLevel:o.level,routingSpec:o.page.routingSpec,oNavigationObserver:l,oHeaderLoadingObserver:d,preprocessorsData:c}}};if(o.page.component.settings){r(f,o.page.component.settings)}e.oAppComponent.runAsOwner(function(){var r=e.oAppComponent.createId(f.componentData.registryEntry.routeConfig.component.name+"::"+f.componentData.registryEntry.routeConfig.entitySet);R.debug("Start to create component "+r+" for route "+n);var o=sap.ui.core.Component.create({name:i,settings:f,handleValidation:true,manifest:true,id:r});e.oAppComponent.registerForDestroy(o);return o.then(function(r){R.debug("Component for route "+n+" was created");if(a){zt(t,e.oAppComponent.oModels);t.setComponent(r);r.onBeforeRendering()}else{t.setComponent(r)}})})}function _t(){j=true}function qt(e){if(j){j=false;return false}if(M){return false}if(e.isCrossAppNavigation){return true}var r=t.oRouter.getRouteInfoByHash(e.innerAppRoute);var n=ke(r.name,r.arguments);return n.treeNode!==F.treeNode||n.keys.some(function(e,t){return e!==F.keys[t]})}function Qt(t){return t.isDraft?e.oApplicationProxy.getAncestralNode(t,1):t}function Gt(){if(F.treeNode.level===0){return false}var t=o.getData().historicalEntries;if(t.length===1||t[1].sRouteName==="root"){return true}if(t[0].keys.length===2&&t[1].keys.length===2){var r=[],n=[];t[0].keys[1].split(",").forEach(function(e){r.push(e.split("=")[0])});t[1].keys[1].split(",").forEach(function(e){n.push(e.split("=")[0])});if(JSON.stringify(r)===JSON.stringify(n)){return true}}var a=Qt(F.treeNode);var i=e.mRoutingTree[t[1].sRouteName];var s=Qt(i);return a!==s}t.routerInitialized=Ut;t.treeNodeFirstDisplay=Kt;t.navigate=at;jt("navigateBack",me.bind(null,{mode:-1}));t.activateOneComponent=Pt;t.afterActivation=ue;t.addUrlParameterInfoForRoute=oe;t.getApplicableStateForIdentityAddedPromise=ne;t.adaptAppStates=ae;t.setVisibilityOfRoute=ct;t.getActiveComponents=yt;t.getAllComponents=mt;t.getRootComponentPromise=Z;t.getActivationInfo=bt;t.getCurrentKeys=ht;t.getAppTitle=$;t.getParsedShellHashFromFLP=te;t.isDiscardDraftConfirmationNeeded=ee;jt("navigateByExchangingQueryParam",He);jt("navigateToSubContext",Ie);jt("navigateToDetailContextIfPossible",Le);t.getSwitchToSiblingFunctionPromise=we;t.getSwitchToSiblingPromise=Oe;t.getNavigationFunction=Ae;t.getSpecialDraftCancelOptionPromise=Be;t.getRootIdentityPromise=st;t.setBackNavigationOption=xe;t.getCurrentIdentity=le;jt("navigateToIdentity",Me);jt("navigateAfterActivation",Qe);jt("navigateUpAfterDeletion",Ge);jt("navigateForNonDraftCreate",Je);jt("adaptUrlAfterNonDraftCreateSaved",Xe);jt("navigateToChildInHierarchy",$e);jt("navigateFromNodeAccordingToContext",et);t.isNavigating=rt;t.getLinksToUpperLayers=Pe;t.setTextForTreeNode=he;jt("navigationContextNotFound",je);jt("navigateToMessageTarget",tt);t.clearHistory=V.makeQueuable(Y);t.suspend=J;t.restore=q.bind(null,false);t.leave=X;t.prepareHostView=Tt;t.preloadComponent=It;t.navigateToMessagePage=gt;t.getAppStateFromShell=Nt;t.userHasAcceptedDataLoss=_t;t.unwantedDataLossPossible=qt;t.isBackLeavingTheEditScope=Gt;var Vt=y.testable(Vt,"createTemplateComponent");var te=y.testable(te,"getParsedShellHashFromFLP");var It=y.testable(It,"preloadComponent");y.testable(function(e){t.createHostView=e},"setCreateHostView");y.testable(function(e){Tt=e},"setPrepareHostView");e.oBusyHelper.setBusy((te()||Promise.resolve()).then(function(t){var r=t&&t.parseParameters(document.location.search);e.bEnablePlaceholder=!(r&&r["sap-ui-xx-placeholder"]&&r["sap-ui-xx-placeholder"][0]==="false");b.generateRoutingStructure(e).then(q.bind(null,true))}),undefined,undefined,true);return{navigateToRoot:V.makeQueuable(ut),navigateToContext:V.makeQueuable(pt),navigateToMessagePage:gt,navigateBack:function(){t.navigateBack()}}}function E(e,t){var n=t.oAppComponent.getRouter();var a={oAppComponent:t.oAppComponent,oRouter:n,oHashChanger:n.getHashChanger(),oTemplateContract:t};t.oNavigationControllerProxy=a;var o=new Promise(function(e){a.initialize=function(t){n.initialize(t);e();a.routerInitialized()};a.fnInitializationResolve=e});t.oBusyHelper.setBusy(o,undefined,undefined,true);r(e,F(t,a))}var M=e.extend("sap.suite.ui.generic.template.lib.navigation.NavigationController",{metadata:{library:"sap.suite.ui.generic.template"},constructor:function(t){e.apply(this,arguments);y.testableStatic(E,"NavigationController")(this,t)}});M._sChanges="Changes";return M});
//# sourceMappingURL=NavigationController.js.map