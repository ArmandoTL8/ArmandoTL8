sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/ui/model/Sorter","sap/ui/core/MessageType","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/genericUtilities/controlHelper"],function(e,r,t,n,a,o){"use strict";function i(e,r,i){var s=Function.prototype;var u;var l;function f(){u=Object.create(null);if(l){for(var e in l){var r=l[e];r.destroy()}}l=Object.create(null)}function g(e,t){var n=Object.create(null);var a=function(e,r,t){if(t){n[t.getId()]=r}};t.controlId=r.oCommonUtils.getPositionableControlId(e,true,a);var i=[];var s,u;var l;for(var f=t.controlId&&o.byId(t.controlId);f;f=n[l]){l=f.getId();i.push(l);s=s||o.isObjectPageSection(f)&&f;u=u||o.isSmartTable(f)&&f}i.reverse();t.pathToControlId=i;t.groupers=s?[s]:[];if(s&&u){t.groupers.push(u);if(t.message.validation){t.getItemBindingPath=Function.prototype}else{var g=v(u);if(g){var c=r.oComponentUtils.getBindingPath();var d=g.presentationControlHandler.getBindingPath();var I=c+"/"+d;t.getItemBindingPath=function(){var e=t.message.aFullTargets.find(function(e){return e.startsWith(I)});if(!e){return null}var r=e.substring(I.length);var n=r.split("/")[0];return I+n}}else{t.getItemBindingPath=Function.prototype}}}else{t.getItemBindingPath=Function.prototype}}function c(e,r){var t=u[e];if(t){r=t.message;var n=!!t.controlId;r.controlIds.some(function(e){if(e===t.controlId){n=false}else if(!t.controlIds[e]){n=true;return true}});t=!n&&t}if(!t){r=r||a.getMessageById(e);var i=Object.create(null);r.controlIds.forEach(function(e){i[e]=o.byId(e)});t={message:r,controlIds:i};g(r.controlIds,t);u[e]=t}return t}function v(e){var r=e.getId();var t=l[r];if(!t){t=T(e);l[r]=t}return t}function d(e,r){var t=e.getTitleInfoForItem(r);return t&&t.title}function I(e,r){return r&&{label:e.table._getColumnLabel(r),hidden:!r.getVisible()}}function p(e,r){var t=e.table.getTable().getColumns();var n=t.find(function(e){var t=e.getLeadingProperty?e.getLeadingProperty():e.data("p13nData").leadingProperty;return t===r});return I(e,n)}function h(e,r){var t=e.columnInfo;if(t){var n=t[r];if(n){return n}}else{t=Object.create(null);e.columnInfo=t}var a=p(e,r);t[r]=a;return a}function m(e,r){var t=e.getItemBindingPath();var n=e.message.aFullTargets.find(function(e){return e.startsWith(t)});if(!n){return}var a=n.substring(t.length);if(a.startsWith("/")){a=a.substring(1)}if(!a||a.indexOf("(")>0){return}return h(r,a)}function b(e,r,t){var n=r&&r.getMessages();if(n&&n.length){var a=d(e.presentationControlHandler,r);n.forEach(function(r){var n=c(r.id,r);if(n.groupers[1]===e.table){var o={index:t<0?9999999:t,rowCurrentlyShown:t>=0,rowIdentifier:a,columnInfo:m(n,e)};e.messageToMsgInTableInfo[r.id]=o}})}}function T(e){var t=r.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e);var n=t.getBinding();if(!n){return null}var o=false;var i={table:e,presentationControlHandler:t,messageToMsgInTableInfo:Object.create(null)};var u=function(){if(o){return}var e=i.messageToMsgInTableInfo;i.messageToMsgInTableInfo=Object.create(null);var r=b.bind(null,i);var n=t.getCurrentContexts()||[];n.forEach(r);for(var u in e){if(!i.messageToMsgInTableInfo[u]){var l=e[u];var f=a.getMessageById(u);l.rowCurrentlyShown=f&&f.validation;i.messageToMsgInTableInfo[u]=l}}s()};i.tableLoaded=t.getUnbusyPromise().then(u);n.attachChange(u);e.attachUiStateChange(f);i.destroy=function(){o=true;n.detachChange(u);e.detachUiStateChange(f)};return i}function C(e){var t=c(e);var n=t.groupers;switch(n.length){case 0:return r.oCommonUtils.getText("GENERIC_MESSAGE_GROUP_NAME");case 1:return n[0].getTitle();default:var a=n[0].getTitle();var o=n[1];var i=o.getHeader();return r.oCommonUtils.getText("MESSAGE_GROUP_TABLE",[a,i])}}function y(e){switch(e){case n.Error:return 1;case n.Warning:return 2;case n.Success:return 3;case n.Information:return 4;case n.None:return 5;default:return 6}}function P(e,r,t){if(!r){return t?1:0}if(!t){return-1}return o.sortChildControls(e,r,t)}function M(e,r){var t=c(e.id);var n=c(r.id);var a=t.groupers.length===n.groupers.length&&t.groupers.every(function(e,r){return n.groupers[r]===e});if(a){var s=t.getItemBindingPath();var u=n.getItemBindingPath();if(s!==u){var l=t.groupers[1];var f=v(l);var g=f&&f.messageToMsgInTableInfo[e.id];var d=f&&f.messageToMsgInTableInfo[r.id];if(g&&d){if(g.index!==d.index){return g.index-d.index}}else if(g||d){return 1-2*!d}return(""+s).localeCompare(""+u)}var I=y(e.type)-y(r.type);if(I||!(t.controlId||n.controlId)){return I}}if(!a&&(t.groupers.length===1||n.groupers.length===1)&&t.groupers[0]===n.groupers[0]){return t.groupers.length-n.groupers.length}var p=t.pathToControlId;var h=n.pathToControlId;var m=Math.max(p.length,h.length);for(var b=0;b<m;b++){if(p[b]!==h[b]){if(b===0){return P(i,t.groupers[0],n.groupers[0])}return P(o.byId(p[b-1]),b<p.length&&o.byId(p[b]),b<h.length&&o.byId(h[b]))}}return 0}function O(e,r,t){e.read(r,{headers:{"sap-messages":"transientOnly"},canonicalRequest:false,error:t.bind(null,null),updateAggregatedMessages:false,success:function(n){var a=n&&e._getKey(n);var o=a?e.getContext("/"+a,r):null;t(o)}})}function S(e,r,t,n){return new Promise(function(r){var a=i.getModel();O(a,e,function(e){if(e){b(t,e,-1)}else{n.forEach(function(e){var r=c(e);var t=r.groupers[1];var n=t&&v(t);if(!n||n.messageToMsgInTableInfo[e]){return}n.messageToMsgInTableInfo[e]={index:9999999,rowCurrentlyShown:false,rowIdentifier:"",columnInfo:m(r,n)}})}r()})})}function w(e,t,n){var a=false;e.aFullTargets.some(function(o){if(o.startsWith(n)){r.oInfoObjectHandler.executeForAllInformationObjects("smartTable",function(r){if(!a){var i=n+r.getNavigationProperty();if(o===i||o.startsWith(i+"(")){a=true;var s=r.getId();var u=t[s];if(u){u.messages.push(e)}else{var l=[e];u={messages:l,promise:r.getControlAsync().then(function(e){var r=v(e);return r&&r.tableLoaded.then(function(){l.forEach(function(e){var r=c(e.id,e);if(!r.controlId){g([s],r)}})})})};t[s]=u}}}},true)}return a})}function x(e,r,t,n){f();var a=Object.create(null);r.forEach(function(e){var r=e.id;c(r,e);if(e.controlIds.length===0){w(e,a,n+"/")}});var o=[];for(var i in a){o.push(a[i].promise)}return Promise.all(o).then(function(){return E().then(function(n){var a=Object.create(null);var o=Object.create(null);r.forEach(function(e){a[e.id]=C(e.id);o[e.id]=U(e.id,e.additionalText)});t.setProperty("/messageToGroupName",a);t.setProperty("/messageToSubtitle",o);e.sort(n);s=function(){var e=t.getProperty("/heartBeat")||0;e++;t.setProperty("/heartBeat",e)};return{getSubtitle:U}})})}function E(){var e=[];for(var r in l){var t=l[r];if(t){e.push(t.tableLoaded)}}return Promise.all(e).then(j)}function B(e,r){var t=o.byId(e.controlIds[0]);var n=t.getBindingContext();var a=r.presentationControlHandler.getCurrentContexts()||[];var i=-1;a.some(function(e,r){if(e===n){i=r;return true}});var s=r.presentationControlHandler.getColumnForCell(t);var u={index:i,rowCurrentlyShown:true,rowIdentifier:d(r.presentationControlHandler,n),columnInfo:I(r,s)};r.messageToMsgInTableInfo[e.id]=u;return u}function j(){var e=[];var r=Object.create(null);var n=function(t){var n=c(t);var a=n.groupers[1];var o=a&&v(a);if(o){var i=n.message;var s=o.messageToMsgInTableInfo[t];if(!(s&&s.rowCurrentlyShown)){if(i.validation){B(i,o)}else{var u=n.getItemBindingPath();if(u){var l=r[u];if(l){l.push(t)}else{l=[t];r[u]=l;var f=S(u,a,o,l);e.push(f)}}}}}};for(var a in u){n(a)}return Promise.all(e).then(function(){var e=new t("");e.fnCompare=M;return e})}function H(e){var t="MSG_SUBTITLE_ROW";var n=[e.rowIdentifier];if(!e.rowCurrentlyShown){t+="_HIDDEN"}if(e.columnInfo){n.push(e.columnInfo.label);t+="_COLUMN";if(e.columnInfo.hidden){t+="_HIDDEN"}}return r.oCommonUtils.getText(t,n)}function U(e,r){var t=c(e);var n=t.groupers[1];if(!n){return r}var a=v(n);if(a){var o=a.messageToMsgInTableInfo[e];if(!o&&t.message.validation){o=B(t.message,a)}if(o&&o.rowIdentifier){return H(o)}}return r}return{getPrepareMessageDisplayPromise:x}}return e.extend("sap.suite.ui.generic.template.ObjectPage.controller.MessageSortingHandler",{constructor:function(e,t,n){r(this,i(e,t,n))}})});
//# sourceMappingURL=MessageSortingHandler.js.map