sap.ui.define(["sap/ui/base/Object","sap/ui/base/Event","sap/ui/core/mvc/ControllerExtension","sap/ui/model/Context","sap/ui/model/Filter","sap/m/MessageBox","sap/ui/generic/app/navigation/service/SelectionVariant","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/model/analytics/odata4analytics","sap/base/util/extend","sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/genericUtilities/ControlStateWrapperFactory","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/IconPool"],function(e,t,a,r,n,i,o,s,l,c,u,g,f,p,v,d,m,y,b){"use strict";var h="lib.CommonUtils";var C=new u(h).getLogger();function P(e,t,r){var n;var o=new m(e);var u=Object.create(null);function d(e){var t;if(s.isSmartTable(e)){t=e.getCustomToolbar()}else if(s.isSmartChart(e)){t=e.getToolbar()}if(t){var a=R(t);if(a&&a.annotatedActionIds){u[e.getId()]=JSON.parse(atob(a.annotatedActionIds))}if(a&&a.deleteButtonId){u[e.getId()].push({ID:a.deleteButtonId,RecordType:"CRUDActionDelete"})}if(a&&a.multiEditButtonId){u[e.getId()].push({ID:a.multiEditButtonId,RecordType:"CRUDActionMultiEdit"})}}}function P(e){var t=e.getId();if(!u[t]){d(e)}return u[t]||[]}function S(t){var a,r,n;a=e.getOwnerComponent().getModel().getMetaModel();r=a.getODataEntitySet(t);n=a.getODataEntityType(r.entityType);return n}function D(a){t.oApplication.attachControlToParent(a,e.getView())}function E(t,a,r){var n=function(e,t){if(e===t){return 0}var r=s.byId(e);var n=s.byId(t);if(!r){if(n){return 1}return e>t?1:-1}if(!n){return-1}if(a){var i=s.isTable(r);var o=s.isTable(n);if(i!==o){return i?1:-1}}var l=r.isFocusable();var c=n.isFocusable();if(l!==c){return l?-1:1}return e>t?1:-1};t=t.concat().sort(n);var i=e.getView();var o=t.find(function(e){var t;var a=r&&function(a){r(e,a,t);t=a};return s.isElementVisibleOnView(e,i,a)});return o}function A(a,r,n,i){return t.oApplication.getDialogFragmentForView(e.getView(),a,r,n,i)}function O(a,r,n,i,o){return t.oApplication.getDialogFragmentForViewAsync(e.getView(),a,r,n,i,o)}var I;function T(t,a,r){var n=e.getOwnerComponent();I=I||n.getModel("i18n").getResourceBundle();return I.getText(t,a,r)}function x(e,t,a,r){var n=a||e,i=t&&t!="|"?e+"|"+t:n;var o=T(i,r,true);if(!o&&i!=n){o=T(n,r)}return o}function M(t,a,r,n){var i=e.getOwnerComponent();var o=a.indexOf("::"+i.getEntitySet()+"--")+2;var s=a.substring(o,a.lastIndexOf("::")),s=s.replace(/--/g,"|").replace(/::/g,"|");return x(t,s,r,n)}function B(e,t){var t=t||e.getSelectionBehavior();if(t==="DATAPOINT"){return{dataPoints:e.getSelectedDataPoints().dataPoints,count:e.getSelectedDataPoints().count}}else if(t==="CATEGORY"){return{dataPoints:e.getSelectedCategories().categories,count:e.getSelectedCategories().count}}else if(t==="SERIES"){return{dataPoints:e.getSelectedSeries().series,count:e.getSelectedSeries().count}}}function R(e){var t={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(e){t[e.getKey()]=e.getValue()})}return t}function w(e){var a,r;var n=G(e,true);var i=t.oPresentationControlHandlerFactory.getPresentationControlHandler(n).getSelectedContexts();var o=n.getModel();H(i,o,n);a=P(n);for(var s=0;s<a.length;s++){r=a[s];F(r,o,i,n)}}function F(t,a,n,i){var o;if(t.RecordType==="CRUDActionDelete"){var s=L(a,n,i);r.getTemplatePrivateModel().setProperty("/listReport/deleteEnabled",s);o=Promise.resolve(s)}else if(t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){var l=a.getMetaModel();o=V(a,l,n,t.RecordType,t.Action,i)}else if(t.RecordType==="CRUDActionMultiEdit"){r.getTemplatePrivateModel().setProperty("/listReport/multiEditEnabled",n.filter(U).length>0)}var c=e.getView().byId(t.ID);if(c&&/generic\/controlProperties/.test(c.getBindingPath("enabled"))){o.then(k.bind(null,t.ID,"enabled"))}}function N(e){var a=W(e);H(t.oPresentationControlHandlerFactory.getPresentationControlHandler(a).getSelectedContexts(),e.getModel(),a)}function k(e,t,a){var n=r.getTemplatePrivateModel();var i=n.getProperty("/generic/controlProperties/"+e);if(!i){i={};i[t]=a;n.setProperty("/generic/controlProperties/"+e,i)}else{n.setProperty("/generic/controlProperties/"+e+"/"+t,a)}}function V(e,t,a,r,n,i){var o,l,c,u;var g=false;if(r==="com.sap.vocabularies.UI.v1.DataFieldForAction"){o=t.getODataFunctionImport(n);c=o&&o["sap:action-for"];if(c&&c!==""&&c!==" "){if(a.length>0){u=o["sap:applicable-path"];if(u&&u!==""&&u!==" "){for(var f=0;f<a.length;f++){if(!a[f]||a[f].isTransient()){continue}l=e.getObject(a[f].getPath());if(l&&l[u]){g=true;break}}}else{g=true}}}else{g=true}}else if(r==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(he(a).length>0){g=true}else if(s.isSmartChart(i)){return i.getChartAsync().then(function(){return i.getDrillStackFilters().length>0})}}return Promise.resolve(g)}function L(e,t,a){if(t.length===0){return false}var r=j(a);var n=r&&r.Deletable&&r.Deletable.Path;return t.some(function(t){var a=e.getObject(t.getPath()+"/DraftAdministrativeData");var r=!(a&&a.InProcessByUser&&!a.DraftIsProcessedByMe);return r&&!t.isTransient()&&!(n&&!e.getProperty(n,t))})}function j(e){var t=e.getModel()&&e.getModel().getMetaModel();var a=t&&t.getODataEntitySet(e.getEntitySet());var r=a&&a["Org.OData.Capabilities.V1.DeleteRestrictions"];return r}function U(e){var a=e.getModel();var r=a.getObject(e.getPath()+"/DraftAdministrativeData");var n=y.analyseContext(e);var i=t.oApplication.isObjectInEditMode(n.entitySet,n.key);if(!r&&!i){var o=a.getMetaModel().getODataEntitySet(y.analyseContext(e).entitySet);var s=o["Org.OData.Capabilities.V1.UpdateRestrictions"]&&o["Org.OData.Capabilities.V1.UpdateRestrictions"].Updatable;if(s){if(s.Path){return!!a.getProperty(s.Path,e)}else if(s.Bool!=="false"){return true}}else{return true}}}function H(t,a,n){var i=_(n);var o=r.getTemplatePrivateModel();var s=o.getProperty("/generic/listCommons/breakoutActionsEnabled");if(i){var l=e.byId("template::IconTabBar");var c="";if(l){c=l.getSelectedKey()}K(s,i,t,a,c,n)}o.setProperty("/generic/listCommons/breakoutActionsEnabled",s)}function K(e,t,a,r,n,i){var o;for(var l in t){o=true;var c=t[l].id+(n&&!t[l].determining?"-"+n:"");if(i&&i.getId().indexOf("AnalyticalListPage")>-1){o=!!e[c].enabled}if(t[l].requiresSelection){if(a.length>0){if(i&&s.isSmartChart(i)){if(t[l].filter==="chart"){o=true}}else if(i&&s.isSmartTable(i)){if(t[l].filter!=="chart"){o=true}}if(t[l].applicablePath!==undefined&&t[l].applicablePath!==""){o=false;for(var u=0;u<a.length;u++){var g="";var f=t[l].applicablePath.split("/");if(f.length>1){for(var p=0;p<f.length-1;p++){g+="/"+f[p]}}var v=r.getObject(a[u].getPath()+g);var d=f[f.length-1];if(v[d]===true){o=true;break}}}}else if(s.isSmartChart(i)){if(i.getId().indexOf("AnalyticalListPage")>-1?t[l].filter==="chart":true){if(i.getDrillStackFilters().length>0){o=true}else{o=false}}}else{if(t[l].filter!=="chart"){o=false}}}e[c]={enabled:o}}}function _(e){var t=r.getControllerExtensions();var a=R(e).sectionId;if(!a){return t&&t["Actions"]}else{return t&&t.Sections&&t.Sections[a]&&t.Sections[a].Actions}}function G(e,t){var a=[s.isSmartTable,s.isSmartChart,s.isSmartList];if(!t){a.push(s.isMTable);a.push(s.isUiTable)}var r=function(e,t){return t(e)};for(var n=e;n;n=n.getParent&&n.getParent()){var i=a.some(r.bind(null,n));if(i){return n}}return null}function W(e){var t=e;while(t){if(s.isSmartTable(t)||s.isSmartChart(t)||s.isSmartList(t)){return t}t=t.getParent&&t.getParent()}return null}function J(a){if(!t.oApplication.checkEtags(a)){var r=e.getOwnerComponent();var n=r.getModel();var i=n.getMetaModel().getODataEntitySet(a);if(e.getMetadata().getName()==="sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"&&z(n,i)){n.invalidateEntityType(i.entityType)}else{var o=function(e){return y.analyseContextPath(e,n).entitySet===a};n.invalidate(o)}var s=r.getId();var l=Object.create(null);l[s]=true;t.oApplication.refreshAllComponents(l);return true}return false}function z(e,t){var a=new g.Model(g.Model.ReferenceByModel(e));var r=a.findQueryResultByName(t.name);var n=r&&r.getParameterization();return!!n}function Y(a,n,i){var o;if(r.isDraftEnabled()){o=t.oDraftController.isActiveEntity(a)?1:6}else{var s=e.getOwnerComponent();o=s.getModel("ui").getProperty("/editable")?6:1}if(i){t.oApplication.setObjectInEditMode(true)}r.navigateAccordingToContext(a,o,n)}function q(e){if(e instanceof sap.ui.generic.app.navigation.service.NavError){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){i.show(T("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:T("ST_GENERIC_ERROR_TITLE"),icon:i.Icon.ERROR})}else{i.show(e.getErrorCode(),{title:T("ST_GENERIC_ERROR_TITLE"),icon:i.Icon.ERROR})}}}function Q(a,r){le(function(){n=t.oApplication.getNavigationHandler();var r={semanticObject:a.semanticObject,action:a.action};var i=n.mixAttributesAndSelectionVariant(a.parameters);if(typeof e.adaptNavigationParameterExtension==="function"){e.adaptNavigationParameterExtension(i,r)}me(a);t.oApplication.navigateExternal(a.semanticObject,a.action,i.toJSONString(),null,q)},Function.prototype,"LeaveApp")}function Z(t){var a=[],r,n,i;var o=e.getOwnerComponent();var s=o.getModel().getMetaModel();if(!t){return{}}var l=o.getAppComponent().getConfig().pages[0];if(!l){return{}}var c=function(e){i=s.getODataEntitySet(e.entitySet).entityType;n=s.getODataEntityType(i);r={};r={entitySet:e.entitySet,aKeys:s.getODataEntityType(i).key.propertyRef,navigationProperty:e.navigationProperty};for(var t=0,a=r.aKeys.length;t<a;t++){var o=0,l=n.property.length;for(o;o<l;o++){if(r.aKeys[t].name===n.property[o].name){r.aKeys[t].type=n.property[o].type;break}}}};var u=function(e,t){if(!t.pages){return a}for(var n=0,i=t.pages.length;n<i;n++){if(!t.pages[n]){break}if(e===t.pages[n].entitySet){c(t.pages[n]);a.splice(0,0,r);break}a=u(e,t.pages[n]);if(a.length>0){c(t.pages[n]);a.splice(0,0,r)}}return a};return u(t,l)}function X(e,t){var a,r,n,i;for(n=0,i=e.length;n<i;n++){if(e[n].navigationProperty){r+="/"+e[n].navigationProperty}else{r="/"+e[n].entitySet}for(var o=0,s=e[n].aKeys.length;o<s;o++){if(o===0){r+="(";a=""}else{a=","}switch(e[n].aKeys[o].type){case"Edm.Guid":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){r+=a+e[n].aKeys[o].name+"="+"guid'"+t.DraftAdministrativeData.DraftUUID+"'"}else{r+=a+e[n].aKeys[o].name+"="+"guid'"+t[e[n].aKeys[o].name]+"'"}break;case"Edm.Boolean":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){r+=a+e[n].aKeys[o].name+"="+false}else{r+=a+e[n].aKeys[o].name+"="+t[e[n].aKeys[o].name]}break;default:if(typeof t[e[n].aKeys[o].name]==="string"){r+=a+e[n].aKeys[o].name+"="+"'"+t[e[n].aKeys[o].name]+"'"}else{r+=a+e[n].aKeys[o].name+"="+t[e[n].aKeys[o].name]}break}if(o===s-1){r+=")"}}}return r}function $(e,a,r,i){var o,s,l,c,u,g,f;var p={semanticObject:"",action:""};var v=e.getParameters();n=t.oApplication.getNavigationHandler();o=n.mixAttributesAndSelectionVariant({},a);for(c in v.semanticAttributesOfSemanticObjects){for(l in v.semanticAttributesOfSemanticObjects[c]){if(!o.getSelectOption(l)){o.addParameter(l,"")}}u=o.getPropertyNames();p.semanticObject=c;g=o.getSelectOptionsPropertyNames();f=o.getParameterNames();for(var d=0,m=u.length;d<m;d++){if(g.indexOf(u[d])<0&&f.indexOf(u[d])<0){delete v.semanticAttributesOfSemanticObjects[c][u[d]];o.removeSelectOption(u[d])}}if(c===v.semanticObject){var y=v.semanticAttributesOfSemanticObjects[""];for(var b=0,m=f.length;b<m;b++){o.removeParameter(f[b]);if(!(f[b]in y)){var h=v.semanticAttributesOfSemanticObjects[v.semanticObject][f[b]];h=typeof h==="undefined"||h===null?"":String(h);o.addParameter(f[b],h)}}o=n.mixAttributesAndSelectionVariant(v.semanticAttributesOfSemanticObjects[c],o.toJSONString());o=ee(o,e.getSource(),i);r.adaptNavigationParameterExtension(o,p);s=o.toJSONString()}}delete v.semanticAttributes;n.processBeforeSmartLinkPopoverOpens(v,s)}function ee(t,a,r){var n;var i=[];var o=e.getOwnerComponent().getEntitySet();if(s.isSemanticObjectController(a)||s.isSmartTable(a)){n=a.getEntitySet()}else{var l=G(a);var c=l&&l.getParent();if(s.isSmartTable(c)){a=c;n=a.getEntitySet()}else{n=o}}i.push(n);var u=r&&r.oMultipleViewsHandler&&r.oMultipleViewsHandler.getMode&&r.oMultipleViewsHandler.getMode()==="multi";if(n!==o&&!u){i.push(o)}i.forEach(function(e){if(a){var r=a.getModel().getMetaModel();var n=r.getODataEntityType(r.getODataEntitySet(e).entityType);t.getPropertyNames().forEach(function(e){var a=r.getODataProperty(n,e);if(a&&(a["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"]&&a["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"].Bool!=="false"||a["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&a["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool!=="false")){t.removeSelectOption(e)}})}});return t}function te(a,r){var n=function(e){for(var t=0;t<e.length;t++){r(e[t].name)}};var i=e.getView().getModel().getMetaModel();var o=i.getODataEntitySet(a,false);var s=i.getODataEntityType(o.entityType,false);n(s.key.propertyRef);var l=t.oDraftController.getDraftContext();if(l.isDraftEnabled(a)){n(l.getSemanticKey(a));r("IsActiveEntity");r("HasDraftEntity");r("HasActiveEntity")}}function ae(t,a,r,n){if(n&&r&&r.getAnalyticBindingPath&&r.getConsiderAnalyticalParameters()){try{var i=r.getAnalyticBindingPath();var o=t.getEntitySet();var s=t.getModel();var c=s.getMetaModel();var u=c.getODataEntitySet(o);var g=e.getOwnerComponent();var f=g.getAppComponent();var p=l.getParametersByEntitySet(f.getModel(),o);if(c.getODataEntityType(u.entityType)["sap:semantics"]!=="aggregate"){if(a){var v=a(u,p);i=v||i}}if(i){n(i)}}catch(e){C.warning("Mandatory parameters have no values")}}}function re(e,a,r){for(var n=0;n<a.length;n++){var i=a[n];var o=i.lastIndexOf("/");var s;if(o<0){if(t.oApplication.getNavigationProperty(e,i)){s=i}else{continue}}else{s=i.substring(0,o)}if(r.indexOf(s)===-1){r.push(s)}}}function ne(t,n,i){var o=t.getParameter("bindingParams"),s=t.getSource().getId();o.parameters=o.parameters||{};o.parameters.transitionMessagesOnly=r.getNoStateMessagesForTables();var l=function(e,t,r){if(n&&n[e]){var i=true;var o=function(){var r=arguments[0];if(!(r instanceof a)){throw new v(h,"Please provide a valid ControllerExtension in order to execute extension "+e)}if(!i){throw new v(h,"Extension "+e+" must be executed synchronously")}var n=Array.prototype.slice.call(arguments,1);t.apply(null,n)};n[e](o,r);i=false}};var c=function(a){if(!s||e.byId(s)===t.getSource()){o.filters.push(a)}};if(n.addTemplateSpecificFilters){n.addTemplateSpecificFilters(o.filters)}l("addExtensionFilters",c,s);var u=t.getSource();if(e.getMetadata().getName()!=="sap.suite.ui.generic.template.ObjectPage.view.Details"){ae(u,n.resolveParamaterizedEntitySet,i,n.setBindingPath)}var g=u.getEntitySet();var f=o.parameters.select&&o.parameters.select.split(",")||[];var p=o.parameters.expand&&o.parameters.expand.split(",")||[];var d=function(a,r){if(a&&(!r||e.byId(r)===t.getSource())){var n=a.split(",");n.forEach(function(e){if(e&&f.indexOf(e)===-1){f.push(e)}})}};if(n.isMandatoryFiltersRequired){te(g,d)}l("ensureExtensionFields",d,s);(n.addNecessaryFields||Function.prototype)(f,d,g);re(g,f,p);if(p.length>0){o.parameters.expand=p.join(",")}if(f.length>0){o.parameters.select=f.join(",")}}function ie(e,t,a){if(!e){return T("DRAFT_OBJECT")}else if(t){return T(a?"LOCKED_OBJECT":"UNSAVED_CHANGES")}else{return""}}function oe(){return new Promise(function(e){var t;O("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var e=Array.prototype.slice.call(arguments,1);var t=arguments[0];if(!t){return""}if(e.length>0&&(e[0]===null||e[0]===undefined||e[0]==="")){if(e.length>3&&(e[3]===null||e[3]===undefined||e[3]==="")){return e.length>2&&(e[1]===null||e[1]===undefined||e[1]==="")?"":e[2]}else{return T(t,e[3])}}else{return T(t,e[0])}},closeDraftAdminPopover:function(){t.close()},formatDraftLockText:ie},"admin").then(function(a){t=a;e(t)})})}function se(e,a,r,n){return t.oDataLossHandler.performIfNoDataLoss(e,a,n,true,true)}function le(e,a,n,i){n=n||"LeavePage";if(r.isDraftEnabled()){return t.oPageLeaveHandler.performAfterDiscardOrKeepDraft(e,a,n,i,false)}else{return t.oDataLossHandler.performIfNoDataLoss(e,a,n,i,false)}}function ce(e,a){a=p({busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},a);var n,i;var o=new Promise(function(e,t){n=e;i=t});var s=a.busy.set?function(){t.oApplication.getBusyHelper().setBusy(o,false,{actionLabel:a.sActionLabel});return e()}:e;var l=a.mConsiderObjectsAsDeleted?function(e){t.oApplication.prepareDeletion(a.mConsiderObjectsAsDeleted);return s()}:s;var c=function(){var e;if(r.isDraftEnabled()){e=l()}else{e=a.dataloss.popup?le(l,i,null,a.dataloss.navigation?"LeavePage":"Proceed",true):l()}if(e instanceof Promise){e.then(n,i)}else{n(e)}};t.oApplication.performAfterSideEffectExecution(c,a.busy.check&&i);return o}function ue(e){var t=e.getId()+"-variant";var a=sap.ui.getCore().byId(t);var r=a.getDefaultVariantKey();return r===a.STANDARDVARIANTKEY?"":r}function ge(e){var t=e.getId()+"-variant";var a=sap.ui.getCore().byId(t);var r=a.getDefaultVariantKey();return r===a.STANDARDVARIANTKEY?"":r}function fe(t){var a;var n=r.getTemplatePrivateModel();var i=e.getOwnerComponent();var o,l,c,u,g,p=[],v=[],d,m,y,b,h,C,P;var S,D;o=i.getAppComponent();l=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");c=n.getProperty("/generic/supportedIntents/");if(s.isSmartChart(t)){a=t.getToolbar()}else if(s.isSmartTable(t)){a=t.getCustomToolbar()}u=a.getContent();g=u.length;for(d=0;d<g;d++){m=R(u[d]);if(m.hasOwnProperty("SemanticObject")&&m.hasOwnProperty("Action")){y=m.SemanticObject;b=m.Action;h={semanticObject:y,action:b,ui5Component:o};p.push([h]);C=f({},h);C.bLinkIsSupported=false;v.push(C)}}if(p.length>0&&l){P=l.getLinks(p);P.done(function(e){c=n.getProperty("/generic/supportedIntents/");S=e.length;for(d=0;d<S;d++){if(e[d][0].length>0){v[d].bLinkIsSupported=true}y=v[d].semanticObject;b=v[d].action;D=n.getProperty("/generic/supportedIntents/"+y);if(!D){c[y]={};c[y][b]={visible:v[d].bLinkIsSupported}}else if(!D[b]){D[b]={visible:v[d].bLinkIsSupported}}else{D[b]["visible"]=v[d].bLinkIsSupported}}n.updateBindings()})}}function pe(a,r){var n=r&&e.byId(r);var i=r&&!n?Promise.reject():new Promise(function(e,r){t.oApplication.performAfterSideEffectExecution(function(){var i=t.oApplication.getBusyHelper();if(i.isBusy()){r();return}if(n&&(!n.getVisible()||n.getEnabled&&!n.getEnabled())){r();return}var o=n?a(n):a();if(o instanceof Promise){o.then(e,r);i.setBusy(o)}else{e(o)}})});i.catch(Function.prototype);return i}function ve(e,a,n,i,o){var s,l={};if(!a){s=[]}else if(Array.isArray(a)){s=a}else{s=[a]}if(n){l.urlParameters=n}if(i&&i.bInvocationGroupingChangeSet){l.operationGrouping="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"}l.triggerChanges=r.isDraftEnabled();r.executeBeforeInvokeActionFromExtensionAPI(o);var c=t.oApplicationController.invokeActions(e,s,l);if(i&&i.bSetBusy){r.getBusyHelper().setBusy(c)}c.then(r.executeAfterInvokeActionFromExtensionAPI.bind(null,o));return c}function de(e){var a=t.oApplication.getChevronNavigationRefreshBehaviour(e);if(a!==Object.create(null)){t.oViewDependencyHelper.setRefreshBehaviour(a)}}function me(e){var a=t.oApplication.getComponentRefreshBehaviour(e);t.oViewDependencyHelper.setRefreshBehaviour(a)}function ye(e,t){var a=t.getModel();var r=t.getPath().split("/")[1];var n=a.oData[r];if(e){var i=n&&n[e]&&n[e].__ref;var o=a.oData[i];return o}else{return n}}function be(t,a){if(t&&t.__metadata){var n=t.__metadata.edit_media;var i=t.__metadata.content_type;var o=n&&new URL(n);var s=o&&o.pathname;var l=b.getIconForMimeType(i);var c={url:s,fileType:i,icon:l};var u=r.getTemplatePrivateModel();var g=e.getOwnerComponent().getEntitySet();if(!u.getProperty("/generic/controlProperties/fileUploader")){u.setProperty("/generic/controlProperties/"+"fileUploader",{})}if(a){u.setProperty("/generic/controlProperties/"+"fileUploader/"+a,c)}else{u.setProperty("/generic/controlProperties/"+"fileUploader/"+g,c)}}}function he(e){return e.filter(function(e){return!e||!e.isTransient()})}function Ce(t,a,r,n){var i=e.getOwnerComponent().getModel().getMetaModel();var o=l.getNavigationPropertyRelationship(i,t,a);var s=l.getNavigationPropertyRelationship(i,r,n);return o.relationship===s.relationship&&o.fromRole===s.toRole&&o.toRole===s.fromRole}function Pe(t){var a=t.getSource();return s.isButton(a)?a.data():sap.ui.getCore().byId(e.createId(R(a)["ActionId"])).data()}var H=c.testable(H,"fillEnabledMapForBreakoutActions");var G=c.testable(G,"getOwnerControl");var P=c.testable(P,"fnGetToolbarCustomData");var ee=c.testable(ee,"removePropertiesFromNavigationContext");return{getPositionableControlId:E,getMetaModelEntityType:S,getText:T,getSpecializedText:x,getContextText:M,getNavigationKeyProperties:Z,mergeNavigationKeyPropertiesWithValues:X,executeGlobalSideEffect:function(){if(r.isDraftEnabled()){var a=e.getView();var n=e.getOwnerComponent();var i=n.getAppComponent();var o=i.getForceGlobalRefresh();var l=n.getModel("ui");a.attachBrowserEvent("keydown",function(e){var n=e.target.type==="search";var i=e.target.type==="textarea";var c=e.target.id.indexOf("rowAction")>-1;var u=e.target.id.indexOf("ColumnListItem")>-1;if(e.keyCode===13&&e.ctrlKey!==true&&l.getProperty("/editable")&&!n&&!i&&!c&&!u){t.oApplication.addSideEffectPromise(new Promise(function(n,i){var l,c,u,g=false,f={draftRootContext:r.getMainComponentDetails().bindingContext,callPreparationOnDraftRoot:true};c=s.getControlWithFocus();while(c){if(s.isSmartField(c)){u=c.getBindingContext&&c.getBindingContext();if(u.isTransient&&u.isTransient()){return n()}}else if(s.isOverflowToolbar(c)||s.isButton(c)||s.isLink(c)||s.isMultiInputField(c)&&(c._sTypedInValue&&c._sTypedInValue.length>0)){g=true}else if(s.isSmartForm(c)){l=c;break}else if(s.isSmartTable(c)){break}c=c.getParent()}if(g){f={}}u=u||c&&c.getBindingContext&&c.getBindingContext()||a.getBindingContext();var p=l?l.check():Promise.resolve();p.then(function(){setTimeout(function(){var a=t.oApplicationController.executeSideEffects(u,null,null,o,f);a.then(function(){n();setTimeout(function(){var t=document.getElementById(e.target.id);if(t){t.focus()}})},i)})})}))}})}},setEnabledToolbarButtons:w,setEnabledFooterButtons:N,fillEnabledMapForBreakoutActions:H,getBreakoutActions:_,getSelectionPoints:B,getDeleteRestrictions:j,getSmartTableDefaultVariant:ue,getSmartChartDefaultVariant:ge,setPrivateModelControlProperty:k,removePropertiesFromNavigationContext:ee,navigateFromListItem:Y,navigateExternal:Q,semanticObjectLinkNavigation:$,getCustomData:function(e){var t=e.getSource().getCustomData();var a={};for(var r=0;r<t.length;r++){a[t[r].getKey()]=t[r].getValue()}return a},getCustomDataText:function(e){return new Promise(function(t,a){e.getCustomData().forEach(function(e){var a=e.getKey();if(a==="text"){var r=e.getBinding("value");var n=!r&&e.getBindingInfo("value");if(!r&&!n){t(e.getValue());return}var i=function(e){var a=e.getSource();a.detachChange(i);t(a.getExternalValue());return};if(r){if(!r.isInitial()){t(r.getExternalValue());return}r.attachChange(i)}else{n.events={change:i};for(var o=0;o<n.parts.length;o++){n.parts[o].targetType="string"}}}})})},onBeforeRebindTableOrChart:ne,formatDraftLockText:ie,showDraftPopover:function(e,t){oe().then(function(a){var r=a.getModel("admin");r.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));r.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));a.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(a.getBindingContext()){a.openBy(t)}else{a.getObjectBinding().attachDataReceived(function(){a.openBy(t)})}})},getContentDensityClass:function(){return t.oApplication.getContentDensityClass()},attachControlToView:D,getDialogFragment:A,getDialogFragmentAsync:O,fnProcessDataLossOrDraftDiscardConfirmation:le,processDataLossTechnicalErrorConfirmation:se,securedExecution:ce,getOwnerControl:G,getOwnerPresentationControl:W,refreshModel:J,getElementCustomData:R,triggerAction:function(a,r,n,i){t.oDataLossHandler.performIfNoDataLoss(function(){t.oCRUDManager.callAction({functionImportPath:n.Action,contexts:a,sourceControlHandler:i,label:n.Label,operationGrouping:""}).then(function(a){if(a&&a.length>0){var n=a[0];if(n.response&&n.response.context&&(!n.actionContext||n.actionContext&&n.response.context.getPath()!==n.actionContext.getPath())){t.oApplication.getBusyHelper().getUnbusy().then(t.oViewDependencyHelper.setMeToDirty.bind(null,e.getOwnerComponent(),r))}else if(n.context&&(!n.actionContext||n.actionContext&&n.context.getPath()!==n.actionContext.getPath())){t.oApplication.getBusyHelper().getUnbusy().then(t.oViewDependencyHelper.setMeToDirty.bind(null,e.getOwnerComponent(),r))}}})},Function.prototype,"Proceed",undefined,false)},checkToolbarIntentsSupported:fe,executeIfControlReady:pe,invokeActionsForExtensionAPI:ve,isContextEditable:U,setExternalChevronRefreshBehaviour:de,setComponentRefreshBehaviour:me,getStreamData:ye,setStreamData:be,getControlStateWrapper:o.getControlStateWrapper,filterActiveContexts:he,checkInverseNavigation:Ce,getCustomDataFromEvent:Pe,getControlStateWrapperById:o.getControlStateWrapperById,handleError:q}}return e.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,t,a){f(this,P(e,t,a))}})});
//# sourceMappingURL=CommonUtils.js.map