sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/extend","sap/suite/ui/generic/template/lib/MessageUtils","sap/ui/model/json/JSONModel"],function(e,t,n,r,o,i){"use strict";var a=new t({filters:[new t({path:"type",operator:n.EQ,value1:sap.ui.core.MessageType.Warning}),new t({path:"type",operator:n.EQ,value1:sap.ui.core.MessageType.Error})],and:false});var s=new t({path:"type",operator:n.EQ,value1:sap.ui.core.MessageType.Error});var u="model";function l(e,n,r,l){var c,f;var g;var p=function(){var t=n.getOwnerComponent();var r=e.componentRegistry[t.getId()];return!!(r.methods.showConfirmationOnDraftActivate&&r.methods.showConfirmationOnDraftActivate())}();function v(t){var n=e.oNavigationControllerProxy.getActiveComponents();var r;for(var o=0;o<n.length&&!r;o++){var i=n[o];var a=e.componentRegistry[i];r=a.viewLevel&&(a.methods.getScrollFunction||Function.prototype)(t)}return r||null}function m(p,m,y){var d=y&&y.messagesForUserDecison;var h,C;return r.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.MessageInfluencingCRUDAction",{onMessageSelect:function(){C.setProperty("/backbtnvisibility",true)},onBackButtonPress:function(){g.navigateBack();C.setProperty("/backbtnvisibility",false)},onAccept:function(){(c||Function.prototype)();h.close()},onReject:function(){(f||Function.prototype)();h.close()},isPositionable:function(e){return!!(e&&v(e))},titlePressed:function(e){h.close();var t=e.getParameter("item");var n=t.getBindingContext("msg").getObject();var r=v(n.controlIds);if(r){C.setProperty("/afterClose",r)}},afterClose:function(){c=null;f=null;C.setProperty("/messageToGroupName",Object.create(null));g.navigateBack();g.setModel(null,"msg");var e=C.getProperty("/afterClose");e()}},u,function(e){g=e.getContent()[0]}).then(function(c){h=c;C=h.getModel(u);var f=d?new i(d):sap.ui.getCore().getMessageManager().getMessageModel();g.setModel(f,"msg");C.setProperty("/situation",p);C.setProperty("/afterClose",Function.prototype);var v=a;var P=s;var M=n.getOwnerComponent().getModel("ui");var b=M.getProperty("/createMode");var w=g.getBinding("items");if(!d){var A=[];var E=e.oNavigationControllerProxy.getActiveComponents();var D=p<3;for(var F=0;F<E.length;F++){var O=E[F];var T=e.componentRegistry[O];if(T.oController===n||p!==2){var x=(T.methods.getMessageFilters||Function.prototype)(D);A=x?A.concat(x):A}}if(A.length===0){return null}v=A.length===1?A[0]:new t({filters:A,and:false})}if(p===3){P=new t({filters:[v,s],and:true});v=new t({filters:[v,a],and:true});var R;switch(m){case"Delete":R=r.getText("DELETE");break;case"BOPFAction":R=y.actionName;break;default:if(b){R=r.getText("CREATE")}else{R=r.getText("SAVE")}}C.setProperty("/CRUDAction",R);if(w.filter(P).getLength()===0){C.setProperty("/situation",4)}}w.filter(v);if(w.getLength()===0){return null}var B=w.getAllCurrentContexts().map(function(e){return e.getObject()});var S=o.getMessageDialogTitleAndSeverity(B,e);C.setProperty("/title",S.sTitle);C.setProperty("/messageType",S.sSeverity);return l(B,w,C).then(function(){return h})})}function y(e){return new Promise(function(t,n){var r;m(e?1:2).then(function(o){r=o;if(r){r.open();return n()}if(!(e&&p)){return t()}m(3).then(function(e){r=e;if(r){c=t;f=n;r.open()}else{t()}})})})}function d(t,n){e.oApplicationProxy.performAfterSideEffectExecution(function(){y(t).then(n)},true)}function h(t,n,r,o){c=t;f=n;return m(3,r,o).then(function(t){if(t){e.oBusyHelper.getUnbusy().then(function(){t.open()},function(){t.open()})}else{n()}})}function C(e,t,n,r,o){if(e===4){return h(t,n,r,o)}else{return d(e===1,t)}}function P(){return new Promise(function e(t){m(1).then(function(e){t(!!e)})})}return{handleCRUDScenario:C,hasValidationMessageOnDetailsViews:P}}return e.extend("sap.suite.ui.generic.template.lib.CRUDActionHandler",{constructor:function(e,t,n,o){r(this,l(e,t,n,o))}})});
//# sourceMappingURL=CRUDActionHandler.js.map