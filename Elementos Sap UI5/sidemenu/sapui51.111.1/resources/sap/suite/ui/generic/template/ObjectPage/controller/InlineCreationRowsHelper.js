sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/base/util/extend"],function(e,t,n){"use strict";function i(e,n,i){var r="@$ui5.context.isTransient";var a={creationRows:new Set,creationRowsHiddenInEditMode:new Set};var o={creationRows:"/editable",creationRowsHiddenInEditMode:"/createMode"};var c;var s=new Map;var d=new Set;var u=2;function l(){a.creationRows.clear();a.creationRowsHiddenInEditMode.clear()}function f(e){var t=e.data("isEntityCreatableUsingBooleanRestrictions"),n=e.data("isEntityCreatableUsingPathRestrictions");return t==="true"&&["true",true].includes(n)}function g(r){if(!n.oComponentUtils.isDraftEnabled()){return}var a=r.getSource();var o=a.getTable();if(t.isAnalyticalTable(o)||t.isTreeTable(o)){return}var c=i(a);var s=["creationRows","creationRowsHiddenInEditMode"].includes(c);if(!s){return}var d=e.getModel("ui");var u=r.getParameters().bindingParams;var l=u.events.dataReceived||Function.prototype;u.events.dataReceived=function(e){l.call(this,e);v(a,c,d)}}function v(e,t,n){var i=o[t];a[t].add(e.getId());if(n.getProperty(i)){C(e).then(function(t){p(e,t)})}if(!d.has(i)){n.bindProperty(i).attachChange(b.bind(null,t));d.add(i)}}function b(e,t){if(t.getSource().getValue()){var n=a[e];n.forEach(function(e){var t=sap.ui.getCore().byId(e);C(t).then(function(e){p(t,e)})})}}function p(e,t){var r=e.getTable();var o=i(e);var s=n.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e);var d=s.isMTable();var l=s.getBinding();var g=s.isLengthFinal();var v=f(e);if(l.isFirstCreateAtEnd()===undefined&&g&&l.getContext()&&v){var b;for(b=0;b<u;b++){R(l,t,d?b!==0:true)}a[o].delete(e.getId())}var p=y.bind(null,r);w(r,p);c=c||new Set;if(!c.has(l)){h(e,l);c.add(l)}}function h(e,t){t.attachCreateActivate(function(){C(e).then(function(n){R(t,n,true);y(e.getTable())})})}function R(e,t,n){e.create(t,n,{inactive:true})}function C(e){return new Promise(function(t){var i=n.oServices.oCRUDManager.getDefaultValues(e,null,true);if(i instanceof Promise){i.then(function(e){var n=e[0];t(n)}).catch(function(){t(null)})}else{t(null)}})}function w(e,t){var n;if(e.getDomRef()){t()}else{n=e.addEventDelegate({onAfterRendering:function(){t();e.removeEventDelegate(n)}})}}function y(e){if(t.isMTable(e)){P(e)}}function P(e){var t,n=e.getId(),i=e.getItems().filter(function(e){var t=e.getBindingContext().isTransient();var n=e.getBinding("type")&&e.getBinding("type").getPath()===r;return t&&!n});if(i.length===0){return}if(s.get(n)){t=s.get(n)}else{t=i.at(0).getProperty("type");s.set(n,t)}i.forEach(function(e){var n=E.bind(null,e,t);w(e,n)})}function E(e,t){var i=e.getDeleteControl();e.bindProperty("type",{path:r,formatter:function(e){return e?"Inactive":t}});i&&i.bindProperty("visible",{path:r,formatter:function(e){return!e}});var a=e.getBindingContext().created();a&&a.then(function(){e.isSelected()&&n.oCommonUtils.setEnabledToolbarButtons(e)})}function m(e){var t=n.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e),r=t.getBinding().isFirstCreateAtEnd()===undefined,a=i(e);if(a==="creationRows"){t.focusOnFirstTransientRow()}else if(a==="creationRowsHiddenInEditMode"){if(r){C(e).then(function(t){p(e,t)})}else{t.focusOnFirstTransientRow()}}}return{onBeforeRebindObjectPage:l,addCreationRowsImpl:p,onBeforeRebindControl:g,handleAddEntry:m}}return e.extend("sap.suite.ui.generic.template.ObjectPage.controller.InlineCreationRowsHelper",{constructor:function(e,t,r){n(this,i(e,t,r))}})});
//# sourceMappingURL=InlineCreationRowsHelper.js.map