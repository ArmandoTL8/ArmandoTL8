// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/theming/Parameters","sap/ui/Device","sap/ui/dom/units/Rem","sap/base/Log","sap/ushell/EventHub","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/ShellHeaderRenderer","sap/ushell/utils","sap/ushell/utils/WindowUtils"],function(e,t,i,a,r,o,n,s,l,h,d,u,p){"use strict";var g="sapUshellShellShowSearchOverlay";var f=0;var c;var y;var v=sap.ui.require.toUrl("sap/ushell/themes/base/img/SAPLogo.svg");var m=e.extend("sap.ushell.ui.ShellHeader",{metadata:{library:"sap.ushell",properties:{logo:{type:"sap.ui.core.URI",defaultValue:""},showLogo:{type:"boolean",defaultValue:true},homeUri:{type:"sap.ui.core.URI",defaultValue:"#"},searchState:{type:"string",defaultValue:"COL"},ariaLabel:{type:"string"},centralAreaElement:{type:"string",defaultValue:null},title:{type:"string",defaultValue:""}},aggregations:{headItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},headEndItems:{type:"sap.ui.core.Control",multiple:true},search:{type:"sap.ui.core.Control",multiple:false},appTitle:{type:"sap.ushell.ui.shell.ShellAppTitle",multiple:false}},associations:{shellLayout:{type:"sap.ui.base.ManagedObject",multiple:false}},events:{searchSizeChanged:{}}},renderer:d});m.prototype.setHomeUri=function(e){if(p.hasInvalidProtocol(e)){o.fatal("Tried to set a URL with an invalid protocol as the home uri. Setting to an empty string instead.",null,"sap/ushell/ui/ShellHeader");e=""}return this.setProperty("homeUri",e)};m.prototype.getShellLayoutControl=function(){return t.byId(this.getShellLayout())};m.prototype.createUIArea=function(){var e=window.document.getElementById("shell-hdr");if(!e){window.document.body.insertAdjacentHTML("afterbegin",'<div id="shell-hdr" class="sapContrastPlus sapUshellShellHead"></div>');this.placeAt("shell-hdr")}};m.prototype.SearchState={COL:"COL",EXP:"EXP",EXP_S:"EXP_S"};m.prototype.init=function(){a.media.attachHandler(this.invalidate,this,a.media.RANGESETS.SAP_STANDARD_EXTENDED);a.resize.attachHandler(this.refreshLayout,this);n.once("ShellNavigationInitialized").do(function(){sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(e){this._rerenderLogoNavigationFilterBound=this._rerenderLogoNavigationFilter.bind(this,e);e.registerNavigationFilter(this._rerenderLogoNavigationFilterBound);this._rerenderLogoNavigationFilterBound.detach=function(){e.unregisterNavigationFilter(this._rerenderLogoNavigationFilterBound)}}.bind(this))}.bind(this))};m.prototype.exit=function(){a.media.detachHandler(this.invalidate,this,a.media.RANGESETS.SAP_STANDARD_EXTENDED);a.resize.detachHandler(this.refreshLayout,this);var e=window.document.getElementById("shell-hdr");if(e){e.parentElement.removeChild(e)}if(this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter){this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter.detach()}};m.prototype.setFocusOnShellHeader=function(e){if(e){var t=this.getHeadEndItems();if(t.length>0){t[t.length-1].focus()}else{this.getAppTitle().focus()}}else{var i=this.getHeadItems();if(i.length>0){i[0].focus()}else{this.getAppTitle().focus()}}};m.prototype.onsapspace=function(e){if(e.target===this.getDomRef("logo")){this._setLocationHref(e.target.href)}};m.prototype._setLocationHref=function(e){if(p.hasInvalidProtocol(e)){o.fatal("Tried to navigate to URL with an invalid protocol. Preventing navigation.",null,"sap/ushell/ui/ShellHeader");return}window.location.href=e};m.prototype.onAfterRendering=function(){var e=this.getDomRef();if(!c&&e.parentElement.getBoundingClientRect().height>0){e.style.visibility="hidden";e.style.height="2.75rem";return}this.refreshLayout()};m.prototype.onThemeChanged=function(e){var t=false;if(c!==e.theme){c=e.theme;t=true}if(y!==this.getLogo()){y=this.getLogo();t=true}if(t){this.invalidate()}};m.prototype.getLogo=function(){if(this.getProperty("logo")!==""){return this.getProperty("logo")}var e=i.get({name:"sapUiGlobalLogo",callback:function(){this.invalidate()}});if(e==="none"){return v}if(e){var t=/url[\s]*\('?"?([^'")]*)'?"?\)/.exec(e);if(t){return t[1]}}return undefined};m.prototype.refreshLayout=function(){if(!this.getDomRef()){return}this._setAppTitleFontSize();this._adjustAppTitleTooltip();if(this.getSearchVisible()){var e=this.getDomRef("hdr-search");e.style.display="none";this._hideElementsForSearch();e.style.display="";e.style["max-width"]=f+"rem";this.fireSearchSizeChanged({remSize:r.fromPx(e.getBoundingClientRect().width),isFullWidth:this.isPhoneState()||this.getDomRef("hdr-end").style.display==="none"})}};m.prototype._setAppTitleFontSize=function(){if(this.isExtraLargeState()){return}var e=this.getDomRef("hdr-begin"),t=window.document.getElementById("shellAppTitle"),i="sapUshellHeadTitleWithSmallerFontSize";if(e&&t){t.classList.remove(i);t.style.overflow="visible";var a=e.getBoundingClientRect(),r=a.x+a.width,o=t.getBoundingClientRect(),n=o.x+o.width;if(n>r){t.classList.add(i)}t.style.overflow=""}};m.prototype._adjustAppTitleTooltip=function(){var e=t.byId("shellAppTitle");if(e){var i=e.getDomRef("button");var a=i&&i.firstChild;if(a){var r;var o=s.last("/core/shell/model/currentState/stateName");var n=s.last("/core/services/allMyApps/enabled");var l=(o==="app"||o==="home")&&n;var d=t.byId(e.getNavigationMenu());var u=d&&d.getItems()&&d.getItems().length>0;if(l||u){r=h.i18n.getText("shellNavMenu_openMenuTooltip")}else{var p=a.offsetWidth<a.scrollWidth;r=p?e.getText():null}if(e.getTooltip()!==r){e.setTooltip(r)}}}};m.prototype.removeHeadItem=function(e){if(typeof e==="number"){e=this.getHeadItems()[e]}this.removeAggregation("headItems",e)};m.prototype.addHeadItem=function(e){this.addAggregation("headItems",e)};m.prototype.isExtraLargeState=function(){return a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD_EXTENDED).from===1440};m.prototype.isPhoneState=function(){var e=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;var t=this.getDomRef().getBoundingClientRect().width>f;return a.system.phone||e==="Phone"||!t};m.prototype.setSearchState=function(e,t,i){if(this.SearchState[e]&&this.getSearchState()!==e){if(typeof t==="boolean"){i=t;t=undefined}this.setProperty("searchState",e,false);var a=e!=="COL";var r=this.getShellLayoutControl();if(r){r.toggleStyleClass(g,a&&i)}f=a?t||35:0}};m.prototype._hideElementsForSearch=function(){if(this.isExtraLargeState()){return}var e,t=this.getDomRef("hdr-search-container"),i=this.getDomRef("hdr-begin"),a=this.getDomRef("hdr-center"),o=this.getDomRef("hdr-end");if(this.getSearchState()==="EXP"||this.isPhoneState()){e=r.toPx(f+3)}else{e=r.toPx(9+.5)}var n=[i];Array.prototype.forEach.call(i.childNodes,function(e){n.unshift(e)});if(a){n.unshift(a)}i.style.flexBasis="";o.style.display="";n.forEach(function(e){if(e.getAttribute("id")==="shellAppTitle"){e.classList.remove("sapUiPseudoInvisibleText")}else{e.style.display=""}});var s;for(var l=0;l<n.length;l++){s=n[l];if(e>t.getBoundingClientRect().width){if(s.getAttribute("id")==="shellAppTitle"){s.classList.add("sapUiPseudoInvisibleText")}else{s.style.display="none";if(a&&l===0){i.style.flexBasis="auto"}}}else{return}}if(r.toPx(f)>t.getBoundingClientRect().width){o.style.display="none"}};m.prototype.getSearchWidth=function(){return f};m.prototype.isHomepage=function(){var e=window.hasher&&"#"+window.hasher.getHash()||"";var t=new RegExp("[?]"+"(?:"+"(?!&[/])."+")*");var i=e.replace(t,"");return u.isRootIntent(i)||i==="#Launchpad-openFLPPage"};m.prototype._rerenderLogoNavigationFilter=function(e,t,i){var a=e.hashChanger.isInnerAppNavigation(t,i);if(a){this.invalidate()}return e.NavigationFilterStatus.Continue};m.prototype.getSearchVisible=function(){return this.getSearchState()!==this.SearchState.COL};m.prototype.getCentralControl=function(){return t.byId(this.getCentralAreaElement())};m.prototype.setNoLogo=function(){this.setLogo(undefined)};m.prototype._getLeanMode=function(){return sap.ushell.Container.getRenderer().getSapUshellConfigParam()==="lean"};return m});
//# sourceMappingURL=ShellHeader.js.map