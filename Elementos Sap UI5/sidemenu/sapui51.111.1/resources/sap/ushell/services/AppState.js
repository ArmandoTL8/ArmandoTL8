// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/Object","sap/ui/thirdparty/jquery","sap/ushell/services/_AppState/AppState","sap/ushell/services/_AppState/AppStatePersistencyMethod","sap/ushell/services/_AppState/Sequentializer","sap/ushell/services/_AppState/SequentializingAdapter","sap/ushell/services/_AppState/WindowAdapter","sap/ushell/utils"],function(e,jQuery,t,n,i,s,a,r){"use strict";function o(e){return r.isDefined(e)&&r.isDefined(e.transient)?!!e.transient:true}function p(e,t,n,i){this._oConfig=i&&i.config;this._sSessionKey="";this._oAdapter=new s(e);this._oAdapter=new a(this,this._oAdapter,i)}p.prototype._getSessionKey=function(){if(!this._sSessionKey){this._sSessionKey=this._getGeneratedKey()}return this._sSessionKey};p.prototype.getAppState=function(e){var n=new jQuery.Deferred,i=this,s;this._loadAppState(e).done(function(e,a,r,o){s=new t(i,e,false,a,undefined,undefined,undefined,r,o);n.resolve(s)}).fail(function(){s=new t(i,e);n.resolve(s)});return n.promise()};p.prototype._getGeneratedKey=function(e){var t=r.generateRandomKey();if(e){t=("TAS"+t).substring(0,41)}else{t=("AS"+t).substring(0,40)}return t};p.prototype.createEmptyAppState=function(i,s,a,r){var p;var d="";var f="";var u=s||o(this._oConfig);var c=this._getGeneratedKey(u);if(a!==undefined&&!this.isPersistencyMethodSupported(a)){a=undefined;r=undefined}if(i){if(!e.isA(i,"sap.ui.core.UIComponent")){throw new Error("oComponent passed must be a UI5 Component")}if(i.getMetadata&&i.getMetadata()&&typeof i.getMetadata().getName==="function"){d=i.getMetadata().getName()||""}if(!d&&i.getMetadata&&i.getMetadata().getComponentName){d=i.getMetadata().getComponentName()}if(i.getMetadata&&i.getMetadata()&&typeof i.getMetadata().getManifest==="function"&&typeof i.getMetadata().getManifest()==="object"&&typeof i.getMetadata().getManifest()["sap.app"]==="object"){f=i.getMetadata().getManifest()["sap.app"].ach||""}}if(u===true){a=r=undefined}else if(a===undefined&&this.isPersistencyMethodSupported(n.PersonalState)){a=n.PersonalState;r=undefined}p=new t(this,c,true,undefined,d,f,u,a,r);return p};p.prototype.createEmptyUnmodifiableAppState=function(){var e=this._getGeneratedKey(),n;n=new t(this,e,false);return n};p.prototype._saveAppState=function(e,t,i,s,a,p,d){var f=this._getSessionKey(),u=r.isDefined(a)?a:o(this._oConfig);if(u){p=undefined;d=undefined}else if(p!==undefined){if(!this.isPersistencyMethodSupported(p)){if(this.isPersistencyMethodSupported(n.PersonalState)){p=n.PersonalState}else{p=undefined}d=undefined}}return this._oAdapter.saveAppState(e,f,t,i,s,u,p,d)};p.prototype._loadAppState=function(e){return this._oAdapter.loadAppState(e)};p.prototype.deleteAppState=function(e){return this._oAdapter.deleteAppState(e)};p._getSequentializer=function(){return new i};p.prototype.getSupportedPersistencyMethods=function(){if(this._oAdapter.getSupportedPersistencyMethods){return this._oAdapter.getSupportedPersistencyMethods()}return[]};p.prototype.isPersistencyMethodSupported=function(e){var t=this.getSupportedPersistencyMethods();if(t.length>0&&e!==undefined){return t.indexOf(e)>=0}return false};p.prototype.setAppStateToPublic=function(e){var t=d(e,"sap-xapp-state"),i=d(e,"sap-iapp-state"),s=(new jQuery.Deferred).resolve(),a=(new jQuery.Deferred).resolve(),r=new jQuery.Deferred,o,p;if(t!==undefined){s=this.makeStatePersistent(t,n.PublicState).done(function(n){if(t!==n){e=e.replace(t,n);o=n}}).fail(r.reject)}if(i!==undefined){a=this.makeStatePersistent(i,n.PublicState).done(function(t){if(i!==t){e=e.replace(i,t);p=t}}).fail(r.reject)}jQuery.when(s,a).done(function(){r.resolve(e,t,i,o,p)});return r.promise()};function d(e,t){var n=new RegExp("(?:"+t+"=)([^&/]+)"),i=n.exec(e),s;if(i&&i.length===2){s=i[1]}return s}p.prototype.makeStatePersistent=function(e,t,n){var i=new jQuery.Deferred;if(this.getSupportedPersistencyMethods().length===0){return i.resolve(e)}if(this.isPersistencyMethodSupported(t)){this.getAppState(e).done(function(s){if(s._iPersistencyMethod!==t){s.bTransient=false;s._iPersistencyMethod=t;s._oPersistencySettings=n;if(e.startsWith("TAS")){e=e.substring(1,e.length)}this._saveAppState(e,s._sData,s._sAppName,s._sACHComponent,false,t,n).done(function(){i.resolve(e)}).fail(i.reject)}else{i.resolve(e)}}.bind(this)).fail(i.reject)}else{i.reject("AppState.makeStatePersistent - adapter does not support persistence method: "+t)}return i.promise()};p.WindowAdapter=a;p.hasNoAdapter=false;return p},true);
//# sourceMappingURL=AppState.js.map