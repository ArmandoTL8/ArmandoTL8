/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/IntentBasedNavigation","sap/fe/core/controllerextensions/InternalIntentBasedNavigation","sap/fe/core/controllerextensions/InternalRouting","sap/fe/core/controllerextensions/KPIManagement","sap/fe/core/controllerextensions/MassEdit","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/Share","sap/fe/core/controllerextensions/SideEffects","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/EditState","sap/fe/core/helpers/MessageStrip","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/fe/core/PageController","sap/fe/macros/chart/ChartUtils","sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/filter/FilterUtils","sap/fe/templates/ListReport/ExtensionAPI","sap/fe/templates/TableScroller","sap/ui/core/mvc/OverrideExecution","sap/ui/Device","sap/ui/mdc/p13n/StateUtil","sap/ui/thirdparty/hasher","./ListReportTemplating","./overrides/IntentBasedNavigation","./overrides/Share","./overrides/ViewState"],function(e,t,i,n,r,o,a,s,l,u,g,d,c,p,h,f,C,b,y,P,_,v,m,w,A,B,I,S,V,T,F,x,E,M){"use strict";var D,R,O,L,N,z,k,H,j,U,K,$,J,q,W,X,G,Q,Y,Z,ee,te,ie,ne,re,oe,ae,se,le,ue,ge;var de=S.system;var ce=p.usingExtension;var pe=p.publicExtension;var he=p.privateExtension;var fe=p.finalExtension;var Ce=p.extensible;var be=p.defineUI5Class;function ye(e,t,i,n){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function Pe(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function _e(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;ve(e,t)}function ve(e,t){ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return ve(e,t)}function me(e,t,i,n,r){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o);if(r&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(r):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function we(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}const Ae=y.TemplateContentView,Be=y.InitialLoadMode;let Ie=(D=be("sap.fe.templates.ListReport.ListReportController"),R=ce(a.override({onAfterBinding:function(){this.getView().getController()._onAfterBinding()}})),O=ce(o.override({getEntitySet:function(){return this.base.getCurrentEntitySet()}})),L=ce(d),N=ce(r.override(x)),z=ce(g.override(E)),k=ce(c.override(M)),H=ce(s),j=ce(u),U=ce(l),K=pe(),$=fe(),J=he(),q=Ce(I.After),W=pe(),X=Ce(I.After),G=pe(),Q=Ce(I.After),Y=pe(),Z=Ce(I.After),D(ee=(te=function(r){_e(o,r);function o(){var t;for(var i=arguments.length,n=new Array(i),o=0;o<i;o++){n[o]=arguments[o]}t=r.call(this,...n)||this;ye(t,"_routing",ie,Pe(t));ye(t,"_intentBasedNavigation",ne,Pe(t));ye(t,"sideEffects",re,Pe(t));ye(t,"intentBasedNavigation",oe,Pe(t));ye(t,"share",ae,Pe(t));ye(t,"viewState",se,Pe(t));ye(t,"kpiManagement",le,Pe(t));ye(t,"placeholder",ue,Pe(t));ye(t,"massEdit",ge,Pe(t));t.handlers={onFilterSearch(){this._getFilterBarControl().triggerSearch()},onFiltersChanged(e){const t=this._getFilterBarControl();if(t){const i=this.getView().getBindingContext("internal");this.onPendingFilters();i.setProperty("appliedFilters",t.getAssignedFiltersText().filtersText);if(e.getParameter("conditionsBased")){i.setProperty("hasPendingFilters",true)}}},onVariantSelected(e){const t=e.getSource();const i=e.getParameter("key");const n=this._getMultiModeControl();n===null||n===void 0?void 0:n.invalidateContent();n===null||n===void 0?void 0:n.setFreezeContent(true);setTimeout(()=>{if(this._shouldAutoTriggerSearch(t)){return this._getFilterBarControl().triggerSearch()}else if(!this._getApplyAutomaticallyOnVariant(t,i)){this.getExtensionAPI().updateAppState()}},0)},onVariantSaved(){setTimeout(()=>{this.getExtensionAPI().updateAppState()},1e3)},onSearch(){const t=this._getFilterBarControl();const i=this.getView().getBindingContext("internal");const n=this.getChartControl();const r=w.getEditStateIsHideDraft(t.getConditions());i.setProperty("hasPendingFilters",false);i.setProperty("hideDraftInfo",r);if(!this._getMultiModeControl()){this._updateALPNotApplicableFields(i,t)}if(n){n.getBindingContext("internal").setProperty("",{});const e=n.getBindingContext("pageInternal");const t=e.getProperty(`${e.getPath()}/alpContentView`);if(t===Ae.Chart){this.hasPendingChartChanges=true}if(t===Ae.Table){this.hasPendingTableChanges=true}}V.retrieveExternalState(t).then(e=>{this.filterBarConditions=e.filter}).catch(function(t){e.error("Error while retrieving the external state",t)});if(this.getView().getViewData().liveMode===false){this.getExtensionAPI().updateAppState()}if(de.phone){const e=this._getDynamicListReportControl();e.setHeaderExpanded(false)}},onChevronPressNavigateOutBound(e,t,i,n){return e._intentBasedNavigation.onChevronPressNavigateOutBound(e,t,i,n)},onChartSelectionChanged(e){const t=e.getSource().getContent(),i=this._getTable(),n=e.getParameter("data"),r=this.getView().getBindingContext("internal");if(n){_.setChartFilters(t)}const o=r.getProperty(`${r.getPath()}/alpContentView`);if(o===Ae.Chart){this.hasPendingChartChanges=true}else if(i){i.rebind();this.hasPendingChartChanges=false}},onSegmentedButtonPressed(e){const t=e.mParameters.key?e.mParameters.key:null;const i=this.getView().getBindingContext("internal");i.setProperty("alpContentView",t);const n=this.getChartControl();const r=this._getTable();const o={onAfterRendering(){const e=a.getItems();e.forEach(function(e){if(e.getKey()===t){e.focus()}});a.removeEventDelegate(o)}};const a=t===Ae.Table?this._getSegmentedButton("Table"):this._getSegmentedButton("Chart");if(a!==e.getSource()){a.addEventDelegate(o)}switch(t){case Ae.Table:this._updateTable(r);break;case Ae.Chart:this._updateChart(n);break;case Ae.Hybrid:this._updateTable(r);this._updateChart(n);break;default:break}this.getExtensionAPI().updateAppState()},onFiltersSegmentedButtonPressed(e){const t=e.getParameter("key")==="Compact";this._getFilterBarControl().setVisible(t);this._getVisualFilterBarControl().setVisible(!t)},onStateChange(){this.getExtensionAPI().updateAppState()},onDynamicPageTitleStateChanged(e){const t=this._getFilterBarControl();if(t&&t.getSegmentedButton()){if(e.getParameter("isExpanded")){t.getSegmentedButton().setVisible(true)}else{t.getSegmentedButton().setVisible(false)}}}};t.formatters={setALPControlMessageStrip(e,t,i){let n="";t=t==="true"||t===true;const r=this._getFilterBarControl();if(r&&Array.isArray(e)&&e.length>0&&t){const o=C.getLabels(e,r.data("entityType"),r,this.oResourceBundle);const a=!i.enableSearch;n=t?C.getALPText(o,r,a):C.getText(o,r,"",m.getLocalizedText);return n}}};return t}var a=o.prototype;a.getExtensionAPI=function e(){if(!this.extensionAPI){this.extensionAPI=new A(this)}return this.extensionAPI};a.onInit=function e(){P.prototype.onInit.apply(this);const t=this.getView().getBindingContext("internal");t.setProperty("hasPendingFilters",true);t.setProperty("appliedFilters","");t.setProperty("hideDraftInfo",false);t.setProperty("uom",{});t.setProperty("scalefactor",{});t.setProperty("scalefactorNumber",{});t.setProperty("currency",{});if(this._hasMultiVisualizations()){let e=this._getDefaultPath();if(!de.desktop&&e===Ae.Hybrid){e=Ae.Chart}t.setProperty("alpContentView",e)}this.filterBarConditions={};this.getAppComponent().getRouterProxy().waitForRouteMatchBeforeNavigation();this._setInitLoad()};a.onExit=function e(){delete this.filterBarConditions;if(this.extensionAPI){this.extensionAPI.destroy()}delete this.extensionAPI};a._onAfterBinding=function e(){const t=this._getControls("table");if(f.isEditStateDirty()){var i,r;(i=this._getMultiModeControl())===null||i===void 0?void 0:i.invalidateContent();const e=(r=this._getTable())===null||r===void 0?void 0:r.getRowBinding();if(e){if(n.getAppComponent(this.getView())._isFclEnabled()){e.refresh()}else{if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(()=>{e.refresh();delete this.sUpdateTimer},0)}const i=()=>{this._updateTableActions(t);e.detachDataReceived(i)};e.attachDataReceived(i)}}f.setEditStateProcessed()}if(!this.sUpdateTimer){this._updateTableActions(t)}const o=this.getView().getBindingContext("internal");if(!o.getProperty("initialVariantApplied")){const e=this.getView().getId();this.pageReady.waitFor(this.getAppComponent().getAppStateHandler().applyAppState(e,this.getView()));o.setProperty("initialVariantApplied",true)}};a.onBeforeRendering=function e(){P.prototype.onBeforeRendering.apply(this)};a.onAfterRendering=function t(){this.getView().getModel("sap.fe.i18n").getResourceBundle().then(e=>{this.oResourceBundle=e;const t=this._getControls();const i=this.getView().getViewData().entitySet;const r=n.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TEXT",this.oResourceBundle,undefined,i);t.forEach(function(e){e.setNoData(r)})}).catch(function(t){e.error("Error while retrieving the resource bundle",t)})};a.onPageReady=function e(t){if(t.forceFocus){this._setInitialFocus()}this.getAppComponent().getShellServices().setBackNavigation(undefined)};a.onViewNeedsRefresh=function e(t){};a.onPendingFilters=function e(){};a.getCurrentEntitySet=function e(){var t;return(t=this._getTable())===null||t===void 0?void 0:t.data("targetCollectionPath").slice(1)};a.onAfterClear=function e(){};a._updateTableActions=function e(t){let r=[];t.forEach(function(e){r=n.getIBNActions(e,r);const t=e.getBindingContext("internal"),o=JSON.parse(v.parseCustomData(m.getCustomData(e,"operationAvailableMap"))),a=e.getSelectedContexts();t.setProperty("selectedContexts",a);t.setProperty("numberOfSelectedContexts",a.length);h.updateDeleteInfoForSelectedContexts(t,a);i.setActionEnablement(t,o,a,"table")});n.updateDataFieldForIBNButtonsVisibility(r,this.getView())};a._scrollTablesToRow=function e(t){this._getControls("table").forEach(function(e){B.scrollTableToRow(e,t)})};a._setInitialFocus=function e(){const t=this._getDynamicListReportControl(),i=t.getHeaderExpanded(),n=this._getFilterBarControl();if(n){if(i){if(!n.getShowMessages()){n.setShowMessages(true)}const e=n.getFilterItems().find(function(e){return e.getRequired()&&e.getConditions().length===0});if(e){e.focus()}else if(this._isInitLoadEnabled()&&n.getFilterItems().length>0){n.getFilterItems()[0].focus()}else{var r;(r=this.getView().byId(`${this._getFilterBarControlId()}-btnSearch`))===null||r===void 0?void 0:r.focus()}}else if(this._isInitLoadEnabled()){var o;(o=this._getTable())===null||o===void 0?void 0:o.focusRow(0)}}else{var a;(a=this._getTable())===null||a===void 0?void 0:a.focusRow(0)}};a._getPageTitleInformation=function e(){const t=this.getAppComponent().getManifestEntry("sap.app");return{title:t.title,subtitle:t.subTitle||"",intent:"",icon:""}};a._getFilterBarControl=function e(){return this.getView().byId(this._getFilterBarControlId())};a._getDynamicListReportControl=function e(){return this.getView().byId(this._getDynamicListReportControlId())};a._getAdaptationFilterBarControl=function e(){const t=this._getFilterBarControl().getInbuiltFilter();return t!==null&&t!==void 0&&t.getParent()?t:undefined};a._getSegmentedButton=function e(t){var i;const n=(i=t==="Chart"?this.getChartControl():this._getTable())===null||i===void 0?void 0:i.data("segmentedButtonId");return this.getView().byId(n)};a._getControlFromPageModelProperty=function e(t){var i;const n=(i=this._getPageModel())===null||i===void 0?void 0:i.getProperty(t);return n&&this.getView().byId(n)};a._getDynamicListReportControlId=function e(){var t;return((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/dynamicListReportId"))||""};a._getFilterBarControlId=function e(){var t;return((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/filterBarId"))||""};a.getChartControl=function e(){return this._getControlFromPageModelProperty("/singleChartId")};a._getVisualFilterBarControl=function e(){const t=b.generate(["visualFilter",this._getFilterBarControlId()]);return t&&this.getView().byId(t)};a._getFilterBarVariantControl=function e(){return this._getControlFromPageModelProperty("/variantManagement/id")};a._getMultiModeControl=function e(){return this.getView().byId("fe::TabMultipleMode::Control")};a._getTable=function e(){if(this._isMultiMode()){var t,i;const e=(t=this._getMultiModeControl())===null||t===void 0?void 0:(i=t.getSelectedInnerControl())===null||i===void 0?void 0:i.content;return e!==null&&e!==void 0&&e.isA("sap.ui.mdc.Table")?e:undefined}else{return this._getControlFromPageModelProperty("/singleTableId")}};a._getControls=function e(t){if(this._isMultiMode()){const e=[];const i=this._getMultiModeControl().content;i.getItems().forEach(i=>{const n=this.getView().byId(i.getKey());if(n&&t){if(i.getKey().indexOf(`fe::${t}`)>-1){e.push(n)}}else if(n!==undefined&&n!==null){e.push(n)}});return e}else if(t==="Chart"){const e=this.getChartControl();return e?[e]:[]}else{const e=this._getTable();return e?[e]:[]}};a._getDefaultPath=function e(){var t;const i=F.getDefaultPath(((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/views"))||[]);switch(i){case"primary":return Ae.Chart;case"secondary":return Ae.Table;case"both":default:return Ae.Hybrid}};a._isMultiMode=function e(){var t;return!!((t=this._getPageModel())!==null&&t!==void 0&&t.getProperty("/multiViewsControl"))};a._isInitLoadEnabled=function e(){const t=this.getView().getViewData().initialLoad;return t===Be.Enabled};a._hasMultiVisualizations=function e(){var t;return(t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/hasMultiVisualizations")};a._disableInitLoad=function e(){const t=this._getFilterBarControl();if(t){t.setSuspendSelection(true)}};a._applyAutomaticallyOnStandardVariant=function e(){return false};a._setInitLoad=function e(){if(!this._isInitLoadEnabled()){this._disableInitLoad()}const t=F.getVariantBackReference(this.getView().getViewData(),this._getPageModel());const i=t&&this.getView().byId(t);if(i){i.registerApplyAutomaticallyOnStandardVariant(this._applyAutomaticallyOnStandardVariant.bind(this))}};a._setShareModel=function e(){const i=t.get("sap.ushell.Container.getUser");const n={bookmarkTitle:document.title,bookmarkCustomUrl:function(){const e=T.getHash();return e?`#${e}`:window.location.href},isShareInJamActive:!!i&&i().isJamActive()};const r=this.getOwnerComponent().getModel("_templPriv");r.setProperty("/listReport/share",n)};a._updateALPNotApplicableFields=function e(t,i){const n={};const r={},o=this._getControls("table"),a=this._getControls("Chart");if(!o.length||!a.length){return}a.forEach(function(e){const t=e.data("targetCollectionPath"),o=t.slice(1),a=`${o}Chart`;if(!n[a]){n[a]=w.getNotApplicableFilters(i,e)}r[a]=n[a]});t.setProperty("controls/ignoredFields",r)};a._isFilterBarHidden=function e(){return this.getView().getViewData().hideFilterBar};a._getApplyAutomaticallyOnVariant=function e(t,i){if(!t||!i){return false}const n=t.getVariants();const r=n.find(function(e){return e&&e.key===i});return r&&r.executeOnSelect||false};a._shouldAutoTriggerSearch=function e(t){if(this.getView().getViewData().initialLoad===Be.Auto&&(!t||t.getStandardVariantKey()===t.getCurrentVariantKey())){const e=this._getFilterBarControl();if(e){const i=e.getConditions();for(const e in i){if(!e.startsWith("$")&&Array.isArray(i[e])&&i[e].length){const e=t.getVariants().find(e=>e.key===t.getCurrentVariantKey());return e&&e.executeOnSelect}}}}return false};a._updateTable=function e(t){if(!t.isTableBound()||this.hasPendingChartChanges){t.rebind();this.hasPendingChartChanges=false}};a._updateChart=function e(t){const i=t.getControlDelegate()._getChart(t);if(!(i&&i.isBound("data"))||this.hasPendingTableChanges){t.getControlDelegate().rebind(t,i.getBindingInfo("data"));this.hasPendingTableChanges=false}};return o}(P),ie=me(te.prototype,"_routing",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=me(te.prototype,"_intentBasedNavigation",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),re=me(te.prototype,"sideEffects",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=me(te.prototype,"intentBasedNavigation",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=me(te.prototype,"share",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),se=me(te.prototype,"viewState",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),le=me(te.prototype,"kpiManagement",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=me(te.prototype,"placeholder",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=me(te.prototype,"massEdit",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),me(te.prototype,"getExtensionAPI",[K,$],Object.getOwnPropertyDescriptor(te.prototype,"getExtensionAPI"),te.prototype),me(te.prototype,"onPageReady",[J,q],Object.getOwnPropertyDescriptor(te.prototype,"onPageReady"),te.prototype),me(te.prototype,"onViewNeedsRefresh",[W,X],Object.getOwnPropertyDescriptor(te.prototype,"onViewNeedsRefresh"),te.prototype),me(te.prototype,"onPendingFilters",[G,Q],Object.getOwnPropertyDescriptor(te.prototype,"onPendingFilters"),te.prototype),me(te.prototype,"onAfterClear",[Y,Z],Object.getOwnPropertyDescriptor(te.prototype,"onAfterClear"),te.prototype),te))||ee);return Ie},false);
//# sourceMappingURL=ListReportController.controller.js.map