/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/deepClone","sap/base/util/merge","sap/base/util/ObjectPath","sap/fe/core/buildingBlocks/BuildingBlockFragment","sap/fe/core/buildingBlocks/BuildingBlockRuntime","sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/jsx-runtime/jsx","sap/ui/base/ManagedObject","sap/ui/core/Component","sap/ui/core/util/XMLPreprocessor","../converters/ConverterContext"],function(e,n,t,i,o,r,s,a,u,c,l,d,f,p){"use strict";var g={};var m=u.isContext;var v=a.generate;var B=s.resolveBindingString;var h=s.isUndefinedExpression;var b=o.xml;var C=o.registerBuildingBlock;let y=function(){function t(t,i,o){this.isPublic=false;this.getConverterContext=function(t,i,o,r){var s;const a=o.appComponent;const u=(s=o.models.viewData)===null||s===void 0?void 0:s.getData();let c=Object.assign({},u);delete c.resourceBundle;c=e(c);c.controlConfiguration=n(c.controlConfiguration,r||{});return p.createConverterContextForMacro(t.startingEntitySet.name,o.models.metaModel,a===null||a===void 0?void 0:a.getDiagnostics(),n,t.contextLocation,c)};Object.keys(t).forEach(e=>{this[e]=t[e]})}g.BuildingBlockBase=t;var i=t.prototype;i.createId=function e(){if(this.id){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++){t[i]=arguments[i]}return v([this.id,...t])}return undefined};i.getProperties=function e(){const n={};for(const e in this){if(this.hasOwnProperty(e)){n[e]=this[e]}}return n};t.register=function e(){};t.unregister=function e(){};i.addConditionally=function e(n,t){if(n){return t}else{return""}};i.attr=function e(n,t){if(t!==undefined&&!h(t)){return()=>b`${n}="${t}"`}else{return()=>""}};return t}();g.BuildingBlockBase=y;const k=function(n){if(!n.hasOwnProperty("metadata")){n.metadata=e(n.metadata||{properties:{},aggregations:{},events:{},stereotype:"xmlmacro",designtime:""})}return n.metadata};function x(e){return function(n,t,i){const o=k(n.constructor);if(e.defaultValue===undefined){var r;e.defaultValue=(r=i.initializer)===null||r===void 0?void 0:r.call(i)}delete i.initializer;if(o.properties[t.toString()]===undefined){o.properties[t.toString()]=e}return i}}g.xmlAttribute=x;function O(e){return x(e)}g.blockAttribute=O;function $(){return function(e,n,t){const i=k(e.constructor);delete t.initializer;if(i.events[n.toString()]===undefined){i.events[n.toString()]={type:"function"}}return t}}g.xmlEvent=$;function w(){return $()}g.blockEvent=w;function A(e){return function(n,t,i){const o=k(n.constructor);delete i.initializer;if(o.aggregations[t]===undefined){o.aggregations[t]=e}return i}}g.xmlAggregation=A;function P(e){return A(e)}g.blockAggregation=P;const j={};function N(e){return function(n){const t=k(n);t.designtime=e.designtime;n.xmlTag=e.name;n.namespace=e.namespace;n.publicNamespace=e.publicNamespace;n.fragment=e.fragment;n.isOpen=e.isOpen;n.isRuntime=e.isRuntime;n.apiVersion=2;if(n.isRuntime===true){n.prototype.getTemplate=function(n){const i=`${e.namespace}.${e.name}`;const o=[];const r=[];const s=[];const a=[];for(const e in t.properties){let n=this[e];if(n!==undefined&&n!==null){if(m(n)){n=n.getPath()}if(t.properties[e].type==="function"){r.push(n);a.push(n);s.push(e)}else{o.push(b`feBB:${e}="${n}"`)}}}if(r.length>0){o.push(b`functionHolder="${r.join(";")}"`);o.push(b`feBB:functionStringInOrder="${a.join(",")}"`);o.push(b`feBB:propertiesAssignedToFunction="${s.join(",")}"`)}for(const e in t.events){const n=this[e];if(n!==undefined){o.push(b`feBB:${e}="${n}"`)}}const u=n.getAttribute("core:require")||undefined;if(u){o.push(b`core:require="${u}"`)}return b`<feBB:BuildingBlockFragment
					xmlns:core="sap.ui.core"
					xmlns:feBB="sap.fe.core.buildingBlocks"
					fragmentName="${i}"

					id="{this>id}"
					type="FE_COMPONENTS"
					${o}
				>
				</feBB:BuildingBlockFragment>`}}n.register=function(){C(n);if(n.isRuntime===true){j[`${e.namespace}.${e.name}`]=n}};n.unregister=function(){f.plugIn(null,n.namespace,n.name);f.plugIn(null,n.publicNamespace,n.name)}}}g.defineBuildingBlock=N;i.registerType("FE_COMPONENTS",{load:async function(e){return Promise.resolve(j[e.fragmentName])},init:function(e){var n,i,o,s,a,u,f,p;let g=e.fragmentContent;if(!g){g=j[e.fragmentName]}const m={};const v=(e===null||e===void 0?void 0:(n=e.customData)===null||n===void 0?void 0:(i=n[0])===null||i===void 0?void 0:(o=i.mProperties)===null||o===void 0?void 0:(s=o.value)===null||s===void 0?void 0:s["sap.fe.core.buildingBlocks"])||{};delete e.customData;const h=e.functionHolder??[];delete e.functionHolder;const b=((a=(u=e.containingView).getController)===null||a===void 0?void 0:a.call(u).getView())??e.containingView;const C=d.getOwnerComponentFor(b);const y=r.getAppComponent(b);const k=y.getMetaModel();const x=C.getModel("_pageModel");const O=(f=v.functionStringInOrder)===null||f===void 0?void 0:f.split(",");const $=(p=v.propertiesAssignedToFunction)===null||p===void 0?void 0:p.split(",");for(const e in g.metadata.properties){const n=g.metadata.properties[e];const t=x.createBindingContext(v[e]);if(t===null){let t=v[e];if(typeof t==="string"){if(n.bindable!==true){switch(n.type){case"boolean":t=t==="true";break;case"number":t=Number(t);break}}else{t=B(t,n.type)}}else if(n.type==="function"){const n=$.indexOf(e);const i=O[n];const o=h===null||h===void 0?void 0:h.find(e=>{var n;return((n=e[0])===null||n===void 0?void 0:n._sapui_handlerName)===i});if(o&&o.length>1){t=o[0].bind(o[1])}}m[e]=t}else if(t.getObject()!==undefined){m[e]=t.getObject()}else{m[e]=k.createBindingContext(v[e])}}for(const e in g.metadata.events){if(v[e]!==undefined&&v[e].startsWith(".")){m[e]=t.get(v[e].substring(1),b.getController())}else{m[e]=""}}return l.runWithPreprocessors(()=>{const e=c.withContext({view:b,appComponent:y},()=>new g(m,{},{isRuntimeInstantiation:true,isPublic:false,appComponent:y}).getContent(b,y));if(!this._bAsync){this._aContent=e}return e},{id:function(e){return b.createId(e)},settings:function(n){const t=this.getMetadata().getAssociations();for(const i of Object.keys(t)){if(n[i]!==undefined){const t=Array.isArray(n[i])?n[i]:[n[i]];n[i]=t.map(n=>typeof n==="string"?e.containingView.createId(n):n)}}return n}})}});return g},false);
//# sourceMappingURL=BuildingBlock.js.map