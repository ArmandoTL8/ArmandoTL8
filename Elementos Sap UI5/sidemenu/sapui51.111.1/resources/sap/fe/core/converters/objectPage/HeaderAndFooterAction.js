/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/templating/DataModelPathHelper","sap/ui/core/Core","../helpers/BindingHelper","../ManifestSettings"],function(e,t,i,n,o,a,l,r,d){"use strict";var v={};var u=d.ActionType;var s=r.UI;var c=r.singletonPathVisitor;var f=r.Draft;var p=a.isPathDeletable;var y=n.pathInModel;var g=n.not;var b=n.ifElse;var E=n.getExpressionFromAnnotation;var h=n.fn;var A=n.equal;var m=n.constant;var D=n.compileExpression;var C=n.and;var S=i.KeyHelper;var O=t.Placement;var I=e.getSemanticObjectMapping;var T=e.getEnabledForAnnotationAction;var B=e.getCopyAction;var F=e.dataFieldIsCopyAction;var P=e.ButtonType;function U(e,t){var i,n,o;return((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Identification)===null||o===void 0?void 0:o.filter(e=>{var i,n,o,a,l,r,d,v,u,s;return((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Hidden)===null||o===void 0?void 0:o.valueOf())!==true&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean((a=e.Determining)===null||a===void 0?void 0:a.valueOf())===t&&(((l=e.ActionTarget)===null||l===void 0?void 0:(r=l.isBound)===null||r===void 0?void 0:r.valueOf())!==true||(e===null||e===void 0?void 0:(d=e.ActionTarget)===null||d===void 0?void 0:(v=d.annotations)===null||v===void 0?void 0:(u=v.Core)===null||u===void 0?void 0:(s=u.OperationAvailable)===null||s===void 0?void 0:s.valueOf())!==false)?true:false}))||[]}v.getIdentificationDataFieldForActions=U;function N(e,t){var i,n,o;return((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Identification)===null||o===void 0?void 0:o.filter(e=>{var i,n,o,a;return((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Hidden)===null||o===void 0?void 0:o.valueOf())!==true&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&Boolean((a=e.Determining)===null||a===void 0?void 0:a.valueOf())===t?true:false}))||[]}const H=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];function k(e,t){const i=e.getDataModelObjectPath(),n=i.navigationProperties.map(e=>e.name),o=E(t,n,undefined,t=>c(t,e.getConvertedTypes(),[])),a=e.getManifestWrapper(),l=a.getViewLevel(),r=l>1?s.IsEditable:g(s.IsEditable);return b(t===undefined||t.valueOf()===false,r,C(r,A(o,false)))}v.getDeleteButtonVisibility=k;function M(e,t,i){const n=i.getEntitySet(),a=o.isDraftRoot(n);let l=b(t!==undefined,t,b(e!==undefined,A(e,true),m(true)));l=a?C(l,g(y("DraftAdministrativeData/InProcessByUser"))):l;return l}v.getDeleteButtonEnabled=M;function x(e,t,i,n,a){const l=i===null||i===void 0?void 0:i.getEntitySet(),r=e.getEntitySet(),d=e.getManifestWrapper().isFclEnabled();let v;const u=R(i,t);if(a&&a>1){v=o.isDraftNode(r)}else{v=o.isDraftRoot(l)}const c=R(i,n);const p=g(s.IsEditable);const E=b(a>1,b(n===undefined||n.valueOf()===false,C(p,A(y("rootEditVisible","internal"),true),b(d,A(y("/showEditButton","fclhelper"),true),true)),C(p,A(c,false),A(y("rootEditVisible","internal"),true),b(d,A(y("/showEditButton","fclhelper"),true),true))),b(t===undefined||t.valueOf()===false,p,C(p,A(u,false))));return b(v,C(E,f.HasNoDraftForCurrentUser),E)}v.getEditButtonVisibility=x;function R(e,t){const i=e.getDataModelObjectPath(),n=i.navigationProperties.map(e=>e.name),o=E(t,n,undefined,t=>c(t,e.getConvertedTypes(),n));return o}v.getHiddenExpression=R;function V(e,t,i){const n=e.getEntitySet(),a=o.isDraftRoot(n),l=o.isSticky(n);let r;if(a&&!o.isSingleton(n)){var d,v;r=n===null||n===void 0?void 0:(d=n.annotations.Common)===null||d===void 0?void 0:(v=d.DraftRoot)===null||v===void 0?void 0:v.EditAction}else if(l&&!o.isSingleton(n)){var u,s;r=n===null||n===void 0?void 0:(u=n.annotations.Session)===null||u===void 0?void 0:(s=u.StickySessionSupported)===null||s===void 0?void 0:s.EditAction}if(r){var c,f;const n=e.getAbsoluteAnnotationPath(r);const o=e.resolveAbsolutePath(n).target;if((o===null||o===void 0?void 0:(c=o.annotations)===null||c===void 0?void 0:(f=c.Core)===null||f===void 0?void 0:f.OperationAvailable)===null){}else if(i>1){if(t!==undefined){return D(C(A(E(t),true),A(y("rootEditEnabled","internal"),true)))}else{return D(A(y("rootEditEnabled","internal"),true))}}else{return T(e,o??undefined)}}return"true"}v.getEditButtonEnabled=V;function j(e){var t,i,n,a,r;const d=e.getContextPath();const v=o.getRootEntitySetPath(d);const s=e.getConverterContextFor("/"+v);const f=e.getEntitySet(),y=e.getEntityType(),b=s.getEntitySet(),m=s.getEntityType(),C=o.getStickySession(b),O=o.getDraftRoot(b),T=o.getDraftNode(b),R=f&&((t=f.annotations)===null||t===void 0?void 0:(i=t.Capabilities)===null||i===void 0?void 0:i.DeleteRestrictions),j=o.isUpdateHidden(b,m),w=b&&!o.isSingleton(b)&&(j===null||j===void 0?void 0:j.valueOf()),L=e.getDataModelObjectPath(),W=p(L,{pathVisitor:(t,i)=>c(t,e.getConvertedTypes(),i)}),$=W?D(W):W,q=U(e.getEntityType(),false);const Q=e.getManifestWrapper().getViewLevel()===1?B(q.filter(e=>F(e))):undefined;const _=q.filter(e=>!F(e));const G=[];if(!o.isSingleton(f)&&O!==null&&O!==void 0&&O.EditAction&&w!==true){G.push({type:u.DraftActions,key:"DraftActions"})}const Y=e.getManifestWrapper().getViewLevel();const z=Y>1?f===null||f===void 0?void 0:(n=f.annotations.Capabilities)===null||n===void 0?void 0:(a=n.UpdateRestrictions)===null||a===void 0?void 0:a.Updatable:undefined;if(O||T){G.push({type:u.CollaborationAvatars,key:"CollaborationAvatars"})}_.filter(e=>H.indexOf(e===null||e===void 0?void 0:e.Criticality)>-1).forEach(t=>{G.push(K(t,e))});if((O!==null&&O!==void 0&&O.EditAction||C!==null&&C!==void 0&&C.EditAction)&&w!==true){G.push({type:u.Primary,key:"EditAction",visible:D(x(e,j,s,o.isUpdateHidden(f,y),Y)),enabled:V(s,z,Y)})}if($&&$!=="false"||(R===null||R===void 0?void 0:(r=R.Deletable)===null||r===void 0?void 0:r.valueOf())!==false&&$!=="false"){const t=o.getDeleteHidden(f,y);G.push({type:u.Secondary,key:"DeleteAction",visible:D(k(e,t)),enabled:D(M(R===null||R===void 0?void 0:R.Deletable,W,e)),parentEntityDeleteEnabled:$})}if(Q){var J;G.push({...K(Q,e),type:u.Copy,text:((J=Q.Label)===null||J===void 0?void 0:J.toString())??l.getLibraryResourceBundle("sap.fe.core").getText("C_COMMON_COPY")})}const X=N(e.getEntityType(),false);X.filter(e=>H.indexOf(e===null||e===void 0?void 0:e.Criticality)===-1).forEach(t=>{var i,n,o,a,l,r,d;if(((i=t.RequiresContext)===null||i===void 0?void 0:i.valueOf())===true){throw new Error(`RequiresContext property should not be true for header IBN action : ${t.Label}`)}if(((n=t.Inline)===null||n===void 0?void 0:n.valueOf())===true){throw new Error(`Inline property should not be true for header IBN action : ${t.Label}`)}const v={semanticObjectMapping:I(t.Mapping)};G.push({type:u.DataFieldForIntentBasedNavigation,text:(o=t.Label)===null||o===void 0?void 0:o.toString(),annotationPath:e.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),buttonType:P.Ghost,visible:D(g(A(E((a=t.annotations)===null||a===void 0?void 0:(l=a.UI)===null||l===void 0?void 0:(r=l.Hidden)===null||r===void 0?void 0:r.valueOf()),true))),enabled:t.NavigationAvailable!==undefined?D(A(E((d=t.NavigationAvailable)===null||d===void 0?void 0:d.valueOf()),true)):true,key:S.generateKeyFromDataField(t),isNavigable:true,press:D(h("._intentBasedNavigation.navigate",[E(t.SemanticObject),E(t.Action),v])),customData:D({semanticObject:E(t.SemanticObject),action:E(t.Action)})})});_.filter(e=>H.indexOf(e===null||e===void 0?void 0:e.Criticality)===-1).forEach(t=>{G.push(K(t,e))});return G}v.getHeaderDefaultActions=j;function w(e){var t,i,n;const o=e.getEntityType();const a=((t=o.annotations)===null||t===void 0?void 0:(i=t.UI)===null||i===void 0?void 0:(n=i.Identification)===null||n===void 0?void 0:n.filter(e=>{var t,i,n;return(e===null||e===void 0?void 0:(t=e.annotations)===null||t===void 0?void 0:(i=t.UI)===null||i===void 0?void 0:(n=i.Hidden)===null||n===void 0?void 0:n.valueOf())===true}))||[];return a.map(e=>({type:u.Default,key:S.generateKeyFromDataField(e)}))}v.getHiddenHeaderActions=w;function L(e,t){var i,n,a,l,r;const d=t.getEntitySet();const v=t.getEntityType();const s=o.getStickySession(d),c=!o.isSingleton(d)&&d&&(((i=d.annotations.Common)===null||i===void 0?void 0:(n=i.DraftRoot)===null||n===void 0?void 0:n.term)||((a=d.annotations)===null||a===void 0?void 0:(l=a.Session)===null||l===void 0?void 0:(r=l.StickySessionSupported)===null||r===void 0?void 0:r.term)),f=Boolean(c==="com.sap.vocabularies.Common.v1.DraftRoot"||s&&(s===null||s===void 0?void 0:s.SaveAction)),p=e>1,y=Boolean(c==="com.sap.vocabularies.Common.v1.DraftRoot"||s&&(s===null||s===void 0?void 0:s.DiscardAction));const g=U(t.getEntityType(),true);const b=g.filter(e=>H.indexOf(e===null||e===void 0?void 0:e.Criticality)>-1).map(e=>K(e,t));if((d===null||d===void 0?void 0:d.entityTypeName)===(v===null||v===void 0?void 0:v.fullyQualifiedName)&&f){b.push({type:u.Primary,key:"SaveAction"})}if(p){b.push({type:u.DefaultApply,key:"ApplyAction"})}g.filter(e=>H.indexOf(e===null||e===void 0?void 0:e.Criticality)===-1).forEach(e=>{b.push(K(e,t))});if(y){b.push({type:u.Secondary,key:"CancelAction",position:{placement:O.End}})}return b}v.getFooterDefaultActions=L;function K(e,t){var i,n;return{type:u.DataFieldForAction,annotationPath:t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:S.generateKeyFromDataField(e),visible:D(g(A(E((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:n.Hidden),true))),enabled:T(t,e.ActionTarget),isNavigable:true}}return v},false);
//# sourceMappingURL=HeaderAndFooterAction.js.map