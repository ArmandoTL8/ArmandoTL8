/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/DataModelPathHelper","sap/ui/core/Core","../../helpers/Aggregation","../../helpers/ID","../../ManifestSettings"],function(e,t,n,o,a,i,r,l,s,d,g){"use strict";var c={};var u=g.VisualizationType;var p=g.VariantManagementType;var v=g.TemplateType;var f=g.ActionType;var m=d.getFilterBarID;var y=d.getChartID;var h=s.AggregationHelper;var b=r.getTargetObjectPath;var A=i.not;var P=i.getExpressionFromAnnotation;var T=i.equal;var C=i.compileExpression;var S=a.KeyHelper;var D=o.OverrideType;var M=o.insertCustomElements;var O=n.getActionsFromManifest;var F=t.isDataFieldForActionAbstract;function I(e,t,n){const o=[];if(e){const t=e.Actions||[];t.forEach(e=>{var t,a,i,r;let l;if(F(e)&&!(((t=e.annotations)===null||t===void 0?void 0:(a=t.UI)===null||a===void 0?void 0:(i=a.Hidden)===null||i===void 0?void 0:i.valueOf())===true)&&!e.Inline&&!e.Determining&&!(e!==null&&e!==void 0&&(r=e.ActionTarget)!==null&&r!==void 0&&r.isBound)){const t=S.generateKeyFromDataField(e);switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":l={type:f.DataFieldForAction,annotationPath:n.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:t,visible:$(e,n)};break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":l={type:f.DataFieldForIntentBasedNavigation,annotationPath:n.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:t,visible:$(e,n),isNavigable:true};break}}if(l){o.push(l)}})}return o}function E(e,t,n){const o=I(e,t,n);const a=O(n.getManifestControlConfiguration(t).actions,n,o);const i={enabled:D.overwrite,enableOnSelect:D.overwrite,visible:D.overwrite,command:D.overwrite};const r=M(o,a.actions,i);return{actions:r,commandActions:a.commandActions}}c.getChartActions=E;function N(e,t){var n;const o=t.getManifestControlConfiguration(e);let a=true;const i=[];if((o===null||o===void 0?void 0:(n=o.chartSettings)===null||n===void 0?void 0:n.personalization)!==undefined){a=o.chartSettings.personalization}if(a){if(a===true){return"Sort,Type,Item"}else if(typeof a==="object"){if(a.type){i.push("Type")}if(a.item){i.push("Item")}if(a.sort){i.push("Sort")}return i.join(",")}}return undefined}c.getP13nMode=N;function w(t,n,o,a){const i=new h(o.getEntityType(),o);if(!a&&!i.isAnalyticsSupported()){throw new Error("ApplySupported is not added to the annotations")}const r=i.getTransAggregations();const s=i.getCustomAggregateDefinitions();const d={};const g=o.getManifestWrapper();const c=g.getVariantManagement();const p=N(n,o);if(p===undefined&&c==="Control"){e.warning("Variant Management cannot be enabled when personalization is disabled")}if(s){const e=i.getEntityType();for(const t of s){var f,A,P,T,C;const n=t===null||t===void 0?void 0:(f=t.annotations)===null||f===void 0?void 0:(A=f.Aggregation)===null||A===void 0?void 0:A.ContextDefiningProperties;const o=t===null||t===void 0?void 0:t.qualifier;const a=o&&e.entityProperties.find(e=>e.name===o);const i=a&&(a===null||a===void 0?void 0:(P=a.annotations)===null||P===void 0?void 0:(T=P.Common)===null||T===void 0?void 0:(C=T.Label)===null||C===void 0?void 0:C.toString());d[o]={name:o,label:i||`Custom Aggregate (${o})`,sortable:true,sortOrder:"both",contextDefiningProperty:n?n.map(e=>e.value):[]}}}const S={};const D=l.getLibraryResourceBundle("sap.fe.core");if(r){for(let e=0;e<r.length;e++){var M,O,F,I,w,$;S[r[e].Name]={name:r[e].Name,propertyPath:r[e].AggregatableProperty.valueOf().value,aggregationMethod:r[e].AggregationMethod,label:(M=r[e])!==null&&M!==void 0&&(O=M.annotations)!==null&&O!==void 0&&(F=O.Common)!==null&&F!==void 0&&F.Label?(I=r[e])===null||I===void 0?void 0:(w=I.annotations)===null||w===void 0?void 0:($=w.Common)===null||$===void 0?void 0:$.Label.toString():`${D.getText("AGGREGATABLE_PROPERTY")} (${r[e].Name})`,sortable:true,sortOrder:"both",custom:false}}}const L=i.getAggregatableProperties();const x=i.getGroupableProperties();const z={};z.$Type="Org.OData.Aggregation.V1.ApplySupportedType";z.AggregatableProperties=[];z.GroupableProperties=[];for(let e=0;L&&e<L.length;e++){var V,j,G;const t={$Type:(V=L[e])===null||V===void 0?void 0:V.$Type,Property:{$PropertyPath:(j=L[e])===null||j===void 0?void 0:(G=j.Property)===null||G===void 0?void 0:G.value}};z.AggregatableProperties.push(t)}for(let e=0;x&&e<x.length;e++){var R;const t={$PropertyPath:(R=x[e])===null||R===void 0?void 0:R.value};z.GroupableProperties.push(t)}const k=E(t,n,o);let[H]=n.split("@");if(H.lastIndexOf("/")===H.length-1){H=H.substr(0,H.length-1)}const Q=t.Title;const U=o.getDataModelObjectPath();const K=H.length===0;const q=U.targetEntitySet?U.targetEntitySet.name:U.startingEntitySet.name;const W=K?m(o.getContextPath()):undefined;const J={legendGroup:{layout:{position:"bottom"}}};let Y;if(o.getTemplateType()===v.ObjectPage){Y=true}else if(o.getTemplateType()===v.ListReport||o.getTemplateType()===v.AnalyticalListPage){Y=false}const _=o.getManifestWrapper().hasMultipleVisualizations()||o.getTemplateType()==="AnalyticalListPage";const X=_?".handlers.onSegmentedButtonPressed":"";const Z=_?"{= ${pageInternal>alpContentView} !== 'Table'}":"true";const ee=i.getAllowedTransformations();z.enableSearch=ee?ee.indexOf("search")>=0:true;let te="";if(t.fullyQualifiedName.split("#").length>1){te=t.fullyQualifiedName.split("#")[1]}return{type:u.Chart,id:te?y(K?q:H,te,u.Chart):y(K?q:H,u.Chart),collection:b(o.getDataModelObjectPath()),entityName:q,personalization:N(n,o),navigationPath:H,annotationPath:o.getAbsoluteAnnotationPath(n),filterId:W,vizProperties:JSON.stringify(J),actions:k.actions,commandActions:k.commandActions,title:Q,autoBindOnInit:Y,onSegmentedButtonPressed:X,visible:Z,customAgg:d,transAgg:S,applySupported:z,variantManagement:B(p,c)}}c.createChartVisualization=w;function B(e,t){return t==="Control"&&!e?p.None:t}function $(e,t){var n,o;return C(A(T(P((n=e.annotations)===null||n===void 0?void 0:(o=n.UI)===null||o===void 0?void 0:o.Hidden,[],undefined,t.getRelativeModelPathFunction()),true)))}return c},false);
//# sourceMappingURL=Chart.js.map