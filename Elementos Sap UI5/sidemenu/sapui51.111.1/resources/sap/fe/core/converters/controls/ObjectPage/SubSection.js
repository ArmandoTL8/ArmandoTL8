/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/ObjectPage/HeaderFacet","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","../../helpers/ConfigurableObject","../../helpers/ID","../../ManifestSettings","../../objectPage/FormMenuActions","../Common/DataVisualization","../Common/Form"],function(e,t,n,i,a,o,r,s,l,c,u,v){"use strict";var d={};var f=v.isReferenceFacet;var m=v.createFormDefinition;var p=u.getDataVisualizationConfiguration;var g=c.getVisibilityEnablementFormMenuActions;var b=c.getFormHiddenActions;var I=c.getFormActions;var F=l.ActionType;var h=s.getSubSectionID;var y=s.getSideContentID;var U=s.getFormID;var D=s.getCustomSubSectionID;var S=r.Placement;var T=r.OverrideType;var A=r.insertCustomElements;var C=o.resolveBindingString;var k=o.ref;var M=o.pathInModel;var O=o.or;var E=o.notEqual;var L=o.not;var $=o.ifElse;var N=o.getExpressionFromAnnotation;var x=o.fn;var P=o.equal;var R=o.compileExpression;var w=a.KeyHelper;var V=i.IssueType;var H=i.IssueSeverity;var B=i.IssueCategory;var j=n.getStashedSettingsForHeaderFacet;var _=n.getHeaderFacetsFromManifest;var z=n.getDesignTimeMetadataSettingsForHeaderFacet;var q=t.removeDuplicateActions;var G=t.isActionNavigable;var X=t.getSemanticObjectMapping;var K=t.getEnabledForAnnotationAction;var Q=t.getActionsFromManifest;var W=t.ButtonType;let J;(function(e){e["Unknown"]="Unknown";e["Form"]="Form";e["DataVisualization"]="DataVisualization";e["XMLFragment"]="XMLFragment";e["Placeholder"]="Placeholder";e["Mixed"]="Mixed"})(J||(J={}));d.SubSectionType=J;const Y=["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.Chart","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"];function Z(e,t,n){const i=e.reduce((e,t)=>{switch(t.$Type){case"com.sap.vocabularies.UI.v1.ReferenceFacet":e.push(t);break;case"com.sap.vocabularies.UI.v1.CollectionFacet":if(t.Facets.find(e=>e.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet")){e.splice(e.length,0,...t.Facets)}else{e.push(t)}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":break}return e},[]);return i.map(e=>{var a;return re(e,i,t,0,!(e!==null&&e!==void 0&&(a=e.Facets)!==null&&a!==void 0&&a.length),n)})}d.createSubSections=Z;function ee(e){const t=_(e.getManifestWrapper().getHeaderFacets());const n=[];Object.keys(t).forEach(function(e){n.push(t[e]);return n});const i=n.reduce((e,t)=>{if(t.templateEdit){e.push(t)}return e},[]);return i.map(e=>te(e))}d.createCustomHeaderFacetSubSections=ee;function te(e){const t=D(e.key);const n={id:t,key:e.key,title:e.title,type:J.XMLFragment,template:e.templateEdit||"",visible:e.visible,level:1,sideContent:undefined,stashed:e.stashed,flexSettings:e.flexSettings,actions:{}};return n}const ne=(e,t)=>{var n,i;return((n=e.ID)===null||n===void 0?void 0:n.toString())||((i=e.Label)===null||i===void 0?void 0:i.toString())||t};function ie(e,t,n){const i=b(t,n)||[],a=I(t,n),o=Q(a,n,e,undefined,undefined,i),r={enabled:T.overwrite,visible:T.overwrite,command:T.overwrite},s=A(e,o.actions,r);return{actions:s?g(q(s)):e,commandActions:o.commandActions}}function ae(e,t){let n=[];switch(e.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":n=e.Facets.filter(e=>f(e)).reduce((e,n)=>le(e,n,t),[]);break;case"com.sap.vocabularies.UI.v1.ReferenceFacet":n=le([],e,t);break;default:break}return ie(n,e,t)}function oe(e){const t=P(N(e),true);return R($(t,W.Ghost,W.Transparent))}function re(t,n,i,a,o,r){var s,l,c,u,v;const d=h(t);const f=(s=t.annotations)===null||s===void 0?void 0:(l=s.UI)===null||l===void 0?void 0:l.Hidden;const g=R(L(P(true,N(f))));const b=g&&typeof g==="string"&&g.indexOf("{=")===0&&(f===null||f===void 0?void 0:f.type)!=="Path";const I=g&&b?g.substring(g.indexOf("{=")+2,g.lastIndexOf("}")):false;const F=R(N(t.Label));const y={id:d,key:ne(t,d),title:F,type:J.Unknown,annotationPath:i.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),visible:g,isVisibilityDynamic:b,level:a,sideContent:undefined};if(r){y.stashed=j(t,t,i);y.flexSettings={designtime:z(t,t,i)}}let U="";a++;switch(t.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":const s=t.Facets;const l=s.map((e,t)=>({index:t,facet:e})).filter(e=>{var t,n;let{facet:i}=e;return Y.includes((t=i.Target)===null||t===void 0?void 0:(n=t.$target)===null||n===void 0?void 0:n.term)});const d=s.filter(e=>!l.find(t=>t.facet===e));if(l.length>0){const n=[];const c=[];const u=[];for(const{facet:e}of l){n.push(re(e,[],i,a,s.length===1,r))}if(d.length>0){e.warning(`Warning: CollectionFacet '${t.ID}' includes a combination of either a chart or a table and other content. This can lead to rendering issues. Consider moving the chart or table into a separate CollectionFacet.`);t.Facets=d;c.push(re(t,[],i,a,o,r))}if(l.find(e=>{let{index:t}=e;return t===0})){u.push(...n);u.push(...c)}else{u.push(...c);u.push(...n)}const v={...y,type:J.Mixed,level:a,content:u};return v}else{const e=ae(t,i),n={...y,type:J.Form,formDefinition:m(t,g,i,e.actions),level:a,actions:e.actions.filter(e=>e.facetName===undefined),commandActions:e.commandActions};return n}case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!t.Target.$target){U=`Unable to find annotationPath ${t.Target.value}`}else{switch(t.Target.$target.term){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.PresentationVariant":case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":const e=p(t.Target.value,de(t,n,i),i,undefined,r);const s=y.title?y.title:"";const l=((c=e.visualizations[0])===null||c===void 0?void 0:(u=c.annotation)===null||u===void 0?void 0:u.title)||((v=e.visualizations[0])===null||v===void 0?void 0:v.title);const d=se(l,s,o);const f=g&&F!=="undefined"&&(F?g:false);const h={...y,type:J.DataVisualization,level:a,presentation:e,showTitle:d,titleVisible:b?`{= (${I}) && ('${F}' !=='undefined') && (${d} ? true : false) }`:f};return h;case"com.sap.vocabularies.UI.v1.FieldGroup":case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.DataPoint":case"com.sap.vocabularies.UI.v1.StatusInfo":case"com.sap.vocabularies.Communication.v1.Contact":const D=ae(t,i),S={...y,type:J.Form,level:a,formDefinition:m(t,g,i,D.actions),actions:D.actions.filter(e=>e.facetName===undefined),commandActions:D.commandActions};return S;default:U=`For ${t.Target.$target.term} Fragment`;break}}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":U="For Reference URL Facet";break;default:break}const D={...y,text:U};return D}d.createSubSection=re;function se(e,t,n){return R(O(L(n),E(C(e),C(t))))}d.getTitleVisibility=se;function le(e,t,n){const i=t.Target.$target;const a=t.Target.value;let o={};let r=[];let[s]=a.split("@");if(s.length>0){if(s.lastIndexOf("/")===s.length-1){s=s.substr(0,s.length-1)}}else{s=undefined}if(i){switch(i.term){case"com.sap.vocabularies.UI.v1.FieldGroup":r=i.Data;o=Q(n.getManifestControlConfiguration(i).actions,n,undefined,undefined,undefined,undefined,t.fullyQualifiedName).actions;break;case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.StatusInfo":if(i.qualifier){r=i}break;default:break}}e=r.reduce((e,a)=>{var o,r,l,c,u,v,d,f,m,p,g,b,I,h,y,D;switch(a.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":if(((o=a.RequiresContext)===null||o===void 0?void 0:o.valueOf())===true){n.getDiagnostics().addIssue(B.Annotation,H.Low,V.MALFORMED_DATAFIELD_FOR_IBN.REQUIRESCONTEXT)}if(((r=a.Inline)===null||r===void 0?void 0:r.valueOf())===true){n.getDiagnostics().addIssue(B.Annotation,H.Low,V.MALFORMED_DATAFIELD_FOR_IBN.INLINE)}if(((l=a.Determining)===null||l===void 0?void 0:l.valueOf())===true){n.getDiagnostics().addIssue(B.Annotation,H.Low,V.MALFORMED_DATAFIELD_FOR_IBN.DETERMINING)}const S={};if(a.Mapping){S.semanticObjectMapping=X(a.Mapping)}e.push({type:F.DataFieldForIntentBasedNavigation,id:U(t,a),key:w.generateKeyFromDataField(a),text:(c=a.Label)===null||c===void 0?void 0:c.toString(),annotationPath:"",enabled:a.NavigationAvailable!==undefined?R(P(N((u=a.NavigationAvailable)===null||u===void 0?void 0:u.valueOf()),true)):"true",visible:R(L(P(N((v=a.annotations)===null||v===void 0?void 0:(d=v.UI)===null||d===void 0?void 0:(f=d.Hidden)===null||f===void 0?void 0:f.valueOf()),true))),buttonType:oe((m=a.annotations)===null||m===void 0?void 0:(p=m.UI)===null||p===void 0?void 0:p.Emphasized),press:R(x("._intentBasedNavigation.navigate",[N(a.SemanticObject),N(a.Action),S])),customData:R({semanticObject:N(a.SemanticObject),action:N(a.Action)})});break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":const T=n.getManifestControlConfiguration(i).actions;const A=w.generateKeyFromDataField(a);e.push({type:F.DataFieldForAction,id:U(t,a),key:A,text:(g=a.Label)===null||g===void 0?void 0:g.toString(),annotationPath:"",enabled:K(n,a.ActionTarget),binding:s?`{ 'path' : '${s}'}`:undefined,visible:R(L(P(N((b=a.annotations)===null||b===void 0?void 0:(I=b.UI)===null||I===void 0?void 0:(h=I.Hidden)===null||h===void 0?void 0:h.valueOf()),true))),requiresDialog:ce(a.ActionTarget),buttonType:oe((y=a.annotations)===null||y===void 0?void 0:(D=y.UI)===null||D===void 0?void 0:D.Emphasized),press:R(x("invokeAction",[a.Action,{contexts:x("getBindingContext",[],M("","$source")),invocationGrouping:a.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",label:N(a.Label),model:x("getModel",[],M("/","$source")),isNavigable:G(T&&T[A])}],k(".editFlow"))),facetName:a.Inline?t.fullyQualifiedName:undefined});break;default:break}return e},e);return A(e,o)}function ce(e){if(e){var t,n;const i=(t=e.annotations)===null||t===void 0?void 0:(n=t.Common)===null||n===void 0?void 0:n.IsActionCritical;if(e.parameters.length>1||i){return"Dialog"}else{return"None"}}else{return"None"}}d.isDialog=ce;function ue(e,t){const n={};Object.keys(e).forEach(i=>n[i]=ve(e[i],i,t));return n}d.createCustomSubSections=ue;function ve(e,t,n){const i=e.sideContent?{template:e.sideContent.template,id:y(t),visible:false,equalSplit:e.sideContent.equalSplit}:undefined;let a=e.position;if(!a){a={placement:S.After}}const o=e.visible!==undefined?e.visible:true;const r=o&&typeof o==="string"&&o.indexOf("{=")===0;const s=Q(e.actions,n);const l={type:J.Unknown,id:e.id||D(t),actions:s.actions,key:t,title:e.title,level:1,position:a,visible:e.visible!==undefined?e.visible:true,sideContent:i,isVisibilityDynamic:r};if(e.template||e.name){l.type=J.XMLFragment;l.template=e.template||e.name||""}else{l.type=J.Placeholder}return l}d.createCustomSubSection=ve;function de(e,t,n){const i=n.getManifestWrapper();if(i.useIconTabBar()){return fe(e,t)}else{var a,o,r,s,l,c;const i=n.getEntityType();if((a=i.annotations)!==null&&a!==void 0&&(o=a.UI)!==null&&o!==void 0&&(r=o.Facets)!==null&&r!==void 0&&r.length&&((s=i.annotations)===null||s===void 0?void 0:(l=s.UI)===null||l===void 0?void 0:(c=l.Facets)===null||c===void 0?void 0:c.length)>1){return fe(e,t)}else{return true}}}function fe(e,t){return t.every(function(t){if(t!==e){if(t.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){var n,i,a,o,r;const e=t;if(((n=e.Target)===null||n===void 0?void 0:(i=n.$target)===null||i===void 0?void 0:i.term)==="com.sap.vocabularies.UI.v1.LineItem"||((a=e.Target)===null||a===void 0?void 0:(o=a.$target)===null||o===void 0?void 0:o.term)==="com.sap.vocabularies.UI.v1.PresentationVariant"||((r=e.Target.$target)===null||r===void 0?void 0:r.term)==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){var s,l,c,u;return((s=e.annotations)===null||s===void 0?void 0:(l=s.UI)===null||l===void 0?void 0:l.Hidden)!==undefined?(c=e.annotations)===null||c===void 0?void 0:(u=c.UI)===null||u===void 0?void 0:u.Hidden:false}return true}else{const e=t;return e.Facets.every(function(e){var t,n,i,a,o,r;const s=e;if(((t=s.Target)===null||t===void 0?void 0:(n=t.$target)===null||n===void 0?void 0:n.term)==="com.sap.vocabularies.UI.v1.LineItem"||((i=s.Target)===null||i===void 0?void 0:(a=i.$target)===null||a===void 0?void 0:a.term)==="com.sap.vocabularies.UI.v1.PresentationVariant"||((o=s.Target)===null||o===void 0?void 0:(r=o.$target)===null||r===void 0?void 0:r.term)==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){var l,c,u,v;return((l=s.annotations)===null||l===void 0?void 0:(c=l.UI)===null||c===void 0?void 0:c.Hidden)!==undefined?(u=s.annotations)===null||u===void 0?void 0:(v=u.UI)===null||v===void 0?void 0:v.Hidden:false}return true})}}return true})}return d},false);
//# sourceMappingURL=SubSection.js.map