/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/editFlow/draft","sap/m/CheckBox","sap/m/MessageToast","sap/m/Text"],function(e,t,n,s,l){"use strict";var o={};let a;(function(e){e["deletableContexts"]="deletableContexts";e["draftsWithDeletableActive"]="draftsWithDeletableActive";e["createModeContexts"]="createModeContexts";e["unSavedContexts"]="unSavedContexts";e["draftsWithNonDeletableActive"]="draftsWithNonDeletableActive"})(a||(a={}));o.DeleteOptionTypes=a;let i;(function(e){e["CHECKBOX"]="checkBox";e["TEXT"]="text"})(i||(i={}));o.DeleteDialogContentControl=i;function E(e,t,n,s){s.forEach(e=>{const t=n.indexOf(e);if(t!==-1){n.splice(t,1)}});e.setProperty(t,[]);return[...n]}function T(e,t){let n=e.getProperty("selectedContexts")||[];if(t.type===a.deletableContexts){n=E(e,a.deletableContexts,n,e.getProperty(a.deletableContexts)||[]);n=E(e,a.createModeContexts,n,e.getProperty(a.createModeContexts)||[]);const t=e.getProperty(a.draftsWithDeletableActive)||[];const s=t.map(e=>e.draft);n=E(e,a.draftsWithDeletableActive,n,s)}else{const s=e.getProperty(t.type)||[];n=E(e,t.type,n,s)}e.setProperty("selectedContexts",n);e.setProperty("numberOfSelectedContexts",n.length)}function _(t,n,l,o){const{internalModelContext:a,entitySetName:i}=t;if(a){if(a.getProperty("deleteEnabled")!=undefined){n.forEach(e=>{if(e.selected){T(a,e)}})}a.setProperty("deleteEnabled",n.some(e=>!e.selected))}if(l.length===1){s.show(e.getTranslatedText("C_TRANSACTION_HELPER_DELETE_TOAST_SINGULAR",o,undefined,i))}else{s.show(e.getTranslatedText("C_TRANSACTION_HELPER_DELETE_TOAST_PLURAL",o,undefined,i))}}function r(e){const t=e.getObject()["DraftAdministrativeData"];return t&&t["InProcessByUser"]||""}function c(t,n,s){let l="";if(n===1&&s.length===1){const n=r(s[0]);l=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_SINGLE_OBJECT_LOCKED",t,[n])}else if(s.length==1){const o=r(s[0]);l=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO_AND_ONE_OBJECT_LOCKED",t,[n,o])}else if(s.length>1){l=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_LOCKED",t,[s.length,n])}return l}function f(t,n,s){let l="";if(s===n){if(n===1){l=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_ONLY_DRAFT_OF_NON_DELETABLE_ACTIVE",t)}else{l=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_ONLY_DRAFTS_OF_NON_DELETABLE_ACTIVE",t)}}else if(n===1){l=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_DRAFT_OF_NON_DELETABLE_ACTIVE",t)}else{l=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_DRAFTS_OF_NON_DELETABLE_ACTIVE",t)}return l}function C(e){const t=e.getObject()["DraftAdministrativeData"];let n="";if(t){n=t["LastChangedByUserDescription"]||t["LastChangedByUser"]||""}return n}function N(t,n,s,l){let o="",a="",i=false;if(n===1&&s.length===1){const n=C(s[0]);o=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_UNSAVED_CHANGES",t,[n]);i=true}else if(n===s.length){o=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_UNSAVED_CHANGES_MULTIPLE_OBJECTS",t);i=true}else if(l===s.length){if(s.length===1){const n=C(s[0]);o=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_UNSAVED_AND_FEW_OBJECTS_LOCKED_SINGULAR",t,[n])}else{o=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_UNSAVED_AND_FEW_OBJECTS_LOCKED_PLURAL",t)}i=true}else if(l>s.length){if(s.length===1){const n=C(s[0]);a=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_UNSAVED_SINGULAR",t,[n])}else{a=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_UNSAVED_PLURAL",t)}}return{infoTxt:o,optionTxt:a,optionWithoutTxt:i}}function d(t,n,s){const{numberOfSelectedContexts:l,lockedContexts:o,draftsWithNonDeletableActive:a}=t;const i=l-(o.length+n-a.length);let E="";if(i>0&&(n===0||a.length===n)){if(o.length>0){if(i===1){E=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_ALL_REMAINING_NON_DELETABLE_SINGULAR",s,undefined)}else{E=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_ALL_REMAINING_NON_DELETABLE_PLURAL",s,undefined)}}else if(i===1){E=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_SINGLE_AND_ONE_OBJECT_NON_DELETABLE",s,undefined)}else{E=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_MULTIPLE_AND_ALL_OBJECT_NON_DELETABLE",s,undefined)}}else if(i===1){E=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO_AND_ONE_OBJECT_NON_DELETABLE",s,[l])}else if(i>1){E=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO_AND_FEW_OBJECTS_NON_DELETABLE",s,[i,l])}return E}function A(e,t){return t.reduce((e,t)=>t.selected?e.concat(t.contexts):e,e)}function D(e,t,n,s,o,E){const{numberOfSelectedContexts:T,draftsWithDeletableActive:_,unSavedContexts:r,createModeContexts:c,lockedContexts:f,draftsWithNonDeletableActive:C}=e;let N="",d="";if(_.length>0){_.forEach(e=>{t.push(e.siblingInfo.targetContext)})}if(c.length>0){c.forEach(e=>t.push(e))}if(f.length>0){d=x.getLockedObjectsText(s,T,f)||"";o.push(new l({text:d}))}if(T!=n-C.length+f.length){N=x.getNonDeletableText(e,n,s);o.push(new l({text:N}))}if(r.length>0){const e=x.getUnsavedContextsText(s,T,r,n)||{};if(e.infoTxt){o.push(new l({text:e.infoTxt}))}if(e.optionTxt||e.optionWithoutTxt){E.push({type:a.unSavedContexts,contexts:r,text:e.optionTxt,selected:true,control:i.CHECKBOX})}}if(C.length>0){const e=x.getNonDeletableActivesOfDraftsText(s,C.length,n)||"";if(e){E.push({type:a.draftsWithNonDeletableActive,contexts:C,text:e,selected:true,control:n>0?i.CHECKBOX:i.TEXT})}}}function O(e,t){if(e.length===1){const n=e[0];if(n.text){t.push(new l({text:n.text}))}}else if(e.length>1){e.forEach(e=>{if(e.control==="text"&&e.text){t.push(new l({text:e.text}))}});e.forEach(e=>{if(e.control==="checkBox"&&e.text){t.push(new n({text:e.text,selected:true,select:function(t){const n=t.getSource();const s=n.getSelected();e.selected=s}}))}})}}function g(t,n,s,l){const{numberOfSelectedContexts:o,entitySetName:E,parentControl:T,description:_,lockedContexts:r,draftsWithNonDeletableActive:c,unSavedContexts:f}=t;const C=n.length+c.length+f.length;const N=o-(r.length+C-c.length);if(o===1&&o===n.length){const t=n[0].getObject();const o=T;const r=o&&o.getParent().getIdentifierColumn();let c;let f=[];if(r){const n=r?t[r]:undefined;const l=_&&_.path?t[_.path]:undefined;if(n){if(l&&_&&r!==_.path){f=[n+" ",l]}else{f=[n,""]}c=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO",s,f,E)}else if(n){f=[n,""];c=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO",s,f,E)}else{c=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",s,undefined,E)}}else{c=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",s,undefined,E)}l.push({type:a.deletableContexts,contexts:n,text:c,selected:true,control:i.TEXT})}else if(f.length!==C&&o>0&&(n.length>0||f.length>0&&c.length>0)){if(o>n.length&&N+r.length>0){let t="";if(C===1){t=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR_NON_DELETABLE",s,undefined,E)}else{t=e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_PLURAL_NON_DELETABLE",s,undefined,E)}l.unshift({type:a.deletableContexts,contexts:n,text:t,selected:true,control:i.TEXT})}else{const t=C===1?e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",s,undefined,E):e.getTranslatedText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_PLURAL",s,undefined,E);l.push({type:a.deletableContexts,contexts:n,text:t,selected:true,control:i.TEXT})}}}async function L(e,n,s,l,o,a){try{const i=x.getConfirmedDeletableContext([],e);const{beforeDeleteCallBack:E,parentControl:T}=n;if(E){await E({contexts:i})}if(i&&i.length){try{await Promise.all(i.map(function(e){if(a&&!e.getProperty("IsActiveEntity")){const n=i.length===1?true:false;return t.deleteDraft(e,o,n)}return e.delete()}));x.afterDeleteProcess(n,e,i,l)}catch(e){await s.showMessageDialog({control:T});throw e}}}catch(e){await s.showMessages();throw e}}async function I(e,n){const s=n.map(e=>{const n=e.getModel().getMetaModel().getMetaContext(e.getCanonicalPath());const s=n.getProperty("@Org.OData.Capabilities.V1.DeleteRestrictions/Deletable/$Path");const l=!s&&n.getProperty("@Org.OData.Capabilities.V1.DeleteRestrictions/Deletable")!==false;const o={context:e,isDraftRoot:!!n.getProperty("@com.sap.vocabularies.Common.v1.DraftRoot"),isDraftNode:!!n.getProperty("@com.sap.vocabularies.Common.v1.DraftNode"),isActive:true,hasActive:false,hasDraft:false,locked:false,deletable:s?e.getProperty(s):l,siblingPromise:Promise.resolve(undefined),siblingInfo:undefined,siblingDeletable:false};if(o.isDraftRoot){var a;o.locked=!!((a=e.getObject("DraftAdministrativeData"))!==null&&a!==void 0&&a.InProcessByUser);o.hasDraft=e.getProperty("HasDraftEntity")}if(o.isDraftRoot||o.isDraftNode){o.isActive=e.getProperty("IsActiveEntity");o.hasActive=e.getProperty("HasActiveEntity");if(!o.isActive&&o.hasActive){o.siblingPromise=t.computeSiblingInformation(e,e).then(async e=>{o.siblingInfo=e;if(s){var t;o.siblingDeletable=await(e===null||e===void 0?void 0:(t=e.targetContext)===null||t===void 0?void 0:t.requestProperty(s))}else{o.siblingDeletable=l}})}}return o});await Promise.all(s.map(e=>e.siblingPromise));const l=[{key:"draftsWithDeletableActive",value:s.filter(e=>e.isDraftRoot&&!e.isActive&&e.hasActive&&e.siblingDeletable)},{key:"draftsWithNonDeletableActive",value:s.filter(e=>!e.isActive&&e.hasActive&&!e.siblingDeletable)},{key:"lockedContexts",value:s.filter(e=>e.isDraftRoot&&e.isActive&&e.hasDraft&&e.locked)},{key:"unSavedContexts",value:s.filter(e=>e.isDraftRoot&&e.isActive&&e.hasDraft&&!e.locked)},{key:"deletableContexts",value:s.filter(e=>!e.isDraftRoot&&!e.isDraftNode&&e.deletable||e.isDraftRoot&&e.isActive&&!e.hasDraft&&e.deletable||e.isDraftRoot&&!e.isActive&&!e.hasActive||e.isDraftNode&&!e.isActive&&!e.hasActive||e.isDraftNode&&!e.isActive&&e.hasActive&&e.siblingDeletable)}];for(const{key:t,value:n}of l){e.setProperty(t,n.map(e=>t==="draftsWithDeletableActive"?{draft:e.context,siblingInfo:e.siblingInfo}:e.context))}}const x={getNonDeletableText:d,deleteConfirmHandler:L,updateOptionsForDeletableTexts:g,updateContentForDeleteDialog:O,updateDraftOptionsForDeletableTexts:D,getConfirmedDeletableContext:A,getLockedObjectsText:c,getUnsavedContextsText:N,getNonDeletableActivesOfDraftsText:f,afterDeleteProcess:_,updateDeleteInfoForSelectedContexts:I};return x},false);
//# sourceMappingURL=DeleteHelper.js.map