/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/PropertyHelper"],function(t,e){"use strict";var n={};var i=e.isPathExpression;var r=e.isAnnotationPathExpression;var a=t.unresolvableExpression;var o=t.getExpressionFromAnnotation;var l=t.equal;var s=t.constant;const c=function(t){return g(t===null||t===void 0?void 0:t.contextLocation,t===null||t===void 0?void 0:t.navigationProperties).map(t=>t.name)};n.getRelativePaths=c;const g=function(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!t){return e}else if(e.length>=t.navigationProperties.length){let n=[];t.navigationProperties.forEach((t,i)=>{if(e[i]!==t){n.push(e[i])}});n=n.concat(e.slice(t.navigationProperties.length));let i=0;while(n.length>1&&i!=n.length-1){const t=n[i];const e=n[i+1];if(t._type==="NavigationProperty"&&t.partner===e.name){n.splice(0,2)}else{i++}}return n}else{let n=[];e.forEach((i,r)=>{if(t.navigationProperties[r]!==i){n.push(e[r])}});n=n.concat(t.navigationProperties.slice(e.length));let i=0;while(n.length>1&&i!=n.length-1){const t=n[i];const e=n[i+1];if(t._type==="NavigationProperty"&&t.partner===e.name){n.splice(0,2)}else{i++}}n=n.map(t=>t._type==="NavigationProperty"?t.targetType.navigationProperties.find(e=>e.name===t.partner):t);return n}};n.getPathRelativeLocation=g;const u=function(t,e){let n="";if((i(e)||r(e))&&e.path){n=e.path}else if(typeof e==="string"){n=e}let a;if(i(e)||r(e)){a=e.$target}else if(t.targetEntityType){a=t.targetEntityType.resolvePath(n)}else{a=t.targetObject}const o=n.split("/");let l=t.targetEntitySet;let s=t.targetEntityType;const c=t.navigationProperties.concat();let g=t.targetEntityType;o.forEach(t=>{if(!g){return}const e=g.navigationProperties.find(e=>e.name===t);if(e){c.push(e);s=e.targetType;if(l&&l.navigationPropertyBinding.hasOwnProperty(t)){l=l.navigationPropertyBinding[t]}g=s}else{const e=g.entityProperties.find(e=>e.name===t);if(e!==null&&e!==void 0&&e.targetType){c.push(e);g=s}else{g=undefined}}});return{startingEntitySet:t.startingEntitySet,navigationProperties:c,contextLocation:t.contextLocation,targetEntitySet:l,targetEntityType:s,targetObject:a,convertedTypes:t.convertedTypes}};n.enhanceDataModelPath=u;const p=function(t){let e=`/${t.startingEntitySet.name}`;let n=t.startingEntitySet;let i=[];t.navigationProperties.forEach(t=>{i.push(t.name);if(n&&n.navigationPropertyBinding.hasOwnProperty(i.join("/"))){e+=`/$NavigationPropertyBinding/${i.join("/")}/$`;n=n.navigationPropertyBinding[i.join("/")];i=[]}});return e};n.getTargetEntitySetPath=p;const v=function(t){var e;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let i="";if(!t.startingEntitySet){return"/"}if(!n){i+=`/${t.startingEntitySet.name}`}if(t.navigationProperties.length>0){i=E(i);i+=t.navigationProperties.map(t=>t.name).join("/")}if((e=t.targetObject)!==null&&e!==void 0&&e.name&&t.targetObject._type!=="NavigationProperty"&&t.targetObject._type!=="EntityType"&&t.targetObject._type!=="EntitySet"&&t.targetObject!==t.startingEntitySet){i=E(i);i+=`${t.targetObject.name}`}else if(t.targetObject&&t.targetObject.hasOwnProperty("term")){i=E(i);i+=`@${t.targetObject.term}`;if(t.targetObject.hasOwnProperty("qualifier")&&!!t.targetObject.qualifier){i+=`#${t.targetObject.qualifier}`}}return i};n.getTargetObjectPath=v;const d=function(t){var e;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(((e=t.contextLocation)===null||e===void 0?void 0:e.startingEntitySet)!==t.startingEntitySet){return v(t)}return f(t,n,i)};n.getContextRelativeTargetObjectPath=d;const f=function(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const i=g(t.contextLocation,t.navigationProperties);if(e){if(i.find(t=>t._type==="NavigationProperty"&&t.isCollection)){return undefined}}let r=n?i.map(t=>{const e=t._type==="NavigationProperty"&&t.isCollection;return e?`${t.name}*`:t.name}).join("/"):i.map(t=>t.name).join("/");if(t.targetObject&&(t.targetObject.name||t.targetObject.type==="PropertyPath"&&t.targetObject.value)&&t.targetObject._type!=="NavigationProperty"&&t.targetObject._type!=="EntityType"&&t.targetObject._type!=="EntitySet"&&t.targetObject!==t.startingEntitySet){r=E(r);r+=t.targetObject.type==="PropertyPath"?`${t.targetObject.value}`:`${t.targetObject.name}`}else if(t.targetObject&&t.targetObject.hasOwnProperty("term")){r=E(r);r+=`@${t.targetObject.term}`;if(t.targetObject.hasOwnProperty("qualifier")&&!!t.targetObject.qualifier){r+=`#${t.targetObject.qualifier}`}}else if(!t.targetObject){return undefined}return r};const y=function(t,e){return j(t,t=>{var e;return t===null||t===void 0?void 0:(e=t.UpdateRestrictions)===null||e===void 0?void 0:e.Updatable},e)};n.isPathUpdatable=y;const h=function(t,e){return j(t,t=>{var e;return t===null||t===void 0?void 0:(e=t.SearchRestrictions)===null||e===void 0?void 0:e.Searchable},e)};n.isPathSearchable=h;const P=function(t,e){return j(t,t=>{var e;return t===null||t===void 0?void 0:(e=t.DeleteRestrictions)===null||e===void 0?void 0:e.Deletable},e)};n.isPathDeletable=P;const b=function(t,e){return j(t,t=>{var e;return t===null||t===void 0?void 0:(e=t.InsertRestrictions)===null||e===void 0?void 0:e.Insertable},e)};n.isPathInsertable=b;const O=function(t,e){return j(t,n=>{if(n&&"FilterRestrictions"in n){var i;const a=(n===null||n===void 0?void 0:(i=n.FilterRestrictions)===null||i===void 0?void 0:i.FilterExpressionRestrictions)||[];const o=a.find(e=>e.Property.$target===t.targetObject);if(o){var r;return e.indexOf(o===null||o===void 0?void 0:(r=o.AllowedExpressions)===null||r===void 0?void 0:r.toString())!==-1}else{return false}}else{return false}})};n.checkFilterExpressionRestrictions=O;const j=function(t,e,n){if(!t||!t.startingEntitySet){return s(true)}t=u(t,n===null||n===void 0?void 0:n.propertyPath);let i=t.startingEntitySet;let r=null;let c=[];const p=[];let v=i;const d=t.targetEntityType;let f=false;t.navigationProperties.forEach(t=>{if(f){c=[]}c.push(t.name);p.push(t);if(t._type==="Property"||!t.containsTarget){const t=c.join("/");if(i&&i.navigationPropertyBinding.hasOwnProperty(t)){r=i;i=i.navigationPropertyBinding[t];v=i;f=true}else{r=i;i=null;f=true}}else{r=i;v=null}});const y=c.join("/");let h,P;if(r!==null){var b,O,j;const i=r;(b=i.annotations)===null||b===void 0?void 0:(O=b.Capabilities)===null||O===void 0?void 0:(j=O.NavigationRestrictions)===null||j===void 0?void 0:j.RestrictedProperties.forEach(i=>{var r;if(((r=i.NavigationProperty)===null||r===void 0?void 0:r.type)==="NavigationPropertyPath"){const r=e(i);if(y===i.NavigationProperty.value&&r!==undefined){var a;const e=p.slice(0,-1);P=e;const i=g((a=t)===null||a===void 0?void 0:a.contextLocation,P).map(t=>t.name);const s=n!==null&&n!==void 0&&n.pathVisitor?m(n.pathVisitor,i):undefined;h=l(o(r,i,undefined,s),true)}}})}let E;if(!(n!==null&&n!==void 0&&n.ignoreTargetCollection)){var S,T;let i=e((S=v)===null||S===void 0?void 0:(T=S.annotations)===null||T===void 0?void 0:T.Capabilities);if(v===null&&i===undefined){var x;i=e(d===null||d===void 0?void 0:(x=d.annotations)===null||x===void 0?void 0:x.Capabilities)}if(i!==undefined){const e=g(t.contextLocation,p).map(t=>t.name);const r=n!==null&&n!==void 0&&n.pathVisitor?m(n.pathVisitor,e):undefined;E=l(o(i,e,undefined,r),true)}}return h||E||(n!==null&&n!==void 0&&n.authorizeUnresolvable?a:s(true))};n.checkOnPath=j;const E=function(t){if(t.length&&!t.endsWith("/")){return`${t}/`}return t};const m=function(t,e){return function(n){return t(n,e)}};return n},false);
//# sourceMappingURL=DataModelPathHelper.js.map