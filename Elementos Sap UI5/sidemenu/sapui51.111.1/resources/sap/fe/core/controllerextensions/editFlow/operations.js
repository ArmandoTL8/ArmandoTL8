/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/m/Button","sap/m/Dialog","sap/m/MessageBox","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/core/library","sap/ui/core/message/Message","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/model/json/JSONModel","../../operationsHelper"],function(e,t,n,a,i,s,o,r,l,c,u,d,g,f,m,p,h,M,P){"use strict";var x=f.MessageType;var v=o.generate;const b=r.Constants,C=r.InvocationGrouping;const E=u.Action;function A(e,t,n,a,i,s){if(!s){s={is412Executed:false,strictHandlingTransitionFails:[],strictHandlingPromises:[],strictHandlingWarningMessages:[],delaySuccessMessages:[],processedMessageIds:[]}}if(!t||t.length===0){return Promise.reject("Bound actions always requires at least one context")}const o=Array.isArray(t);i.aContexts=o?t:[t];const r=n.getMetaModel(),l=`${r.getMetaPath(i.aContexts[0].getPath())}/${e}`,c=r.createBindingContext(`${l}/@$ui5.overload/0`);i.isCriticalAction=D(r,l,i.aContexts,c);const u=function(e){if(e[0].status==="fulfilled"){return e[0].value}else{throw e[0].reason||e}};return T(e,n,c,a,i,s).then(e=>{if(o){return e}else{return u(e)}},e=>{if(o){throw e}else{return u(e)}})}function $(e,t,n,a,i){if(!t){return Promise.reject("Action expects a model/context for execution")}const s=t.getMetaModel(),o=t.bindContext(`/${e}`).getPath(),r=s.createBindingContext(`/${s.createBindingContext(o).getObject("$Action")}/0`);a.isCriticalAction=D(s,`${o}/@$ui5.overload`);return T(e,t,r,n,a,i)}function O(e,t,n){if(!t){return Promise.reject("Bound functions always requires a context")}const a=n.getMetaModel(),i=`${a.getMetaPath(t.getPath())}/${e}`,s=a.createBindingContext(i);return S(e,n,s,t)}function y(e,t){if(!e){return Promise.resolve()}const n=t.getMetaModel(),a=t.bindContext(`/${e}`).getPath(),i=n.createBindingContext(`/${n.createBindingContext(a).getObject("$Function")}/0`);return S(e,t,i)}function S(e,t,n,a){let i;if(!n||!n.getObject()){return Promise.reject(new Error(`Function ${e} not found`))}if(a){n=t.bindContext(`${e}(...)`,a);i="functionGroup"}else{n=t.bindContext(`/${e}(...)`);i="functionImport"}const s=n.execute(i);t.submitBatch(i);return s.then(function(){return n.getBoundContext()})}function T(e,t,n,a,i,s){return new Promise(async function(o,r){let l={};let c;let u;const g=i.label;const f=i.skipParameterDialog;const m=i.aContexts;const p=i.bIsCreateAction;const h=i.isCriticalAction;let M;let P;let x;let v;let b;let E;let A;const $=n.getObject();if(!n||!n.getObject()){return r(new Error(`Action ${e} not found`))}const O=_(n);const y=O.length>0&&!(O.length===1&&O[0].$Name==="ResultIsActiveEntity");const S=i.parameterValues;const T=a.getComponentData();const I=T&&T.startupParameters||{};if(y&&f){A=k(p,O,S,I)}c=null;if(y){if(!(f&&A)){c=j}}else if(h){c=w}l={fnOnSubmitted:i.onSubmitted,fnOnResponse:i.onResponse,actionName:e,model:t,aActionParameters:O,bGetBoundContext:i.bGetBoundContext,defaultValuesExtensionFunction:i.defaultValuesExtensionFunction,label:i.label,selectedItems:i.selectedItems};if(n.getObject("$IsBound")){if(i.additionalSideEffect&&i.additionalSideEffect.pathExpressions){M=t.getMetaModel();P=M.getMetaPath(m[0].getPath());x=M.getObject(`${P}/@com.sap.vocabularies.Common.v1.Messages/$Path`);if(x){v=i.additionalSideEffect.pathExpressions.findIndex(function(e){return typeof e==="string"&&e===x});E=n.getObject("$ReturnType");b=E&&!E.$isCollection&&n.getModel().getObject(P).$Type===E.$Type;if(v>-1||b){i.mBindingParameters=i.mBindingParameters||{};if(n.getObject(`$ReturnType/$Type/${x}`)&&(!i.mBindingParameters.$select||i.mBindingParameters.$select.split(",").indexOf(x)===-1)){i.mBindingParameters.$select=i.mBindingParameters.$select?`${i.mBindingParameters.$select},${x}`:x;if(v===-1){i.additionalSideEffect.pathExpressions.push("*")}if(i.additionalSideEffect.triggerActions.length===0&&v>-1){i.additionalSideEffect.pathExpressions.splice(v,1)}}}}}l.aContexts=m;l.mBindingParameters=i.mBindingParameters;l.additionalSideEffect=i.additionalSideEffect;l.bGrouped=i.invocationGrouping===C.ChangeSet;l.internalModelContext=i.internalModelContext;l.operationAvailableMap=i.operationAvailableMap;l.isCreateAction=p;l.bObjectPage=i.bObjectPage;if(i.controlId){l.control=i.parentControl.byId(i.controlId)}else{l.control=i.parentControl}}if(p){l.bIsCreateAction=p}const B=($.$Parameter||[]).some(e=>($.$EntitySetPath&&$.$EntitySetPath===e.$Name||$.$IsBound)&&e.$isCollection);l.isStatic=B;if(c){u=c(e,a,g,l,O,S,n,i.parentControl,i.entitySetName,i.messageHandler,s);return u.then(function(e){N(i,l,$);o(e)}).catch(function(e){r(e)})}else{if(S){for(const e in l.aActionParameters){var D;l.aActionParameters[e].value=S===null||S===void 0?void 0:(D=S.find(t=>t.name===l.aActionParameters[e].$Name))===null||D===void 0?void 0:D.value}}else{for(const e in l.aActionParameters){var F;l.aActionParameters[e].value=(F=I[l.aActionParameters[e].$Name])===null||F===void 0?void 0:F[0]}}let e;try{e=await V(a,l,i.parentControl,i.messageHandler,s);const t=d.getMessageManager().getMessageModel().getData();if(s&&s.is412Executed&&s.strictHandlingTransitionFails.length){s.delaySuccessMessages=s.delaySuccessMessages.concat(t)}N(i,l,$);o(e)}catch{r(e)}finally{var H,R;if(s&&s.is412Executed&&s.strictHandlingTransitionFails.length){try{const e=s.strictHandlingTransitionFails;const t=[];e.forEach(function(e){t.push(e.oAction.getContext())});l.aContexts=t;const n=await V(a,l,i.parentControl,i.messageHandler,s);s.strictHandlingTransitionFails=[];d.getMessageManager().addMessages(s.delaySuccessMessages);N(i,l,$);o(n)}catch(e){r(e)}}i===null||i===void 0?void 0:(H=i.messageHandler)===null||H===void 0?void 0:H.showMessageDialog({control:(R=l)===null||R===void 0?void 0:R.control});if(s){s={is412Executed:false,strictHandlingTransitionFails:[],strictHandlingPromises:[],strictHandlingWarningMessages:[],delaySuccessMessages:[],processedMessageIds:[]}}}}})}function w(e,t,a,i,s,o,r,l,c,d){return new Promise((a,s)=>{let o=e?e:null;o=o.indexOf(".")>=0?o.split(".")[o.split(".").length-1]:o;const r=o&&c?`${c}|${o}`:"";const g=l.getController().oResourceBundle;const f=n.getTranslatedText("C_OPERATIONS_ACTION_CONFIRM_MESSAGE",g,undefined,r);u.confirm(f,{onClose:async function(e){if(e===E.OK){try{const e=await V(t,i,l,d);a(e)}catch(e){try{await d.showMessageDialog();s(e)}catch(t){s(e)}}}else{a()}}})})}async function I(e,t,n,a,i,s,o,r){var l;const c=await V(e,t,n,a,r);if((l=t.aContexts)!==null&&l!==void 0&&l.length){if(c!==null&&c!==void 0&&c.some(e=>e.status==="rejected")){throw c}}const u=d.getMessageManager().getMessageModel().getData();if(r&&r.is412Executed&&r.strictHandlingTransitionFails.length){if(!o){r.delaySuccessMessages=r.delaySuccessMessages.concat(u)}else{d.getMessageManager().addMessages(r.delaySuccessMessages);if(u.length){a.showMessageDialog({onBeforeShowMessage:function(e,n){return B(t,i,s,e,n)},control:t.control})}}}else if(u.length){a.showMessageDialog({isActionParameterDialogOpen:t===null||t===void 0?void 0:t.oDialog.isOpen(),onBeforeShowMessage:function(e,n){return B(t,i,s,e,n)},control:t.control})}return c}function N(e,n,a){if(n.internalModelContext&&n.operationAvailableMap&&n.aContexts&&n.aContexts.length&&a.$IsBound){const a=n.isStatic;if(!a){t.setActionEnablement(n.internalModelContext,JSON.parse(n.operationAvailableMap),e.selectedItems,"table")}else if(n.control){const e=n.control;if(e.isA("sap.ui.mdc.Table")){const a=e.getSelectedContexts();t.setActionEnablement(n.internalModelContext,JSON.parse(n.operationAvailableMap),a,"table")}}}}function B(e,t,n,a,s){let o=s.showMessageBox,r=s.showMessageDialog;const l=e.control;const c=a.filter(function(e){return e.getTarget()===""});const u=a.filter(function(t){return t.getTarget&&t.getTarget().indexOf(e.actionName)!==-1&&e.aActionParameters.some(function(e){return t.getTarget().indexOf(e.$Name)!==-1})});u.forEach(function(e){e.isAPDTarget=true});const d=u.length?true:false;if(n.isOpen()&&t.length!==0&&!e.isStatic){if(!e.bGrouped){if(t.length>1||!d){n.close();n.destroy()}}else if(!d){n.close();n.destroy()}}let g=[];const f=n.isOpen();if(a.length===1&&a[0].getTarget&&a[0].getTarget()!==undefined&&a[0].getTarget()!==""){if(l&&l.getModel("ui").getProperty("/isEditable")===false||!l){o=!d;r=false}else if(l&&l.getModel("ui").getProperty("/isEditable")===true){o=false;r=false}}else if(l){if(l.getModel("ui").getProperty("/isEditable")===false){if(f&&d){r=false}}else if(l.getModel("ui").getProperty("/isEditable")===true){if(!f&&d){r=true;g=c.concat(u)}else if(!f&&c.length===0){r=false}}}return{showMessageBox:o,showMessageDialog:r,filteredMessages:g.length?g:a,fnGetMessageSubtitle:l&&l.isA("sap.ui.mdc.Table")&&i.setMessageSubtitle.bind({},l,t)}}function j(t,i,o,r,f,P,x,C,E,A,$){const y=G(x,t),S=x.getModel().oModel.getMetaModel(),T=S.createBindingContext(y),w=x.getObject("$IsBound")?x.getPath().split("/@$ui5.overload/0")[0]:x.getPath().split("/0")[0],N=S.createBindingContext(w),j=r.isCreateAction,_="sap/fe/core/controls/ActionParameterDialog";return new Promise(async function(y,S){let w;const D=d.getMessageManager();const H=e=>{D.addMessages(e.map(e=>{const t=e.actionParameterInfo.field.getBinding(e.actionParameterInfo.isMultiValue?"items":"value");return new m({message:e.message,type:"Error",processor:t===null||t===void 0?void 0:t.getModel(),persistent:true,target:t===null||t===void 0?void 0:t.getResolvedPath()})}))};const R=e=>{const t=D.getMessageModel().getData();const n=v(["APD_",e.$Name]);const a=t.filter(e=>e.getControlIds().some(e=>n.split("-").includes(e)));D.removeMessages(a)};const V=async function(e){const t=w.filter(e=>e.field.getRequired());await Promise.allSettled(t.map(e=>e.validationPromise));const a=t.filter(e=>{if(e.isMultiValue){return e.value===undefined||!e.value.length}else{const t=e.field.getValue();return t===undefined||t===null||t===""}});H(a.map(t=>{var a;return{actionParameterInfo:t,message:n.getTranslatedText("C_OPERATIONS_ACTION_PARAMETER_DIALOG_MISSING_MANDATORY_MSG",e,[((a=t.field.getParent())===null||a===void 0?void 0:a.getAggregation("label")).getText()])}}));const i=w.find(e=>e.field.getValueState()==="Error"||a.includes(e));if(i){i.field.focus();return false}else{return true}};const G={handleChange:async function(e){const t=e.getSource();const n=w.find(e=>e.field===t);R(n.parameter);n.validationPromise=e.getParameter("promise");try{n.value=await n.validationPromise}catch(e){delete n.value;H([{actionParameterInfo:n,message:e.message}])}}};const k=h.loadTemplate(_,"fragment");const L=new M({$displayMode:{}});try{const m=await p.process(k,{name:_},{bindingContexts:{action:x,actionName:N,entitySet:T},models:{action:x.getModel(),actionName:N.getModel(),entitySet:T.getModel(),metaModel:T.getModel()}});const h=r.aContexts||[];const D=[];let H;await n.setUserDefaults(i,f,L,true);const J=await g.load({definition:m,controller:G});w=f.map(e=>{const t=d.byId(v(["APD_",e.$Name]));const n=t.isA("sap.ui.mdc.MultiValueField");return{parameter:e,field:t,isMultiValue:n}});const X=C.getController().oResourceBundle;let Y={dialogCancelled:true,result:undefined};const z=new c(v(["fe","APD_",t]),{title:o||n.getTranslatedText("C_OPERATIONS_ACTION_PARAMETER_DIALOG_TITLE",X),content:[J],escapeHandler:function(){z.close()},beginButton:new l(v(["fe","APD_",t,"Action","Ok"]),{text:j?n.getTranslatedText("C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE_BUTTON",X):F(X,o,t,E),type:"Emphasized",press:async function(){try{if(!await V(X)){return}a.lock(z);try{A.removeTransitionMessages();let e;const t=H&&H.getParameterContext();for(const n in f){if(f[n].$isCollection){const t=z.getModel("mvfview").getProperty(`/${f[n].$Name}`),a=[];for(const e in t){a.push(t[e].Key)}e=a}else{e=t.getProperty(f[n].$Name)}f[n].value=e;e=undefined}r.label=o;try{const e=await I(i,r,C,A,h,z,false,$);Y={dialogCancelled:false,result:e};z.close()}catch(e){const t=sap.ui.getCore().getMessageManager().getMessageModel().getData();if($&&$.is412Executed&&$.strictHandlingTransitionFails.length){$.delaySuccessMessages=$.delaySuccessMessages.concat(t)}throw e}finally{if($&&$.is412Executed&&$.strictHandlingTransitionFails.length){try{const e=$.strictHandlingTransitionFails;const t=[];e.forEach(function(e){t.push(e.oAction.getContext())});r.aContexts=t;const n=await I(i,r,C,A,h,z,true,$);$.strictHandlingTransitionFails=[];Y={dialogCancelled:false,result:n}}catch{if($&&$.is412Executed&&$.strictHandlingTransitionFails.length){d.getMessageManager().addMessages($.delaySuccessMessages)}await A.showMessageDialog({isActionParameterDialogOpen:z.isOpen(),onBeforeShowMessage:function(e,t){return B(r,h,z,e,t)}})}}if(a.isLocked(z)){a.unlock(z)}}}catch(e){let t=true;await A.showMessages({context:r.aContexts[0],isActionParameterDialogOpen:z.isOpen(),messagePageNavigationCallback:function(){z.close()},onBeforeShowMessage:function(e,n){const a=B(r,h,z,e,n);t=a.showMessageDialog;return a},aSelectedContexts:r.aContexts,sActionName:o,control:r.control});if(t){if(z.isOpen()){}else{S(e)}}}}finally{if($){$={is412Executed:false,strictHandlingTransitionFails:[],strictHandlingPromises:[],strictHandlingWarningMessages:[],delaySuccessMessages:[],processedMessageIds:[]}}if(a.isLocked(z)){a.unlock(z)}}}}),endButton:new l(v(["fe","APD_",t,"Action","Cancel"]),{text:n.getTranslatedText("C_COMMON_ACTION_PARAMETER_DIALOG_CANCEL",X),press:function(){z.close()}}),beforeOpen:async function(t){const a=Object.assign({},t);A.removeTransitionMessages();const i=function(){const e=z.getModel().getMetaModel(),t=x.sPath&&x.sPath.split("/@")[0],n=e.getObject(`${t}@com.sap.vocabularies.Common.v1.DefaultValuesFunction`);return n};const o=async function(t){const o=i();const l=async function(a,i){if(i!==undefined){if(h.length>0&&i.$Path){try{let e=await n.requestSingletonProperty(i.$Path,H.getModel());if(e===null){e=await H.getParameterContext().requestProperty(i.$Path)}if(h.length>1){let n=i.$Path;if(n.indexOf(`${t}/`)===0){n=n.replace(`${t}/`,"")}for(let t=1;t<h.length;t++){if(h[t].getProperty(n)!==e){return{paramName:a,value:undefined,bNoPossibleValue:true}}}}return{paramName:a,value:e}}catch(t){e.error("Error while reading default action parameter",a,r.actionName);return{paramName:a,value:undefined,bLatePropertyError:true}}}else{return{paramName:a,value:i}}}else if(L&&L.oData[a]){return{paramName:a,value:L.oData[a]}}else{return{paramName:a,value:undefined}}};const c=function(e){const t=z.getModel().getMetaModel(),a=n.getParameterPath(x.getPath(),e)+"@",i=t.getObject(a),s=i&&i["@com.sap.vocabularies.UI.v1.ParameterDefaultValue"];return s};const d=[];let g,m;for(const e in f){g=f[e].$Name;m=c(g);d.push(l(g,m))}if(x.getObject("$IsBound")&&h.length>0){if(o&&o.length>0&&typeof o==="string"){for(const e in h){D.push(O(o,h[e],r.model))}}}const p=Promise.all(d);let M=Promise.resolve([]);let v;if(D&&D.length>0){M=Promise.all(D)}if(r.defaultValuesExtensionFunction){const e=r.defaultValuesExtensionFunction.substring(0,r.defaultValuesExtensionFunction.lastIndexOf(".")||-1).replace(/\./gi,"/"),t=r.defaultValuesExtensionFunction.substring(r.defaultValuesExtensionFunction.lastIndexOf(".")+1,r.defaultValuesExtensionFunction.length);v=s.actionWrapper(a,e,t,{contexts:h})}try{const e=await Promise.all([p,M,v]);const t=e[0];const a=e[1];const i=e[2];let s;for(const e in f){var b;s=f[e].$Name;const n=P===null||P===void 0?void 0:(b=P.find(t=>t.name===f[e].$Name))===null||b===void 0?void 0:b.value;if(n){H.setParameter(f[e].$Name,n)}else if(i&&i.hasOwnProperty(s)){H.setParameter(f[e].$Name,i[s])}else if(t[e]&&t[e].value!==undefined){H.setParameter(f[e].$Name,t[e].value)}else if(o&&!t[e].bNoPossibleValue){if(h.length>1){let t=0;while(t<h.length-1){if(a[t]&&a[t+1]&&a[t].getObject(s)===a[t+1].getObject(s)){t++}else{break}}if(t===h.length-1){H.setParameter(f[e].$Name,a[t].getObject(s))}}else if(a[0]&&a[0].getObject(s)){H.setParameter(f[e].$Name,a[0].getObject(s))}}}const r=t.some(function(e){if(e.bLatePropertyError){return e.bLatePropertyError}});if(r){const e=n.getTranslatedText("C_APP_COMPONENT_SAPFE_ETAG_LATE_PROPERTY",X);u.warning(e,{contentWidth:"25em"})}}catch(t){e.error("Error while retrieving the parameter",t)}};const l=async function(){if(x.getObject("$IsBound")&&h.length>0){const t=x.getObject("$Parameter");const n=t[0]&&t[0].$Name;try{const e=await h[0].requestObject();if(e){H.setParameter(n,e)}await o(n)}catch(t){e.error("Error while retrieving the parameter",t)}}else{await o()}};await l();for(const e of w){const t=e.isMultiValue?e.field.getItems():e.field.getValue();e.value=t;e.validationPromise=Promise.resolve(t)}},afterClose:function(){f.forEach(R);z.destroy();if(Y.dialogCancelled){S(b.CancelActionDialog)}else{y(Y.result)}}});r.oDialog=z;z.setModel(x.getModel().oModel);z.setModel(L,"paramsModel");z.bindElement({path:"/",model:"paramsModel"});const Q=new M({});z.setModel(Q,"mvfview");for(const e of w){if(e.isMultiValue){var q,W;e===null||e===void 0?void 0:(q=e.field)===null||q===void 0?void 0:(W=q.getBinding("items"))===null||W===void 0?void 0:W.attachChange(()=>{R(e.parameter)})}else{var K,U;e===null||e===void 0?void 0:(K=e.field)===null||K===void 0?void 0:(U=K.getBinding("value"))===null||U===void 0?void 0:U.attachChange(()=>{R(e.parameter)})}}let Z=`${t}(...)`;if(!h.length){Z=`/${Z}`}z.bindElement({path:Z});if(C){C.addDependent(z)}if(h.length>0){z.setBindingContext(h[0])}H=z.getObjectBinding();z.open()}catch(e){S(e)}})}function _(e){const t=e.getObject("$Parameter")||[];if(t&&t.length){if(e.getObject("$IsBound")){return t.slice(1,t.length)||[]}}return t}function D(e,t,n,a){const i=e.getObject(`${t}@com.sap.vocabularies.Common.v1.IsActionCritical`);let s=i&&i.$Path;if(!s){return!!i}const o=a&&a.getObject("$Parameter"),r=s&&s.split("/"),l=o&&o.length&&typeof o==="object"&&s&&n&&n.length;if(l){o.filter(function(e){const t=r&&r.indexOf(e.$Name);if(t>-1){r.splice(t,1)}});s=r.join("/");return n[0].getObject(s)}else if(s){return n[0].getObject(s)}}function F(e,t,a,i){let s=a?a:null;const o=s.split(".");s=s.indexOf(".")>=0?o[o.length-1]:s;const r=s&&i?`${i}|${s}`:"";const l="ACTION_PARAMETER_DIALOG_ACTION_NAME";const c=e&&n.checkIfResourceKeyExists(e.aCustomBundles,`${l}|${r}`);if(t){if(c){return n.getTranslatedText(l,e,undefined,r)}else if(e&&n.checkIfResourceKeyExists(e.aCustomBundles,`${l}|${i}`)){return n.getTranslatedText(l,e,undefined,`${i}`)}else if(e&&n.checkIfResourceKeyExists(e.aCustomBundles,`${l}`)){return n.getTranslatedText(l,e)}else{return t}}else{return n.getTranslatedText("C_COMMON_DIALOG_OK",e)}}function H(e,t,n,a,i,s,o,r){let l;const c=sap.ui.getCore().getMessageManager().getMessageModel().getData();const u=c.filter(function(e){const t=r.processedMessageIds.find(function(t){return e.id===t});if(!t){r.processedMessageIds.push(e.id);if(e.type===x.Success){r.delaySuccessMessages.push(e)}}return e.persistent===true&&e.type!==x.Success&&!t});if(u.length){if(e.internalModelContext){l=r.strictHandlingTransitionFails;l.push({oAction:t,groupId:n});r.strictHandlingTransitionFails=l}}if(a===i&&r&&r.strictHandlingWarningMessages.length){P.renderMessageView(e,o,s,r.strictHandlingWarningMessages,r,true)}}function R(e,t,n,a,i,s,o,r,l){let c,u=true;if(n){var d;const t=e.getBoundContext().getPath();const n=e.getModel().getMetaModel().getMetaPath(t);const a=e.getModel().getMetaModel().getObject(n);if(a&&((d=a[0])===null||d===void 0?void 0:d.$kind)!=="Action"){u=false}}if(!u){c=n?e.execute(a).then(function(){return e.getBoundContext()}):e.execute(a)}else{c=n?e.execute(a,undefined,P.fnOnStrictHandlingFailed.bind(q,a,t,i,r,e.getContext(),o,s,l)).then(function(){if(l){H(t,e,a,r,o,s,i,l)}return Promise.resolve(e.getBoundContext())}).catch(function(){if(l){H(t,e,a,r,o,s,i,l)}return Promise.reject()}):e.execute(a,undefined,P.fnOnStrictHandlingFailed.bind(q,a,t,i,r,e.getContext(),o,s,l)).then(function(n){if(l){H(t,e,a,r,o,s,i,l)}return Promise.resolve(n)}).catch(function(){if(l){H(t,e,a,r,o,s,i,l)}return Promise.reject()})}return c.catch(()=>{throw b.ActionExecutionFailed})}function V(t,n,a,i,s){const o=n.aContexts||[];const r=n.model;const l=n.aActionParameters||[];const c=n.actionName;const u=n.fnOnSubmitted;const d=n.fnOnResponse;const g=a&&a.isA("sap.ui.core.mvc.View")&&a.getController().oResourceBundle;let f;function m(){if(l&&l.length){for(let e=0;e<l.length;e++){if(!l[e].value){switch(l[e].$Type){case"Edm.String":l[e].value="";break;case"Edm.Boolean":l[e].value=false;break;case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":l[e].value=0;break;default:break}}f.setParameter(l[e].$Name,l[e].value)}}}if(o.length){return new Promise(function(e){const a=n.mBindingParameters;const l=n.bGrouped;const d=n.bGetBoundContext;const p=[];let h;let M;let P;const x=function(e,a,o,r){m();P=!l?`$auto.${a}`:e.getUpdateGroupId();n.requestSideEffects=L.bind(q,t,o,n);h=R(e,n,d,P,g,i,r,a,s);p.push(h);L(t,o,n,P)};const v=function(e,a,o,l){const c=[];m();P=`apiMode${a}`;n.requestSideEffects=L.bind(q,t,o,n,P,c);h=R(e,n,d,P,g,i,l,a,s);p.push(h);c.push(h);L(t,o,n,P,c);r.submitBatch(P);return Promise.allSettled(c)};async function b(e){(u||function e(){})(p);function t(e,t,i){f=r.bindContext(`${c}(...)`,e,a);return v(f,t,{context:e,pathExpressions:n.additionalSideEffect&&n.additionalSideEffect.pathExpressions,triggerActions:n.additionalSideEffect&&n.additionalSideEffect.triggerActions},i)}await e.reduce(async(e,n,a)=>{await e;await t(n,a+1,o.length)},Promise.resolve());C()}if(!l){b(o)}else{for(M=0;M<o.length;M++){f=r.bindContext(`${c}(...)`,o[M],a);x(f,o.length<=1?null:M,{context:o[M],pathExpressions:n.additionalSideEffect&&n.additionalSideEffect.pathExpressions,triggerActions:n.additionalSideEffect&&n.additionalSideEffect.triggerActions},o.length)}(u||function e(){})(p);C()}function C(){return Promise.allSettled(p).then(e)}}).finally(function(){(d||function e(){})()})}else{f=r.bindContext(`/${c}(...)`);m();const t="actionImport";const a=f.execute(t,undefined,P.fnOnStrictHandlingFailed.bind(q,t,{label:n.label,model:r},g,null,null,null,i,s));r.submitBatch(t);(u||function e(){})(a);return a.then(function(e){if(e){return e}else{var t,n,a;return(t=(n=f).getBoundContext)===null||t===void 0?void 0:(a=t.call(n))===null||a===void 0?void 0:a.getObject()}}).catch(function(t){e.error("Error while executing action "+c,t);throw t}).finally(function(){(d||function e(){})()})}}function G(e,t){let n=e.getPath();n=e.getObject("$IsBound")?n.split("@$ui5.overload")[0]:n.split("/0")[0];return n.split(`/${t}`)[0]}function k(e,t,n,a){if(n){for(const e of t){if(e.$Name!=="ResultIsActiveEntity"&&!(n!==null&&n!==void 0&&n.find(t=>t.name===e.$Name))){return false}}}else if(e&&a){for(const e of t){if(!a[e.$Name]){return false}}}return true}function L(n,a,i,s,o){const r=n.getSideEffectsService();let l;if(a&&a.triggerActions&&a.triggerActions.length){a.triggerActions.forEach(function(e){if(e){l=r.executeAction(e,a.context,s);if(o){o.push(l)}}})}if(a&&a.pathExpressions&&a.pathExpressions.length>0){l=r.requestSideEffects(a.pathExpressions,a.context,s);if(o){o.push(l)}l.then(function(){if(i.operationAvailableMap&&i.internalModelContext){t.setActionEnablement(i.internalModelContext,JSON.parse(i.operationAvailableMap),i.selectedItems,"table")}}).catch(function(t){e.error("Error while requesting side effects",t)})}}const q={callBoundAction:A,callActionImport:$,callBoundFunction:O,callFunctionImport:y,executeDependingOnSelectedContexts:R,valuesProvidedForAllParameters:k,getActionParameterActionName:F,actionParameterShowMessageCallback:B,afterActionResolution:N};return q},false);
//# sourceMappingURL=operations.js.map