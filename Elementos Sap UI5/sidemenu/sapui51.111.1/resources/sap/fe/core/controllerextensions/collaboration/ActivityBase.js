/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/UriParameters","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/ui/core/ws/SapPcpWebSocket"],function(e,t,o,n){"use strict";var r={};var a=n.SUPPORTED_PROTOCOLS;var i=o.Activity;const s="/collaboration";const c="/collaboration/connected";const l="/collaboration/connection";const u="/collaboration/DraftID";function f(e){return!!e.getProperty(c)}r.isCollaborationConnected=f;function d(o,n,r,a,i,f){let d=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(i.getProperty(l)){if(i.getProperty(u)===r){return}else{P(i)}}const p=[o];i.setProperty(s,{activeUsers:p,activities:{}});d=d||t.fromQuery(window.location.search).get("useFLPUser")==="true";const h=b(o,n,r,a,d);i.setProperty(l,h);i.setProperty(u,r);h.attachMessage(function(e){const t=e.getParameter("pcpFields");f(t)});h.attachOpen(function(){i.setProperty(c,true)});h.attachError(function(){e.error(`The connection to the websocket channel ${n} could not be established`);i.setProperty(c,false)});h.attachClose(function(){i.setProperty(c,false)})}r.initializeCollaboration=d;function p(e,t,o,n){if(f(o)){const r=o.getProperty(l);r.send("",{clientAction:e,clientContent:t,clientTriggeredActionName:n});if(e===i.Activate||e===i.Discard){P(o)}}}r.broadcastCollaborationMessage=p;function P(e){const t=e.getProperty(l);t===null||t===void 0?void 0:t.close();e.setProperty(l,null);e.setProperty(u,undefined)}r.endCollaboration=P;function b(e,o,r,i){let s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;const c=window.location;let l;const u=t.fromQuery(window.location.search).get("useBackendUrl");if(u){l=u.replace("https","wss")}else{l=c.protocol==="https:"?"wss:":"ws:";l+=`//${c.host}`}l+=`${(o.startsWith("/")?"":"/")+o}?draft=${r}&relatedService=${i}`;if(s){l+=`&userID=${encodeURI(e.id)}&userName=${encodeURI(e.initialName||"")}`}return new n(l,[a.v10])}return r},false);
//# sourceMappingURL=ActivityBase.js.map