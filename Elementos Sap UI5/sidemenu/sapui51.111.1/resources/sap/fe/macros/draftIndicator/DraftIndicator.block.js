/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/strings/formatMessage","sap/base/util/deepClone","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/CommonUtils","sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/macros/ResourceModel","sap/m/Button","sap/m/library","sap/m/ObjectMarker","sap/m/Popover","sap/m/Text","sap/m/VBox","sap/fe/core/jsx-runtime/jsx","sap/fe/core/jsx-runtime/jsxs"],function(e,t,i,r,a,n,s,o,l,c,d,u,f,p,D,v){"use strict";var y,g,b,A,_,h,T,m,O,I,B,P,E,C,x;var M={};var R=c.ObjectMarkerVisibility;var U=c.ObjectMarkerType;var L=s.pathInModel;var N=s.or;var w=s.not;var V=s.isEmpty;var F=s.ifElse;var j=s.and;var k=n.convertMetaModelContext;var z=a.UI;var S=a.Entity;var H=i.defineBuildingBlock;var G=i.BuildingBlockBase;var K=i.blockAttribute;function J(e,t,i,r){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function W(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function X(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;Y(e,t)}function Y(e,t){Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return Y(e,t)}function $(e,t,i,r,a){var n={};Object.keys(r).forEach(function(e){n[e]=r[e]});n.enumerable=!!n.enumerable;n.configurable=!!n.configurable;if("value"in n||n.initializer){n.writable=true}n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n);if(a&&n.initializer!==void 0){n.value=n.initializer?n.initializer.call(a):void 0;n.initializer=undefined}if(n.initializer===void 0){Object.defineProperty(e,t,n);n=null}return n}function q(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let Q=(y=H({name:"DraftIndicator",namespace:"sap.fe.macros",isRuntime:true}),g=K({type:"string"}),b=K({type:"string"}),A=K({type:"string",defaultValue:"IconAndText",validate:e=>{if(e&&![R.IconOnly,R.IconAndText].includes(e)){throw new Error(`Allowed value ${e} does not match`)}}}),_=K({type:"sap.ui.model.Context",required:true,$kind:["EntitySet","NavigationProperty"]}),h=K({type:"boolean",defaultValue:false,bindable:true}),T=K({type:"string",defaultValue:""}),y(m=(O=function(i){X(a,i);function a(){var e;for(var t=arguments.length,r=new Array(t),a=0;a<t;a++){r[a]=arguments[a]}e=i.call(this,...r)||this;J(e,"id",I,W(e));J(e,"ariaLabelledBy",B,W(e));J(e,"draftIndicatorType",P,W(e));J(e,"entitySet",E,W(e));J(e,"isDraftIndicatorVisible",C,W(e));J(e,"class",x,W(e));return e}M=a;a.formatDraftOwnerTextInPopover=function e(t,i,r,a,n){if(t){const e=a||i||n||r;if(!e){return o.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_UNSAVED_CHANGES_BY_UNKNOWN")}else{return i?o.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_LOCKED_BY_KNOWN",[e]):o.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_UNSAVED_CHANGES_BY_KNOWN",[e])}}else{return o.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_NO_DATA_TEXT")}};var n=a.prototype;n.getDraftAdministrativeDataProperties=function e(){const t=this.entitySet.getModel().createBindingContext("DraftAdministrativeData",this.entitySet);const i=k(t);return i.targetType.entityProperties.map(e=>e.name)};n.getPopoverTitleBindingExpression=function e(){return F(w(S.IsActive),L("M_COMMON_DRAFT_OBJECT","sap.fe.i18n"),F(S.HasDraft,F(w(V(L("DraftAdministrativeData/InProcessByUser"))),L("M_COMMON_DRAFT_LOCKED_OBJECT","sap.fe.i18n"),L("M_DRAFT_POPOVER_ADMIN_UNSAVED_OBJECT","sap.fe.i18n")),this.draftIndicatorType===R.IconAndText?" ":L("C_DRAFT_POPOVER_ADMIN_DATA_DRAFTINFO_FLAGGED_OBJECT","sap.fe.i18n")))};n.getDraftOwnerTextBindingExpression=function e(){const t=this.getDraftAdministrativeDataProperties();const i=[{path:"HasDraftEntity",targetType:"any"},{path:"DraftAdministrativeData/InProcessByUser"},{path:"DraftAdministrativeData/LastChangedByUser"}];if(t.includes("InProcessByUserDescription")){i.push({path:"DraftAdministrativeData/InProcessByUserDescription"})}if(t.includes("LastChangedByUserDescription")){i.push({path:"DraftAdministrativeData/LastChangedByUserDescription"})}return{parts:i,formatter:a.formatDraftOwnerTextInPopover}};n.createPopover=function i(a){const n=j(w(S.IsActive),V(L("DraftAdministrativeData/LastChangeDateTime")));const s=this.draftIndicatorType===R.IconAndText?L("M_DRAFT_POPOVER_ADMIN_GENERIC_LOCKED_OBJECT_POPOVER_TEXT","sap.fe.i18n"):L("C_DRAFT_POPOVER_ADMIN_DATA_DRAFTINFO_POPOVER_NO_DATA_TEXT","sap.fe.i18n");const o=j(w(S.IsActive),w(V(L("DraftAdministrativeData/LastChangeDateTime"))));const c={parts:[{path:"M_DRAFT_POPOVER_ADMIN_LAST_CHANGE_TEXT",model:"sap.fe.i18n"},{path:"DraftAdministrativeData/LastChangeDateTime"}],formatter:e};const d=j(S.IsActive,w(V(L("DraftAdministrativeData/LastChangeDateTime"))));const y=t(c);const g=D(u,{title:this.getPopoverTitleBindingExpression(),showHeader:true,contentWidth:"15.625rem",verticalScrolling:false,class:"sapUiContentPadding",endButton:D(l,{icon:"sap-icon://decline",press:()=>{var e;return(e=this.draftPopover)===null||e===void 0?void 0:e.close()}}),children:v(p,{class:"sapUiContentPadding",children:[D(p,{visible:n,children:D(f,{text:s})}),D(p,{visible:o,children:D(f,{text:c})}),v(p,{visible:d,children:[D(f,{text:this.getDraftOwnerTextBindingExpression()}),D(f,{class:"sapUiSmallMarginTop",text:y})]})]})});r.getTargetView(a).addDependent(g);return g};n.onObjectMarkerPressed=function e(t){const i=t.getSource();const r=i.getBindingContext();this.draftPopover??=this.createPopover(i);this.draftPopover.setBindingContext(r);this.draftPopover.openBy(i,false)};n.getIconAndTextAdditionalInfoBindingExpression=function e(){const t=this.getDraftAdministrativeDataProperties();const i=[];if(t.includes("InProcessByUserDescription")){i.push(L("DraftAdministrativeData/InProcessByUserDescription"))}i.push(L("DraftAdministrativeData/InProcessByUser"));if(t.includes("LastChangedByUserDescription")){i.push(L("DraftAdministrativeData/LastChangedByUserDescription"))}i.push(L("DraftAdministrativeData/LastChangedByUser"));return F(S.HasDraft,N(...i),"")};n.getIconAndTextContent=function e(){const t=F(w(S.IsActive),U.Draft,F(S.HasDraft,F(L("DraftAdministrativeData/InProcessByUser"),U.LockedBy,F(L("DraftAdministrativeData/LastChangedByUser"),U.UnsavedBy,U.Unsaved)),U.Flagged));const i=F(w(S.HasDraft),R.TextOnly,R.IconAndText);return D(d,{type:t,press:this.onObjectMarkerPressed.bind(this),visibility:i,visible:this.isDraftIndicatorVisible,additionalInfo:this.getIconAndTextAdditionalInfoBindingExpression(),ariaLabelledBy:this.ariaLabelledBy?[this.ariaLabelledBy]:[],class:this.class})};n.getIconOnlyContent=function e(){const t=F(w(S.IsActive),U.Draft,F(S.HasDraft,F(L("DraftAdministrativeData/InProcessByUser"),U.Locked,U.Unsaved),U.Flagged));const i=j(w(z.IsEditable),S.HasDraft,w(L("DraftAdministrativeData/DraftIsCreatedByMe")));return D(d,{type:t,press:this.onObjectMarkerPressed.bind(this),visibility:R.IconOnly,visible:i,ariaLabelledBy:this.ariaLabelledBy?[this.ariaLabelledBy]:[],class:this.class})};n.getContent=function e(){if(this.draftIndicatorType===R.IconAndText){return this.getIconAndTextContent()}else{return this.getIconOnlyContent()}};return a}(G),I=$(O.prototype,"id",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),B=$(O.prototype,"ariaLabelledBy",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),P=$(O.prototype,"draftIndicatorType",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),E=$(O.prototype,"entitySet",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),C=$(O.prototype,"isDraftIndicatorVisible",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),x=$(O.prototype,"class",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),O))||m);M=Q;return M},false);
//# sourceMappingURL=DraftIndicator.block.js.map