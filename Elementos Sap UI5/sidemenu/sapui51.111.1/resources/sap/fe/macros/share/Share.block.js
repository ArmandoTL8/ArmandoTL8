/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/CommonUtils","sap/fe/core/controls/CommandExecution","sap/fe/core/helpers/ClassSupport","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/suite/ui/commons/collaboration/CollaborationHelper","sap/suite/ui/commons/collaboration/ServiceContainer","sap/ui/core/Core","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","sap/ushell/ui/footerbar/AddBookmarkButton","./ShareAPI","sap/fe/core/jsx-runtime/jsx"],function(e,t,i,n,r,o,a,s,l,u,c,d,p,m,v,f){"use strict";var b,h,g,S,y,M,_,w,I,B,A,O,z;var C={};var E=r.defineReference;var T=t.defineBuildingBlock;var P=t.BuildingBlockBase;var x=t.blockAttribute;function N(e,t,i,n){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function k(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function D(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;j(e,t)}function j(e,t){j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return j(e,t)}function R(e,t,i,n,r){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o);if(r&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(r):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function L(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let F=(b=T({name:"Share",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",isRuntime:true}),h=x({type:"string",required:true,isPublic:true}),g=x({type:"boolean",defaultValue:true,isPublic:true,bindable:true}),S=E(),y=E(),M=E(),b(_=(w=function(t){D(r,t);function r(){var e;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++){n[r]=arguments[r]}e=t.call(this,...n)||this;N(e,"id",I,k(e));N(e,"visible",B,k(e));N(e,"menuButton",A,k(e));N(e,"menu",O,k(e));N(e,"saveAsTileMenuItem",z,k(e));return e}C=r;var b=r.prototype;b._initializeMenuItems=async function e(t,i){const n=await l.isTeamsModeActive();if(n){var r,o;(r=this.menuButton.current)===null||r===void 0?void 0:r.unbindProperty("visible",true);(o=this.menuButton.current)===null||o===void 0?void 0:o.setVisible(false);return}const a=t.getController();const u=c.getLibraryResourceBundle("sap.fe.core");const d=i.getShellServices();const p=await d.waitForPluginsLoad();if(!p){var m;const e=(m=this.menuButton.current)===null||m===void 0?void 0:m.getAggregation("_control");e===null||e===void 0?void 0:e.attachEventOnce("press",{},()=>this._initializeMenuItems,this)}if(this.menu.current){this.menu.current.addItem(f(s,{text:u.getText("T_SEMANTIC_CONTROL_SEND_EMAIL"),icon:"sap-icon://email",press:()=>a.share._triggerEmail()}));this._addShellBasedMenuItems(a,d,u)}};b._addShellBasedMenuItems=async function e(t,i,n){var r,o;const a=i.hasUShell();const l=!!((r=(o=i.getUser()).isJamActive)!==null&&r!==void 0&&r.call(o));const c=await u.getServiceAsync();const v=c.getOptions();if(a){if(l){var b,h;this===null||this===void 0?void 0:(b=this.menu)===null||b===void 0?void 0:(h=b.current)===null||h===void 0?void 0:h.addItem(f(s,{text:n.getText("T_COMMON_SAPFE_SHARE_JAM"),icon:"sap-icon://share-2",press:()=>t.share._triggerShareToJam()}))}for(const e of v){var g,S,y;const t={text:e.text,icon:e.icon,items:[]};if(e!==null&&e!==void 0&&e.subOptions&&(e===null||e===void 0?void 0:(g=e.subOptions)===null||g===void 0?void 0:g.length)>0){t.items=[];e.subOptions.forEach(e=>{const i=new s({text:e.text,icon:e.icon,press:this.collaborationMenuItemPress,customData:new d({key:"collaborationData",value:e})});if(e.fesrStepName){p.setSemanticStepname(i,"press",e.fesrStepName)}t.items.push(i)})}else{t.press=this.collaborationMenuItemPress;t["customData"]=new d({key:"collaborationData",value:e})}const i=new s(t);if(t.press&&e.fesrStepName){p.setSemanticStepname(i,"press",e.fesrStepName)}this===null||this===void 0?void 0:(S=this.menu)===null||S===void 0?void 0:(y=S.current)===null||y===void 0?void 0:y.addItem(i)}const e=new m;if(e.getEnabled()){var M,_;this===null||this===void 0?void 0:(M=this.menu)===null||M===void 0?void 0:(_=M.current)===null||_===void 0?void 0:_.addItem(f(s,{ref:this.saveAsTileMenuItem,text:e.getText(),icon:e.getIcon(),press:()=>t.share._saveAsTile(this.saveAsTileMenuItem.current),children:{dependents:[e]}}))}else{e.destroy()}}};b.collaborationMenuItemPress=async function e(t){const n=t.getSource();const r=await u.getServiceAsync();const o=i.getTargetView(n);const a=o.getController();await a.share._adaptShareMetadata();const s=o.getModel("collaborationInfo").getData();r.share(n.data("collaborationData"),s)};b.getContent=function t(i,r){const s=f(v,{id:this.id,children:f(a,{ref:this.menuButton,icon:"sap-icon://action",visible:this.visible,tooltip:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE} (Ctrl+Shift+S)",children:f(o,{ref:this.menu})})});i.addDependent(f(n,{visible:this.visible,enabled:this.visible,command:"Share",execute:()=>{var e;return(e=this.menuButton.current)===null||e===void 0?void 0:e.getMenu().openBy(this.menuButton.current,true)}}));this.isInitialized=this._initializeMenuItems(i,r).catch(t=>{e.error(t)});return s};return r}(P),I=R(w.prototype,"id",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),B=R(w.prototype,"visible",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),A=R(w.prototype,"menuButton",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),O=R(w.prototype,"menu",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),z=R(w.prototype,"saveAsTileMenuItem",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),w))||_);C=F;return C},false);
//# sourceMappingURL=Share.block.js.map