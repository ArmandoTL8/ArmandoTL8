/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/internal/helpers/TableTemplating","sap/fe/macros/MacroMetadata"],function(e,t,a,n,i,o,r,l){"use strict";var s=r.buildExpressionForHeaderVisible;var u=o.getContextRelativeTargetObjectPath;var c=i.generate;var d=n.getInvolvedDataModelObjects;var p=a.getVisualizationsFromPresentationVariant;var b=a.getDataVisualizationConfiguration;const f=l.extend("sap.fe.macros.table.Table",{name:"Table",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",fragment:"sap.fe.macros.table.Table",metadata:{stereotype:"xmlmacro",properties:{tableDefinition:{type:"sap.ui.model.Context"},metaPath:{type:"sap.ui.model.Context",isPublic:true},contextPath:{type:"sap.ui.model.Context",isPublic:true},collection:{type:"sap.ui.model.Context",required:true,$kind:["EntitySet","NavigationProperty","Singleton"]},parentEntitySet:{type:"sap.ui.model.Context"},id:{type:"string",isPublic:true},_apiId:{type:"string"},navigationPath:{type:"string"},readOnly:{type:"boolean",isPublic:true},fieldMode:{type:"string",defaultValue:"",allowedValues:["","nowrapper"]},disableAddRowButtonForEmptyData:{type:"boolean"},customValidationFunction:{type:"string"},useCondensedTableLayout:{type:"boolean"},rowAction:{type:"string",defaultValue:undefined},selectionMode:{type:"string",isPublic:true},busy:{type:"boolean",isPublic:true},enableFullScreen:{type:"boolean",isPublic:true},header:{type:"string",isPublic:true},headerVisible:{type:"boolean",isPublic:true},headerLevel:{type:"sap.ui.core.TitleLevel",defaultValue:"Auto",isPublic:true},noDataText:{type:"string"},creationMode:{type:"string"},createAtEnd:{type:"boolean"},createOutbound:{type:"string"},createOutboundDetail:{type:"string"},createNewAction:{type:"string"},personalization:{type:"string|boolean",isPublic:true},isSearchable:{type:"boolean",isPublic:true},type:{type:"string",isPublic:true},tableType:{type:"string"},enableExport:{type:"boolean",isPublic:true},enablePaste:{type:"boolean",isPublic:true},selectionLimit:{type:"string"},multiSelectMode:{type:"string"},filterBar:{type:"string",isPublic:true},filterBarId:{type:"string"},tableDelegate:{type:"string"},enableAutoScroll:{type:"boolean"},visible:{type:"string"},isAlp:{type:"boolean",defaultValue:false},variantManagement:{type:"string",isPublic:true},columnEditMode:{type:"string",computed:true},tabTitle:{type:"string",defaultValue:""},isOptimizedForSmallDevice:{type:"boolean"},enableAutoColumnWidth:{type:"boolean"},dataStateIndicatorFilter:{type:"string"},isCompactType:{type:"boolean"}},events:{variantSaved:{type:"function"},variantSelected:{type:"function"},onChange:{type:"function"},rowPress:{type:"function",isPublic:true},onContextChange:{type:"function"},onSegmentedButtonPressed:{type:"function"},stateChange:{type:"function"},selectionChange:{type:"function",isPublic:true}},aggregations:{actions:{type:"sap.fe.macros.internal.table.Action | sap.fe.macros.internal.table.ActionGroup",isPublic:true},columns:{type:"sap.fe.macros.internal.table.Column",isPublic:true}}},create:function(e,a,n,i){let o;const r=d(e.metaPath,e.contextPath);if(!e.tableDefinition){const t=this.getConverterContext(r,e.contextPath,n);const a=this._getVisualizationPath(r,t);const l=this._getPresentationPath(r);const s=this._buildActions(i.actions);const u=this.parseAggregation(i.columns,function(e,t){var a;const n=e.getAttribute("key")||"InlineXMLColumn_"+t;i[n]=e;return{key:n,type:"Slot",width:e.getAttribute("width"),importance:e.getAttribute("importance"),horizontalAlign:e.getAttribute("horizontalAlign"),availability:e.getAttribute("availability"),header:e.getAttribute("header"),template:((a=e.children[0])===null||a===void 0?void 0:a.outerHTML)||"",properties:e.getAttribute("properties")?e.getAttribute("properties").split(","):undefined,position:{placement:e.getAttribute("positionPlacement"),anchor:e.getAttribute("positionAnchor")}}});const c={};let d={enableExport:e.enableExport,enableFullScreen:e.enableFullScreen,enablePaste:e.enablePaste,selectionMode:e.selectionMode,type:e.type};d=JSON.parse(JSON.stringify(d));c[a]={actions:s,columns:u,tableSettings:d};const p=this.getConverterContext(r,e.contextPath,n,c);const f=b(a,e.useCondensedLayout,p,undefined,undefined,l,true);o=f.visualizations[0];e.tableDefinition=this.createBindingContext(o,n)}else{o=e.tableDefinition.getObject()}o.path="{_pageModel>"+e.tableDefinition.getPath()+"}";this.setDefaultValue(e,"selectionMode",o.annotation.selectionMode,true);this.setDefaultValue(e,"enableFullScreen",o.control.enableFullScreen,true);this.setDefaultValue(e,"enableExport",o.control.enableExport,true);this.setDefaultValue(e,"enablePaste",o.annotation.standardActions.actions.paste.enabled,true);this.setDefaultValue(e,"updatablePropertyPath",o.annotation.standardActions.updatablePropertyPath,true);this.setDefaultValue(e,"type",o.control.type,true);this.setDefaultValue(e,"useCondensedTableLayout",o.control.useCondensedTableLayout);this.setDefaultValue(e,"disableAddRowButtonForEmptyData",o.control.disableAddRowButtonForEmptyData);this.setDefaultValue(e,"customValidationFunction",o.control.customValidationFunction);this.setDefaultValue(e,"headerVisible",o.control.headerVisible);this.setDefaultValue(e,"searchable",o.annotation.searchable);this.setDefaultValue(e,"showRowCount",o.control.showRowCount);this.setDefaultValue(e,"inlineCreationRowCount",o.control.inlineCreationRowCount);this.setDefaultValue(e,"header",o.annotation.title);this.setDefaultValue(e,"selectionLimit",o.control.selectionLimit);this.setDefaultValue(e,"isCompactType",o.control.isCompactType);this.setDefaultValue(e,"inlineCreationRowsHiddenInEditMode",o.annotation.inlineCreationRowsHiddenInEditMode);if(e.id){e._apiId=e.id;e.id=this.getContentId(e.id)}else{this.setDefaultValue(e,"id",o.annotation.id);e._apiId=o.annotation.id+"::Table"}this.setDefaultValue(e,"creationMode",o.annotation.create.mode);this.setDefaultValue(e,"createAtEnd",o.annotation.create.append);this.setDefaultValue(e,"createOutbound",o.annotation.create.outbound);this.setDefaultValue(e,"createNewAction",o.annotation.create.newAction);this.setDefaultValue(e,"createOutboundDetail",o.annotation.create.outboundDetail);this.setDefaultValue(e,"personalization",o.annotation.p13nMode);this.setDefaultValue(e,"variantManagement",o.annotation.variantManagement);this.setDefaultValue(e,"enableAutoColumnWidth",true);this.setDefaultValue(e,"dataStateIndicatorFilter",o.control.dataStateIndicatorFilter);this.setDefaultValue(e,"isOptimizedForSmallDevice",t.isSmallDevice());switch(e.readOnly){case"false":e.readOnly=false;break;case"true":e.readOnly=true;break;default:}switch(e.enableAutoColumnWidth){case"false":e.enableAutoColumnWidth=false;break;case"true":e.enableAutoColumnWidth=true;break;default:}if(e.readOnly===undefined&&o.annotation.displayMode===true){e.readOnly=true}if(e.rowPress){e.rowAction="Navigation"}this.setDefaultValue(e,"rowPress",o.annotation.row.press);this.setDefaultValue(e,"rowAction",o.annotation.row.action);if(e.personalization==="false"){e.personalization=undefined}else if(e.personalization==="true"){e.personalization="Sort,Column,Filter"}switch(e.personalization){case"false":e.personalization=undefined;break;case"true":e.personalization="Sort,Column,Filter";break;default:}if(e.isSearchable==="false"){e.searchable=false}else{e.searchable=o.annotation.searchable}let l=false;if(!e.filterBar&&!e.filterBarId&&e.searchable){e.filterBarId=c([e.id,"StandardAction","BasicSearch"]);l=true}e.useBasicSearch=l;e.tableType=e.type;e.showCreate=o.annotation.standardActions.actions.create.visible||true;e.autoBindOnInit=o.annotation.autoBindOnInit;e.navigationPath=o.annotation.navigationPath;if(o.annotation.collection.startsWith("/")&&r.startingEntitySet._type==="Singleton"){o.annotation.collection=e.navigationPath}e.parentEntitySet=n.models.metaModel.createBindingContext("/"+(r.contextLocation.targetEntitySet?r.contextLocation.targetEntitySet.name:r.startingEntitySet.name));e.collection=n.models.metaModel.createBindingContext(o.annotation.collection);switch(e.readOnly){case true:e.columnEditMode="Display";break;case false:e.columnEditMode="Editable";break;default:e.columnEditMode=undefined}e.headerBindingExpression=s(e);return e},_buildActions:function(e){const t={};if(e&&e.children.length>0){const a=Array.prototype.slice.apply(e.children);let n=0;a.forEach(function(e){n++;let a=[];if(e.children.length&&e.localName==="ActionGroup"&&e.namespaceURI==="sap.fe.macros"){const i=Array.prototype.slice.apply(e.children);i.forEach(function(e){const a=e.getAttribute("key")||"InlineXMLAction_"+n;const i={key:a,text:e.getAttribute("text"),__noWrap:true,press:e.getAttribute("press"),requiresSelection:e.getAttribute("requiresSelection")==="true",enabled:e.getAttribute("enabled")===null?true:e.getAttribute("enabled")};t[i.key]=i;n++});a=Object.values(t).slice(-e.children.length).map(function(e){return e.key})}const i=e.getAttribute("key")||"InlineXMLAction_"+n;const o={key:i,text:e.getAttribute("text"),position:{placement:e.getAttribute("placement"),anchor:e.getAttribute("anchor")},__noWrap:true,press:e.getAttribute("press"),requiresSelection:e.getAttribute("requiresSelection")==="true",enabled:e.getAttribute("enabled")===null?true:e.getAttribute("enabled"),menu:a.length?a:null};t[o.key]=o})}return t},_getVisualizationPath:function(t,a){const n=u(t);if(t.targetObject.term==="com.sap.vocabularies.UI.v1.LineItem"){return n}const i=a.getEntityTypeAnnotation(n);let o=[];switch(t.targetObject.term){case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":if(t.targetObject.PresentationVariant){o=p(t.targetObject.PresentationVariant,n,i.converterContext,true)}break;case"com.sap.vocabularies.UI.v1.PresentationVariant":o=p(t.targetObject,n,i.converterContext,true);break;default:e.error(`Bad metapath parameter for table : ${t.targetObject.term}`)}const r=o.find(e=>e.visualization.term==="com.sap.vocabularies.UI.v1.LineItem");if(r){return r.annotationPath}else{return n}},_getPresentationPath:function(e){let t;switch(e.targetObject.term){case"com.sap.vocabularies.UI.v1.PresentationVariant":t=u(e);break;case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":t=u(e)+"/PresentationVariant";break;default:t=null}return t}});return f},false);
//# sourceMappingURL=Table.metadata.js.map