/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingToolkit","sap/fe/macros/DelegateUtil","sap/fe/macros/field/FieldRuntime","sap/fe/macros/filter/FilterUtils","sap/ui/core/Component","sap/ui/core/format/NumberFormat","sap/ui/model/Filter"],function(e,t,n,i,o,r,a,s,c){"use strict";var l=n.pathInModel;var f=n.compileExpression;function u(e,n){const i=e.data("entityType"),o=t.getAppComponent(e).getMetaModel(),r=o.getObject(`${i}${n}`),a={},s=[],l=[];let f="";if(r){f=r.Text;(r.SelectOptions||[]).filter(function(e){return e&&e.PropertyName&&e.PropertyName.$PropertyPath}).forEach(function(e){const t=e.PropertyName.$PropertyPath;if(!l.includes(t)){l.push(t)}for(const n in e.Ranges){const i=e.Ranges[n];a[t]=(a[t]||[]).concat(new c(t,i.Option.$EnumMember.split("/").pop(),i.Low,i.High))}});for(const e in a){s.push(new c({filters:a[e],and:false}))}}return{properties:l,filters:s,text:f}}function m(e){let t=[];const n=e.data("hiddenFilters");if(n&&Array.isArray(n.paths)){n.paths.forEach(function(n){const i=u(e,n.annotationPath);t=t.concat(i.filters)})}return t}function g(e){let t=[];const n=i.getCustomData(e,"quickFilterKey");if(n){t=t.concat(u(e,n).filters)}return t}function d(e){return g(e).concat(m(e))}function p(e,t,n){let i;const o=e.data("rowsBindingInfo"),r=e.getModel();const a=n.batchGroupId||"",s=h(e);let l=Array.isArray(n.additionalFilters)?n.additionalFilters:[];const f=s.bindingPath?s.bindingPath:o.path;l=l.concat(s.filters).concat(P(e));const u=new c({filters:l,and:true});const m=r.bindList((t?`${t.getPath()}/`:"")+f,e.getBindingContext(),[],u);return m.fetchFilter(m.getContext()).then(function(e){i=r.bindProperty(`${m.getPath()}/$count`,m.getContext(),{$$groupId:a||"$auto",$filter:e[0],$search:s.search});return i.requestValue()}).then(function(e){i.destroy();m.destroy();return e})}function b(e){const t=s.getIntegerInstance({groupingEnabled:true});return t.format(e)}function h(e){const t=e.getParent().getTableDefinition();let n=[];function i(e){const t=e.getParent().getTableDefinition().aggregates;return Object.keys(t).map(function(e){return t[e].relativePath})}if(t.enableAnalytics){n=n.concat(i(e));if(!t.enableAnalyticsSearch){n=n.concat(["search"])}}return r.getFilterInfo(e.getFilter(),{ignoredProperties:n,targetControl:e})}function P(e){const t=e.getP13nMode();if(t&&t.indexOf("Filter")>-1){const t=(i.getCustomData(e,"sap_fe_TableDelegate_propertyInfoMap")||[]).filter(function(e){return e&&!(e.filterable===false)}),n=r.getFilterInfo(e,{propertiesMetadata:t});if(n&&n.filters){return n.filters}}return[]}function O(e){const t=h(e);return{filters:t.filters.concat(d(e),P(e)),search:t.search,bindingPath:t.bindingPath}}function j(e){return y(e).promise}function F(e){const t=y(e);if(t.resolve){t.resolve(e);e.data("boundPromiseResolve",null)}}function y(e){if(!e.data("boundPromise")){let t;e.data("boundPromise",new Promise(function(e){t=e}));if(e.isBound()){t(e)}else{e.data("boundPromiseResolve",t)}}return{promise:e.data("boundPromise"),resolve:e.data("boundPromiseResolve")}}function C(e,n,i){e.filters=i;if(n.search){e.parameters.$search=t.normalizeSearchTerm(n.search)}else{e.parameters.$search=undefined}}function $(n,r){const s=n.getView();const c=s.getBindingContext("internal");if(c){const u=i.getCustomData(r,"targetCollectionPath");if(u){const i=n.getOwnerComponent();const m=a.getOwnerComponentFor(i);const g=m.getMetaModel();const d=t.getShellServices(m);const p=o._fnFixHashQueryString(t.getHash());const b=r.getParent().getTableDefinition().columns;const h=[];const P=[];const O=[];let j="",F,y;let C;const $=[];let v,x;for(let e=0;e<b.length;e++){F=b[e].annotationPath;if(F){y=g.getObject(F);if(y&&y.$kind==="Property"){j=b[e].annotationPath}else if(y&&y.$Type==="com.sap.vocabularies.UI.v1.DataField"){j=`${u}/${g.getObject(`${F}/Value/$Path`)}`}}if(j!==""){const e=Object.keys(g.getObject(j+"@"));for(let n=0;n<e.length;n++){if(!O.includes(j)&&e[n].indexOf(`@${"com.sap.vocabularies.Common.v1.SemanticObject"}`)===0&&e[n].indexOf(`@${"com.sap.vocabularies.Common.v1.SemanticObjectMapping"}`)===-1&&e[n].indexOf(`@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}`)===-1){x=/#(.*)/.exec(e[n]);v=x?x[1]:"";$.push(t.getSemanticObjectPromise(m,s,g,j,v));O.push(j)}}}j=""}if($.length===0){return Promise.resolve()}else{Promise.all($).then(function(e){const n=[];let i;const o=e.filter(function(e){if(e.semanticObject&&typeof e.semanticObject.semanticObject==="object"){i=f(l(e.semanticObject.semanticObject.$Path));e.semanticObject.semanticObject=i;e.semanticObjectForGetLinks[0].semanticObject=i;return true}else if(e){return e.semanticObject!==undefined}else{return false}});for(let e=0;e<o.length;e++){C=o[e];if(C&&C.semanticObject&&!(C.semanticObject.semanticObject.indexOf("{")===0)){h.push(C.semanticObjectForGetLinks);P.push({semanticObject:C.semanticObject&&C.semanticObject.semanticObject,unavailableActions:C.unavailableActions,path:o[e].semanticObjectPath});n.push(d.getLinksWithCache([C.semanticObjectForGetLinks]))}}return t.updateSemanticTargets(n,P,c,p)}).catch(function(t){e.error("fnGetSemanticTargetsFromTable: Cannot get Semantic Objects",t)})}}}}function v(e){e.clearSelection();const t=e.getBindingContext("internal");if(t){t.setProperty("deleteEnabled",false);t.setProperty("numberOfSelectedContexts",0);t.setProperty("selectedContexts",[]);t.setProperty("deletableContexts",[])}}const x={getCountFormatted:b,getHiddenFilters:m,getFiltersInfoForSV:u,getTableFilters:d,getListBindingForCount:p,getFilterInfo:h,getP13nFilters:P,getAllFilterInfo:O,whenBound:j,onTableBound:F,getSemanticTargetsFromTable:$,updateBindingInfo:C,clearSelection:v};return x},false);
//# sourceMappingURL=Utils.js.map