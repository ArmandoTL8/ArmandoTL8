/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/routing/NavigationReason","sap/fe/core/converters/ManifestSettings","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/PasteHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/filter/FilterUtils","sap/fe/macros/ResourceModel","sap/fe/macros/table/Utils","sap/m/MessageBox","sap/ui/core/Core","sap/ui/core/message/Message","../MacroAPI"],function(e,t,n,r,i,o,a,l,s,u,c,p,d,g){"use strict";var f,b,y,h,m,v,w,P,C,E,D,T,x,z,I,M,R,B,S,O,A,V,F,_,j,$,U,L,N,q,k,H,W,G,K,J,Q,X,Y,Z,ee,te,ne,re,ie,oe,ae,le,se,ue,ce,pe,de,ge,fe,be,ye,he,me,ve,we,Pe,Ce,Ee,De,Te,xe,ze,Ie;var Me=i.xmlEventHandler;var Re=i.property;var Be=i.event;var Se=i.defineUI5Class;var Oe=i.aggregation;var Ae=r.CreationMode;function Ve(e,t,n,r){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Fe(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function _e(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;je(e,t)}function je(e,t){je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return je(e,t)}function $e(e,t,n,r,i){var o={};Object.keys(r).forEach(function(e){o[e]=r[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o);if(i&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(i):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function Ue(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let Le=(f=Se("sap.fe.macros.table.TableAPI"),b=Re({type:"string",expectedTypes:["EntitySet","EntityType","Singleton","NavigationProperty"],expectedAnnotations:["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"]}),y=Re({type:"sap.ui.model.Context"}),h=Re({type:"boolean"}),m=Re({type:"string"}),v=Re({type:"boolean",defaultValue:false}),w=Re({type:"string",defaultValue:"ResponsiveTable"}),P=Re({type:"boolean",defaultValue:true}),C=Re({type:"boolean",defaultValue:false}),E=Re({type:"boolean",defaultValue:false}),D=Re({type:"string"}),T=Re({type:"string"}),x=Re({type:"string"}),z=Re({type:"boolean",defaultValue:true}),I=Re({type:"boolean",defaultValue:false}),M=Re({type:"boolean",defaultValue:true}),R=Oe({type:"sap.fe.macros.table.Action"}),B=Oe({type:"sap.fe.macros.table.Column"}),S=Re({type:"boolean",defaultValue:false}),O=Re({type:"boolean",defaultValue:false}),A=Re({type:"boolean",defaultValue:false}),V=Re({type:"boolean",defaultValue:false}),F=Be(),_=Be(),j=Be(),$=Re({type:"boolean|string",defaultValue:true}),U=Re({type:"string"}),L=Re({type:"string"}),N=Re({type:"boolean",defaultValue:true}),q=Be(),k=Me(),H=Me(),W=Me(),G=Me(),K=Me(),J=Me(),Q=Me(),X=Me(),f(Y=(Z=function(r){_e(i,r);function i(e){var t;for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++){i[o-1]=arguments[o]}t=r.call(this,e,...i)||this;Ve(t,"metaPath",ee,Fe(t));Ve(t,"tableDefinition",te,Fe(t));Ve(t,"readOnly",ne,Fe(t));Ve(t,"id",re,Fe(t));Ve(t,"busy",ie,Fe(t));Ve(t,"type",oe,Fe(t));Ve(t,"enableExport",ae,Fe(t));Ve(t,"enablePaste",le,Fe(t));Ve(t,"enableFullScreen",se,Fe(t));Ve(t,"filterBar",ue,Fe(t));Ve(t,"selectionMode",ce,Fe(t));Ve(t,"header",pe,Fe(t));Ve(t,"enableAutoColumnWidth",de,Fe(t));Ve(t,"isOptimizedForSmallDevice",ge,Fe(t));Ve(t,"headerVisible",fe,Fe(t));Ve(t,"actions",be,Fe(t));Ve(t,"columns",ye,Fe(t));Ve(t,"dataInitialized",he,Fe(t));Ve(t,"bindingSuspended",me,Fe(t));Ve(t,"outDatedBinding",ve,Fe(t));Ve(t,"pendingRequest",we,Fe(t));Ve(t,"rowPress",Pe,Fe(t));Ve(t,"stateChange",Ce,Fe(t));Ve(t,"internalDataRequested",Ee,Fe(t));Ve(t,"personalization",De,Fe(t));Ve(t,"variantManagement",Te,Fe(t));Ve(t,"menu",xe,Fe(t));Ve(t,"isSearchable",ze,Fe(t));Ve(t,"selectionChange",Ie,Fe(t));t.updateFilterBar();if(t.content){t.content.attachEvent("selectionChange",{},t.onTableSelectionChange,Fe(t))}return t}var g=i.prototype;g.getSelectedContexts=function e(){return this.content.getSelectedContexts()};g.addMessage=function e(t){const n=this._getMessageManager();const r=this.content;const i=new d({target:r.getRowBinding().getResolvedPath(),type:t.type,message:t.message,processor:r.getModel(),description:t.description,persistent:t.persistent});n.addMessages(i);return i.getId()};g.removeMessage=function e(t){const n=this._getMessageManager();const r=n.getMessageModel().getData();const i=r.find(e=>e.id===t);if(i){n.removeMessages(i)}};g._getMessageManager=function e(){return sap.ui.getCore().getMessageManager()};g._getRowBinding=function e(){const t=this.getContent();return t.getRowBinding()};g.getCounts=function e(){const t=this.getContent();return u.getListBindingForCount(t,t.getBindingContext(),{batchGroupId:!this.getProperty("bindingSuspended")?t.data("batchGroupId"):"$auto",additionalFilters:u.getHiddenFilters(t)}).then(e=>u.getCountFormatted(e)).catch(()=>"0")};g.onTableRowPress=function e(t,r,i,o){if(i&&i.isInactive()&&i.isTransient()){return false}if(this.getTableDefinition().enableAnalytics&&i&&i.isA("sap.ui.model.odata.v4.Context")&&typeof i.getProperty("@$ui5.node.isExpanded")==="boolean"){return false}else{const e=Object.assign({},o,{reason:n.RowPress});r._routing.navigateForwardToContext(i,e)}};g.onInternalDataReceived=function e(t){if(t.getParameter("error")){this.getController().messageHandler.showMessageDialog()}};g.onInternalDataRequested=function e(t){this.setProperty("dataInitialized",true);this.fireEvent("internalDataRequested",t.getParameters())};g.onPaste=function e(t,n){if(!this.tableDefinition.control.enablePaste||!this.getModel("ui").getProperty("/isEditable")){return}const r=t.getParameter("data"),i=t.getSource();if(i.getEnablePaste()===true){o.pasteData(r,i,n)}else{const e=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");c.error(e.getText("T_OP_CONTROLLER_SAPFE_PASTE_DISABLED_MESSAGE"),{title:e.getText("C_COMMON_SAPFE_ERROR")})}};g.onBeforeExport=function e(t){var n;const r=t.getParameter("userExportSettings").splitCells,o=t.getSource(),a=(n=t.getParameter("exportSettings").workbook)===null||n===void 0?void 0:n.columns,l=this.tableDefinition.columns;i.updateExportSettings(a,l,o,r)};i.dataStateIndicatorFilter=function e(t,n){var r;const i=(r=n.getBindingContext())===null||r===void 0?void 0:r.getPath();const o=(i?`${i}/`:"")+n.getRowBinding().getPath();return o===t.getTarget()?true:false};g.onDataStateChange=function e(t){const n=t.getSource();const r=t.getParameter("filteredMessages");if(r){const e=n.getModel("internal");e.setProperty("filteredMessages",r,n.getBindingContext("internal"))}};i.updateExportSettings=function e(t,n,r,i){for(let e=t.length-1;e>=0;e--){const o=t[e];o.label=a.getLocalizedText(o.label,r);if(o.type==="Boolean"){o.falseValue=s.getText("no");o.trueValue=s.getText("yes")}const l=n===null||n===void 0?void 0:n.find(e=>{if(i){return this._columnWithTargetValueToBeAdded(e,o)}else{return false}});if(l){const n={label:s.getText("TargetValue"),property:Array.isArray(o.property)?o.property:[o.property],template:l.exportDataPointTargetValue};t.splice(e+1,0,n)}}return t};i._columnWithTargetValueToBeAdded=function e(t,n){var r;let i=false;if(t.exportDataPointTargetValue&&((r=t.propertyInfos)===null||r===void 0?void 0:r.length)===1){if(t.relativePath===n.property||n.property[0]===t.propertyInfos[0]||n.property.includes(t.relativePath)||n.property.includes(t.name)){delete n.template;i=true}}return i};g.resumeBinding=function e(t){this.setProperty("bindingSuspended",false);if(t&&!this.getDataInitialized()||this.getProperty("outDatedBinding")){var n;this.setProperty("outDatedBinding",false);(n=this.getContent())===null||n===void 0?void 0:n.rebind()}};g.refreshNotApplicableFields=function e(t){const n=this.getContent();return l.getNotApplicableFilters(t,n)};g.suspendBinding=function e(){this.setProperty("bindingSuspended",true)};g.invalidateContent=function e(){this.setProperty("dataInitialized",false);this.setProperty("outDatedBinding",false)};g.onMassEditButtonPressed=function t(n,r){const i=this.content;if(r&&r.massEdit){r.massEdit.openMassEditDialog(i)}else{e.warning("The Controller is not enhanced with Mass Edit functionality")}};g.onTableSelectionChange=function e(t){this.fireEvent("selectionChange",t.getParameters())};g.getTableDefinition=function e(){return this.tableDefinition};g.updateFilterBar=function e(){const t=this.getContent();const n=this.getFilterBar();if(t&&n&&t.getFilter()!==n){this._setFilterBar(n)}};g._setFilterBar=function e(n){var r;const i=this.getContent();const o=this===null||this===void 0?void 0:this.getId();const a=this.data("tableAPILocalId");const l=a&&n&&o&&o.replace(new RegExp(a+"$"),n);const s=((r=t.getTargetView(this))===null||r===void 0?void 0:r.byId(n))||p.byId(n)||p.byId(l);if(s){if(s.isA("sap.fe.macros.filterBar.FilterBarAPI")){i.setFilter(`${s.getId()}-content`)}else if(s.isA("sap.ui.mdc.FilterBar")){i.setFilter(s.getId())}}};g.checkIfColumnExists=function e(t,n){return t.some(function(e){if((e===null||e===void 0?void 0:e.columnName)===n&&e!==null&&e!==void 0&&e.sColumnNameVisible||(e===null||e===void 0?void 0:e.sTextArrangement)!==undefined&&(e===null||e===void 0?void 0:e.sTextArrangement)===n){return n}})};g.getIdentifierColumn=function e(){const t=this.getContent();const n=this.getTableDefinition().headerInfoTitle;const r=t&&t.getModel().getMetaModel(),i=t.data("metaPath");const o=r.getObject(`${i}/$Type/$Key`);const a=[];if(o&&o.length>0){o.forEach(function(e){if(e!=="IsActiveEntity"){a.push(e)}})}const l=this.getTableDefinition().semanticKeys;const s=[];const u=[];const c=t.getColumns();c.forEach(function(e){const t=e===null||e===void 0?void 0:e.getDataProperty();s.push(t)});s.forEach(function(e){var t,n;const o=r.getObject(`${i}/$Type/${e}@`);const a=o&&((t=o["@com.sap.vocabularies.Common.v1.Text"])===null||t===void 0?void 0:t.$Path);const l=o&&((n=o["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"])===null||n===void 0?void 0:n.$EnumMember);u.push({columnName:e,sTextArrangement:a,sColumnNameVisible:!(l==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly")})});let p;if(n!==undefined&&this.checkIfColumnExists(u,n)){p=n}else if(l!==undefined&&l.length===1&&this.checkIfColumnExists(u,l[0])){p=l[0]}else if(a!==undefined&&a.length===1&&this.checkIfColumnExists(u,a[0])){p=a[0]}return p};g.setUpEmptyRows=async function e(t){var n,r,i;let o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(((n=this.tableDefinition.control)===null||n===void 0?void 0:n.creationMode)!==Ae.InlineCreationRows){return}if((r=this.tableDefinition.control)!==null&&r!==void 0&&r.inlineCreationRowsHiddenInEditMode&&!((i=t.getBindingContext("ui"))!==null&&i!==void 0&&i.getProperty("createMode"))&&!o){return}const a=new Promise(e=>{if(t.getDomRef()){e()}else{const n={onAfterRendering:function(){t.removeEventDelegate(n);e()}};t.addEventDelegate(n,this)}});await a;const l=t.getModel("ui");if(l.getProperty("/isEditablePending")){const e=l.bindProperty("/isEditablePending");await new Promise(t=>{const n=()=>{e.detachChange(n);e.destroy();t()};e.attachChange(n)})}const s=l.getProperty("/isEditable");if(!s){return}const u=t.getRowBinding();if(u.isResolved()&&u.isLengthFinal()){const e=u.getContext().getPath();const n=u.getAllCurrentContexts().find(function(t){return t.isInactive()&&t.getPath().startsWith(e)});if(!n){await this._createEmptyRow(u,t)}}};g._createEmptyRow=async function n(r,i){var o;const a=((o=this.tableDefinition.control)===null||o===void 0?void 0:o.inlineCreationRowCount)||2;const l=[];for(let e=0;e<a;e+=1){l.push({})}const s=i.data("tableType")!=="ResponsiveTable";const u=true;const c=t.getTargetView(i);const p=c.getController();const d=p._editFlow;if(!this.creatingEmptyRows){this.creatingEmptyRows=true;try{const e=await d.createMultipleDocuments(r,l,s,false,p.editFlow.onBeforeCreate,u);e===null||e===void 0?void 0:e.forEach(function(e){e.created().catch(function(e){if(!e.canceled){throw e}})})}catch(t){e.error(t)}finally{this.creatingEmptyRows=false}}};return i}(g),ee=$e(Z.prototype,"metaPath",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),te=$e(Z.prototype,"tableDefinition",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=$e(Z.prototype,"readOnly",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),re=$e(Z.prototype,"id",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),ie=$e(Z.prototype,"busy",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=$e(Z.prototype,"type",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=$e(Z.prototype,"enableExport",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),le=$e(Z.prototype,"enablePaste",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),se=$e(Z.prototype,"enableFullScreen",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=$e(Z.prototype,"filterBar",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=$e(Z.prototype,"selectionMode",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=$e(Z.prototype,"header",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),de=$e(Z.prototype,"enableAutoColumnWidth",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=$e(Z.prototype,"isOptimizedForSmallDevice",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=$e(Z.prototype,"headerVisible",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),be=$e(Z.prototype,"actions",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),ye=$e(Z.prototype,"columns",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),he=$e(Z.prototype,"dataInitialized",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),me=$e(Z.prototype,"bindingSuspended",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),ve=$e(Z.prototype,"outDatedBinding",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),we=$e(Z.prototype,"pendingRequest",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),Pe=$e(Z.prototype,"rowPress",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),Ce=$e(Z.prototype,"stateChange",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),Ee=$e(Z.prototype,"internalDataRequested",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),De=$e(Z.prototype,"personalization",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),Te=$e(Z.prototype,"variantManagement",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),xe=$e(Z.prototype,"menu",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),ze=$e(Z.prototype,"isSearchable",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),Ie=$e(Z.prototype,"selectionChange",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),$e(Z.prototype,"onTableRowPress",[k],Object.getOwnPropertyDescriptor(Z.prototype,"onTableRowPress"),Z.prototype),$e(Z.prototype,"onInternalDataReceived",[H],Object.getOwnPropertyDescriptor(Z.prototype,"onInternalDataReceived"),Z.prototype),$e(Z.prototype,"onInternalDataRequested",[W],Object.getOwnPropertyDescriptor(Z.prototype,"onInternalDataRequested"),Z.prototype),$e(Z.prototype,"onPaste",[G],Object.getOwnPropertyDescriptor(Z.prototype,"onPaste"),Z.prototype),$e(Z.prototype,"onBeforeExport",[K],Object.getOwnPropertyDescriptor(Z.prototype,"onBeforeExport"),Z.prototype),$e(Z.prototype,"onDataStateChange",[J],Object.getOwnPropertyDescriptor(Z.prototype,"onDataStateChange"),Z.prototype),$e(Z.prototype,"onMassEditButtonPressed",[Q],Object.getOwnPropertyDescriptor(Z.prototype,"onMassEditButtonPressed"),Z.prototype),$e(Z.prototype,"onTableSelectionChange",[X],Object.getOwnPropertyDescriptor(Z.prototype,"onTableSelectionChange"),Z.prototype),Z))||Y);return Le},false);
//# sourceMappingURL=TableAPI.js.map