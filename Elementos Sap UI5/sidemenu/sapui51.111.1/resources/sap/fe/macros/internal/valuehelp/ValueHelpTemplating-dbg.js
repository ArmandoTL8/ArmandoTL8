/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/helpers/BindingToolkit", "sap/fe/core/helpers/StableIdHelper", "sap/fe/core/templating/DataModelPathHelper", "sap/fe/core/templating/PropertyHelper", "sap/fe/core/templating/UIFormatters", "sap/fe/macros/field/FieldHelper"], function (BindingToolkit, StableIdHelper, DataModelPathHelper, PropertyHelper, UIFormatters, FieldHelper) {
  "use strict";

  var _exports = {};
  var getDisplayMode = UIFormatters.getDisplayMode;
  var isUnit = PropertyHelper.isUnit;
  var isSemanticKey = PropertyHelper.isSemanticKey;
  var isProperty = PropertyHelper.isProperty;
  var isGuid = PropertyHelper.isGuid;
  var isCurrency = PropertyHelper.isCurrency;
  var hasValueListForValidation = PropertyHelper.hasValueListForValidation;
  var hasValueHelpWithFixedValues = PropertyHelper.hasValueHelpWithFixedValues;
  var hasValueHelp = PropertyHelper.hasValueHelp;
  var hasDateType = PropertyHelper.hasDateType;
  var checkFilterExpressionRestrictions = DataModelPathHelper.checkFilterExpressionRestrictions;
  var generate = StableIdHelper.generate;
  var compileExpression = BindingToolkit.compileExpression;
  /**
   * Retrieve the displayMode for the value help.
   * The main rule is that if a property is used in a VHTable then we don't want to display the text arrangement directly.
   *
   * @param propertyPath The current property
   * @param isValueHelpWithFixedValues The value help is a drop-down list
   * @returns The target displayMode
   */
  const getValueHelpTableDisplayMode = function (propertyPath, isValueHelpWithFixedValues) {
    var _propertyPath$targetO, _propertyPath$targetO2, _oTextAnnotation$anno, _oTextAnnotation$anno2, _oTextAnnotation$anno3;
    const sDisplayMode = getDisplayMode(propertyPath);
    const oTextAnnotation = (_propertyPath$targetO = propertyPath.targetObject.annotations) === null || _propertyPath$targetO === void 0 ? void 0 : (_propertyPath$targetO2 = _propertyPath$targetO.Common) === null || _propertyPath$targetO2 === void 0 ? void 0 : _propertyPath$targetO2.Text;
    const oTextArrangementAnnotation = typeof oTextAnnotation !== "string" && (oTextAnnotation === null || oTextAnnotation === void 0 ? void 0 : (_oTextAnnotation$anno = oTextAnnotation.annotations) === null || _oTextAnnotation$anno === void 0 ? void 0 : (_oTextAnnotation$anno2 = _oTextAnnotation$anno.UI) === null || _oTextAnnotation$anno2 === void 0 ? void 0 : (_oTextAnnotation$anno3 = _oTextAnnotation$anno2.TextArrangement) === null || _oTextAnnotation$anno3 === void 0 ? void 0 : _oTextAnnotation$anno3.toString());
    if (isValueHelpWithFixedValues) {
      return oTextAnnotation && typeof oTextAnnotation !== "string" && oTextAnnotation.path ? sDisplayMode : "Value";
    } else {
      // Only explicit defined TextArrangements in a Value Help with Dialog are considered
      return oTextArrangementAnnotation ? sDisplayMode : "Value";
    }
  };

  /**
   * Method to return delegate property of Value Help.
   *
   * @function
   * @name getDelegateConfiguration
   * @memberof sap.fe.macros.internal.valuehelp.ValueHelpTemplating.js
   * @param propertyPath The current property path
   * @param conditionModelName Condition model of the Value Help
   * @param originalPropertyPath The original property path
   * @param requestGroupId The requestGroupId to use for requests
   * @param useMultiValueField If true the value help is for a multi value Field
   * @returns The expression needed to configure the delegate
   */
  _exports.getValueHelpTableDisplayMode = getValueHelpTableDisplayMode;
  const getDelegateConfiguration = function (propertyPath, conditionModelName, originalPropertyPath, requestGroupId) {
    let useMultiValueField = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;
    const isUnitValueHelp = propertyPath !== originalPropertyPath;
    const delegateConfiguration = {
      name: "sap/fe/macros/valuehelp/ValueHelpDelegate",
      payload: {
        propertyPath,
        isUnitValueHelp,
        conditionModel: conditionModelName,
        requestGroupId,
        useMultiValueField,
        qualifiers: {},
        valueHelpQualifier: ""
      }
    };
    return compileExpression(delegateConfiguration); // for some reason "qualifiers: {}" is ignored here
  };

  /**
   * Method to generate the ID for Value Help.
   *
   * @function
   * @name generateID
   * @memberof sap.fe.macros.internal.valuehelp.ValueHelpTemplating.js
   * @param sFlexId Flex ID of the current object
   * @param sIdPrefix Prefix for the ValueHelp ID
   * @param sOriginalPropertyName Name of the property
   * @param sPropertyName Name of the ValueHelp Property
   * @returns The Id generated for the ValueHelp
   */
  _exports.getDelegateConfiguration = getDelegateConfiguration;
  const generateID = function (sFlexId, sIdPrefix, sOriginalPropertyName, sPropertyName) {
    if (sFlexId) {
      return sFlexId;
    }
    let sProperty = sPropertyName;
    if (sOriginalPropertyName !== sPropertyName) {
      sProperty = `${sOriginalPropertyName}::${sPropertyName}`;
    }
    return generate([sIdPrefix, sProperty]);
  };

  /**
   * Method to check if a property needs to be validated or not when used in the valuehelp.
   *
   * @function
   * @name requiresValidation
   * @memberof sap.fe.macros.internal.valuehelp.ValueHelpTemplating.js
   * @param  property ValueHelp property type annotations
   * @returns `true` if the value help needs to be validated
   */
  _exports.generateID = generateID;
  const requiresValidation = function (property) {
    return hasValueHelpWithFixedValues(property) || hasValueListForValidation(property) || hasValueHelp(property) && (isUnit(property) || isCurrency(property) || isGuid(property));
  };

  /**
   * Method to decide if case-sensitive filter requests are to be used or not.
   *
   *  If the back end has FilterFunctions Capabilies for the service or the entity, we check it includes support for tolower.
   *
   * @function
   * @name useCaseSensitiveFilterRequests
   * @memberof sap.fe.macros.internal.valuehelp.ValueHelpTemplating.js
   * @param oDataModelPath Current data model pathÂ·
   * @param aEntityContainerFilterFunctions Filter functions of entity container
   * @returns `true` if the entity set or service supports case sensitive filter requests
   */
  _exports.requiresValidation = requiresValidation;
  const useCaseSensitiveFilterRequests = function (oDataModelPath, aEntityContainerFilterFunctions) {
    var _oDataModelPath$targe, _oDataModelPath$targe2, _oDataModelPath$targe3;
    const filterFunctions = (oDataModelPath === null || oDataModelPath === void 0 ? void 0 : (_oDataModelPath$targe = oDataModelPath.targetEntitySet) === null || _oDataModelPath$targe === void 0 ? void 0 : (_oDataModelPath$targe2 = _oDataModelPath$targe.annotations) === null || _oDataModelPath$targe2 === void 0 ? void 0 : (_oDataModelPath$targe3 = _oDataModelPath$targe2.Capabilities) === null || _oDataModelPath$targe3 === void 0 ? void 0 : _oDataModelPath$targe3.FilterFunctions) || aEntityContainerFilterFunctions;
    return filterFunctions ? !(filterFunctions.indexOf("tolower") > -1) : true;
  };
  _exports.useCaseSensitiveFilterRequests = useCaseSensitiveFilterRequests;
  const isSemanticDateRange = function (oDataModelPath) {
    const targetProperty = oDataModelPath.targetObject;
    const targetRestrictions = checkFilterExpressionRestrictions(oDataModelPath, ["SingleRange"]);
    return hasDateType(targetProperty) && compileExpression(targetRestrictions);
  };
  _exports.isSemanticDateRange = isSemanticDateRange;
  const shouldShowConditionPanel = function (oDataModelPath, oContextPath) {
    // Force push the context path inside
    oDataModelPath.contextLocation = oContextPath;
    return compileExpression(checkFilterExpressionRestrictions(oDataModelPath, ["SingleValue", "MultiValue"])) === "false";
  };
  _exports.shouldShowConditionPanel = shouldShowConditionPanel;
  const getColumnDataProperty = function (sValueListProperty, propertyPath) {
    var _propertyPath$targetO3, _propertyPath$targetO4, _propertyPath$targetO5, _propertyPath$targetO6, _propertyPath$targetO7, _propertyPath$targetO8;
    if (propertyPath !== null && propertyPath !== void 0 && (_propertyPath$targetO3 = propertyPath.targetObject) !== null && _propertyPath$targetO3 !== void 0 && (_propertyPath$targetO4 = _propertyPath$targetO3.annotations) !== null && _propertyPath$targetO4 !== void 0 && (_propertyPath$targetO5 = _propertyPath$targetO4.Common) !== null && _propertyPath$targetO5 !== void 0 && _propertyPath$targetO5.Text && (_propertyPath$targetO6 = propertyPath.targetObject.annotations.Common.Text) !== null && _propertyPath$targetO6 !== void 0 && (_propertyPath$targetO7 = _propertyPath$targetO6.annotations) !== null && _propertyPath$targetO7 !== void 0 && (_propertyPath$targetO8 = _propertyPath$targetO7.UI) !== null && _propertyPath$targetO8 !== void 0 && _propertyPath$targetO8.TextArrangement && propertyPath.targetObject.annotations.Common.Text.annotations.UI.TextArrangement.valueOf() === "UI.TextArrangementType/TextOnly") {
      return propertyPath.targetObject.annotations.Common.Text.path;
    }
    return sValueListProperty;
  };
  _exports.getColumnDataProperty = getColumnDataProperty;
  const getColumnHAlign = function (propertyPath) {
    const property = propertyPath.targetObject;
    const propertyType = isProperty(property) ? property.type : "";
    return !propertyType || isSemanticKey(property, propertyPath) ? "Begin" : FieldHelper.getPropertyAlignment(propertyType, {
      textAlignMode: "Table"
    });
  };
  _exports.getColumnHAlign = getColumnHAlign;
  return _exports;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZXRWYWx1ZUhlbHBUYWJsZURpc3BsYXlNb2RlIiwicHJvcGVydHlQYXRoIiwiaXNWYWx1ZUhlbHBXaXRoRml4ZWRWYWx1ZXMiLCJzRGlzcGxheU1vZGUiLCJnZXREaXNwbGF5TW9kZSIsIm9UZXh0QW5ub3RhdGlvbiIsInRhcmdldE9iamVjdCIsImFubm90YXRpb25zIiwiQ29tbW9uIiwiVGV4dCIsIm9UZXh0QXJyYW5nZW1lbnRBbm5vdGF0aW9uIiwiVUkiLCJUZXh0QXJyYW5nZW1lbnQiLCJ0b1N0cmluZyIsInBhdGgiLCJnZXREZWxlZ2F0ZUNvbmZpZ3VyYXRpb24iLCJjb25kaXRpb25Nb2RlbE5hbWUiLCJvcmlnaW5hbFByb3BlcnR5UGF0aCIsInJlcXVlc3RHcm91cElkIiwidXNlTXVsdGlWYWx1ZUZpZWxkIiwiaXNVbml0VmFsdWVIZWxwIiwiZGVsZWdhdGVDb25maWd1cmF0aW9uIiwibmFtZSIsInBheWxvYWQiLCJjb25kaXRpb25Nb2RlbCIsInF1YWxpZmllcnMiLCJ2YWx1ZUhlbHBRdWFsaWZpZXIiLCJjb21waWxlRXhwcmVzc2lvbiIsImdlbmVyYXRlSUQiLCJzRmxleElkIiwic0lkUHJlZml4Iiwic09yaWdpbmFsUHJvcGVydHlOYW1lIiwic1Byb3BlcnR5TmFtZSIsInNQcm9wZXJ0eSIsImdlbmVyYXRlIiwicmVxdWlyZXNWYWxpZGF0aW9uIiwicHJvcGVydHkiLCJoYXNWYWx1ZUhlbHBXaXRoRml4ZWRWYWx1ZXMiLCJoYXNWYWx1ZUxpc3RGb3JWYWxpZGF0aW9uIiwiaGFzVmFsdWVIZWxwIiwiaXNVbml0IiwiaXNDdXJyZW5jeSIsImlzR3VpZCIsInVzZUNhc2VTZW5zaXRpdmVGaWx0ZXJSZXF1ZXN0cyIsIm9EYXRhTW9kZWxQYXRoIiwiYUVudGl0eUNvbnRhaW5lckZpbHRlckZ1bmN0aW9ucyIsImZpbHRlckZ1bmN0aW9ucyIsInRhcmdldEVudGl0eVNldCIsIkNhcGFiaWxpdGllcyIsIkZpbHRlckZ1bmN0aW9ucyIsImluZGV4T2YiLCJpc1NlbWFudGljRGF0ZVJhbmdlIiwidGFyZ2V0UHJvcGVydHkiLCJ0YXJnZXRSZXN0cmljdGlvbnMiLCJjaGVja0ZpbHRlckV4cHJlc3Npb25SZXN0cmljdGlvbnMiLCJoYXNEYXRlVHlwZSIsInNob3VsZFNob3dDb25kaXRpb25QYW5lbCIsIm9Db250ZXh0UGF0aCIsImNvbnRleHRMb2NhdGlvbiIsImdldENvbHVtbkRhdGFQcm9wZXJ0eSIsInNWYWx1ZUxpc3RQcm9wZXJ0eSIsInZhbHVlT2YiLCJnZXRDb2x1bW5IQWxpZ24iLCJwcm9wZXJ0eVR5cGUiLCJpc1Byb3BlcnR5IiwidHlwZSIsImlzU2VtYW50aWNLZXkiLCJGaWVsZEhlbHBlciIsImdldFByb3BlcnR5QWxpZ25tZW50IiwidGV4dEFsaWduTW9kZSJdLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiVmFsdWVIZWxwVGVtcGxhdGluZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEVudGl0eVNldCwgUHJvcGVydHkgfSBmcm9tIFwiQHNhcC11eC92b2NhYnVsYXJpZXMtdHlwZXNcIjtcbmltcG9ydCB0eXBlIHsgQ29tcGlsZWRCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb24gfSBmcm9tIFwic2FwL2ZlL2NvcmUvaGVscGVycy9CaW5kaW5nVG9vbGtpdFwiO1xuaW1wb3J0IHsgY29tcGlsZUV4cHJlc3Npb24gfSBmcm9tIFwic2FwL2ZlL2NvcmUvaGVscGVycy9CaW5kaW5nVG9vbGtpdFwiO1xuaW1wb3J0IHsgZ2VuZXJhdGUgfSBmcm9tIFwic2FwL2ZlL2NvcmUvaGVscGVycy9TdGFibGVJZEhlbHBlclwiO1xuaW1wb3J0IHR5cGUgeyBEYXRhTW9kZWxPYmplY3RQYXRoIH0gZnJvbSBcInNhcC9mZS9jb3JlL3RlbXBsYXRpbmcvRGF0YU1vZGVsUGF0aEhlbHBlclwiO1xuaW1wb3J0IHsgY2hlY2tGaWx0ZXJFeHByZXNzaW9uUmVzdHJpY3Rpb25zIH0gZnJvbSBcInNhcC9mZS9jb3JlL3RlbXBsYXRpbmcvRGF0YU1vZGVsUGF0aEhlbHBlclwiO1xuaW1wb3J0IHtcblx0aGFzRGF0ZVR5cGUsXG5cdGhhc1ZhbHVlSGVscCxcblx0aGFzVmFsdWVIZWxwV2l0aEZpeGVkVmFsdWVzLFxuXHRoYXNWYWx1ZUxpc3RGb3JWYWxpZGF0aW9uLFxuXHRpc0N1cnJlbmN5LFxuXHRpc0d1aWQsXG5cdGlzUHJvcGVydHksXG5cdGlzU2VtYW50aWNLZXksXG5cdGlzVW5pdFxufSBmcm9tIFwic2FwL2ZlL2NvcmUvdGVtcGxhdGluZy9Qcm9wZXJ0eUhlbHBlclwiO1xuaW1wb3J0IHsgZ2V0RGlzcGxheU1vZGUgfSBmcm9tIFwic2FwL2ZlL2NvcmUvdGVtcGxhdGluZy9VSUZvcm1hdHRlcnNcIjtcbmltcG9ydCBGaWVsZEhlbHBlciBmcm9tIFwic2FwL2ZlL21hY3Jvcy9maWVsZC9GaWVsZEhlbHBlclwiO1xuXG5pbXBvcnQgdHlwZSB7IFZhbHVlSGVscFBheWxvYWQgfSBmcm9tIFwic2FwL2ZlL21hY3Jvcy9pbnRlcm5hbC92YWx1ZWhlbHAvVmFsdWVMaXN0SGVscGVyXCI7XG5cbi8qKlxuICogUmV0cmlldmUgdGhlIGRpc3BsYXlNb2RlIGZvciB0aGUgdmFsdWUgaGVscC5cbiAqIFRoZSBtYWluIHJ1bGUgaXMgdGhhdCBpZiBhIHByb3BlcnR5IGlzIHVzZWQgaW4gYSBWSFRhYmxlIHRoZW4gd2UgZG9uJ3Qgd2FudCB0byBkaXNwbGF5IHRoZSB0ZXh0IGFycmFuZ2VtZW50IGRpcmVjdGx5LlxuICpcbiAqIEBwYXJhbSBwcm9wZXJ0eVBhdGggVGhlIGN1cnJlbnQgcHJvcGVydHlcbiAqIEBwYXJhbSBpc1ZhbHVlSGVscFdpdGhGaXhlZFZhbHVlcyBUaGUgdmFsdWUgaGVscCBpcyBhIGRyb3AtZG93biBsaXN0XG4gKiBAcmV0dXJucyBUaGUgdGFyZ2V0IGRpc3BsYXlNb2RlXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRWYWx1ZUhlbHBUYWJsZURpc3BsYXlNb2RlID0gZnVuY3Rpb24gKHByb3BlcnR5UGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCwgaXNWYWx1ZUhlbHBXaXRoRml4ZWRWYWx1ZXM6IGJvb2xlYW4pOiBzdHJpbmcge1xuXHRjb25zdCBzRGlzcGxheU1vZGUgPSBnZXREaXNwbGF5TW9kZShwcm9wZXJ0eVBhdGgpO1xuXHRjb25zdCBvVGV4dEFubm90YXRpb24gPSBwcm9wZXJ0eVBhdGgudGFyZ2V0T2JqZWN0LmFubm90YXRpb25zPy5Db21tb24/LlRleHQ7XG5cdGNvbnN0IG9UZXh0QXJyYW5nZW1lbnRBbm5vdGF0aW9uID0gdHlwZW9mIG9UZXh0QW5ub3RhdGlvbiAhPT0gXCJzdHJpbmdcIiAmJiBvVGV4dEFubm90YXRpb24/LmFubm90YXRpb25zPy5VST8uVGV4dEFycmFuZ2VtZW50Py50b1N0cmluZygpO1xuXHRpZiAoaXNWYWx1ZUhlbHBXaXRoRml4ZWRWYWx1ZXMpIHtcblx0XHRyZXR1cm4gb1RleHRBbm5vdGF0aW9uICYmIHR5cGVvZiBvVGV4dEFubm90YXRpb24gIT09IFwic3RyaW5nXCIgJiYgb1RleHRBbm5vdGF0aW9uLnBhdGggPyBzRGlzcGxheU1vZGUgOiBcIlZhbHVlXCI7XG5cdH0gZWxzZSB7XG5cdFx0Ly8gT25seSBleHBsaWNpdCBkZWZpbmVkIFRleHRBcnJhbmdlbWVudHMgaW4gYSBWYWx1ZSBIZWxwIHdpdGggRGlhbG9nIGFyZSBjb25zaWRlcmVkXG5cdFx0cmV0dXJuIG9UZXh0QXJyYW5nZW1lbnRBbm5vdGF0aW9uID8gc0Rpc3BsYXlNb2RlIDogXCJWYWx1ZVwiO1xuXHR9XG59O1xuXG4vKipcbiAqIE1ldGhvZCB0byByZXR1cm4gZGVsZWdhdGUgcHJvcGVydHkgb2YgVmFsdWUgSGVscC5cbiAqXG4gKiBAZnVuY3Rpb25cbiAqIEBuYW1lIGdldERlbGVnYXRlQ29uZmlndXJhdGlvblxuICogQG1lbWJlcm9mIHNhcC5mZS5tYWNyb3MuaW50ZXJuYWwudmFsdWVoZWxwLlZhbHVlSGVscFRlbXBsYXRpbmcuanNcbiAqIEBwYXJhbSBwcm9wZXJ0eVBhdGggVGhlIGN1cnJlbnQgcHJvcGVydHkgcGF0aFxuICogQHBhcmFtIGNvbmRpdGlvbk1vZGVsTmFtZSBDb25kaXRpb24gbW9kZWwgb2YgdGhlIFZhbHVlIEhlbHBcbiAqIEBwYXJhbSBvcmlnaW5hbFByb3BlcnR5UGF0aCBUaGUgb3JpZ2luYWwgcHJvcGVydHkgcGF0aFxuICogQHBhcmFtIHJlcXVlc3RHcm91cElkIFRoZSByZXF1ZXN0R3JvdXBJZCB0byB1c2UgZm9yIHJlcXVlc3RzXG4gKiBAcGFyYW0gdXNlTXVsdGlWYWx1ZUZpZWxkIElmIHRydWUgdGhlIHZhbHVlIGhlbHAgaXMgZm9yIGEgbXVsdGkgdmFsdWUgRmllbGRcbiAqIEByZXR1cm5zIFRoZSBleHByZXNzaW9uIG5lZWRlZCB0byBjb25maWd1cmUgdGhlIGRlbGVnYXRlXG4gKi9cbmV4cG9ydCBjb25zdCBnZXREZWxlZ2F0ZUNvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoXG5cdHByb3BlcnR5UGF0aDogc3RyaW5nLFxuXHRjb25kaXRpb25Nb2RlbE5hbWU6IHN0cmluZyxcblx0b3JpZ2luYWxQcm9wZXJ0eVBhdGg6IHN0cmluZyxcblx0cmVxdWVzdEdyb3VwSWQ/OiBzdHJpbmcsXG5cdHVzZU11bHRpVmFsdWVGaWVsZCA9IGZhbHNlXG4pOiBDb21waWxlZEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbiB7XG5cdGNvbnN0IGlzVW5pdFZhbHVlSGVscCA9IHByb3BlcnR5UGF0aCAhPT0gb3JpZ2luYWxQcm9wZXJ0eVBhdGg7XG5cdGNvbnN0IGRlbGVnYXRlQ29uZmlndXJhdGlvbjogeyBuYW1lOiBzdHJpbmc7IHBheWxvYWQ6IFZhbHVlSGVscFBheWxvYWQgfSA9IHtcblx0XHRuYW1lOiBcInNhcC9mZS9tYWNyb3MvdmFsdWVoZWxwL1ZhbHVlSGVscERlbGVnYXRlXCIsXG5cdFx0cGF5bG9hZDoge1xuXHRcdFx0cHJvcGVydHlQYXRoLFxuXHRcdFx0aXNVbml0VmFsdWVIZWxwLFxuXHRcdFx0Y29uZGl0aW9uTW9kZWw6IGNvbmRpdGlvbk1vZGVsTmFtZSxcblx0XHRcdHJlcXVlc3RHcm91cElkLFxuXHRcdFx0dXNlTXVsdGlWYWx1ZUZpZWxkLFxuXHRcdFx0cXVhbGlmaWVyczoge30sXG5cdFx0XHR2YWx1ZUhlbHBRdWFsaWZpZXI6IFwiXCJcblx0XHR9XG5cdH07XG5cdHJldHVybiBjb21waWxlRXhwcmVzc2lvbihkZWxlZ2F0ZUNvbmZpZ3VyYXRpb24pOyAvLyBmb3Igc29tZSByZWFzb24gXCJxdWFsaWZpZXJzOiB7fVwiIGlzIGlnbm9yZWQgaGVyZVxufTtcblxuLyoqXG4gKiBNZXRob2QgdG8gZ2VuZXJhdGUgdGhlIElEIGZvciBWYWx1ZSBIZWxwLlxuICpcbiAqIEBmdW5jdGlvblxuICogQG5hbWUgZ2VuZXJhdGVJRFxuICogQG1lbWJlcm9mIHNhcC5mZS5tYWNyb3MuaW50ZXJuYWwudmFsdWVoZWxwLlZhbHVlSGVscFRlbXBsYXRpbmcuanNcbiAqIEBwYXJhbSBzRmxleElkIEZsZXggSUQgb2YgdGhlIGN1cnJlbnQgb2JqZWN0XG4gKiBAcGFyYW0gc0lkUHJlZml4IFByZWZpeCBmb3IgdGhlIFZhbHVlSGVscCBJRFxuICogQHBhcmFtIHNPcmlnaW5hbFByb3BlcnR5TmFtZSBOYW1lIG9mIHRoZSBwcm9wZXJ0eVxuICogQHBhcmFtIHNQcm9wZXJ0eU5hbWUgTmFtZSBvZiB0aGUgVmFsdWVIZWxwIFByb3BlcnR5XG4gKiBAcmV0dXJucyBUaGUgSWQgZ2VuZXJhdGVkIGZvciB0aGUgVmFsdWVIZWxwXG4gKi9cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZUlEID0gZnVuY3Rpb24gKFxuXHRzRmxleElkOiBzdHJpbmcgfCB1bmRlZmluZWQsXG5cdHNJZFByZWZpeDogc3RyaW5nLFxuXHRzT3JpZ2luYWxQcm9wZXJ0eU5hbWU6IHN0cmluZyxcblx0c1Byb3BlcnR5TmFtZTogc3RyaW5nXG4pOiBzdHJpbmcge1xuXHRpZiAoc0ZsZXhJZCkge1xuXHRcdHJldHVybiBzRmxleElkO1xuXHR9XG5cdGxldCBzUHJvcGVydHkgPSBzUHJvcGVydHlOYW1lO1xuXHRpZiAoc09yaWdpbmFsUHJvcGVydHlOYW1lICE9PSBzUHJvcGVydHlOYW1lKSB7XG5cdFx0c1Byb3BlcnR5ID0gYCR7c09yaWdpbmFsUHJvcGVydHlOYW1lfTo6JHtzUHJvcGVydHlOYW1lfWA7XG5cdH1cblx0cmV0dXJuIGdlbmVyYXRlKFtzSWRQcmVmaXgsIHNQcm9wZXJ0eV0pO1xufTtcblxuLyoqXG4gKiBNZXRob2QgdG8gY2hlY2sgaWYgYSBwcm9wZXJ0eSBuZWVkcyB0byBiZSB2YWxpZGF0ZWQgb3Igbm90IHdoZW4gdXNlZCBpbiB0aGUgdmFsdWVoZWxwLlxuICpcbiAqIEBmdW5jdGlvblxuICogQG5hbWUgcmVxdWlyZXNWYWxpZGF0aW9uXG4gKiBAbWVtYmVyb2Ygc2FwLmZlLm1hY3Jvcy5pbnRlcm5hbC52YWx1ZWhlbHAuVmFsdWVIZWxwVGVtcGxhdGluZy5qc1xuICogQHBhcmFtICBwcm9wZXJ0eSBWYWx1ZUhlbHAgcHJvcGVydHkgdHlwZSBhbm5vdGF0aW9uc1xuICogQHJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZSBoZWxwIG5lZWRzIHRvIGJlIHZhbGlkYXRlZFxuICovXG5leHBvcnQgY29uc3QgcmVxdWlyZXNWYWxpZGF0aW9uID0gZnVuY3Rpb24gKHByb3BlcnR5OiBQcm9wZXJ0eSk6IGJvb2xlYW4ge1xuXHRyZXR1cm4gKFxuXHRcdGhhc1ZhbHVlSGVscFdpdGhGaXhlZFZhbHVlcyhwcm9wZXJ0eSkgfHxcblx0XHRoYXNWYWx1ZUxpc3RGb3JWYWxpZGF0aW9uKHByb3BlcnR5KSB8fFxuXHRcdChoYXNWYWx1ZUhlbHAocHJvcGVydHkpICYmIChpc1VuaXQocHJvcGVydHkpIHx8IGlzQ3VycmVuY3kocHJvcGVydHkpIHx8IGlzR3VpZChwcm9wZXJ0eSkpKVxuXHQpO1xufTtcblxuLyoqXG4gKiBNZXRob2QgdG8gZGVjaWRlIGlmIGNhc2Utc2Vuc2l0aXZlIGZpbHRlciByZXF1ZXN0cyBhcmUgdG8gYmUgdXNlZCBvciBub3QuXG4gKlxuICogIElmIHRoZSBiYWNrIGVuZCBoYXMgRmlsdGVyRnVuY3Rpb25zIENhcGFiaWxpZXMgZm9yIHRoZSBzZXJ2aWNlIG9yIHRoZSBlbnRpdHksIHdlIGNoZWNrIGl0IGluY2x1ZGVzIHN1cHBvcnQgZm9yIHRvbG93ZXIuXG4gKlxuICogQGZ1bmN0aW9uXG4gKiBAbmFtZSB1c2VDYXNlU2Vuc2l0aXZlRmlsdGVyUmVxdWVzdHNcbiAqIEBtZW1iZXJvZiBzYXAuZmUubWFjcm9zLmludGVybmFsLnZhbHVlaGVscC5WYWx1ZUhlbHBUZW1wbGF0aW5nLmpzXG4gKiBAcGFyYW0gb0RhdGFNb2RlbFBhdGggQ3VycmVudCBkYXRhIG1vZGVsIHBhdGjCt1xuICogQHBhcmFtIGFFbnRpdHlDb250YWluZXJGaWx0ZXJGdW5jdGlvbnMgRmlsdGVyIGZ1bmN0aW9ucyBvZiBlbnRpdHkgY29udGFpbmVyXG4gKiBAcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGVudGl0eSBzZXQgb3Igc2VydmljZSBzdXBwb3J0cyBjYXNlIHNlbnNpdGl2ZSBmaWx0ZXIgcmVxdWVzdHNcbiAqL1xuZXhwb3J0IGNvbnN0IHVzZUNhc2VTZW5zaXRpdmVGaWx0ZXJSZXF1ZXN0cyA9IGZ1bmN0aW9uIChcblx0b0RhdGFNb2RlbFBhdGg6IERhdGFNb2RlbE9iamVjdFBhdGgsXG5cdGFFbnRpdHlDb250YWluZXJGaWx0ZXJGdW5jdGlvbnM6IHN0cmluZ1tdXG4pOiBib29sZWFuIHtcblx0Y29uc3QgZmlsdGVyRnVuY3Rpb25zID1cblx0XHQoKG9EYXRhTW9kZWxQYXRoPy50YXJnZXRFbnRpdHlTZXQgYXMgRW50aXR5U2V0KT8uYW5ub3RhdGlvbnM/LkNhcGFiaWxpdGllcz8uRmlsdGVyRnVuY3Rpb25zIGFzIHVua25vd24gYXMgc3RyaW5nW10pIHx8XG5cdFx0YUVudGl0eUNvbnRhaW5lckZpbHRlckZ1bmN0aW9ucztcblx0cmV0dXJuIGZpbHRlckZ1bmN0aW9ucyA/ICEoZmlsdGVyRnVuY3Rpb25zLmluZGV4T2YoXCJ0b2xvd2VyXCIpID4gLTEpIDogdHJ1ZTtcbn07XG5cbmV4cG9ydCBjb25zdCBpc1NlbWFudGljRGF0ZVJhbmdlID0gZnVuY3Rpb24gKG9EYXRhTW9kZWxQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoKSB7XG5cdGNvbnN0IHRhcmdldFByb3BlcnR5ID0gb0RhdGFNb2RlbFBhdGgudGFyZ2V0T2JqZWN0IGFzIFByb3BlcnR5O1xuXHRjb25zdCB0YXJnZXRSZXN0cmljdGlvbnMgPSBjaGVja0ZpbHRlckV4cHJlc3Npb25SZXN0cmljdGlvbnMob0RhdGFNb2RlbFBhdGgsIFtcIlNpbmdsZVJhbmdlXCJdKTtcblx0cmV0dXJuIGhhc0RhdGVUeXBlKHRhcmdldFByb3BlcnR5KSAmJiBjb21waWxlRXhwcmVzc2lvbih0YXJnZXRSZXN0cmljdGlvbnMpO1xufTtcblxuZXhwb3J0IGNvbnN0IHNob3VsZFNob3dDb25kaXRpb25QYW5lbCA9IGZ1bmN0aW9uIChvRGF0YU1vZGVsUGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCwgb0NvbnRleHRQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoKTogYm9vbGVhbiB7XG5cdC8vIEZvcmNlIHB1c2ggdGhlIGNvbnRleHQgcGF0aCBpbnNpZGVcblx0b0RhdGFNb2RlbFBhdGguY29udGV4dExvY2F0aW9uID0gb0NvbnRleHRQYXRoO1xuXHRyZXR1cm4gY29tcGlsZUV4cHJlc3Npb24oY2hlY2tGaWx0ZXJFeHByZXNzaW9uUmVzdHJpY3Rpb25zKG9EYXRhTW9kZWxQYXRoLCBbXCJTaW5nbGVWYWx1ZVwiLCBcIk11bHRpVmFsdWVcIl0pKSA9PT0gXCJmYWxzZVwiO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENvbHVtbkRhdGFQcm9wZXJ0eSA9IGZ1bmN0aW9uIChzVmFsdWVMaXN0UHJvcGVydHk6IHN0cmluZywgcHJvcGVydHlQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoKTogc3RyaW5nIHtcblx0aWYgKFxuXHRcdHByb3BlcnR5UGF0aD8udGFyZ2V0T2JqZWN0Py5hbm5vdGF0aW9ucz8uQ29tbW9uPy5UZXh0ICYmXG5cdFx0cHJvcGVydHlQYXRoLnRhcmdldE9iamVjdC5hbm5vdGF0aW9ucy5Db21tb24uVGV4dD8uYW5ub3RhdGlvbnM/LlVJPy5UZXh0QXJyYW5nZW1lbnQgJiZcblx0XHRwcm9wZXJ0eVBhdGgudGFyZ2V0T2JqZWN0LmFubm90YXRpb25zLkNvbW1vbi5UZXh0LmFubm90YXRpb25zLlVJLlRleHRBcnJhbmdlbWVudC52YWx1ZU9mKCkgPT09IFwiVUkuVGV4dEFycmFuZ2VtZW50VHlwZS9UZXh0T25seVwiXG5cdCkge1xuXHRcdHJldHVybiBwcm9wZXJ0eVBhdGgudGFyZ2V0T2JqZWN0LmFubm90YXRpb25zLkNvbW1vbi5UZXh0LnBhdGg7XG5cdH1cblx0cmV0dXJuIHNWYWx1ZUxpc3RQcm9wZXJ0eTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRDb2x1bW5IQWxpZ24gPSBmdW5jdGlvbiAocHJvcGVydHlQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoKSB7XG5cdGNvbnN0IHByb3BlcnR5ID0gcHJvcGVydHlQYXRoLnRhcmdldE9iamVjdDtcblx0Y29uc3QgcHJvcGVydHlUeXBlID0gaXNQcm9wZXJ0eShwcm9wZXJ0eSkgPyBwcm9wZXJ0eS50eXBlIDogXCJcIjtcblxuXHRyZXR1cm4gIXByb3BlcnR5VHlwZSB8fCBpc1NlbWFudGljS2V5KHByb3BlcnR5LCBwcm9wZXJ0eVBhdGgpXG5cdFx0PyBcIkJlZ2luXCJcblx0XHQ6IEZpZWxkSGVscGVyLmdldFByb3BlcnR5QWxpZ25tZW50KHByb3BlcnR5VHlwZSwgeyB0ZXh0QWxpZ25Nb2RlOiBcIlRhYmxlXCIgfSk7XG59O1xuIl0sIm1hcHBpbmdzIjoiO0FBQUE7QUFBQTtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7RUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNPLE1BQU1BLDRCQUE0QixHQUFHLFVBQVVDLFlBQWlDLEVBQUVDLDBCQUFtQyxFQUFVO0lBQUE7SUFDckksTUFBTUMsWUFBWSxHQUFHQyxjQUFjLENBQUNILFlBQVksQ0FBQztJQUNqRCxNQUFNSSxlQUFlLDRCQUFHSixZQUFZLENBQUNLLFlBQVksQ0FBQ0MsV0FB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