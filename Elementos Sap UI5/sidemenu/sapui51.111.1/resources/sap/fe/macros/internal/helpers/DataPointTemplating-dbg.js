/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/formatters/ValueFormatter", "sap/fe/core/helpers/BindingToolkit", "sap/fe/core/templating/DataModelPathHelper", "sap/fe/core/templating/PropertyHelper", "sap/fe/core/templating/UIFormatters", "sap/ui/model/odata/v4/AnnotationHelper"], function (valueFormatters, BindingToolkit, DataModelPathHelper, PropertyHelper, UIFormatters, AnnotationHelper) {
  "use strict";

  var _exports = {};
  var getDisplayMode = UIFormatters.getDisplayMode;
  var getBindingWithUnitOrCurrency = UIFormatters.getBindingWithUnitOrCurrency;
  var getBindingWithTimezone = UIFormatters.getBindingWithTimezone;
  var isProperty = PropertyHelper.isProperty;
  var hasStaticPercentUnit = PropertyHelper.hasStaticPercentUnit;
  var getRelativePaths = DataModelPathHelper.getRelativePaths;
  var enhanceDataModelPath = DataModelPathHelper.enhanceDataModelPath;
  var unresolvableExpression = BindingToolkit.unresolvableExpression;
  var isPathInModelExpression = BindingToolkit.isPathInModelExpression;
  var getExpressionFromAnnotation = BindingToolkit.getExpressionFromAnnotation;
  var formatWithTypeInformation = BindingToolkit.formatWithTypeInformation;
  var formatResult = BindingToolkit.formatResult;
  var EDM_TYPE_MAPPING = BindingToolkit.EDM_TYPE_MAPPING;
  var compileExpression = BindingToolkit.compileExpression;
  const getDataPointTargetExpression = oDataModelPath => {
    return oDataModelPath !== null && oDataModelPath !== void 0 && oDataModelPath.TargetValue ? getExpressionFromAnnotation(oDataModelPath.TargetValue) : unresolvableExpression;
  };
  const oResourceModel = sap.ui.getCore().getLibraryResourceBundle("sap.fe.macros");
  const buildExpressionForProgressIndicatorDisplayValue = oPropertyDataModelObjectPath => {
    var _oPropertyDataModelOb;
    const fieldValue = (oPropertyDataModelObjectPath === null || oPropertyDataModelObjectPath === void 0 ? void 0 : (_oPropertyDataModelOb = oPropertyDataModelObjectPath.targetObject) === null || _oPropertyDataModelOb === void 0 ? void 0 : _oPropertyDataModelOb.Value) || "";
    const relativeLocation = getRelativePaths(oPropertyDataModelObjectPath);
    let fieldValueExpression = getExpressionFromAnnotation(fieldValue, relativeLocation);
    const TargetExpression = getDataPointTargetExpression(oPropertyDataModelObjectPath.targetObject);
    if (fieldValueExpression && TargetExpression) {
      var _targetObject$annotat, _targetObject$annotat2, _targetObject$annotat3, _targetObject$annotat4;
      let targetObject = oPropertyDataModelObjectPath.targetObject.Value;
      if (!isProperty(targetObject)) {
        targetObject = oPropertyDataModelObjectPath.targetObject.Value.$target;
      }
      const unit = ((_targetObject$annotat = targetObject.annotations) === null || _targetObject$annotat === void 0 ? void 0 : (_targetObject$annotat2 = _targetObject$annotat.Measures) === null || _targetObject$annotat2 === void 0 ? void 0 : _targetObject$annotat2.Unit) || ((_targetObject$annotat3 = targetObject.annotations) === null || _targetObject$annotat3 === void 0 ? void 0 : (_targetObject$annotat4 = _targetObject$annotat3.Measures) === null || _targetObject$annotat4 === void 0 ? void 0 : _targetObject$annotat4.ISOCurrency);
      if (!unit) {
        return oResourceModel.getText("T_COMMON_PROGRESS_INDICATOR_DISPLAY_VALUE_NO_UOM", [compileExpression(fieldValueExpression), compileExpression(TargetExpression)]);
      }
      // If the unit isn't a path, we check for a % sign as it is a special case.
      if (hasStaticPercentUnit(fieldValue === null || fieldValue === void 0 ? void 0 : fieldValue.$target)) {
        return `${compileExpression(fieldValueExpression)} %`;
      }
      fieldValueExpression = formatWithTypeInformation(targetObject, fieldValueExpression);
      const unitBindingExpression = unit.$target ? formatWithTypeInformation(unit.$target, getExpressionFromAnnotation(unit, relativeLocation)) : getExpressionFromAnnotation(unit, relativeLocation);
      return compileExpression(formatResult([fieldValueExpression, TargetExpression, unitBindingExpression], valueFormatters.formatProgressIndicatorText));
    }
    return undefined;
  };
  _exports.buildExpressionForProgressIndicatorDisplayValue = buildExpressionForProgressIndicatorDisplayValue;
  const buildUnitBindingExpression = dataPoint => {
    var _dataPoint$targetObje, _dataPoint$targetObje2, _targetObject$annotat5, _targetObject$annotat6, _targetObject$annotat7, _targetObject$annotat8;
    const relativeLocation = getRelativePaths(dataPoint);
    const targetObject = dataPoint === null || dataPoint === void 0 ? void 0 : (_dataPoint$targetObje = dataPoint.targetObject) === null || _dataPoint$targetObje === void 0 ? void 0 : (_dataPoint$targetObje2 = _dataPoint$targetObje.Value) === null || _dataPoint$targetObje2 === void 0 ? void 0 : _dataPoint$targetObje2.$target;
    if (!isProperty(targetObject)) {
      return "";
    }
    const unit = ((_targetObject$annotat5 = targetObject.annotations) === null || _targetObject$annotat5 === void 0 ? void 0 : (_targetObject$annotat6 = _targetObject$annotat5.Measures) === null || _targetObject$annotat6 === void 0 ? void 0 : _targetObject$annotat6.Unit) || ((_targetObject$annotat7 = targetObject.annotations) === null || _targetObject$annotat7 === void 0 ? void 0 : (_targetObject$annotat8 = _targetObject$annotat7.Measures) === null || _targetObject$annotat8 === void 0 ? void 0 : _targetObject$annotat8.ISOCurrency);
    return unit ? compileExpression(getExpressionFromAnnotation(unit, relativeLocation)) : "";
  };
  _exports.buildUnitBindingExpression = buildUnitBindingExpression;
  const buildRatingIndicatorSubtitleExpression = (oContext, mSampleSize) => {
    if (mSampleSize) {
      return formatRatingIndicatorSubTitle(AnnotationHelper.value(mSampleSize, {
        context: oContext
      }));
    }
  };
  // returns the text for the Rating Indicator Subtitle (e.g. '7 reviews')
  const formatRatingIndicatorSubTitle = iSampleSizeValue => {
    if (iSampleSizeValue) {
      const sSubTitleLabel = iSampleSizeValue > 1 ? oResourceModel.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL_PLURAL") : oResourceModel.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL");
      return oResourceModel.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE", [String(iSampleSizeValue), sSubTitleLabel]);
    }
  };

  /**
   * This function is used to get the header text of rating indicator.
   *
   * @param oContext Context of interface
   * @param oDataPoint Data point object
   * @returns {string | undefined} Expression binding for rating indicator text
   */
  const getHeaderRatingIndicatorText = (oContext, oDataPoint) => {
    let result;
    if (oDataPoint && oDataPoint.SampleSize) {
      result = buildRatingIndicatorSubtitleExpression(oContext, oDataPoint.SampleSize);
    } else if (oDataPoint && oDataPoint.Description) {
      const sModelValue = AnnotationHelper.value(oDataPoint.Description, {
        context: oContext
      });
      result = "${path:" + sModelValue + "}";
    }
    return result;
  };
  getHeaderRatingIndicatorText.requiresIContext = true;
  _exports.getHeaderRatingIndicatorText = getHeaderRatingIndicatorText;
  const buildExpressionForDescription = fieldValue => {
    var _fieldValue$targetObj, _fieldValue$targetObj2, _fieldValue$targetObj3;
    const relativeLocation = getRelativePaths(fieldValue);
    if (fieldValue !== null && fieldValue !== void 0 && (_fieldValue$targetObj = fieldValue.targetObject) !== null && _fieldValue$targetObj !== void 0 && (_fieldValue$targetObj2 = _fieldValue$targetObj.annotations) !== null && _fieldValue$targetObj2 !== void 0 && (_fieldValue$targetObj3 = _fieldValue$targetObj2.Common) !== null && _fieldValue$targetObj3 !== void 0 && _fieldValue$targetObj3.Text) {
      var _fieldValue$targetObj4, _fieldValue$targetObj5;
      const oTextExpression = getExpressionFromAnnotation(fieldValue === null || fieldValue === void 0 ? void 0 : (_fieldValue$targetObj4 = fieldValue.targetObject.annotations) === null || _fieldValue$targetObj4 === void 0 ? void 0 : (_fieldValue$targetObj5 = _fieldValue$targetObj4.Common) === null || _fieldValue$targetObj5 === void 0 ? void 0 : _fieldValue$targetObj5.Text, relativeLocation);
      if (isPathInModelExpression(oTextExpression)) {
        oTextExpression.parameters = {
          $$noPatch: true
        };
      }
      return oTextExpression;
    }
    return undefined;
  };
  const getDecimalFormat = (outExpression, fieldValue, sNumberOfFractionalDigits) => {
    if (!outExpression.constraints) {
      outExpression.constraints = {};
    }
    outExpression.constraints = Object.assign(outExpression.constraints, {
      precision: fieldValue.$target.precision,
      scale: sNumberOfFractionalDigits ? sNumberOfFractionalDigits : fieldValue.$target.scale
    });
    // sNumberOfFractionalDigits is only defined in getValueFormatted when NumberOfFractionalDigits is defined.
    // In that case, we need to instance the preserveDecimals parameter because of a change MDC side
    if (sNumberOfFractionalDigits) {
      if (!outExpression.formatOptions) {
        outExpression.formatOptions = {};
      }
      outExpression.formatOptions = Object.assign(outExpression.formatOptions, {
        preserveDecimals: false
      });
    }
    return outExpression;
  };
  const getValueFormatted = (oPropertyDataModelPath, fieldValue, sPropertyType, sNumberOfFractionalDigits) => {
    var _fieldValue$path;
    let outExpression;
    const relativeLocation = (fieldValue === null || fieldValue === void 0 ? void 0 : (_fieldValue$path = fieldValue.path) === null || _fieldValue$path === void 0 ? void 0 : _fieldValue$path.indexOf("/")) === -1 ? getRelativePaths(oPropertyDataModelPath) : [];
    outExpression = getExpressionFromAnnotation(fieldValue, relativeLocation);
    const oPropertyDefinition = oPropertyDataModelPath.targetObject;
    if (sPropertyType && isPathInModelExpression(outExpression)) {
      var _EDM_TYPE_MAPPING$sPr;
      formatWithTypeInformation(oPropertyDefinition, outExpression);
      outExpression.type = (_EDM_TYPE_MAPPING$sPr = EDM_TYPE_MAPPING[sPropertyType]) === null || _EDM_TYPE_MAPPING$sPr === void 0 ? void 0 : _EDM_TYPE_MAPPING$sPr.type;
      switch (sPropertyType) {
        case "Edm.Decimal":
          // for the listReport, the decimal fields are formatted by returning a string
          // for the facets of the OP, the decimal fields are formatted by returning a promise, so we manage all the cases
          outExpression = getDecimalFormat(outExpression, fieldValue, sNumberOfFractionalDigits);
          break;
        default:
      }
    }
    return outExpression;
  };
  _exports.getValueFormatted = getValueFormatted;
  const buildFieldBindingExpression = (oDataModelPath, dataPointFormatOptions, bHideMeasure) => {
    var _oDataPointValue$$tar, _oPropertyDataModelOb2, _oPropertyDataModelOb3, _oPropertyDataModelOb4;
    const oDataPoint = oDataModelPath.targetObject;
    const oDataPointValue = (oDataPoint === null || oDataPoint === void 0 ? void 0 : oDataPoint.Value) || "";
    const sPropertyType = oDataPointValue === null || oDataPointValue === void 0 ? void 0 : (_oDataPointValue$$tar = oDataPointValue.$target) === null || _oDataPointValue$$tar === void 0 ? void 0 : _oDataPointValue$$tar.type;
    let sNumberOfFractionalDigits;
    if (sPropertyType === "Edm.Decimal" && oDataPoint.ValueFormat) {
      if (oDataPoint.ValueFormat.NumberOfFractionalDigits) {
        sNumberOfFractionalDigits = oDataPoint.ValueFormat.NumberOfFractionalDigits;
      }
    }
    const oPropertyDataModelObjectPath = enhanceDataModelPath(oDataModelPath, oDataPointValue.path);
    const oDescription = oPropertyDataModelObjectPath ? buildExpressionForDescription(oPropertyDataModelObjectPath) : undefined;
    const oFormattedValue = getValueFormatted(oPropertyDataModelObjectPath, oDataPointValue, sPropertyType, sNumberOfFractionalDigits);
    const sDisplayMode = oDescription ? dataPointFormatOptions.displayMode || getDisplayMode(oPropertyDataModelObjectPath) : "Value";
    let oBindingExpression;
    switch (sDisplayMode) {
      case "Description":
        oBindingExpression = oDescription;
        break;
      case "ValueDescription":
        oBindingExpression = formatResult([oFormattedValue, oDescription], valueFormatters.formatWithBrackets);
        break;
      case "DescriptionValue":
        oBindingExpression = formatResult([oDescription, oFormattedValue], valueFormatters.formatWithBrackets);
        break;
      default:
        if ((_oPropertyDataModelOb2 = oPropertyDataModelObjectPath.targetObject) !== null && _oPropertyDataModelOb2 !== void 0 && (_oPropertyDataModelOb3 = _oPropertyDataModelOb2.annotations) !== null && _oPropertyDataModelOb3 !== void 0 && (_oPropertyDataModelOb4 = _oPropertyDataModelOb3.Common) !== null && _oPropertyDataModelOb4 !== void 0 && _oPropertyDataModelOb4.Timezone) {
          oBindingExpression = getBindingWithTimezone(oPropertyDataModelObjectPath, oFormattedValue);
        } else {
          oBindingExpression = _computeBindingWithUnitOrCurrency(oPropertyDataModelObjectPath, oFormattedValue, bHideMeasure || (dataPointFormatOptions === null || dataPointFormatOptions === void 0 ? void 0 : dataPointFormatOptions.measureDisplayMode) === "Hidden");
        }
    }
    return compileExpression(oBindingExpression);
  };
  _exports.buildFieldBindingExpression = buildFieldBindingExpression;
  const _computeBindingWithUnitOrCurrency = (propertyDataModelObjectPath, formattedValue, hideMeasure) => {
    var _propertyDataModelObj, _propertyDataModelObj2, _propertyDataModelObj3, _propertyDataModelObj4, _propertyDataModelObj5, _propertyDataModelObj6;
    if ((_propertyDataModelObj = propertyDataModelObjectPath.targetObject) !== null && _propertyDataModelObj !== void 0 && (_propertyDataModelObj2 = _propertyDataModelObj.annotations) !== null && _propertyDataModelObj2 !== void 0 && (_propertyDataModelObj3 = _propertyDataModelObj2.Measures) !== null && _propertyDataModelObj3 !== void 0 && _propertyDataModelObj3.Unit || (_propertyDataModelObj4 = propertyDataModelObjectPath.targetObject) !== null && _propertyDataModelObj4 !== void 0 && (_propertyDataModelObj5 = _propertyDataModelObj4.annotations) !== null && _propertyDataModelObj5 !== void 0 && (_propertyDataModelObj6 = _propertyDataModelObj5.Measures) !== null && _propertyDataModelObj6 !== void 0 && _propertyDataModelObj6.ISOCurrency) {
      if (hideMeasure && hasStaticPercentUnit(propertyDataModelObjectPath.targetObject)) {
        return formattedValue;
      }
      return getBindingWithUnitOrCurrency(propertyDataModelObjectPath, formattedValue, undefined, hideMeasure ? {
        showMeasure: false
      } : undefined);
    }
    return formattedValue;
  };

  /**
   * Method to calculate the percentage value of Progress Indicator. Basic formula is Value/Target * 100.
   *
   * @param oPropertyDataModelObjectPath
   * @returns The expression binding used to calculate the percentage value, which is shown in the progress indicator based on the formula given above.
   */
  _exports._computeBindingWithUnitOrCurrency = _computeBindingWithUnitOrCurrency;
  const buildExpressionForProgressIndicatorPercentValue = oPropertyDataModelObjectPath => {
    var _oPropertyDataModelOb5, _oPropertyDefinition$, _oPropertyDefinition$2, _oPropertyDefinition$3, _oPropertyDefinition$4;
    const fieldValue = (oPropertyDataModelObjectPath === null || oPropertyDataModelObjectPath === void 0 ? void 0 : (_oPropertyDataModelOb5 = oPropertyDataModelObjectPath.targetObject) === null || _oPropertyDataModelOb5 === void 0 ? void 0 : _oPropertyDataModelOb5.Value) || "";
    const relativeLocation = getRelativePaths(oPropertyDataModelObjectPath);
    const fieldValueExpression = getExpressionFromAnnotation(fieldValue, relativeLocation);
    const TargetExpression = getDataPointTargetExpression(oPropertyDataModelObjectPath.targetObject);
    const oPropertyDefinition = fieldValue.$target;
    const unit = ((_oPropertyDefinition$ = oPropertyDefinition.annotations) === null || _oPropertyDefinition$ === void 0 ? void 0 : (_oPropertyDefinition$2 = _oPropertyDefinition$.Measures) === null || _oPropertyDefinition$2 === void 0 ? void 0 : _oPropertyDefinition$2.Unit) || ((_oPropertyDefinition$3 = oPropertyDefinition.annotations) === null || _oPropertyDefinition$3 === void 0 ? void 0 : (_oPropertyDefinition$4 = _oPropertyDefinition$3.Measures) === null || _oPropertyDefinition$4 === void 0 ? void 0 : _oPropertyDefinition$4.ISOCurrency);
    if (unit) {
      const unitBindingExpression = unit.$target ? formatWithTypeInformation(unit.$target, getExpressionFromAnnotation(unit, relativeLocation)) : getExpressionFromAnnotation(unit, relativeLocation);
      return compileExpression(formatResult([fieldValueExpression, TargetExpression, unitBindingExpression], valueFormatters.computePercentage));
    }
    return compileExpression(formatResult([fieldValueExpression, TargetExpression, ""], valueFormatters.computePercentage));
  };
  _exports.buildExpressionForProgressIndicatorPercentValue = buildExpressionForProgressIndicatorPercentValue;
  return _exports;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZXREYXRhUG9pbnRUYXJnZXRFeHByZXNzaW9uIiwib0RhdGFNb2RlbFBhdGgiLCJUYXJnZXRWYWx1ZSIsImdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbiIsInVucmVzb2x2YWJsZUV4cHJlc3Npb24iLCJvUmVzb3VyY2VNb2RlbCIsInNhcCIsInVpIiwiZ2V0Q29yZSIsImdldExpYnJhcnlSZXNvdXJjZUJ1bmRsZSIsImJ1aWxkRXhwcmVzc2lvbkZvclByb2dyZXNzSW5kaWNhdG9yRGlzcGxheVZhbHVlIiwib1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aCIsImZpZWxkVmFsdWUiLCJ0YXJnZXRPYmplY3QiLCJWYWx1ZSIsInJlbGF0aXZlTG9jYXRpb24iLCJnZXRSZWxhdGl2ZVBhdGhzIiwiZmllbGRWYWx1ZUV4cHJlc3Npb24iLCJUYXJnZXRFeHByZXNzaW9uIiwiaXNQcm9wZXJ0eSIsIiR0YXJnZXQiLCJ1bml0IiwiYW5ub3RhdGlvbnMiLCJNZWFzdXJlcyIsIlVuaXQiLCJJU09DdXJyZW5jeSIsImdldFRleHQiLCJjb21waWxlRXhwcmVzc2lvbiIsImhhc1N0YXRpY1BlcmNlbnRVbml0IiwiZm9ybWF0V2l0aFR5cGVJbmZvcm1hdGlvbiIsInVuaXRCaW5kaW5nRXhwcmVzc2lvbiIsImZvcm1hdFJlc3VsdCIsInZhbHVlRm9ybWF0dGVycyIsImZvcm1hdFByb2dyZXNzSW5kaWNhdG9yVGV4dCIsInVuZGVmaW5lZCIsImJ1aWxkVW5pdEJpbmRpbmdFeHByZXNzaW9uIiwiZGF0YVBvaW50IiwiYnVpbGRSYXRpbmdJbmRpY2F0b3JTdWJ0aXRsZUV4cHJlc3Npb24iLCJvQ29udGV4dCIsIm1TYW1wbGVTaXplIiwiZm9ybWF0UmF0aW5nSW5kaWNhdG9yU3ViVGl0bGUiLCJBbm5vdGF0aW9uSGVscGVyIiwidmFsdWUiLCJjb250ZXh0IiwiaVNhbXBsZVNpemVWYWx1ZSIsInNTdWJUaXRsZUxhYmVsIiwiU3RyaW5nIiwiZ2V0SGVhZGVyUmF0aW5nSW5kaWNhdG9yVGV4dCIsIm9EYXRhUG9pbnQiLCJyZXN1bHQiLCJTYW1wbGVTaXplIiwiRGVzY3JpcHRpb24iLCJzTW9kZWxWYWx1ZSIsInJlcXVpcmVzSUNvbnRleHQiLCJidWlsZEV4cHJlc3Npb25Gb3JEZXNjcmlwdGlvbiIsIkNvbW1vbiIsIlRleHQiLCJvVGV4dEV4cHJlc3Npb24iLCJpc1BhdGhJbk1vZGVsRXhwcmVzc2lvbiIsInBhcmFtZXRlcnMiLCIkJG5vUGF0Y2giLCJnZXREZWNpbWFsRm9ybWF0Iiwib3V0RXhwcmVzc2lvbiIsInNOdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMiLCJjb25zdHJhaW50cyIsIk9iamVjdCIsImFzc2lnbiIsInByZWNpc2lvbiIsInNjYWxlIiwiZm9ybWF0T3B0aW9ucyIsInByZXNlcnZlRGVjaW1hbHMiLCJnZXRWYWx1ZUZvcm1hdHRlZCIsIm9Qcm9wZXJ0eURhdGFNb2RlbFBhdGgiLCJzUHJvcGVydHlUeXBlIiwicGF0aCIsImluZGV4T2YiLCJvUHJvcGVydHlEZWZpbml0aW9uIiwidHlwZSIsIkVETV9UWVBFX01BUFBJTkciLCJidWlsZEZpZWxkQmluZGluZ0V4cHJlc3Npb24iLCJkYXRhUG9pbnRGb3JtYXRPcHRpb25zIiwiYkhpZGVNZWFzdXJlIiwib0RhdGFQb2ludFZhbHVlIiwiVmFsdWVGb3JtYXQiLCJOdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMiLCJlbmhhbmNlRGF0YU1vZGVsUGF0aCIsIm9EZXNjcmlwdGlvbiIsIm9Gb3JtYXR0ZWRWYWx1ZSIsInNEaXNwbGF5TW9kZSIsImRpc3BsYXlNb2RlIiwiZ2V0RGlzcGxheU1vZGUiLCJvQmluZGluZ0V4cHJlc3Npb24iLCJmb3JtYXRXaXRoQnJhY2tldHMiLCJUaW1lem9uZSIsImdldEJpbmRpbmdXaXRoVGltZXpvbmUiLCJfY29tcHV0ZUJpbmRpbmdXaXRoVW5pdE9yQ3VycmVuY3kiLCJtZWFzdXJlRGlzcGxheU1vZGUiLCJwcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgiLCJmb3JtYXR0ZWRWYWx1ZSIsImhpZGVNZWFzdXJlIiwiZ2V0QmluZGluZ1dpdGhVbml0T3JDdXJyZW5jeSIsInNob3dNZWFzdXJlIiwiYnVpbGRFeHByZXNzaW9uRm9yUHJvZ3Jlc3NJbmRpY2F0b3JQZXJjZW50VmFsdWUiLCJjb21wdXRlUGVyY2VudGFnZSJdLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiRGF0YVBvaW50VGVtcGxhdGluZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFByb3BlcnR5IH0gZnJvbSBcIkBzYXAtdXgvdm9jYWJ1bGFyaWVzLXR5cGVzXCI7XG5pbXBvcnQgdmFsdWVGb3JtYXR0ZXJzIGZyb20gXCJzYXAvZmUvY29yZS9mb3JtYXR0ZXJzL1ZhbHVlRm9ybWF0dGVyXCI7XG5pbXBvcnQgdHlwZSB7IEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbiwgQ29tcGlsZWRCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb24sIFBhdGhJbk1vZGVsRXhwcmVzc2lvbiB9IGZyb20gXCJzYXAvZmUvY29yZS9oZWxwZXJzL0JpbmRpbmdUb29sa2l0XCI7XG5pbXBvcnQge1xuXHRjb21waWxlRXhwcmVzc2lvbixcblx0RURNX1RZUEVfTUFQUElORyxcblx0Zm9ybWF0UmVzdWx0LFxuXHRmb3JtYXRXaXRoVHlwZUluZm9ybWF0aW9uLFxuXHRnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24sXG5cdGlzUGF0aEluTW9kZWxFeHByZXNzaW9uLFxuXHR1bnJlc29sdmFibGVFeHByZXNzaW9uXG59IGZyb20gXCJzYXAvZmUvY29yZS9oZWxwZXJzL0JpbmRpbmdUb29sa2l0XCI7XG5pbXBvcnQgdHlwZSB7IERhdGFNb2RlbE9iamVjdFBhdGggfSBmcm9tIFwic2FwL2ZlL2NvcmUvdGVtcGxhdGluZy9EYXRhTW9kZWxQYXRoSGVscGVyXCI7XG5pbXBvcnQgeyBlbmhhbmNlRGF0YU1vZGVsUGF0aCwgZ2V0UmVsYXRpdmVQYXRocyB9IGZyb20gXCJzYXAvZmUvY29yZS90ZW1wbGF0aW5nL0RhdGFNb2RlbFBhdGhIZWxwZXJcIjtcbmltcG9ydCB7IGhhc1N0YXRpY1BlcmNlbnRVbml0LCBpc1Byb3BlcnR5IH0gZnJvbSBcInNhcC9mZS9jb3JlL3RlbXBsYXRpbmcvUHJvcGVydHlIZWxwZXJcIjtcbmltcG9ydCB7IGdldEJpbmRpbmdXaXRoVGltZXpvbmUsIGdldEJpbmRpbmdXaXRoVW5pdE9yQ3VycmVuY3ksIGdldERpc3BsYXlNb2RlIH0gZnJvbSBcInNhcC9mZS9jb3JlL3RlbXBsYXRpbmcvVUlGb3JtYXR0ZXJzXCI7XG5pbXBvcnQgQW5ub3RhdGlvbkhlbHBlciBmcm9tIFwic2FwL3VpL21vZGVsL29kYXRhL3Y0L0Fubm90YXRpb25IZWxwZXJcIjtcblxuZXhwb3J0IHR5cGUgRGF0YVBvaW50Rm9ybWF0T3B0aW9ucyA9IFBhcnRpYWw8e1xuXHRtZWFzdXJlRGlzcGxheU1vZGU6IHN0cmluZztcblx0ZGlzcGxheU1vZGU6IHN0cmluZztcbn0+O1xuXG5jb25zdCBnZXREYXRhUG9pbnRUYXJnZXRFeHByZXNzaW9uID0gKG9EYXRhTW9kZWxQYXRoOiBhbnkpOiBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248c3RyaW5nPiA9PiB7XG5cdHJldHVybiBvRGF0YU1vZGVsUGF0aD8uVGFyZ2V0VmFsdWUgPyBnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24ob0RhdGFNb2RlbFBhdGguVGFyZ2V0VmFsdWUpIDogdW5yZXNvbHZhYmxlRXhwcmVzc2lvbjtcbn07XG5cbmNvbnN0IG9SZXNvdXJjZU1vZGVsID0gc2FwLnVpLmdldENvcmUoKS5nZXRMaWJyYXJ5UmVzb3VyY2VCdW5kbGUoXCJzYXAuZmUubWFjcm9zXCIpO1xuXG5leHBvcnQgY29uc3QgYnVpbGRFeHByZXNzaW9uRm9yUHJvZ3Jlc3NJbmRpY2F0b3JEaXNwbGF5VmFsdWUgPSAoXG5cdG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGg6IERhdGFNb2RlbE9iamVjdFBhdGhcbik6IENvbXBpbGVkQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uID0+IHtcblx0Y29uc3QgZmllbGRWYWx1ZSA9IG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGg/LnRhcmdldE9iamVjdD8uVmFsdWUgfHwgXCJcIjtcblx0Y29uc3QgcmVsYXRpdmVMb2NhdGlvbiA9IGdldFJlbGF0aXZlUGF0aHMob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aCk7XG5cdGxldCBmaWVsZFZhbHVlRXhwcmVzc2lvbiA9IGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbihmaWVsZFZhbHVlLCByZWxhdGl2ZUxvY2F0aW9uKSBhcyBhbnk7XG5cdGNvbnN0IFRhcmdldEV4cHJlc3Npb24gPSBnZXREYXRhUG9pbnRUYXJnZXRFeHByZXNzaW9uKG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0T2JqZWN0KSBhcyBhbnk7XG5cblx0aWYgKGZpZWxkVmFsdWVFeHByZXNzaW9uICYmIFRhcmdldEV4cHJlc3Npb24pIHtcblx0XHRsZXQgdGFyZ2V0T2JqZWN0ID0gb1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QuVmFsdWU7XG5cdFx0aWYgKCFpc1Byb3BlcnR5KHRhcmdldE9iamVjdCkpIHtcblx0XHRcdHRhcmdldE9iamVjdCA9IG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgudGFyZ2V0T2JqZWN0LlZhbHVlLiR0YXJnZXQ7XG5cdFx0fVxuXHRcdGNvbnN0IHVuaXQgPSB0YXJnZXRPYmplY3QuYW5ub3RhdGlvbnM/Lk1lYXN1cmVzPy5Vbml0IHx8IHRhcmdldE9iamVjdC5hbm5vdGF0aW9ucz8uTWVhc3VyZXM/LklTT0N1cnJlbmN5O1xuXG5cdFx0aWYgKCF1bml0KSB7XG5cdFx0XHRyZXR1cm4gb1Jlc291cmNlTW9kZWwuZ2V0VGV4dChcIlRfQ09NTU9OX1BST0dSRVNTX0lORElDQVRPUl9ESVNQTEFZX1ZBTFVFX05PX1VPTVwiLCBbXG5cdFx0XHRcdGNvbXBpbGVFeHByZXNzaW9uKGZpZWxkVmFsdWVFeHByZXNzaW9uKSBhcyBzdHJpbmcsXG5cdFx0XHRcdGNvbXBpbGVFeHByZXNzaW9uKFRhcmdldEV4cHJlc3Npb24pIGFzIHN0cmluZ1xuXHRcdFx0XSk7XG5cdFx0fVxuXHRcdC8vIElmIHRoZSB1bml0IGlzbid0IGEgcGF0aCwgd2UgY2hlY2sgZm9yIGEgJSBzaWduIGFzIGl0IGlzIGEgc3BlY2lhbCBjYXNlLlxuXHRcdGlmIChoYXNTdGF0aWNQZXJjZW50VW5pdChmaWVsZFZhbHVlPy4kdGFyZ2V0KSkge1xuXHRcdFx0cmV0dXJuIGAke2NvbXBpbGVFeHByZXNzaW9uKGZpZWxkVmFsdWVFeHByZXNzaW9uKSBhcyBzdHJpbmd9ICVgO1xuXHRcdH1cblxuXHRcdGZpZWxkVmFsdWVFeHByZXNzaW9uID0gZm9ybWF0V2l0aFR5cGVJbmZvcm1hdGlvbih0YXJnZXRPYmplY3QsIGZpZWxkVmFsdWVFeHByZXNzaW9uKTtcblx0XHRjb25zdCB1bml0QmluZGluZ0V4cHJlc3Npb24gPSB1bml0LiR0YXJnZXRcblx0XHRcdD8gZm9ybWF0V2l0aFR5cGVJbmZvcm1hdGlvbih1bml0LiR0YXJnZXQsIGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbih1bml0LCByZWxhdGl2ZUxvY2F0aW9uKSlcblx0XHRcdDogZ2V0RXhwcmVzc2lvbkZyb21Bbm5vdGF0aW9uKHVuaXQsIHJlbGF0aXZlTG9jYXRpb24pO1xuXG5cdFx0cmV0dXJuIGNvbXBpbGVFeHByZXNzaW9uKFxuXHRcdFx0Zm9ybWF0UmVzdWx0KFtmaWVsZFZhbHVlRXhwcmVzc2lvbiwgVGFyZ2V0RXhwcmVzc2lvbiwgdW5pdEJpbmRpbmdFeHByZXNzaW9uXSwgdmFsdWVGb3JtYXR0ZXJzLmZvcm1hdFByb2dyZXNzSW5kaWNhdG9yVGV4dClcblx0XHQpO1xuXHR9XG5cdHJldHVybiB1bmRlZmluZWQ7XG59O1xuXG5leHBvcnQgY29uc3QgYnVpbGRVbml0QmluZGluZ0V4cHJlc3Npb24gPSAoZGF0YVBvaW50OiBEYXRhTW9kZWxPYmplY3RQYXRoKTogQ29tcGlsZWRCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb24gPT4ge1xuXHRjb25zdCByZWxhdGl2ZUxvY2F0aW9uID0gZ2V0UmVsYXRpdmVQYXRocyhkYXRhUG9pbnQpO1xuXG5cdGNvbnN0IHRhcmdldE9iamVjdCA9IGRhdGFQb2ludD8udGFyZ2V0T2JqZWN0Py5WYWx1ZT8uJHRhcmdldDtcblx0aWYgKCFpc1Byb3BlcnR5KHRhcmdldE9iamVjdCkpIHtcblx0XHRyZXR1cm4gXCJcIjtcblx0fVxuXHRjb25zdCB1bml0ID0gdGFyZ2V0T2JqZWN0LmFubm90YXRpb25zPy5NZWFzdXJlcz8uVW5pdCB8fCB0YXJnZXRPYmplY3QuYW5ub3RhdGlvbnM/Lk1lYXN1cmVzPy5JU09DdXJyZW5jeTtcblx0cmV0dXJuIHVuaXQgPyBjb21waWxlRXhwcmVzc2lvbihnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24odW5pdCwgcmVsYXRpdmVMb2NhdGlvbikpIDogXCJcIjtcbn07XG5cbmNvbnN0IGJ1aWxkUmF0aW5nSW5kaWNhdG9yU3VidGl0bGVFeHByZXNzaW9uID0gKG9Db250ZXh0OiBhbnksIG1TYW1wbGVTaXplOiBhbnkpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xuXHRpZiAobVNhbXBsZVNpemUpIHtcblx0XHRyZXR1cm4gZm9ybWF0UmF0aW5nSW5kaWNhdG9yU3ViVGl0bGUoQW5ub3RhdGlvbkhlbHBlci52YWx1ZShtU2FtcGxlU2l6ZSwgeyBjb250ZXh0OiBvQ29udGV4dCB9KSBhcyBhbnkpO1xuXHR9XG59O1xuLy8gcmV0dXJucyB0aGUgdGV4dCBmb3IgdGhlIFJhdGluZyBJbmRpY2F0b3IgU3VidGl0bGUgKGUuZy4gJzcgcmV2aWV3cycpXG5jb25zdCBmb3JtYXRSYXRpbmdJbmRpY2F0b3JTdWJUaXRsZSA9IChpU2FtcGxlU2l6ZVZhbHVlOiBudW1iZXIpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xuXHRpZiAoaVNhbXBsZVNpemVWYWx1ZSkge1xuXHRcdGNvbnN0IHNTdWJUaXRsZUxhYmVsID1cblx0XHRcdGlTYW1wbGVTaXplVmFsdWUgPiAxXG5cdFx0XHRcdD8gb1Jlc291cmNlTW9kZWwuZ2V0VGV4dChcIlRfQU5OT1RBVElPTl9IRUxQRVJfUkFUSU5HX0lORElDQVRPUl9TVUJUSVRMRV9MQUJFTF9QTFVSQUxcIilcblx0XHRcdFx0OiBvUmVzb3VyY2VNb2RlbC5nZXRUZXh0KFwiVF9BTk5PVEFUSU9OX0hFTFBFUl9SQVRJTkdfSU5ESUNBVE9SX1NVQlRJVExFX0xBQkVMXCIpO1xuXHRcdHJldHVybiBvUmVzb3VyY2VNb2RlbC5nZXRUZXh0KFwiVF9BTk5PVEFUSU9OX0hFTFBFUl9SQVRJTkdfSU5ESUNBVE9SX1NVQlRJVExFXCIsIFtTdHJpbmcoaVNhbXBsZVNpemVWYWx1ZSksIHNTdWJUaXRsZUxhYmVsXSk7XG5cdH1cbn07XG5cbi8qKlxuICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGdldCB0aGUgaGVhZGVyIHRleHQgb2YgcmF0aW5nIGluZGljYXRvci5cbiAqXG4gKiBAcGFyYW0gb0NvbnRleHQgQ29udGV4dCBvZiBpbnRlcmZhY2VcbiAqIEBwYXJhbSBvRGF0YVBvaW50IERhdGEgcG9pbnQgb2JqZWN0XG4gKiBAcmV0dXJucyB7c3RyaW5nIHwgdW5kZWZpbmVkfSBFeHByZXNzaW9uIGJpbmRpbmcgZm9yIHJhdGluZyBpbmRpY2F0b3IgdGV4dFxuICovXG5leHBvcnQgY29uc3QgZ2V0SGVhZGVyUmF0aW5nSW5kaWNhdG9yVGV4dCA9IChvQ29udGV4dDogYW55LCBvRGF0YVBvaW50OiBhbnkpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xuXHRsZXQgcmVzdWx0OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cdGlmIChvRGF0YVBvaW50ICYmIG9EYXRhUG9pbnQuU2FtcGxlU2l6ZSkge1xuXHRcdHJlc3VsdCA9IGJ1aWxkUmF0aW5nSW5kaWNhdG9yU3VidGl0bGVFeHByZXNzaW9uKG9Db250ZXh0LCBvRGF0YVBvaW50LlNhbXBsZVNpemUpO1xuXHR9IGVsc2UgaWYgKG9EYXRhUG9pbnQgJiYgb0RhdGFQb2ludC5EZXNjcmlwdGlvbikge1xuXHRcdGNvbnN0IHNNb2RlbFZhbHVlID0gQW5ub3RhdGlvbkhlbHBlci52YWx1ZShvRGF0YVBvaW50LkRlc2NyaXB0aW9uLCB7IGNvbnRleHQ6IG9Db250ZXh0IH0pO1xuXHRcdHJlc3VsdCA9IFwiJHtwYXRoOlwiICsgc01vZGVsVmFsdWUgKyBcIn1cIjtcblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTtcbmdldEhlYWRlclJhdGluZ0luZGljYXRvclRleHQucmVxdWlyZXNJQ29udGV4dCA9IHRydWU7XG5cbmNvbnN0IGJ1aWxkRXhwcmVzc2lvbkZvckRlc2NyaXB0aW9uID0gKGZpZWxkVmFsdWU6IERhdGFNb2RlbE9iamVjdFBhdGgpOiBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248YW55PiB8IHVuZGVmaW5lZCA9PiB7XG5cdGNvbnN0IHJlbGF0aXZlTG9jYXRpb24gPSBnZXRSZWxhdGl2ZVBhdGhzKGZpZWxkVmFsdWUpO1xuXHRpZiAoZmllbGRWYWx1ZT8udGFyZ2V0T2JqZWN0Py5hbm5vdGF0aW9ucz8uQ29tbW9uPy5UZXh0KSB7XG5cdFx0Y29uc3Qgb1RleHRFeHByZXNzaW9uID0gZ2V0RXhwcmVzc2lvbkZyb21Bbm5vdGF0aW9uKGZpZWxkVmFsdWU/LnRhcmdldE9iamVjdC5hbm5vdGF0aW9ucz8uQ29tbW9uPy5UZXh0LCByZWxhdGl2ZUxvY2F0aW9uKTtcblx0XHRpZiAoaXNQYXRoSW5Nb2RlbEV4cHJlc3Npb24ob1RleHRFeHByZXNzaW9uKSkge1xuXHRcdFx0b1RleHRFeHByZXNzaW9uLnBhcmFtZXRlcnMgPSB7ICQkbm9QYXRjaDogdHJ1ZSB9O1xuXHRcdH1cblx0XHRyZXR1cm4gb1RleHRFeHByZXNzaW9uO1xuXHR9XG5cdHJldHVybiB1bmRlZmluZWQ7XG59O1xuXG5jb25zdCBnZXREZWNpbWFsRm9ybWF0ID0gKFxuXHRvdXRFeHByZXNzaW9uOiBQYXRoSW5Nb2RlbEV4cHJlc3Npb248YW55Pixcblx0ZmllbGRWYWx1ZTogYW55LFxuXHRzTnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzOiBzdHJpbmdcbik6IEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbjxhbnk+ID0+IHtcblx0aWYgKCFvdXRFeHByZXNzaW9uLmNvbnN0cmFpbnRzKSB7XG5cdFx0b3V0RXhwcmVzc2lvbi5jb25zdHJhaW50cyA9IHt9O1xuXHR9XG5cdG91dEV4cHJlc3Npb24uY29uc3RyYWludHMgPSBPYmplY3QuYXNzaWduKG91dEV4cHJlc3Npb24uY29uc3RyYWludHMsIHtcblx0XHRwcmVjaXNpb246IGZpZWxkVmFsdWUuJHRhcmdldC5wcmVjaXNpb24sXG5cdFx0c2NhbGU6IHNOdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMgPyBzTnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzIDogZmllbGRWYWx1ZS4kdGFyZ2V0LnNjYWxlXG5cdH0pO1xuXHQvLyBzTnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzIGlzIG9ubHkgZGVmaW5lZCBpbiBnZXRWYWx1ZUZvcm1hdHRlZCB3aGVuIE51bWJlck9mRnJhY3Rpb25hbERpZ2l0cyBpcyBkZWZpbmVkLlxuXHQvLyBJbiB0aGF0IGNhc2UsIHdlIG5lZWQgdG8gaW5zdGFuY2UgdGhlIHByZXNlcnZlRGVjaW1hbHMgcGFyYW1ldGVyIGJlY2F1c2Ugb2YgYSBjaGFuZ2UgTURDIHNpZGVcblx0aWYgKHNOdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMpIHtcblx0XHRpZiAoIW91dEV4cHJlc3Npb24uZm9ybWF0T3B0aW9ucykge1xuXHRcdFx0b3V0RXhwcmVzc2lvbi5mb3JtYXRPcHRpb25zID0ge307XG5cdFx0fVxuXHRcdG91dEV4cHJlc3Npb24uZm9ybWF0T3B0aW9ucyA9IE9iamVjdC5hc3NpZ24ob3V0RXhwcmVzc2lvbi5mb3JtYXRPcHRpb25zLCB7XG5cdFx0XHRwcmVzZXJ2ZURlY2ltYWxzOiBmYWxzZVxuXHRcdH0pO1xuXHR9XG5cdHJldHVybiBvdXRFeHByZXNzaW9uO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldFZhbHVlRm9ybWF0dGVkID0gKFxuXHRvUHJvcGVydHlEYXRhTW9kZWxQYXRoOiBEYXRhTW9kZWxPYmplY3RQYXRoLFxuXHRmaWVsZFZhbHVlOiBhbnksXG5cdHNQcm9wZXJ0eVR5cGU6IHN0cmluZyxcblx0c051bWJlck9mRnJhY3Rpb25hbERpZ2l0czogc3RyaW5nXG4pOiBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248c3RyaW5nPiA9PiB7XG5cdGxldCBvdXRFeHByZXNzaW9uOiBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248YW55Pjtcblx0Y29uc3QgcmVsYXRpdmVMb2NhdGlvbiA9IGZpZWxkVmFsdWU/LnBhdGg/LmluZGV4T2YoXCIvXCIpID09PSAtMSA/IGdldFJlbGF0aXZlUGF0aHMob1Byb3BlcnR5RGF0YU1vZGVsUGF0aCkgOiBbXTtcblx0b3V0RXhwcmVzc2lvbiA9IGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbihmaWVsZFZhbHVlLCByZWxhdGl2ZUxvY2F0aW9uKTtcblx0Y29uc3Qgb1Byb3BlcnR5RGVmaW5pdGlvbiA9IG9Qcm9wZXJ0eURhdGFNb2RlbFBhdGgudGFyZ2V0T2JqZWN0IGFzIFByb3BlcnR5O1xuXHRpZiAoc1Byb3BlcnR5VHlwZSAmJiBpc1BhdGhJbk1vZGVsRXhwcmVzc2lvbihvdXRFeHByZXNzaW9uKSkge1xuXHRcdGZvcm1hdFdpdGhUeXBlSW5mb3JtYXRpb24ob1Byb3BlcnR5RGVmaW5pdGlvbiwgb3V0RXhwcmVzc2lvbik7XG5cdFx0b3V0RXhwcmVzc2lvbi50eXBlID0gRURNX1RZUEVfTUFQUElOR1tzUHJvcGVydHlUeXBlXT8udHlwZTtcblx0XHRzd2l0Y2ggKHNQcm9wZXJ0eVR5cGUpIHtcblx0XHRcdGNhc2UgXCJFZG0uRGVjaW1hbFwiOlxuXHRcdFx0XHQvLyBmb3IgdGhlIGxpc3RSZXBvcnQsIHRoZSBkZWNpbWFsIGZpZWxkcyBhcmUgZm9ybWF0dGVkIGJ5IHJldHVybmluZyBhIHN0cmluZ1xuXHRcdFx0XHQvLyBmb3IgdGhlIGZhY2V0cyBvZiB0aGUgT1AsIHRoZSBkZWNpbWFsIGZpZWxkcyBhcmUgZm9ybWF0dGVkIGJ5IHJldHVybmluZyBhIHByb21pc2UsIHNvIHdlIG1hbmFnZSBhbGwgdGhlIGNhc2VzXG5cdFx0XHRcdG91dEV4cHJlc3Npb24gPSBnZXREZWNpbWFsRm9ybWF0KG91dEV4cHJlc3Npb24sIGZpZWxkVmFsdWUsIHNOdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQ6XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIG91dEV4cHJlc3Npb247XG59O1xuXG5leHBvcnQgY29uc3QgYnVpbGRGaWVsZEJpbmRpbmdFeHByZXNzaW9uID0gKFxuXHRvRGF0YU1vZGVsUGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCxcblx0ZGF0YVBvaW50Rm9ybWF0T3B0aW9uczogRGF0YVBvaW50Rm9ybWF0T3B0aW9ucyxcblx0YkhpZGVNZWFzdXJlOiBib29sZWFuXG4pOiBDb21waWxlZEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbiA9PiB7XG5cdGNvbnN0IG9EYXRhUG9pbnQgPSBvRGF0YU1vZGVsUGF0aC50YXJnZXRPYmplY3Q7XG5cdGNvbnN0IG9EYXRhUG9pbnRWYWx1ZSA9IG9EYXRhUG9pbnQ/LlZhbHVlIHx8IFwiXCI7XG5cdGNvbnN0IHNQcm9wZXJ0eVR5cGUgPSBvRGF0YVBvaW50VmFsdWU/LiR0YXJnZXQ/LnR5cGU7XG5cdGxldCBzTnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzO1xuXG5cdGlmIChzUHJvcGVydHlUeXBlID09PSBcIkVkbS5EZWNpbWFsXCIgJiYgb0RhdGFQb2ludC5WYWx1ZUZvcm1hdCkge1xuXHRcdGlmIChvRGF0YVBvaW50LlZhbHVlRm9ybWF0Lk51bWJlck9mRnJhY3Rpb25hbERpZ2l0cykge1xuXHRcdFx0c051bWJlck9mRnJhY3Rpb25hbERpZ2l0cyA9IG9EYXRhUG9pbnQuVmFsdWVGb3JtYXQuTnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzO1xuXHRcdH1cblx0fVxuXHRjb25zdCBvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoID0gZW5oYW5jZURhdGFNb2RlbFBhdGgob0RhdGFNb2RlbFBhdGgsIG9EYXRhUG9pbnRWYWx1ZS5wYXRoKTtcblx0Y29uc3Qgb0Rlc2NyaXB0aW9uID0gb1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aCA/IGJ1aWxkRXhwcmVzc2lvbkZvckRlc2NyaXB0aW9uKG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgpIDogdW5kZWZpbmVkO1xuXHRjb25zdCBvRm9ybWF0dGVkVmFsdWUgPSBnZXRWYWx1ZUZvcm1hdHRlZChvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoLCBvRGF0YVBvaW50VmFsdWUsIHNQcm9wZXJ0eVR5cGUsIHNOdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMpO1xuXHRjb25zdCBzRGlzcGxheU1vZGUgPSBvRGVzY3JpcHRpb24gPyBkYXRhUG9pbnRGb3JtYXRPcHRpb25zLmRpc3BsYXlNb2RlIHx8IGdldERpc3BsYXlNb2RlKG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgpIDogXCJWYWx1ZVwiO1xuXHRsZXQgb0JpbmRpbmdFeHByZXNzaW9uOiBhbnk7XG5cdHN3aXRjaCAoc0Rpc3BsYXlNb2RlKSB7XG5cdFx0Y2FzZSBcIkRlc2NyaXB0aW9uXCI6XG5cdFx0XHRvQmluZGluZ0V4cHJlc3Npb24gPSBvRGVzY3JpcHRpb247XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwiVmFsdWVEZXNjcmlwdGlvblwiOlxuXHRcdFx0b0JpbmRpbmdFeHByZXNzaW9uID0gZm9ybWF0UmVzdWx0KFtvRm9ybWF0dGVkVmFsdWUsIG9EZXNjcmlwdGlvbl0sIHZhbHVlRm9ybWF0dGVycy5mb3JtYXRXaXRoQnJhY2tldHMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIkRlc2NyaXB0aW9uVmFsdWVcIjpcblx0XHRcdG9CaW5kaW5nRXhwcmVzc2lvbiA9IGZvcm1hdFJlc3VsdChbb0Rlc2NyaXB0aW9uLCBvRm9ybWF0dGVkVmFsdWVdLCB2YWx1ZUZvcm1hdHRlcnMuZm9ybWF0V2l0aEJyYWNrZXRzKTtcblx0XHRcdGJyZWFrO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHRpZiAob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3Q/LmFubm90YXRpb25zPy5Db21tb24/LlRpbWV6b25lKSB7XG5cdFx0XHRcdG9CaW5kaW5nRXhwcmVzc2lvbiA9IGdldEJpbmRpbmdXaXRoVGltZXpvbmUob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aCwgb0Zvcm1hdHRlZFZhbHVlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG9CaW5kaW5nRXhwcmVzc2lvbiA9IF9jb21wdXRlQmluZGluZ1dpdGhVbml0T3JDdXJyZW5jeShcblx0XHRcdFx0XHRvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoLFxuXHRcdFx0XHRcdG9Gb3JtYXR0ZWRWYWx1ZSxcblx0XHRcdFx0XHRiSGlkZU1lYXN1cmUgfHwgZGF0YVBvaW50Rm9ybWF0T3B0aW9ucz8ubWVhc3VyZURpc3BsYXlNb2RlID09PSBcIkhpZGRlblwiXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdH1cblx0cmV0dXJuIGNvbXBpbGVFeHByZXNzaW9uKG9CaW5kaW5nRXhwcmVzc2lvbik7XG59O1xuXG5leHBvcnQgY29uc3QgX2NvbXB1dGVCaW5kaW5nV2l0aFVuaXRPckN1cnJlbmN5ID0gKFxuXHRwcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGg6IERhdGFNb2RlbE9iamVjdFBhdGgsXG5cdGZvcm1hdHRlZFZhbHVlOiBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248c3RyaW5nPixcblx0aGlkZU1lYXN1cmU6IGJvb2xlYW5cbik6IEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbjxzdHJpbmc+ID0+IHtcblx0aWYgKFxuXHRcdHByb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3Q/LmFubm90YXRpb25zPy5NZWFzdXJlcz8uVW5pdCB8fFxuXHRcdHByb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3Q/LmFubm90YXRpb25zPy5NZWFzdXJlcz8uSVNPQ3VycmVuY3lcblx0KSB7XG5cdFx0aWYgKGhpZGVNZWFzdXJlICYmIGhhc1N0YXRpY1BlcmNlbnRVbml0KHByb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QpKSB7XG5cdFx0XHRyZXR1cm4gZm9ybWF0dGVkVmFsdWU7XG5cdFx0fVxuXHRcdHJldHVybiBnZXRCaW5kaW5nV2l0aFVuaXRPckN1cnJlbmN5KFxuXHRcdFx0cHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoLFxuXHRcdFx0Zm9ybWF0dGVkVmFsdWUsXG5cdFx0XHR1bmRlZmluZWQsXG5cdFx0XHRoaWRlTWVhc3VyZSA/IHsgc2hvd01lYXN1cmU6IGZhbHNlIH0gOiB1bmRlZmluZWRcblx0XHQpO1xuXHR9XG5cdHJldHVybiBmb3JtYXR0ZWRWYWx1ZTtcbn07XG5cbi8qKlxuICogTWV0aG9kIHRvIGNhbGN1bGF0ZSB0aGUgcGVyY2VudGFnZSB2YWx1ZSBvZiBQcm9ncmVzcyBJbmRpY2F0b3IuIEJhc2ljIGZvcm11bGEgaXMgVmFsdWUvVGFyZ2V0ICogMTAwLlxuICpcbiAqIEBwYXJhbSBvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoXG4gKiBAcmV0dXJucyBUaGUgZXhwcmVzc2lvbiBiaW5kaW5nIHVzZWQgdG8gY2FsY3VsYXRlIHRoZSBwZXJjZW50YWdlIHZhbHVlLCB3aGljaCBpcyBzaG93biBpbiB0aGUgcHJvZ3Jlc3MgaW5kaWNhdG9yIGJhc2VkIG9uIHRoZSBmb3JtdWxhIGdpdmVuIGFib3ZlLlxuICovXG5leHBvcnQgY29uc3QgYnVpbGRFeHByZXNzaW9uRm9yUHJvZ3Jlc3NJbmRpY2F0b3JQZXJjZW50VmFsdWUgPSAob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCk6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XG5cdGNvbnN0IGZpZWxkVmFsdWUgPSBvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoPy50YXJnZXRPYmplY3Q/LlZhbHVlIHx8IFwiXCI7XG5cdGNvbnN0IHJlbGF0aXZlTG9jYXRpb24gPSBnZXRSZWxhdGl2ZVBhdGhzKG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgpO1xuXHRjb25zdCBmaWVsZFZhbHVlRXhwcmVzc2lvbiA9IGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbihmaWVsZFZhbHVlLCByZWxhdGl2ZUxvY2F0aW9uKTtcblx0Y29uc3QgVGFyZ2V0RXhwcmVzc2lvbiA9IGdldERhdGFQb2ludFRhcmdldEV4cHJlc3Npb24ob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QpO1xuXG5cdGNvbnN0IG9Qcm9wZXJ0eURlZmluaXRpb24gPSBmaWVsZFZhbHVlLiR0YXJnZXQgYXMgUHJvcGVydHk7XG5cdGNvbnN0IHVuaXQgPSBvUHJvcGVydHlEZWZpbml0aW9uLmFubm90YXRpb25zPy5NZWFzdXJlcz8uVW5pdCB8fCBvUHJvcGVydHlEZWZpbml0aW9uLmFubm90YXRpb25zPy5NZWFzdXJlcz8uSVNPQ3VycmVuY3k7XG5cdGlmICh1bml0KSB7XG5cdFx0Y29uc3QgdW5pdEJpbmRpbmdFeHByZXNzaW9uID0gKHVuaXQgYXMgYW55KS4kdGFyZ2V0XG5cdFx0XHQ/IGZvcm1hdFdpdGhUeXBlSW5mb3JtYXRpb24oXG5cdFx0XHRcdFx0KHVuaXQgYXMgYW55KS4kdGFyZ2V0LFxuXHRcdFx0XHRcdGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbih1bml0LCByZWxhdGl2ZUxvY2F0aW9uKSBhcyBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248c3RyaW5nPlxuXHRcdFx0ICApXG5cdFx0XHQ6IChnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24odW5pdCwgcmVsYXRpdmVMb2NhdGlvbikgYXMgQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uPHN0cmluZz4pO1xuXG5cdFx0cmV0dXJuIGNvbXBpbGVFeHByZXNzaW9uKFxuXHRcdFx0Zm9ybWF0UmVzdWx0KFtmaWVsZFZhbHVlRXhwcmVzc2lvbiwgVGFyZ2V0RXhwcmVzc2lvbiwgdW5pdEJpbmRpbmdFeHByZXNzaW9uXSwgdmFsdWVGb3JtYXR0ZXJzLmNvbXB1dGVQZXJjZW50YWdlKVxuXHRcdCk7XG5cdH1cblxuXHRyZXR1cm4gY29tcGlsZUV4cHJlc3Npb24oZm9ybWF0UmVzdWx0KFtmaWVsZFZhbHVlRXhwcmVzc2lvbiwgVGFyZ2V0RXhwcmVzc2lvbiwgXCJcIl0sIHZhbHVlRm9ybWF0dGVycy5jb21wdXRlUGVyY2VudGFnZSkpO1xufTtcbiJdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQUE7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQXVCQSxNQUFNQSw0QkFBNEIsR0FBSUMsY0FBbUIsSUFBdUM7SUFDL0YsT0FBT0EsY0FBYyxhQUFkQSxjQUFjLGVBQWRBLGNBQWMsQ0FBRUMsV0FBVyxHQUFHQywyQkFBMkIsQ0FBQ0YsY0FBYyxDQUFDQyxXQUFXLENBQUMsR0FBR0Usc0JBQXNCO0VBQ3RILENBQUM7RUFFRCxNQUFNQyxjQUFjLEdBQUdDLEdBQUcsQ0FBQ0MsRUFBRSxDQUFDQyxPQUFPLEVBQUUsQ0FBQ0Msd0JBQXdCLENBQUMsZUFBZSxDQUFDO0VBRTFFLE1BQU1DLCtDQUErQyxHQUMzREMsNEJBQWlELElBQ1g7SUFBQTtJQUN0QyxNQUFNQyxVQUFVLEdBQUcsQ0FBQUQsNEJBQTRCLGFBQTVCQSw0QkFBNEIsZ0RBQTVCQSw0QkFBNEIsQ0FBRUUsWUFBWSwwREFBMUMsc0JBQTRDQyxLQUFLLEtBQUksRUFBRTtJQUMxRSxNQUFNQyxnQkFBZ0IsR0FBR0MsZ0JBQWdCLENBQUNMLDRCQUE0QixDQUFDO0lBQ3ZFLElBQUlNLG9CQUFvQixHQUFHZCwyQkFBMkIsQ0FBQ1MsVUFBVSxFQUFFRyxnQkFBZ0IsQ0FBUTtJQUMzRixNQUFNRyxnQkFBZ0IsR0FBR2xCLDRCQUE0QixDQUFDVyw0QkFBNEIsQ0FBQ0UsWUFBWSxDQUFRO0lBRXZHLElBQUlJLG9CQUFvQixJQUFJQyxnQkFBZ0IsRUFBRTtNQUFBO01BQzdDLElBQUlMLFlBQVksR0FBR0YsNEJBQTRCLENBQUNFLFlBQVksQ0FBQ0MsS0FBSztNQUNsRSxJQUFJLENBQUNLLFVB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