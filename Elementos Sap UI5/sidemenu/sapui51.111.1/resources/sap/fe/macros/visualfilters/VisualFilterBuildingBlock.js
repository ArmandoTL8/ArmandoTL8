/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/buildingBlocks/BuildingBlockRuntime","sap/fe/core/converters/helpers/Aggregation","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","../ResourceModel","./InteractiveChartHelper"],function(e,t,r,i,a,l,o,n,u){"use strict";var s,g,p,c,d,f,m,b,h,v,y,M,P,T,w,C,A,V,E,I,_,U,x,D,z,S,H,B,L,O,$,F,R,N,q,j,k,X,Y,G,W,J,K,Q,Z,ee,te,re,ie;var ae={};var le=o.generate;var oe=a.getInvolvedDataModelObjects;var ne=i.AggregationHelper;var ue=r.xml;var se=t.defineBuildingBlock;var ge=t.BuildingBlockBase;var pe=t.blockAttribute;function ce(e,t,r,i){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function de(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function fe(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;me(e,t)}function me(e,t){me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return me(e,t)}function be(e,t,r,i,a){var l={};Object.keys(i).forEach(function(e){l[e]=i[e]});l.enumerable=!!l.enumerable;l.configurable=!!l.configurable;if("value"in l||l.initializer){l.writable=true}l=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},l);if(a&&l.initializer!==void 0){l.value=l.initializer?l.initializer.call(a):void 0;l.initializer=undefined}if(l.initializer===void 0){Object.defineProperty(e,t,l);l=null}return l}function he(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let ve=(s=se({name:"VisualFilter",namespace:"sap.fe.macros"}),g=pe({type:"string"}),p=pe({type:"string",defaultValue:""}),c=pe({type:"sap.ui.model.Context",required:true,$kind:["EntitySet","NavigationProperty"]}),d=pe({type:"sap.ui.model.Context"}),f=pe({type:"string"}),m=pe({type:"string"}),b=pe({type:"sap.ui.model.Context"}),h=pe({type:"sap.ui.model.Context"}),v=pe({type:"boolean"}),y=pe({type:"boolean"}),M=pe({type:"boolean"}),P=pe({type:"string"}),T=pe({type:"string"}),w=pe({type:"sap.ui.model.Context"}),C=pe({type:"boolean"}),A=pe({type:"string"}),V=pe({type:"boolean"}),E=pe({type:"boolean"}),I=pe({type:"boolean",defaultValue:false}),_=pe({type:"string",defaultValue:"$auto.visualFilters"}),U=pe({type:"string"}),x=pe({type:"string"}),D=pe({type:"boolean"}),s(z=(S=function(t){fe(r,t);function r(r,i,a){var o,s,g,p,c,d,f,m,b,h,v,y,M,P,T,w,C,A,V,E,I,_;var U;U=t.call(this,r,i,a)||this;ce(U,"id",H,de(U));ce(U,"title",B,de(U));ce(U,"contextPath",L,de(U));ce(U,"metaPath",O,de(U));ce(U,"outParameter",$,de(U));ce(U,"valuelistProperty",F,de(U));ce(U,"selectionVariantAnnotation",R,de(U));ce(U,"inParameters",N,de(U));ce(U,"multipleSelectionAllowed",q,de(U));ce(U,"required",j,de(U));ce(U,"showOverlayInitially",k,de(U));ce(U,"renderLineChart",X,de(U));ce(U,"requiredProperties",Y,de(U));ce(U,"filterBarEntityType",G,de(U));ce(U,"showError",W,de(U));ce(U,"chartMeasure",J,de(U));ce(U,"bUoMHasCustomAggregate",K,de(U));ce(U,"showValueHelp",Q,de(U));ce(U,"bCustomAggregate",Z,de(U));ce(U,"groupId",ee,de(U));ce(U,"errorMessageTitle",te,de(U));ce(U,"errorMessage",re,de(U));ce(U,"draftSupported",ie,de(U));U.groupId="$auto.visualFilters";U.inParameters=r.inParameters;U.metaPath=r.metaPath;U.sMetaPath=(o=U.metaPath)===null||o===void 0?void 0:o.getPath();const x=oe(U.metaPath,r.contextPath);const D=U.getConverterContext(x,undefined,a);const z=new ne(D.getEntityType(),D);const S=z.getCustomAggregateDefinitions();const ae=x.targetObject;let le;let ue;const se=ae&&ae.Visualizations;if(se){for(let e=0;e<se.length;e++){const t=ae.Visualizations[e]&&ae.Visualizations[e].value;le=D.getEntityTypeAnnotation(t)&&D.getEntityTypeAnnotation(t).annotation}}let ge,pe=[];if((s=le)!==null&&s!==void 0&&(g=s.Measures)!==null&&g!==void 0&&g.length){pe=S.filter(function(e){var t;return e.qualifier===((t=le)===null||t===void 0?void 0:t.Measures[0].value)});ue=pe.length>0?pe[0].qualifier:le.Measures[0].value;ge=z.getAggregatedProperties("AggregatedProperties")[0]}if(ge&&ge.length>0&&!((p=le)!==null&&p!==void 0&&p.DynamicMeasures)&&pe.length===0&&(c=le)!==null&&c!==void 0&&c.Measures&&((d=le)===null||d===void 0?void 0:d.Measures.length)>0){e.warning("The transformational aggregate measures are configured as Chart.Measures but should be configured as Chart.DynamicMeasures instead. Please check the SAP Help documentation and correct the configuration accordingly.")}if((f=le)!==null&&f!==void 0&&f.DynamicMeasures){if(pe.length===0){ue=D.getConverterContextFor(D.getAbsoluteAnnotationPath(le.DynamicMeasures[0].value)).getDataModelObjectPath().targetObject.Name;ge=z.getAggregatedProperties("AggregatedProperty")}else{e.warning("The dynamic measures have been ignored as visual filters can deal with only 1 measure and the first (custom aggregate) measure defined under Chart.Measures is considered.")}}let fe;if(le){if(le.ChartType==="UI.ChartType/Line"||le.ChartType==="UI.ChartType/Bar"){fe=true}else{fe=false}}if(S.some(function(e){return e.qualifier===ue})){U.bCustomAggregate=true}let me;if(r.selectionVariantAnnotation){var be;const e=(be=U.metaPath)===null||be===void 0?void 0:be.getModel().createBindingContext(r.selectionVariantAnnotation.getPath());me=e&&oe(e,r.contextPath).targetObject}let he=0;if(me&&!r.multipleSelectionAllowed){for(let e=0;e<me.SelectOptions.length;e++){var ve;if(me.SelectOptions[e].PropertyName.value===((ve=le)===null||ve===void 0?void 0:ve.Dimensions[0].value)){he++;if(he>1){throw new Error("Multiple SelectOptions for FilterField having SingleValue Allowed Expression")}}}}const ye=U.getAggregateProperties(ge,ue);if(ye){U.aggregateProperties=ye}const Me=((m=se[0])===null||m===void 0?void 0:(b=m.$target)===null||b===void 0?void 0:b.Measures)&&((h=se[0])===null||h===void 0?void 0:(v=h.$target)===null||v===void 0?void 0:(y=v.Measures[0])===null||y===void 0?void 0:(M=y.$target)===null||M===void 0?void 0:M.annotations);const Pe=ye===null||ye===void 0?void 0:(P=ye.AggregatableProperty)===null||P===void 0?void 0:(T=P.$target)===null||T===void 0?void 0:T.annotations;const Te=Me===null||Me===void 0?void 0:Me.Measures;const we=Pe===null||Pe===void 0?void 0:Pe.Measures;const Ce=U.getUoM(Te,we);if(Ce&&S.some(function(e){return e.qualifier===Ce})){U.bUoMHasCustomAggregate=true}else{U.bUoMHasCustomAggregate=false}const Ae=Me===null||Me===void 0?void 0:(w=Me.UI)===null||w===void 0?void 0:w.Hidden;const Ve=Pe===null||Pe===void 0?void 0:(C=Pe.UI)===null||C===void 0?void 0:C.Hidden;const Ee=U.getHiddenMeasure(Ae,Ve,U.bCustomAggregate);const Ie=((A=le)===null||A===void 0?void 0:A.Dimensions[0])&&((V=le)===null||V===void 0?void 0:V.Dimensions[0].$target)&&le.Dimensions[0].$target.type;const _e=(E=le)===null||E===void 0?void 0:E.ChartType;if(Ie==="Edm.Date"||Ie==="Edm.Time"||Ie==="Edm.DateTimeOffset"){U.showValueHelp=false}else if(typeof Ee==="boolean"&&Ee){U.showValueHelp=false}else if(!(_e==="UI.ChartType/Bar"||_e==="UI.ChartType/Line")){U.showValueHelp=false}else if(r.renderLineChart==="false"&&_e==="UI.ChartType/Line"){U.showValueHelp=false}else{U.showValueHelp=true}U.chartType=_e;U.draftSupported=l.isDraftSupported(a.models.metaModel,(I=r.contextPath)===null||I===void 0?void 0:I.getPath());if(typeof Ee==="boolean"&&Ee||!fe||r.renderLineChart==="false"){U.showError=true;U.errorMessageTitle=Ee||!fe?n.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"):n.getText("M_VISUAL_FILTER_LINE_CHART_INVALID_DATATYPE");if(Ee){U.errorMessage=n.getText("M_VISUAL_FILTER_HIDDEN_MEASURE",[ue])}else if(!fe){U.errorMessage=n.getText("M_VISUAL_FILTER_UNSUPPORTED_CHART_TYPE")}else{U.errorMessage=n.getText("M_VISUAL_FILTER_LINE_CHART_UNSUPPORTED_DIMENSION")}}U.chartMeasure=ue;const Ue=U.sMetaPath+"Visualizations/0/$AnnotationPath";const xe=(_=U.metaPath)===null||_===void 0?void 0:_.getModel().createBindingContext(Ue,le);U._measureDimensionTitle=u.getMeasureDimensionTitle(xe,le,r.contextPath,U.bCustomAggregate,U.aggregateProperties);U._toolTip=u.getToolTip(xe,le,r.contextPath,U.sMetaPath,U.bCustomAggregate,U.aggregateProperties,U.renderLineChart);U._UoMVisibility=u.getUoMVisiblity(le,U.showError);U._scaleUoMTitle=u.getScaleUoMTitle(xe,le,r.contextPath,U.sMetaPath,U.bCustomAggregate,U.aggregateProperties);U._filterCountBinding=u.getfilterCountBinding(le);return U}ae=r;var i=r.prototype;i.getAggregateProperties=function e(t,r){let i;if(!t){return}t.some(function(e){if(e.Name===r){i=e;return true}});return i};i.getUoM=function e(t,r){var i,a;let l=t===null||t===void 0?void 0:t.ISOCurrency;let o=t===null||t===void 0?void 0:t.Unit;if(!l&&!o&&r){l=r.ISOCurrency;o=r.Unit}return((i=l)===null||i===void 0?void 0:i.path)||((a=o)===null||a===void 0?void 0:a.path)};i.getHiddenMeasure=function e(t,r,i){if(!i&&r){return r.valueOf()}else{return t===null||t===void 0?void 0:t.valueOf()}};i.getRequired=function e(){if(this.required){return ue`<Label text="" width="0.5rem" required="true">
							<layoutData>
								<OverflowToolbarLayoutData priority="Never" />
							</layoutData>
						</Label>`}else{return ue``}};i.getUoMTitle=function e(t){if(this._UoMVisibility){return ue`<Title
							id="${le([this.id,"ScaleUoMTitle"])}"
							visible="{= !${t}}"
							text="${this._scaleUoMTitle}"
							titleStyle="H6"
							level="H3"
							width="4.15rem"
						/>`}else{return ue``}};i.getValueHelp=function e(t){if(this.showValueHelp){return ue`<ToolbarSpacer />
						<Button
							id="${le([this.id,"VisualFilterValueHelpButton"])}"
							type="Transparent"
							ariaHasPopup="Dialog"
							text="${this._filterCountBinding}"
							press="VisualFilterRuntime.fireValueHelp"
							enabled="{= !${t}}"
						>
							<layoutData>
								<OverflowToolbarLayoutData priority="Never" />
							</layoutData>
						</Button>`}else{return ue``}};i.getInteractiveChartFragment=function e(){if(this.showError){return ue`<core:Fragment fragmentName="sap.fe.macros.visualfilters.fragments.InteractiveChartWithError" type="XML" />`}else if(this.chartType==="UI.ChartType/Bar"){return ue`<core:Fragment fragmentName="sap.fe.macros.visualfilters.fragments.InteractiveBarChart" type="XML" />`}else{return ue`<core:Fragment fragmentName="sap.fe.macros.visualfilters.fragments.InteractiveLineChart" type="XML" />`}};i.getTemplate=function e(){var t;const r=le([this.sMetaPath]);const i="${internal>"+r+"/showError}";const a=(t=this.metaPath)===null||t===void 0?void 0:t.getPath();return ue`
		<control:VisualFilter
		core:require="{VisualFilterRuntime: 'sap/fe/macros/visualfilters/VisualFilterRuntime'}"
		xmlns="sap.m"
		xmlns:control="sap.fe.core.controls.filterbar"
		xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
		xmlns:core="sap.ui.core"
		id="${this.id}"
		height="13rem"
		width="20.5rem"
		class="sapUiSmallMarginBeginEnd"
		customData:infoPath="${le([a])}"
	>
		<VBox height="2rem" class="sapUiSmallMarginBottom">
			<OverflowToolbar style="Clear">
				${this.getRequired()}
				<Title
					id="${le([this.id,"MeasureDimensionTitle"])}"
					text="${this._measureDimensionTitle}"
					tooltip="${this._toolTip}"
					titleStyle="H6"
					level="H3"
					class="sapUiTinyMarginEnd sapUiNoMarginBegin"
				/>
				${this.getUoMTitle(i)}
				${this.getValueHelp(i)}
			</OverflowToolbar>
		</VBox>
		<VBox height="100%" width="100%">
			${this.getInteractiveChartFragment()}
		</VBox>
	</control:VisualFilter>`};return r}(ge),H=be(S.prototype,"id",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),B=be(S.prototype,"title",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),L=be(S.prototype,"contextPath",[c],{configurable:true,enumerable:true,writable:true,initializer:null}),O=be(S.prototype,"metaPath",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),$=be(S.prototype,"outParameter",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),F=be(S.prototype,"valuelistProperty",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),R=be(S.prototype,"selectionVariantAnnotation",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),N=be(S.prototype,"inParameters",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),q=be(S.prototype,"multipleSelectionAllowed",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),j=be(S.prototype,"required",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),k=be(S.prototype,"showOverlayInitially",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),X=be(S.prototype,"renderLineChart",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=be(S.prototype,"requiredProperties",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),G=be(S.prototype,"filterBarEntityType",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),W=be(S.prototype,"showError",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),J=be(S.prototype,"chartMeasure",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),K=be(S.prototype,"bUoMHasCustomAggregate",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=be(S.prototype,"showValueHelp",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=be(S.prototype,"bCustomAggregate",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),ee=be(S.prototype,"groupId",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),te=be(S.prototype,"errorMessageTitle",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),re=be(S.prototype,"errorMessage",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),ie=be(S.prototype,"draftSupported",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),S))||z);ae=ve;return ae},false);
//# sourceMappingURL=VisualFilterBuildingBlock.js.map