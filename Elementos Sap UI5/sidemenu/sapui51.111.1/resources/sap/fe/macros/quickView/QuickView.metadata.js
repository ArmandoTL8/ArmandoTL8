/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/SemanticObjectHelper","sap/fe/macros/field/FieldTemplating","sap/fe/macros/MacroMetadata"],function(e,t,i,a,n,o){"use strict";var c=n.getDataModelObjectPathForValue;var s=a.hasSemanticObject;var r=a.getSemanticObjectUnavailableActions;var l=a.getSemanticObjects;var d=a.getSemanticObjectMappings;var u=a.getDynamicPathFromSemanticObject;var v=i.isProperty;var m=t.pathInModel;var f=t.getExpressionFromAnnotation;var p=t.compileExpression;const g=o.extend("sap.fe.macros.quickView.QuickView",{name:"QuickView",namespace:"sap.fe.macros",fragment:"sap.fe.macros.quickView.QuickView",metadata:{stereotype:"xmlmacro",designtime:"sap/fe/macros/quickView/QuickView.designtime",properties:{dataField:{type:"sap.ui.model.Context",required:true,$kind:"Property",$Type:["com.sap.vocabularies.UI.v1.DataField","com.sap.vocabularies.UI.v1.DataFieldWithUrl","com.sap.vocabularies.UI.v1.DataFieldForAnnotation","com.sap.vocabularies.UI.v1.DataPointType"]},semanticObject:{type:"string"},contextPath:{type:"sap.ui.model.Context",required:false},semanticObjectsToResolve:{type:"sap.ui.model.Context",required:false,computed:true}},events:{}},create:function(t){var i,a,o,s,r,l,d,f;let g=e.getInvolvedDataModelObjects(t.dataField,t.contextPath);const b=c(g);g=b||g;const y=g.targetObject;const O=y?n.isUsedInNavigationWithQuickViewFacets(g,y)+"":"false";const j=y===null||y===void 0?void 0:(i=y.annotations)===null||i===void 0?void 0:i.Common;const P=j?n.getSemanticObjectExpressionToResolve(j,true):[];const h=u(t.semanticObject);if(h){P.push({key:h,value:t.semanticObject})}t.semanticObjectsToResolve=n.getSemanticObjects(P);const S=this._getRelativePathToQuickViewEntity(g);const F=S?`/${((a=g.contextLocation)===null||a===void 0?void 0:(o=a.targetEntitySet)===null||o===void 0?void 0:o.name)||((s=g.contextLocation)===null||s===void 0?void 0:(r=s.targetObject)===null||r===void 0?void 0:r.fullyQualifiedName)}/${S}`:undefined;const k=S?p(m(S)):undefined;const Q=this._getPropertyWithSemanticObject(g);let T;const{semanticObjectsList:V,qualifierMap:w}=this._getSemanticObjectsForPayloadAndQualifierMap(Q);const x=this._getSemanticObjectMappingsForPayload(Q,w);const M=this._getSemanticObjectUnavailableActionsForPayload(Q,w);if(v(Q)){T=w["main"]||w[""]}this._addCustomSemanticObjectToSemanticObjectListForPayload(V,t.semanticObject);const _=((l=y.annotations)===null||l===void 0?void 0:(d=l.Common)===null||d===void 0?void 0:(f=d.Label)===null||f===void 0?void 0:f.valueOf())||"";const E={semanticObjects:V,entityType:F,semanticObjectUnavailableActions:M,semanticObjectMappings:x,mainSemanticObject:T,propertyPathLabel:_,dataField:F===undefined?t.dataField.getPath():undefined,contact:undefined,navigationPath:k,hasQuickViewFacets:O};t.delegateConfiguration=JSON.stringify({name:"sap/fe/macros/quickView/QuickViewDelegate",payload:E});return t},_getRelativePathToQuickViewEntity:function(e){let t;const i=this._getNavPropToQuickViewEntity(e);if(i){t=e.navigationProperties.reduce((t,a)=>{var n;if(a.name!==i.name&&!((n=e.contextLocation)!==null&&n!==void 0&&n.navigationProperties.find(e=>e.name===a.name))){return`${t}${a.name}/`}return t},"");t=`${t}${i.name}`}return t},_getPropertyWithSemanticObject:function(e){let t;if(s(e.targetObject)){t=e.targetObject}else if(e.navigationProperties.length>0){for(const a of e.navigationProperties){var i;if(!((i=e.contextLocation)!==null&&i!==void 0&&i.navigationProperties.find(e=>e.fullyQualifiedName===a.fullyQualifiedName))&&!t&&s(a)){t=a}}}return t},_getSemanticObjectsForPayloadAndQualifierMap:function(e){const t={};const i=[];if(e!==undefined){for(const a of l(e)){const e=p(f(a));if(e&&!i.includes(e)){t[a.qualifier||""]=e;i.push(e)}}}return{semanticObjectsList:i,qualifierMap:t}},_getSemanticObjectMappingsForPayload:function(e,t){const i=[];if(e!==undefined){for(const a of d(e)){const e=t[a.qualifier||""];if(e){i.push({semanticObject:e,items:a.map(e=>({key:e.LocalProperty.value,value:e.SemanticObjectProperty.valueOf()}))})}}}return i},_getSemanticObjectUnavailableActionsForPayload:function(e,t){const i=[];if(e!==undefined){for(const a of r(e)){const e=t[a.qualifier||""];if(e){i.push({semanticObject:e,actions:a.map(e=>e)})}}}return i},_addCustomSemanticObjectToSemanticObjectListForPayload:function(e,t){if(t){if(t[0]!=="["){if(e.indexOf(t)===-1){e.push(t)}}else{for(const i of JSON.parse(t)){if(e.indexOf(i)===-1){e.push(i)}}}}},_getNavPropToQuickViewEntity:function(e){var t;const i=e.targetObject;const a=e.targetEntityType.navigationProperties;let n=a.find(e=>{var t;return(t=e.referentialConstraint)===null||t===void 0?void 0:t.some(t=>{var a,n,o;return(t===null||t===void 0?void 0:t.sourceProperty)===i.name&&(e===null||e===void 0?void 0:(a=e.targetType)===null||a===void 0?void 0:(n=a.annotations)===null||n===void 0?void 0:(o=n.UI)===null||o===void 0?void 0:o.QuickViewFacets)})});if(!n&&((t=e.contextLocation)===null||t===void 0?void 0:t.targetEntitySet)!==e.targetEntitySet){var o,c,s,r,l,d;const t=(e===null||e===void 0?void 0:(o=e.targetEntityType)===null||o===void 0?void 0:(c=o.annotations)===null||c===void 0?void 0:(s=c.Common)===null||s===void 0?void 0:s.SemanticKey)||[];const a=t.some(function(e){var t;return(e===null||e===void 0?void 0:(t=e.$target)===null||t===void 0?void 0:t.name)===i.name});const u=e.navigationProperties[e.navigationProperties.length-1];if((a||i.isKey)&&e!==null&&e!==void 0&&(r=e.targetEntityType)!==null&&r!==void 0&&(l=r.annotations)!==null&&l!==void 0&&(d=l.UI)!==null&&d!==void 0&&d.QuickViewFacets){n=u}}return n}});return g},false);
//# sourceMappingURL=QuickView.metadata.js.map