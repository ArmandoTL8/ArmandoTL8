/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/type/TypeUtil","sap/ui/mdc/field/FieldBaseDelegate","sap/ui/model/Filter"],function(e,t,n,o,a){"use strict";return Object.assign({},o,{initializeTypeFromBinding:function(e,t,n){const o={};if(t&&t.isA(["sap.ui.model.odata.type.Unit","sap.ui.model.odata.type.Currency"])&&Array.isArray(n)&&n.length>2&&n[2]!==undefined){t.formatValue(n,"string");o.bTypeInitialized=true;o.mCustomUnits=n[2]}return o},initializeInternalUnitType:function(e,t,n){if((n===null||n===void 0?void 0:n.mCustomUnits)!==undefined){t.formatValue([null,null,n.mCustomUnits],"string")}},enhanceValueForUnit:function(e,t,n){if((n===null||n===void 0?void 0:n.bTypeInitialized)===true&&t.length===2){t.push(n.mCustomUnits);return t}return undefined},getDefaultValueHelpDelegate:function(e){return{name:"sap/ui/mdc/odata/v4/ValueHelpDelegate",payload:{}}},getTypeUtil:function(e){return n},_getValueListParameter:function(e,t){return e.Parameters.filter(function(e){if(e.LocalDataProperty){return e.LocalDataProperty.$PropertyPath===t}else{return false}})},_getFilter:function(e,t,n,o,i){const r=[];const l=e.Parameters.filter(function(e){var o;return e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterIn"||e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||((o=e.LocalDataProperty)===null||o===void 0?void 0:o.$PropertyPath)===t&&e.ValueListProperty===n});for(const e of l){var u;if(((u=e.LocalDataProperty)===null||u===void 0?void 0:u.$PropertyPath)===t){r.push(new a({path:n,operator:"EQ",value1:o}))}else if((e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterIn"||e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterInOut")&&i!==null&&i!==void 0&&i.isActionParameterDialog){var s;const t=`APD_::${(s=e.LocalDataProperty)===null||s===void 0?void 0:s.$PropertyPath}`;const n=sap.ui.getCore().byId(t);const o=n===null||n===void 0?void 0:n.getValue();if(o!==null){r.push(new a({path:e.ValueListProperty,operator:"EQ",value1:o}))}}}return r},getItemForValue:function(e,t,n){if(n.value!==""){return o.getItemForValue(e,t,n)}return undefined},getDescription:async function(n,o,a,i,r,l,u,s,c,d,p){var f,m;if(!n&&d!==null&&d!==void 0&&d.getDisplay().includes("Description")){n={retrieveTextFromValueList:true}}if(((f=n)===null||f===void 0?void 0:f.retrieveTextFromValueList)===true||((m=n)===null||m===void 0?void 0:m.isFilterField)===true){const n=o.getModel();const i=n?n.getMetaModel():t.getAppComponent(o).getModel().getMetaModel();const r=o.getPayload();const u=r===null||r===void 0?void 0:r.propertyPath;let s;try{var v;const t=await i.requestValueListInfo(u,true,l);const n=i.getObject(`${u}@sapui.name`);const o=t[Object.keys(t)[0]];const c=this._getValueListParameter(o,n);const d=c===null||c===void 0?void 0:(v=c[0])===null||v===void 0?void 0:v.ValueListProperty;if(!d){throw Error(`Inconsistent value help annotation for ${n}`)}const p=o.$model;const f=p.getMetaModel().getObject(`/${o.CollectionPath}/${d}@com.sap.vocabularies.Common.v1.Text`);if(f&&f.$Path){s=f.$Path;const e=this._getFilter(o,n,d,a,r);const t=p.bindList(`/${o.CollectionPath}`,undefined,undefined,e,{$select:s});const i=await t.requestContexts(0,2);return i.length?i[0].getObject(s):undefined}else{const t=`Text Annotation for ${d} is not defined`;e.error(t);return undefined}}catch(t){const n=t?t.status:undefined;const o=t instanceof Error?t.message:String(t);const a=n===404?`Metadata not found (${n}) for value help of property ${u}`:o;e.error(a)}}return undefined}})},false);
//# sourceMappingURL=FieldBaseDelegate.js.map