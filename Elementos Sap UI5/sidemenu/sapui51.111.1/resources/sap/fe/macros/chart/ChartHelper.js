/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/macros/CommonHelper","sap/fe/macros/internal/helpers/ActionHelper","sap/fe/macros/ODataMetaModelUtil","sap/ui/model/json/JSONModel","sap/ui/model/odata/v4/AnnotationHelper"],function(e,a,t,o,r,n,i){"use strict";var s=a.getUiControl;function c(e){if(!e){return undefined}let a=JSON.stringify(e);a=a.replace(new RegExp("{","g"),"\\{");a=a.replace(new RegExp("}","g"),"\\}");return a}function l(e){const a=e.getPath(),t=a.replace(/@com.sap.vocabularies.UI.v1.(Chart|PresentationVariant).*/,"");return t}const p={"com.sap.vocabularies.UI.v1.ChartType/Column":"column","com.sap.vocabularies.UI.v1.ChartType/ColumnStacked":"stacked_column","com.sap.vocabularies.UI.v1.ChartType/ColumnDual":"dual_column","com.sap.vocabularies.UI.v1.ChartType/ColumnStackedDual":"dual_stacked_column","com.sap.vocabularies.UI.v1.ChartType/ColumnStacked100":"100_stacked_column","com.sap.vocabularies.UI.v1.ChartType/ColumnStackedDual100":"100_dual_stacked_column","com.sap.vocabularies.UI.v1.ChartType/Bar":"bar","com.sap.vocabularies.UI.v1.ChartType/BarStacked":"stacked_bar","com.sap.vocabularies.UI.v1.ChartType/BarDual":"dual_bar","com.sap.vocabularies.UI.v1.ChartType/BarStackedDual":"dual_stacked_bar","com.sap.vocabularies.UI.v1.ChartType/BarStacked100":"100_stacked_bar","com.sap.vocabularies.UI.v1.ChartType/BarStackedDual100":"100_dual_stacked_bar","com.sap.vocabularies.UI.v1.ChartType/Area":"area","com.sap.vocabularies.UI.v1.ChartType/AreaStacked":"stacked_column","com.sap.vocabularies.UI.v1.ChartType/AreaStacked100":"100_stacked_column","com.sap.vocabularies.UI.v1.ChartType/HorizontalArea":"bar","com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked":"stacked_bar","com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked100":"100_stacked_bar","com.sap.vocabularies.UI.v1.ChartType/Line":"line","com.sap.vocabularies.UI.v1.ChartType/LineDual":"dual_line","com.sap.vocabularies.UI.v1.ChartType/Combination":"combination","com.sap.vocabularies.UI.v1.ChartType/CombinationStacked":"stacked_combination","com.sap.vocabularies.UI.v1.ChartType/CombinationDual":"dual_combination","com.sap.vocabularies.UI.v1.ChartType/CombinationStackedDual":"dual_stacked_combination","com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationStacked":"horizontal_stacked_combination","com.sap.vocabularies.UI.v1.ChartType/Pie":"pie","com.sap.vocabularies.UI.v1.ChartType/Donut":"donut","com.sap.vocabularies.UI.v1.ChartType/Scatter":"scatter","com.sap.vocabularies.UI.v1.ChartType/Bubble":"bubble","com.sap.vocabularies.UI.v1.ChartType/Radar":"line","com.sap.vocabularies.UI.v1.ChartType/HeatMap":"heatmap","com.sap.vocabularies.UI.v1.ChartType/TreeMap":"treemap","com.sap.vocabularies.UI.v1.ChartType/Waterfall":"waterfall","com.sap.vocabularies.UI.v1.ChartType/Bullet":"bullet","com.sap.vocabularies.UI.v1.ChartType/VerticalBullet":"vertical_bullet","com.sap.vocabularies.UI.v1.ChartType/HorizontalWaterfall":"horizontal_waterfall","com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationDual":"dual_horizontal_combination","com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationStackedDual":"dual_horizontal_stacked_combination"};const u={"com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Category":"category","com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series":"series","com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Category2":"category2"};const m={getP13nMode(e){const a=[],t=e.variantManagement&&(e.variantManagement==="Page"||e.variantManagement==="Control"),o=true;if(t&&o){if(o){return"Sort,Type,Item"}else if(typeof o==="object"){if(o.type){a.push("Type")}if(o.sort){a.push("Sort")}return a.join(",")}}},formatChartType(e){return p[e.$EnumMember]},formatDimensions(a){const t=a.getObject("./"),o=a.getModel(),i=l(a),s=[];let p,m;let b=false;t.DimensionAttributes=t.DimensionAttributes||[];for(p=0;p<t.Dimensions.length;p++){const a=t.Dimensions[p].$PropertyPath;const n=o.getObject(`${i+a}@com.sap.vocabularies.Common.v1.Text`)||{};if(a.indexOf("/")>-1){e.error(`$expand is not yet supported. Dimension: ${a} from an association cannot be used`)}if(n.$Path&&n.$Path.indexOf("/")>-1){e.error(`$expand is not yet supported. Text Property: ${n.$Path} from an association cannot be used for the dimension ${a}`);b=true}const l={key:a,textPath:!b?n.$Path:undefined,label:o.getObject(`${i+a}@com.sap.vocabularies.Common.v1.Label`),role:"category"};for(m=0;m<t.DimensionAttributes.length;m++){const e=t.DimensionAttributes[m];if(l.key===e.Dimension.$PropertyPath){l.role=u[e.Role.$EnumMember]||l.role;break}}l.criticality=r.fetchCriticality(o,o.createBindingContext(i+a)).then(c);s.push(l)}const v=new n(s);v.$$valueAsPromise=true;return v.createBindingContext("/")},formatMeasures(e){return e.getModel().getData()},getUiChart(e){return s(e,"@com.sap.vocabularies.UI.v1.Chart")},getOperationAvailableMap(e,a){const t=e.Actions||[];return JSON.stringify(o.getOperationAvailableMap(t,"chart",a))},getSortConditions:function(e,a,o,r){if(a&&t._isPresentationVariantAnnotation(o)&&a.SortOrder){const t={sorters:[]};const o=e.getPath(0).split("@")[0];a.SortOrder.forEach(function(){let a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};let n="";const i={};if(a.DynamicProperty){var s;n="_fe_aggregatable_"+((s=e.getModel(0).getObject(o+a.DynamicProperty.$AnnotationPath))===null||s===void 0?void 0:s.Name)}else if(a.Property){const t=r.GroupableProperties;if(t&&t.length){for(let e=0;e<t.length;e++){if(t[e].$PropertyPath===a.Property.$PropertyPath){n="_fe_groupable_"+a.Property.$PropertyPath;break}if(!n){n="_fe_aggregatable_"+a.Property.$PropertyPath}}}else if(e.getModel(0).getObject(o+a.Property.$PropertyPath+"@Org.OData.Aggregation.V1.Groupable")){n="_fe_groupable_"+a.Property.$PropertyPath}else{n="_fe_aggregatable_"+a.Property.$PropertyPath}}if(n){i.name=n;i.descending=!!a.Descending;t.sorters.push(i)}else{throw new Error("Please define the right path to the sort property")}});return JSON.stringify(t)}return undefined},getBindingData(e,a,o){const r=[];let n;for(const e in o){if(o[e].$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){const n=o[e].Action;const i=t.getActionPath(a,false,n,true);if(i&&i.$Path){r.push(`'${i.$Path}'`)}else if(i===null){}}}if(r.length>0){n=" $select: '"+r.join()+"'"}return"'{path: '"+(a.getObject("$kind")==="EntitySet"?"/":"")+a.getObject("@sapui.name")+"'"+(n?",parameters:{"+n+"}":"")+"}'"},_getModel(e,a){return a.context},isDataFieldForActionButtonEnabled(e,a,t,r,n){if(e!==true){return"true"}const i=t.getModel();const s=t.getPath();const c=i.getObject(s).$Partner;const l=r&&JSON.parse(r);const p=l&&l[a]&&l[a].split("/");const u=o.getNumberOfContextsExpression(n);if(p&&p[0]===c){const e=l[a].replace(c+"/","");return"{= ${"+u+" && ${"+e+"}}"}else{return"{= ${"+u+"}"}},getHiddenPathExpressionForTableActionsAndIBN(e,a){const t=a.context,o=t.getPath(),r=i.getNavigationPath(o);if(e.indexOf("/")>0){const a=e.split("/");const o=a[0];if(t.getObject(r+"/$Partner")===o){return"{= !%{"+a.slice(1).join("/")+"} }"}}return true},getPressEventForDataFieldForActionButton(e,a,t){const r={contexts:"${internal>selectedContexts}"};return o.getPressEventDataFieldForActionButton(e,a,r,t)},getActionType(e){return(e["$Type"].indexOf("com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")>-1||e["$Type"].indexOf("com.sap.vocabularies.UI.v1.DataFieldForAction")>-1)&&e["Inline"]},getCollectionName(e){return e.split("/")[e.split("/").length-1]}};m.getSortConditions.requiresIContext=true;return m},false);
//# sourceMappingURL=ChartHelper.js.map