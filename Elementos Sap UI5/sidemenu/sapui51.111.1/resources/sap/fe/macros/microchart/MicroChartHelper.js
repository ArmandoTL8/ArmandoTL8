/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/macros/CommonHelper","sap/m/library","sap/ui/core/format/DateFormat"],function(t,e,a,r){"use strict";const n=a.ValueColor;const i={yyyy:new RegExp("[1-9][0-9]{3,}|0[0-9]{3}"),Q:new RegExp("[1-4]"),MM:new RegExp("0[1-9]|1[0-2]"),ww:new RegExp("0[1-9]|[1-4][0-9]|5[0-3]"),yyyyMMdd:new RegExp("([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])"),yyyyMM:new RegExp("([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])")};const o={getThresholdColor:function(t,e){const a=e.context;const r=a.getPath();let i=n.Neutral;if(r.indexOf("DeviationRange")>-1){i=n.Error}else if(r.indexOf("ToleranceRange")>-1){i=n.Critical}return i},getMeasurePropertyPaths:function(a,r,n){const i=[];if(!r){t.warning("FE:Macro:MicroChart : Couldn't find annotations for the DataPoint.");return undefined}a.Measures.forEach(function(o,s){const u=e.getMeasureAttributeIndex(s,a),l=u>-1&&a.MeasureAttributes&&a.MeasureAttributes[u],c=l&&r&&r[l.DataPoint.$AnnotationPath];if(c&&c.Value&&c.Value.$Path){i.push(c.Value.$Path)}else{t.warning(`FE:Macro:MicroChart : Couldn't find DataPoint(Value) measure for the measureAttribute ${n} MicroChart.`)}});return i.join(",")},getHiddenPathExpression:function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++){e[a]=arguments[a]}if(!e[0]&&!e[1]){return true}else if(e[0]===true||e[1]===true){return false}else{const t=[];[].forEach.call(e,function(e){if(e&&e.$Path){t.push("%{"+e.$Path+"}")}});return"{= "+t.join(" || ")+" === true ? false : true }"}},isNotAlwaysHidden:function(t,e,a,r,n){if(r===true){this.logError(t,e)}if(n===true){this.logError(t,a)}if(r===undefined&&n===undefined){return true}else{return(!r||r.$Path)&&r!==undefined||(!n||n.$Path)&&n!==undefined?true:false}},logError:function(e,a){t.error(`Measure Property ${a.$Path} is hidden for the ${e} Micro Chart`)},formatDecimal:function(t,e,a){const r=[],n=["style: 'short'"];let i;if(typeof a==="number"){i=a}else{i=e&&e.$Scale||1}let o;if(t){if(e.$Nullable!=undefined){r.push("nullable: "+e.$Nullable)}if(e.$Precision!=undefined){n.push("precision: "+(e.$Precision?e.$Precision:"1"))}r.push("scale: "+(i==="variable"?"'"+i+"'":i));o="{ path: '"+t+"'"+", type: 'sap.ui.model.odata.type.Decimal', constraints: { "+r.join(",")+" }, formatOptions: { "+n.join(",")+" } }"}return o},getSelectParameters:function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++){e[a]=arguments[a]}const r=[],n=e[1],i=[];if(e[0]){i.push("$$groupId : '"+e[0]+"'")}if(e[2]){r.push(e[2])}else if(n){for(const t in n){if(!n[t].$EnumMember&&n[t].$Path){r.push(n[t].$Path)}}}for(let t=3;t<e.length;t++){if(e[t]){r.push(e[t])}}if(r.length){i.push("$select : '"+r.join(",")+"'")}return i.join(",")},getDataPointQualifiersForMeasures:function(e,a,r){const n=[],i=e.MeasureAttributes,o=function(e){const o=e.$PropertyPath;let s;i.forEach(function(t){if(a&&(t&&t.Measure&&t.Measure.$PropertyPath)===o&&t.DataPoint&&t.DataPoint.$AnnotationPath){const e=t.DataPoint.$AnnotationPath;if(a[e]){s=e.indexOf("#")?e.split("#")[1]:"";n.push(s)}}});if(s===undefined){t.warning(`FE:Macro:MicroChart : Couldn't find DataPoint(Value) measure for the measureAttribute for ${r} MicroChart.`)}};if(!a){t.warning(`FE:Macro:MicroChart : Couldn't find annotations for the DataPoint ${r} MicroChart.`)}e.Measures.forEach(o);return n.join(",")},logWarning:function(e,a){for(const r in a){const n=a[r];if(!n){t.warning(`${r} parameter is missing for the ${e} Micro Chart`)}}},getDisplayValueForMicroChart:function(t,e,a,r){const n=t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits;let i;if(e){i=o.formatDecimal(e["$Path"],a,n)}else{i=o.formatDecimal(t.Value["$Path"],r,n)}return i},shouldMicroChartRender:function(t,e,a,r,n){const i=["Area","Column","Comparison"],s=e&&e.Value,u=a&&a["com.sap.vocabularies.UI.v1.Hidden"],l=r&&r.Dimensions&&r.Dimensions[0],c=i.indexOf(t)>-1?s&&l:s;if(t==="Harvey"){const t=e&&e.MaximumValue,a=n&&n["com.sap.vocabularies.UI.v1.Hidden"];return s&&t&&o.isNotAlwaysHidden("Bullet",s,t,u,a)}return c&&o.isNotAlwaysHidden(t,s,undefined,u)},getdataPointQualifiersForMicroChart:function(t){if(t.indexOf("com.sap.vocabularies.UI.v1.DataPoint")===-1){return undefined}if(t.indexOf("#")>-1){return t.split("#")[1]}return""},getcolorPaletteForMicroChart:function(t){return t.Criticality?undefined:"sapUiChartPaletteQualitativeHue1, sapUiChartPaletteQualitativeHue2, sapUiChartPaletteQualitativeHue3,          sapUiChartPaletteQualitativeHue4, sapUiChartPaletteQualitativeHue5, sapUiChartPaletteQualitativeHue6, sapUiChartPaletteQualitativeHue7,          sapUiChartPaletteQualitativeHue8, sapUiChartPaletteQualitativeHue9, sapUiChartPaletteQualitativeHue10, sapUiChartPaletteQualitativeHue11"},getMeasureScaleForMicroChart:function(t){if(t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits){return t.ValueFormat.NumberOfFractionalDigits}if(t.Value&&t.Value["$Path"]&&t.Value["$Path"]["$Scale"]){return t.Value["$Path"]["$Scale"]}return 1},getBindingExpressionForMicrochart:function(t,e,a,r,n,i){const s=r["$isCollection"]||r["$kind"]==="EntitySet";const u=s?"":n;let l=o.getUOMPathForMicrochart(e);let c="";switch(t){case"Radial":l="";break;case"Harvey":c=i.Criticality?i.Criticality["$Path"]:"";break}const f=o.getSelectParameters(a.batchGroupId,"",c,l),h=`{ path: '${u}'`+`, parameters : {${f}} }`;return h},getUOMPathForMicrochart:function(t,e){let a;if(e&&!t){a=e["@Org.OData.Measures.V1.ISOCurrency"]&&e["@Org.OData.Measures.V1.ISOCurrency"].$Path||e["@Org.OData.Measures.V1.Unit"]&&e["@Org.OData.Measures.V1.Unit"].$Path}return a?a:undefined},getAggregationForMicrochart:function(t,e,a,r,n,i,s){let u=e["$kind"]==="EntitySet"?"/":"";u=u+r;const l="";let c="";let f=a.Criticality?a.Criticality["$Path"]:"";const h=o.getUOMPathForMicrochart(false,i);let m="";let d="";if(n&&n.$PropertyPath&&n.$PropertyPath["@com.sap.vocabularies.Common.v1.Text"]){d=n.$PropertyPath["@com.sap.vocabularies.Common.v1.Text"].$Path}else{d=n.$PropertyPath}switch(t){case"Points":c=a&&a.CriticalityCalculation;m=a&&a.TargetValue&&a.TargetValue["$Path"];f="";break;case"Columns":c=a&&a.CriticalityCalculation;break;case"LinePoints":f="";break;case"Bars":d="";break}const p=o.getSelectParameters(l,c,f,h,m,d,s),P=`{path:'${u}'`+`, parameters : {${p}} }`;return P},getCurrencyOrUnit:function(t){if(t["@Org.OData.Measures.V1.ISOCurrency"]){return t["@Org.OData.Measures.V1.ISOCurrency"].$Path||t["@Org.OData.Measures.V1.ISOCurrency"]}else if(t["@Org.OData.Measures.V1.Unit"]){return t["@Org.OData.Measures.V1.Unit"].$Path||t["@Org.OData.Measures.V1.Unit"]}else{return""}},getCalendarPattern:function(t){return t["@com.sap.vocabularies.Common.v1.IsCalendarYear"]&&"yyyy"||t["@com.sap.vocabularies.Common.v1.IsCalendarQuarter"]&&"Q"||t["@com.sap.vocabularies.Common.v1.IsCalendarMonth"]&&"MM"||t["@com.sap.vocabularies.Common.v1.IsCalendarWeek"]&&"ww"||t["@com.sap.vocabularies.Common.v1.IsCalendarDate"]&&"yyyyMMdd"||t["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]&&"yyyyMM"},formatDimension:function(e,a,n){const i=r.getDateInstance({pattern:a}).parse(e,false,true);if(i instanceof Date){return parseFloat(i.getTime())}else{t.warning("Date value could not be determined for "+n)}return 0},formatDateDimension:function(t){return o.formatDimension(t,"yyyy-MM-dd","")},formatStringDimension:function(e,a,r){const n=e&&e.toString().match(i[a]);if(n&&n.length){return o.formatDimension(n[0],a,r)}else{t.warning("Pattern not supported for "+r)}return 0},getX:function(t,e,a){if(e==="Edm.Date"){return"{parts: [{path: '"+t+"', type: 'sap.ui.model.odata.type.String'}, {value: '"+t+"'}], formatter: 'MICROCHARTR.formatStringDimension'}"}else if(e==="Edm.String"){const e=a&&o.getCalendarPattern(a);if(e){return"{parts: [{path: '"+t+"', type: 'sap.ui.model.odata.type.String'}, {value: '"+e+"'}, {value: '"+t+"'}], formatter: 'MICROCHARTR.formatStringDimension'}"}}}};return o},false);
//# sourceMappingURL=MicroChartHelper.js.map