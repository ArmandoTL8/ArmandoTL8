/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/flexibility/Util","sap/ui/fl/changeHandler/condenser/Classification"],function(e,n,t,i,r){"use strict";var o=function(e,n){var t=function(n){if(e._pQueue===n){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(n):n();e._pQueue.then(t.bind(null,e._pQueue));return e._pQueue};var a=function(e){return new Promise(function(n,t){sap.ui.require([e],n,t)})};var u=function(e){var n=e&&e.getEngine?e.getEngine().getController(e,"Filter"):null;return n?n.getFilterControl():null};var f=function(r,f,l,d){var c=u(f);var p=d===i.REVERT;var g=p?r.getRevertData():r.getContent();if(c&&c.applyConditionsAfterChangesApplied){c.applyConditionsAfterChangesApplied(f)}var s,v=null,C=l.modifier;return o(f,function(){return C.getProperty(f,"filterConditions").then(function(i){s=e({},i);if(s){for(var o in s){if(o===g.name){v=s[o];break}}}if(!v){s[g.name]=[];v=s[g.name]}if(!p){r.setRevertData({name:g.name,condition:g.condition})}var u=t.indexOfCondition(g.condition,v);if(u<0){v.push(g.condition);C.setProperty(f,"filterConditions",s);return C.getProperty(f,"delegate").then(function(e){return a(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?e.getFilterDelegate().addCondition:e.addCondition);if(t){return t(g.name,f,l).catch(function(e){n.error("Error during Delegate.addCondition call: "+e)})}}).finally(function(){if(p){r.resetRevertData()}})}})})};var l=function(r,f,l,d){var c=u(f);var p=d===i.REVERT;var g=p?r.getRevertData():r.getContent();if(c&&c.applyConditionsAfterChangesApplied){c.applyConditionsAfterChangesApplied(f)}var s,v,C=-1,m=l.modifier;return o(f,function(){return m.getProperty(f,"filterConditions").then(function(i){s=e({},i);if(s){for(var o in s){if(o===g.name){v=s[o];break}}}if(!p){r.setRevertData({name:g.name,condition:g.condition})}if(v&&v.length>0){C=t.indexOfCondition(g.condition,v);if(C>=0){v.splice(C,1);m.setProperty(f,"filterConditions",s);return m.getProperty(f,"delegate").then(function(e){return a(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?e.getFilterDelegate().removeCondition:e.removeCondition);if(t){return t(g.name,f,l).catch(function(e){n.error("Error during Delegate.removeCondition call: "+e)})}}).finally(function(){if(p){r.resetRevertData()}})}}})})};var d=function(e,n){var t=e.getContent();return{classification:r.Reverse,affectedControl:e.getSelector(),uniqueKey:t.name+"_"+JSON.stringify(t.condition)}};var c={};c.addCondition=i.createChangeHandler({apply:f,revert:l,getCondenserInfo:d});c.removeCondition=i.createChangeHandler({apply:l,revert:f,getCondenserInfo:d});return c});
//# sourceMappingURL=ConditionFlex.js.map