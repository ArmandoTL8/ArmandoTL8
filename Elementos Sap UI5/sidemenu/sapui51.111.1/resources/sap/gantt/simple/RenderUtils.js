/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["./AggregationUtils","./GanttUtils","sap/ui/core/Core","../library","sap/ui/Device","../misc/Utility","sap/ui/core/theming/Parameters","../misc/Format"],function(e,t,i,a,n,r,l,s){"use strict";var o=13;var g=a.simple.horizontalTextAlignment;var p={apiVersion:2,RENDER_EXTEND_FACTOR:.382,getGanttRenderWidth:function(e){var t=jQuery(document.getElementById(e.getId()+"-gantt")).width();return t*(1+2*p.RENDER_EXTEND_FACTOR)},renderAttributes:function(e,t,i){var a=i.map(function(e){var i=e.split("-").reduce(function(e,t){return e+t.charAt(0).toUpperCase()+t.slice(1)},"get");return{name:e,value:t[i]()}});a.forEach(function(t){if(t.value||t.value===0){if(t.name==="style"){var i=t.value.split(";");i.forEach(function(t){t=t.trim();if(t!=""){var i=t.split(/:(.*)/);if(i[0]==="fill"&&i[1].indexOf(" ")!=-1){i[1]=encodeURI(i[1])}e.style(i[0],i[1])}})}else{e.attr(t.name,t.value)}}})},renderTooltip:function(e,t){if(t.getTooltip()){e.openStart("title").openEnd();e.text(t.getTooltip());e.close("title")}},updateShapeSelections:function(e,i,a){if(e._getResizeExtension==null){return}var n=e._getResizeExtension();var r=e.getId();t.getShapesWithUid(r,a).forEach(function(t){if(t){this._bShapeSelectionProperties=false;this._hasShapeSelectionProperties(t,e);if(this._bShapeSelectionProperties){this._updateShapeStyle(t,false,e,0)}if(t.isA("sap.gantt.simple.shapes.Shape")){t.setSelected(false)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("selected",false,true)}else{t.setProperty("selected",false,true)}}}.bind(this));n.clearAllOutline(r);t.getShapesWithUid(r,i).forEach(function(t){if(t){if(t.getProperty("selectable")){this._bShapeSelectionProperties=false;this._hasShapeSelectionProperties(t,e);if(this._bShapeSelectionProperties){this._updateShapeStyle(t,true,e,0)}if(t.isA("sap.gantt.simple.shapes.Shape")){t.setSelected(true)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("selected",true,true);n.toggleOutline(t)}else{t.setProperty("selected",true,true);n.toggleOutline(t)}}e.getSelection().updateProperties(t.getShapeUid(),{draggable:t.getDraggable(),time:t.getTime(),endTime:t.getEndTime()})}}.bind(this))},_hasShapeSelectionProperties:function(e,t){if(!e||e.isA("sap.gantt.simple.Relationship")){return}if(e.isA("sap.gantt.simple.BaseConditionalShape")){e=e._getActiveShapeElement()}if(e&&(e.getSelectedFill()||e.getSelectedTitleColor())){this._bShapeSelectionProperties=true}else if(e instanceof sap.gantt.simple.BaseGroup){if(t.getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,i){i.forEach(function(e){if(!this._bShapeSelectionProperties){this._hasShapeSelectionProperties(e,t)}}.bind(this))}.bind(this))}else{e._eachChildOfGroup(e,function(e){if(!this._bShapeSelectionProperties){this._hasShapeSelectionProperties(e,t)}}.bind(this))}}},_updateShapeStyle:function(e,t,i,a,n,r){if(!e||e.isA("sap.gantt.simple.Relationship")||!e.getVisible()){return}if(e.isA("sap.gantt.simple.BaseConditionalShape")&&e._getActiveShapeElement()){this._updateShapeStyle(e._getActiveShapeElement(),t,i,a,n,r)}else if(e.isA("sap.gantt.simple.BaseGroup")){if(i.getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,l){l.forEach(function(e){var l=this._updateGroupShapeStyle(e,t,i,a,n,r);a=l}.bind(this))}.bind(this))}else{e._eachChildOfGroup(e,function(e){var l=this._updateGroupShapeStyle(e,t,i,a,n,r);a=l}.bind(this))}}else{this._updateShapeSelectionStyle(e,t,n,r)}},_updateGroupShapeStyle:function(e,t,i,a,n,r){if(!e||e.isA("sap.gantt.simple.Relationship")||!e.getVisible()){return a}r=r||{};var l=e.getParent();var s=l.getFill()||r.fill;var o=l.getTitleColor()||r.titleColor;var g=l.getSelectedFill()||r.selectedFill;var p=l.getSelectedTitleColor()||r.selectedTitleColor;var h=l.getDomRef("nonLabelGroup")?l.getDomRef("nonLabelGroup"):l.getDomRef()||n;if(h){var d=h.children||h.childNodes;while(a<d.length&&d[a].tagName==="title"){a+=1}this._bUpdatedTitle=false;var f=e.isA("sap.gantt.simple.BaseGroup")||e.isA("sap.gantt.simple.BaseConditionalShape")&&e._getActiveShapeElement()&&e._getActiveShapeElement().isA("sap.gantt.simple.BaseGroup");var c=f?0:a;var u={fill:s,titleColor:o,selectedFill:g,selectedTitleColor:p};this._updateShapeStyle(e,t,i,c,h.children[a],u);var S=this._bUpdatedTitle&&!f?2:1;a+=S}return a},_updateShapeSelectionStyle:function(e,t,i,a){a=a||{};var n=e.getFill()||a.fill;var r=e.getTitleColor()||a.titleColor;var s=t?e.getSelectedFill()||a.selectedFill||n:n;var o=l.get("sapUiBaseText");var g=e.isA("sap.gantt.simple.BaseText")?r||n||o:r||o;var p=e.isA("sap.gantt.simple.BaseText")?e.getSelectedFill()||a.selectedFill:null;var h=t?e.getSelectedTitleColor()||a.selectedTitleColor||p||g:g;var d=i?i:document.getElementById(e.getId());if(d){d.style.fill=e.isA("sap.gantt.simple.BaseText")?h:s;var f=d.nextSibling;if(f&&f.tagName==="text"&&e.getShowTitle()&&e.getTitle()){f.style.fill=h;this._bUpdatedTitle=true}}},updateShapeHighlights:function(e,i,a){if(e._getResizeExtension==null){return}var n=e._getResizeExtension();var r=e.getId();t.getShapesWithUid(r,a).forEach(function(e){if(e){if(e.isA("sap.gantt.simple.shapes.Shape")){e.setHighlighted(false)}else if(e.getParent().isA("sap.gantt.simple.BaseConditionalShape")){e.getParent().setProperty("highlighted",false,true)}else{e.setProperty("highlighted",false,true)}}});n.clearAllHighlight(r);t.getShapesWithUid(r,i).forEach(function(t){if(t){if(t.getProperty("highlightable")){if(t.isA("sap.gantt.simple.shapes.Shape")){t.setHighlighted(true)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("highlighted",true,true);n.toggleHighlight(t)}else{t.setProperty("highlighted",true,true);n.toggleHighlight(t)}}e.getHighlight().updateProperties(t.getShapeUid(),{time:t.getTime(),endTime:t.getEndTime()})}})},updateShapeSelectionByShapeID:function(e,t){if(e._getResizeExtension==null){return}var i=e.getSelection().getSelectedShapeIDS();var a=e.getSelection().getDeSelectedShapeIDS();var n=e.getSelection().getSelectedRowIDS();var r=e.getSelection().getDeSelectedRowIDS();if(i&&i.length>0){this._updateShapeSelection(e,i,true)}if(n&&n.length>0){this._updateRowSelection(e,n,true)}if(a&&a.length>0){this._updateShapeSelection(e,a,false)}if(r&&r.length>0){this._updateRowSelection(e,r,false,t)}},_updateShapeSelection:function(e,i,a){var n=e.getId();if(!a){i.forEach(function(t){e.oSelection.mSelected.deSelectShapeId[t]={selected:a}})}t.getShapeByShapeId(n,i).forEach(function(t){this._updateShapes(t,a,e)}.bind(this))},_updateRowSelection:function(e,i,a,n){var r=e.getId();var l=e.searchTxt;if(!a){l=e.deSelectTxt}if(n){t.getShapesInRowsById(r,i).forEach(function(t){if(t&&(!a||t.getProperty("selectable"))){if(t.mProperties.shapeId){e.getSelection().updateShapeId(t.getShapeId(),a)}this._updateShapes(t,a,e)}}.bind(this))}else if(l!==null&&l!==undefined){t.getShapesInRowsById(r,i).forEach(function(t){if(t){var i=this._selectShapeBySearchText(e,t,a);if(i&&(!a||t.getProperty("selectable"))){if(t.mProperties.shapeId){e.getSelection().updateShapeId(t.getShapeId(),a)}this._updateShapes(t,a,e);if(!a){e.getSelection().clearSelectionByUid(t.getShapeUid())}}}}.bind(this))}},_updateShapes:function(e,t,i){e.setProperty("selected",t,true);if(t){i.getSelection().updateProperties(e.getShapeUid(),{draggable:e.getDraggable(),time:e.getTime(),endTime:e.getEndTime()},true)}else{i.getSelection().clearSelectionByUid(e.getShapeUid())}},updateShapeHighlightByShapeID:function(e,t){if(e._getResizeExtension==null){return}var i=e.getHighlight().getHighlightedShapeID();var a=e.getHighlight().getDeEmphasizedShapeID();if(i&&i.length>0){this._updateShapeHighlight(e,i,true)}if(a&&a.length>0){this._updateShapeHighlight(e,a,false)}},_updateShapeHighlight:function(e,i,a){var n=e.getId();t.getShapeByShapeId(n,i).forEach(function(t){this._updateShapeAttributes(t,a,e)}.bind(this))},_updateShapeAttributes:function(e,t,i){e.setProperty("highlighted",t,true);if(t){i.getHighlight().updateProperties(e.getShapeUid(),{time:e.getTime(),endTime:e.getEndTime()},true)}else{i.getHighlight().clearHighlightByUid(e.getShapeUid())}},_selectShapeBySearchText:function(e,t,i){var a=false;var n=e.getTable().getBindingInfo("rows").model;var r=e.searchProperty;if(!i){r=e.deSelectProperty}function l(t){if(i){e.searchTxt.forEach(function(e){if(t!==undefined&&t!==null&&t.toString().toLowerCase().indexOf(e.toString().toLowerCase())!==-1){a=true}})}else{if(t!==undefined&&t!==null&&t.toString().toLowerCase().indexOf(e.deSelectTxt.toString().toLowerCase())!==-1){a=true}}}if(Array.isArray(r)&&r.length>0){r.forEach(function(e){if(a){return}var i=t.getBindingContext(n).getProperty(e);l(i)})}else if(typeof r==="string"){var s=t.getBindingContext(n).getProperty(r);l(s)}else{var o=t.getBindingContext(n).getObject();if(o){Object.keys(o).forEach(function(e){if(a){return}l(o[e])})}}return a},getShapeElementByTarget:function(e){return jQuery(this.getDraggableDOMElement(e)).control(0,true)},getDraggableDOMElement:function(e){return jQuery(e).closest("["+t.SHAPE_ID_DATASET_KEY+"]").get(0)},addTitleSpacing:function(e,t){if(e.titleSpacing){e.x=t?e.x-e.titleSpacing:e.x+e.titleSpacing}},renderElementTitle:function(e,t,a){if(t.getShowTitle==null||!t.getShowTitle()){return}var n=t.getTitle();if(n){var s=0,p=0,h=0;if(t.getWidth){p=t.getWidth();h=t.getWidth()}if(t.getHeadWidth){s=t.getHeadWidth();p-=s}if(t.getTailWidth){p-=t.getTailWidth()}var d=2+s+2;var f={text:n,fill:t.getTitleColor()||l.get("sapUiBaseText"),showEllipsis:true,truncateWidth:p-t.getTitleSpacing(),textAnchor:t.getHorizontalTextAlignment().toLowerCase(),verticalTextAlignment:t.getVerticalTextAlignment(),fontWeight:t.getFontWeight(),fontFamily:t.getFontFamily(),fontSize:t.getFontSize()||o};var c=i.getConfiguration().getRTL();if(t.getTitleSpacing()){if(f.textAnchor===g.End.toLowerCase()){f.titleSpacing=-t.getTitleSpacing()}else{f.titleSpacing=t.getTitleSpacing()}}var u=t.getGanttChartBase();var S=t.getParent(),m;var x=u&&u.getEnablePseudoShapesDisplay()&&S&&S.isPseudoShape;if(x){m=t.getParent().getButton()[0].getHeight()}f.x=this._calculateX(t,f.textAnchor,t.getX(),t.getWidth(),d,undefined,f,m,x);this.setVerticalAlignment(t,f);var v=r.getShapeBias(t);f.x=f.x+v.x;f.y=f.y+v.y;this.addTitleSpacing(f,c);var T=a(f).addStyleClass("sapGanttTextNoPointerEvents");T.setProperty("childElement",true,true);T.bPseudoShape=x;T.oTextElement=t;T.iIconHeight=m;var E=T._truncateText(T.getText(),x,m);var y,P=T.getTruncateWidth();if(S&&S.getAggregation("task")){S.getAggregation("task").truncatedTextWidth=P}if(x){if(E.ellipsis){y=T.measureTextWidth(E.truncatedText+"...")}else{y=T.measureTextWidth(E.truncatedText)}}var w=y+(2+m);if(!(w<=P)&&x){if(f.textAnchor===g.Dynamic.toLowerCase()){if(!c){T.setProperty("x",f.x-(2+m),true)}else{T.setProperty("x",f.x+(2+m+4),true)}}else if(f.textAnchor===g.Start.toLowerCase()){if(!c){T.setProperty("x",f.x-(2+m+4),true)}else{T.setProperty("x",f.x+(2+m+4),true)}}else if(f.textAnchor===g.Middle.toLowerCase()){if(!c){T.setProperty("x",f.x-(2+m)/2,true)}else{T.setProperty("x",f.x+(2+m)/2,true)}}else if(f.textAnchor===g.End.toLowerCase()){if(!c){T.setProperty("x",f.x+4,true)}else{T.setProperty("x",f.x-4,true)}}}T.renderElement(e,T)}},_calculateX:function(e,t,a,n,r,l,s,o,p){var h=i.getConfiguration().getRTL(),d,f;if(t===g.Start.toLowerCase()){d=p?a+r+(2+o):a+r;f=p?a+n-r-(2+o):a+n-r;a=h?f:d}else if(t===g.End.toLowerCase()){d=l?a+n-r-(2+o)-l:a+n-r;f=l?a+r+l+(2+o):a+r;a=h?f:d}else if(t===g.Middle.toLowerCase()){if(!l&&!p){a=a+n/2}else{d=l?a+n/2-(l+(2+o))/2:a+n/2+(2+o)/2;f=l?a+n/2+(l+(2+o))/2:a+n/2-(2+o)/2;a=h?f:d}}else if(t===g.Dynamic.toLowerCase()){if(l){this.renderDynamicText(e,s,r,null,a)}else{this.renderDynamicText(e,s,r)}if(p){if(h){s.x=s.x-r-(2+o)}else{s.x=s.x+(2+o)}a=s.x}else if(l){if(h){a=a+n-r}a=s.x?s.x:a}else{a=s.x}}return a},renderCalenderTitle:function(e,t,a,n){var r=t.title;var s=t.baseCalender;if(r){var p=0,h=0;if(a.width){p=a.width;h=a.width}var d={text:r,fill:s.getTitleColor()||l.get("sapUiBaseText"),showEllipsis:true,truncateWidth:p-s.getTitleSpacing(),textAnchor:s.getHorizontalTextAlignment(),verticalTextAlignment:s.getVerticalTextAlignment(),fontWeight:s.getFontWeight(),fontSize:s.getFontSize()||o,fontFamily:s.getFontFamily()};var f=i.getConfiguration().getRTL();if(s.getTitleSpacing()){if(d.textAnchor.toLowerCase()===g.End.toLowerCase()){d.titleSpacing=-s.getTitleSpacing()}else{d.titleSpacing=s.getTitleSpacing()}}if(d.textAnchor.toLowerCase()===g.Start.toLowerCase()){d.x=f?a.x+a.width:a.x}else if(d.textAnchor.toLowerCase()===g.End.toLowerCase()){d.x=f?a.x:a.x+a.width}else if(d.textAnchor.toLowerCase()===g.Middle.toLowerCase()){d.x=a.x+a.width/2}else if(d.textAnchor.toLowerCase()===g.Dynamic.toLowerCase()){this.renderDynamicText(s,d,0,a)}if(d.verticalTextAlignment==="Top"){d.y=a.height/2-1}else if(d.verticalTextAlignment==="Bottom"){d.y=a.height/2+d.fontSize-1}else{d.y=a.height/2+d.fontSize/2-1}this.addTitleSpacing(d,f);var c=n(d).addStyleClass("sapGanttTextNoPointerEvents");c.setProperty("childElement",true,true);c.renderElement(e,c)}},setVerticalAlignment:function(e,t){if(t.verticalTextAlignment==="Top"){t.y=e.getY()+t.fontSize-1}else if(t.verticalTextAlignment==="Bottom"){t.y=e.getY()+parseInt(e.getHeight(),10)-1}else{t.y=e.getY()+parseInt(e.getHeight()/2,10)+t.fontSize/2.5}},renderDynamicText:function(e,t,a,n,r){var l=i.getConfiguration().getRTL();var o=s.abapTimestampToDate(e.getAxisTime()._oZoomStrategy.getVisibleHorizon().getStartTime());var g;if(n){t.x=l?n.x+n.width-a:n.x+a;g=t.x;if(n.x<e.getAxisTime().timeToView(o)&&n.x+n.width>e.getAxisTime().timeToView(o)){t.x=l?e.getAxisTime().timeToView(o)-a:e.getAxisTime().timeToView(o)+a;t._shapeCropped=true;t._xBiassed=t.x-g}}else{if(!r){t.x=l?e.getX()+e.getWidth()-a:e.getX()+a;g=t.x}else{g=r}if(e.getTime()<o&&e.getEndTime()>o){t.x=l?e.getAxisTime().timeToView(o)-a:e.getAxisTime().timeToView(o)+a;t._shapeCropped=true;t._xBiassed=t.x-g;if(l&&r){t.x=t.x-2}}else if(r&&!l){t.x=g+a}}},renderInlineShapes:function(e,i,a){var n=i.getId()+"-top";var r=i.getId()+"-row";e.openStart("g",i);e.class(n);e.openEnd();e.openStart("g");e.attr(t.ROW_ID_DATASET_KEY,i.getRowId()||"");e.class(r);e.openEnd();this.renderMainRowAllShapes(e,i,a);e.close("g");e.close("g")},renderMainRowAllShapes:function(t,i,a){var n=a.getSyncedControl().getRowStates();var r=this.calcRowDomPosition(i,n),l=r.rowYCenter,s=r.rowHeight;var o=e.getAllNonLazyAggregations(i);var g=Object.keys(o).filter(function(e){return e.indexOf("calendars")===-1&&e!=="relationships"}).map(function(e){return i.getAggregation(e)||[]}.bind(i));var h=i.getRowUid(),d=a.oSelection,f=a.oHighlight,c=a._oExpandModel,u=a.getAxisTime(),S=c.isRowExpanded(h),m=i.getParent().getIndex(),x=a.oOverlapShapeIds&&a.oOverlapShapeIds[m]&&a.oOverlapShapeIds[m].length>0;g.forEach(function(e,n){Array.isArray(e)&&e.forEach(function(e){if(a.isShapeVisible(e)&&!e.isPartOfExpandedPseudoShape){if(a.getEnablePseudoShapesDisplay()){var n;if(e.isPseudoShape){n=e.aShapeIds.some(function(e){return a.oOverlapShapeIds&&a.oOverlapShapeIds[m]&&a.oOverlapShapeIds[m].includes(e)})}else{n=a.oOverlapShapeIds&&a.oOverlapShapeIds[m]&&a.oOverlapShapeIds[m].length>0?false:S}}p.renderMainRowShape(t,e,{expandModel:c,selectionModel:d,highlightModel:f,axisTime:u,rowSetting:i,rowUid:h,rowExpanded:a.getEnablePseudoShapesDisplay()?n:S,mainRowYCenter:l,rowHeight:s},a.getShowParentRowOnExpand()&&!a.getUseParentShapeOnExpand()||a._aExpandedIndices.indexOf(m)>-1&&x)}})})},renderMainRowShape:function(e,t,i,a){this.setSpecialProperties(t,i);var n=t.getParentRowSettings().getParent().getParent(),r=n.getParent();var l=t.getParent().getParent(),s=l.getIndex(),o=r.oOverlapShapeIds&&r.oOverlapShapeIds[s]&&r.oOverlapShapeIds[s].length>0;if(Object.keys(i.expandModel.mExpanded).indexOf(i.rowUid)==-1&&!i.rowExpanded||a||r._aExpandedIndices.indexOf(s)>-1&&o){t.renderElement(e,t,null)}if(i.rowExpanded){this.renderExpandShapesIfNecessary(e,t,i,a)}},setSpecialProperties:function(t,i){var a=i.expandModel,n=i.rowUid,r=i.rowSetting.getShapeUid(t),l=t.getParentRowSettings().getParent().getParent(),s=l.getParent(),o=t.getParent().getParent().getIndex();if(!t._iBaseRowHeight){t._iBaseRowHeight=a.getBaseRowHeight();var g=e.getNonLazyAggregations(t);Object.keys(g).filter(function(e){var t=g[e];if(t.appData!==null){return t.appData.sapGanttOrder===1}}).map(function(e){if(e==="utilizationBar"||e==="utilizationLine"){t._iBaseRowHeight=t._iBaseRowHeight-1}})}t.mAxisTime=i.axisTime;t.setProperty("shapeUid",r,true);if(t.getProperty("selectable")){t.setProperty("selected",i.selectionModel.existed(r),true)}if(t.getProperty("highlightable")){t.setProperty("highlighted",i.highlightModel.existed(r),true)}var p=s.getUseParentShapeOnExpand()&&s.oOverlapShapeIds&&s.oOverlapShapeIds[o]&&s.oOverlapShapeIds[o].length>0?"":t.getScheme();t.setProperty("rowYCenter",a.getRowYCenterByUid(n,i.mainRowYCenter,p,0,s,o),true)},isValidD:function(e){return!!e&&e.indexOf("NaN")===-1&&e.indexOf("undefined")===-1&&e.indexOf("null")===-1},renderExpandShapesIfNecessary:function(i,a,n,r){var l;var s=a.getParentRowSettings().getParent().getParent(),o=s.getParent();var g=function(e){if(!e||e.length===0){return}var a=e;if(jQuery.isArray(e)===false){a=[e]}t.calculateLevelForShapes(a,"time","endTime");a.forEach(function(e,t){if(e._level){t=e._level-1}var a=r?n.expandModel.getRowYCenterByUid(n.rowUid,null,e.getScheme(),t,o):n.expandModel.getRowYCenterByUid(n.rowUid,null,e.getScheme(),t,o)-n.expandModel.getBaseRowHeight();e.setProperty("rowYCenter",a,true);e._iBaseRowHeight=n.expandModel.getExpandShapeHeightByUid(n.rowUid,e.getScheme(),n.iRowHeight);e.setProperty("shapeUid",n.rowSetting.getShapeUid(e),true);e.renderElement(i,e)})};a._isSubTasks=a.mBindingInfos.hasOwnProperty("subTasks")||typeof a.getSubTasks==="function"&&a.getSubTasks();if(o.getUseParentShapeOnExpand()){var p=a.getParent().getAllExpandableShapes(o);var h=a.getScheme();var d;var f;p.forEach(function(e,t){if(o.isShapeVisible(e)){l=t}});var c=p[l];if(a===c||o.oOverlapShapeIds&&o.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()]&&o.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()].length>0){var u=[];p.forEach(function(t){var i=e.getNonLazyElementsByScheme(t,h);i.forEach(function(e){if(e instanceof sap.gantt.simple.BaseConditionalShape){var t=e._getActiveShapeElement();if(t instanceof sap.gantt.simple.BaseGroup){d=null;f=null;t.getShapes().forEach(function(e){if(!d&&!f){d=e.getTime();f=e.getEndTime()}else{if(e.getTime()>=d){d=d}else{d=e.getTime()}if(e.getEndTime()>=f){f=e.getEndTime()}else{f=f}}});t.setTime(d);t.setEndTime(f);u=u.concat(t)}else if(t){u=u.concat(t)}}else if(e instanceof sap.gantt.simple.BaseGroup){d=null;f=null;e.getShapes().forEach(function(e){if(!d&&!f){d=e.getTime();f=e.getEndTime()}else{if(e.getTime()>=d){d=d}else{d=e.getTime()}if(e.getEndTime()>=f){f=e.getEndTime()}else{f=f}}});e.setTime(d);e.setEndTime(f);u=u.concat(e)}else{u=u.concat(e)}})});if(u.length!==0){u.forEach(function(e){e.setProperty("childElement",false,true)})}g(u)}}else if(a._isSubTasks){var p=a.getParent().getAllExpandableShapes(o);var d;var f;p.forEach(function(e,t){if(o.isShapeVisible(e)){l=t}});var c=p[l];if(a===c||o.oOverlapShapeIds&&o.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()]&&o.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()].length>0){var u=[];p.forEach(function(t){var i=e.getLazyElementsByScheme(t,a.getParent().getParentGantt().getShapeSchemes()[1].getKey());i.forEach(function(e){if(e instanceof sap.gantt.simple.BaseConditionalShape){var t=e._getActiveShapeElement();if(t instanceof sap.gantt.simple.BaseGroup){d=null;f=null;t.getShapes().forEach(function(e){if(!d&&!f){d=e.getTime();f=e.getEndTime()}else{if(e.getTime()>=d){d=d}else{d=e.getTime()}if(e.getEndTime()>=f){f=e.getEndTime()}else{f=f}}});t.setTime(d);t.setEndTime(f);u=u.concat(t)}else if(t){u=u.concat(t)}}else if(e instanceof sap.gantt.simple.BaseGroup){d=null;f=null;e.getShapes().forEach(function(e){if(!d&&!f){d=e.getTime();f=e.getEndTime()}else{if(e.getTime()>=d){d=d}else{d=e.getTime()}if(e.getEndTime()>=f){f=e.getEndTime()}else{f=f}}});e.setTime(d);e.setEndTime(f);u=u.concat(e)}else{u=u.concat(e)}})});g(u)}}else if(!a._isSubTasks){var S=e.getLazyAggregations(a);Object.keys(S).forEach(function(e){var t=a.getAggregation(e);g(t)})}},calcRowDomPosition:function(e,t){var i=e._getRow(),a=i.getParent(),n=a.indexOfRow(i);var r=t[n].height;var l=0;for(var s=0;s<=n;s++){l+=t[s].height}l-=r/2;return{rowYCenter:l,rowHeight:r}},pushOrUnshift:function(e,t,i){if(i===true){e.splice(0,0,t)}else{e.push(t)}},createOrderedListOfRenderFunctionsFromTemplate:function(e){var t=[];for(var i=0;i<e.length;i++){this.pushOrUnshift(t,e[i].fnCallback,e[i].bUnshift)}return t},renderElementAnimation:function(e,t){var i=t.getAnimationProperties(t.getAnimationSettings());if(i){e.openStart("animate");e.attr("attributeName","fill");e.attr("values",i.values);e.attr("dur",i.duration);e.attr("repeatCount",i.repeatCount);e.openEnd().close("animate")}}};return p},true);
//# sourceMappingURL=RenderUtils.js.map