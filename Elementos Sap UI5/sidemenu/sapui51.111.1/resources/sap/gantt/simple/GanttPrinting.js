/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/ui/core/Element","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/Dialog","sap/m/ProgressIndicator","sap/m/Button","sap/m/Input","sap/m/FlexBox","sap/m/library","sap/m/FlexItemData","sap/m/ScrollContainer","sap/m/ComboBox","sap/m/RadioButton","sap/m/RadioButtonGroup","sap/m/CheckBox","sap/m/Slider","sap/m/ResponsiveScale","sap/m/StepInput","sap/m/DatePicker","sap/m/BusyDialog","sap/m/MessageStrip","sap/m/Switch","sap/m/Panel","sap/m/TextArea","sap/gantt/misc/Format","sap/gantt/simple/GanttChartContainer","sap/gantt/config/TimeHorizon","sap/gantt/axistime/FullScreenStrategy","sap/ui/core/Item","sap/ui/core/HTML","sap/ui/layout/VerticalLayout","sap/ui/layout/HorizontalLayout","sap/ui/layout/GridData","sap/ui/layout/form/SimpleForm","sap/ui/model/json/JSONModel","sap/ui/core/theming/Parameters","sap/ui/core/ResizeHandler","sap/gantt/thirdparty/jspdf","sap/gantt/thirdparty/html2canvas","sap/gantt/thirdparty/svg2pdf","./RenderUtils","sap/m/PDFViewer","sap/ui/Device","sap/gantt/simple/GanttRowSettings"],function(t,e,i,a,n,o,r,s,h,l,g,p,_,d,u,c,C,P,f,m,y,v,T,b,w,x,G,S,M,R,D,N,B,E,I,A,H,F,O,L,k,W,z,V,U,j,K,J,X){"use strict";var $=d.FlexDirection,q=t.simple.GanttChartWithTableDisplayType;V=window.html2canvas;z=window.jsPDF;U=window.svg2pdf;var Q=i.extend("sap.gantt.simple.GanttPrinting",{metadata:{library:"sap.gantt",associations:{ganttChart:{type:"sap.gantt.simple.GanttChartWithTable",multiple:false}}}});Q._oPaperSizes={A5:{width:et(148),height:et(210)},A4:{width:et(210),height:et(297)},A3:{width:et(297),height:et(420)},A2:{width:et(420),height:et(594)},A1:{width:et(594),height:et(841)},A0:{width:et(841),height:et(1189)},Letter:{width:at(8.5),height:at(11)},Legal:{width:at(8.5),height:at(14)},Tabloid:{width:at(11),height:at(17)},Custom:{width:undefined,height:undefined}};var Y="9px Arial, Helvetica, sans-serif";var Z="12px Arial, Helvetica, sans-serif";var tt="16384";Q.prototype.init=function(){this._oRb=a.getLibraryResourceBundle("sap.gantt");var t={multiplePage:true,qualityWarning:false,showOrientationMessage:false,orientationMessage:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"),portrait:true,paperSize:"A4",paperWidth:Q._oPaperSizes.A4.width,paperHeight:Q._oPaperSizes.A4.height,unit:"mm",repeatSelectionPanel:false,scale:100,duration:"all",startDate:new Date,endDate:new Date,showPageNumber:false,showHeaderText:false,headerText:"",showFooterText:false,footerText:"",exportAll:true,exportRange:"",exportAsJPEG:true,compressionQuality:75,previewPageNumber:1,lastPageNumber:undefined,marginType:"default",marginLocked:false,marginTop:et(5),marginRight:et(5),marginBottom:et(5),marginLeft:et(5),cropMarks:false,cropMarksWeight:.25,cropMarksOffset:et(3)};this._oModel=new L(t);this._oGanttCanvas=undefined;this._iHeaderAndFooterHeight=et(8);this._ganttChartContainer=new D;this.sFont=null;this._oPdfPreview=null};Q.prototype.export=function(){this._savePdf()};Q.prototype.exportSinglePage=function(){var t=new Date;this.oSinglePagePdf.save("GanttChartExport-"+t.toISOString()+".pdf")};Q.prototype.renderGanttClone=function(t){if(a.getConfiguration().getRTL()&&!t){return Promise.resolve()}return new Promise(function(t){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",t,this);this._ganttChartClone.invalidate()}.bind(this))};Q.prototype.mergeCanvases=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),a=t[0].width,n=[],o=t.reduce(function(t,e,i,a){n.push({cnv:e,y:t});t+=a[i].height;return t},0);e.width=a;e.height=o;n.forEach(function(t){i.beginPath();i.drawImage(t.cnv,0,t.y,a,t.cnv.height)});if(e.width>tt||e.height>tt){this._oClonedGanttDiv.style.height=e.height+"px";this._oClonedGanttDiv.style.width=e.width+"px";return undefined}return e};Q.prototype.generateCanvasAsync=function(t){var e=0;var i=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=i>1?false:true;var n=this;var o=[];var r=0;var s=25/Math.ceil(i);function h(){if(n._bMultipleBatches){r+=s;n._oProgressIndicator.setPercentValue(r)}}function l(t){if(n._bCancel){return Promise.reject()}n._oClonedGanttDiv.style.height=tt+"px";var o=t*n.iThreshold;var r=n._getOriginalGanttChart().getTable()._getTotalRowCount();n.iThreshold=Math.min(n.iThreshold,r-o);n.bLast=e+1>=i?true:false;n._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);n._ganttChartClone.getTable().setVisibleRowCount(n.iThreshold);n.bFirst=t===0?true:false;n._ganttChartClone.getTable().setFirstVisibleRow(o);if(a.getConfiguration().getRTL()){n._ganttChartClone._bRenderGanttClone=true}return n._ganttChartClone.getInnerGantt().resolveWhenReady(n._originalHasRenderedShapes)}function g(t){h();return l(t).then(function(){h();n._bExpandCollapse=true;return n._expandAndCollapse()}).then(function(){n._ganttChartClone._bExpandRows=true;h();return n._expandRowSettings()}).then(function(){n._ganttChartClone._bExpandRows=false;n._setCloneDivHeight();document.getElementById(n._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=n._iContentHeight;document.getElementById(n._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=n._iContentHeight;if(!n.bLast){h()}return n._createGanttCanvas()}).then(function(t){return o.push(t)}).then(function(){if(t===0){n._ganttChartClone.setShowGanttHeader(false)}e=e+1;if(e<i){g(e)}else if(!n._bCancel){n._oGanttCanvas=n.mergeCanvases(o);n._updateDialogPreview();n._oDialog.getContent()[0].setBusy(false);n._oFlexBoxPreview.setBusy(false);n._oButtonExport.setEnabled(true);if(n._bMultipleBatches){n._oProgressIndicator.setPercentValue(100);setTimeout(function(){n._closeProgressIndicator(true)},500)}}else{return Promise.reject()}}).catch(function(){})}return g(t)};Q.prototype.generatePdfAsync=function(t){var e=0;var i=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=i>1?false:true;var n=this;var o=0;var r=25/Math.ceil(i);function s(){if(n._bMultipleBatches){o+=r;n._oProgressIndicator.setPercentValue(o)}}function h(t){if(n._bCancel){return Promise.reject()}n._oClonedGanttDiv.style.height=tt+"px";var o=t*n.iThreshold;var r=n._getOriginalGanttChart().getTable()._getTotalRowCount();n.iThreshold=Math.min(n.iThreshold,r-o);n.bLast=e+1>=i?true:false;n._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);n._ganttChartClone.getTable().setVisibleRowCount(n.iThreshold);n.bFirst=t===0?true:false;n._ganttChartClone.getTable().setFirstVisibleRow(o);if(a.getConfiguration().getRTL()){n._ganttChartClone._bRenderGanttClone=true}return n._ganttChartClone.getInnerGantt().resolveWhenReady(n._originalHasRenderedShapes)}function l(t){s();return h(t).then(function(){s();n._bExpandCollapse=true;return n._expandAndCollapse()}).then(function(){n._ganttChartClone._bExpandRows=true;s();return n._expandRowSettings()}).then(function(){n._ganttChartClone._bExpandRows=false;n._setCloneDivHeight();document.getElementById(n._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=n._iContentHeight;document.getElementById(n._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=n._iContentHeight;if(!n.bLast){s()}return n._createBatchList()}).then(function(t){return n._oDomToPrint.push(t)}).then(function(){if(t===0){n._ganttChartClone.setShowGanttHeader(false)}e=e+1;if(e<i){l(e)}else if(!n._bCancel){if(n._bMultipleBatches){n._oProgressIndicator.setPercentValue(100);setTimeout(function(){n._closeProgressIndicator(true)},500)}return n._generateSvgToPdf()}else{return Promise.reject()}}).catch(function(){})}return l(t)};Q.prototype.open=function(){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set")}var t=this;this._createAndOpenDialog();this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt(false).then(function(){if(t._bMultipleBatches){t._openProgressDialog()}return t.generateCanvasAsync(0)}).catch(function(e){if(e&&e.bMaxCanvasSizeExceeded){t._updateDialogPreviewCanvas();t._oDialog.getContent()[0].setBusy(false)}})}else{if(a.getConfiguration().getRTL()){t._ganttChartClone._bRenderGanttClone=true}return this._drawClonedGantt(false).then(function(){t._bExpandCollapse=true;return t._expandAndCollapse()}).then(function(){t._ganttChartClone._bExpandRows=true;return t._expandRowSettings()}).then(function(){t._ganttChartClone._bExpandRows=false;t._setCloneDivHeightNonOptimised();document.getElementById(t._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=t._iContentHeight;document.getElementById(t._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=t._iContentHeight;return t._createGanttCanvas()}).then(function(e){t._oGanttCanvas=e;t._updateDialogPreview();t._oDialog.getContent()[0].setBusy(false);t._oButtonExport.setEnabled(true)}).catch(function(e){if(e&&e.bMaxCanvasSizeExceeded){t._updateDialogPreviewCanvas();t._oDialog.getContent()[0].setBusy(false)}})}};Q.prototype.openPdfPreview=function(){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set")}this._oDomToPrint=[];this._oDomToPrintHeight=0;this._oDomToPrintWidth=0;var t=this;this._createAndOpenDialog(true);this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt(true).then(function(){if(t._bMultipleBatches){t._openProgressDialog()}return t.generatePdfAsync(0)}).catch(function(e){if(e){t._oDialog.getContent()[0].setBusy(false)}})};Q.prototype.close=function(){var t=this._getOriginalGanttChart();if(this._initialDisplayType===q.Table){t.setSelectionPanelSize(this._initialSelectionPanelSize);t.setDisplayType(this._initialDisplayType);if(t.getParent()&&t.getParent().isA("sap.gantt.simple.GanttChartContainer")&&t.getParent().getToolbar()){t.getParent().getToolbar()._oDisplayTypeSegmentedButton.setSelectedKey(q.Table)}}this._ganttChartClone.destroy();this._ganttChartClone=null;this._ganttChartContainer.destroy();this._ganttChartContainer=null;document.body.removeChild(this._oClonedGanttDiv);W.deregister(this._sResizeHandlerId);if(this._oPdfPreview){this._oPdfPreview.destroy()}this._oDialog.close();this._oDialog.destroy();if(J.browser.safari){t.getInnerGantt().invalidate()}};Q.prototype._closeProgressIndicator=function(t){this._oProgressDialog.close();this._oProgressDialog.destroy();this._bCancel=true;if(!this._bUpdateGanttCanvas&&!t){this.close()}};Q.prototype.setGanttChart=function(t){this.setAssociation("ganttChart",t);this._initialDisplayType=t.getDisplayType();this._initialSelectionPanelSize=t._iLastTableAreaSize?t._iLastTableAreaSize:t.getSelectionPanelSize();var e=this._initialDisplayType===q.Table?true:false;if(e){t.setSelectionPanelSize("100%");t.setDisplayType(q.Both)}this._ganttChartClone=t.clone();this._ganttChartClone._enableOptimisation=t.getPrintingBatchSize()>0?true:false;this._bUpdateGanttCanvas=false;this._bCancel=false;this._ganttChartClone.setEnableChartOverflowToolbar(false);this.canvasScale=2;if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.getTable().destroyExtension();var i=e?1:Math.max(t.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(t.getPrintingBatchSize()/i),t.getTable()._getTotalRowCount());this._bMultipleBatches=t.getTable()._getTotalRowCount()>this.iThreshold;this.bFirst=true;this._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._ganttChartClone.getTable().setVisibleRowCount(this.iThreshold);this._ganttChartClone.getTable().setThreshold(this.iThreshold);this._ganttChartClone.setParent(this._getOriginalGanttChart(),"originalGanttChart",true)}else{this._ganttChartContainer.setParent(this._getOriginalGanttChart(),"originalGanttChart",true)}this._addBackOriginalGanttRowBinding(this._ganttChartClone,t);this._originalHasRenderedShapes=t.getInnerGantt().hasRenderedShapes();this._ganttChartClone.mEventRegistry={};this._ganttChartClone.setHeight("100%");var a=t._oSplitter._calculatedSizes[0];if(this._initialDisplayType===q.Chart){this._ganttChartClone.setProperty("selectionPanelSize","1px",true)}else{this._ganttChartClone.setProperty("selectionPanelSize",a.toString()+"px",true)}var n=t.getAxisTimeStrategy();if(!n.isA("sap.gantt.axistime.FullScreenStrategy")&&!e){t.isPrint=true;t._getScrollExtension()._updateVisibleHorizonForce();var o=this._ganttChartClone.getAxisTimeStrategy();o.setTotalHorizon(n.getTotalHorizon());o.setVisibleHorizon(n.getTotalHorizon())}var r=n.getVisibleHorizon();var s=this._getHorizonDates(r);var h=this._horizonWidthInSec(s);this._fPixelsBySec=t.getVisibleWidth()/h;this._ganttChartClone.isPrint=true;this._ganttChartClone._bClonedGantt=true;if(!this._ganttChartClone._enableOptimisation){this._ganttChartContainer.addGanttChart(this._ganttChartClone)}return this};Q.prototype._expandAndCollapse=function(){var t=this;return this._expandAndCollapseRow().then(function(){if(t._bExpandCollapse){return t._expandAndCollapse()}else{return Promise.resolve()}})};Q.prototype._expandAndCollapseRow=function(){if(this._bCancel){this._bExpandCollapse=false;return Promise.reject()}var t=this._getOriginalGanttChart().getTable();if(!t.isA("sap.ui.table.TreeTable")){this._bExpandCollapse=false;return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)}var e=t.getBinding("rows"),i=this._ganttChartClone.getTable().getBinding("rows");for(var a=0;a<e.getLength();a++){if(i.findNode(a)!==undefined&&e.isExpanded(a)&&!i.isExpanded(a)){i.expand(a);return this.renderGanttClone(true)}else if(i.findNode(a)!==undefined&&!e.isExpanded(a)&&i.isExpanded(a)){i.collapse(a);return this.renderGanttClone(true)}}this._bExpandCollapse=false;return Promise.resolve()};Q.prototype._expandRowSettings=function(){if(this._bCancel){return Promise.reject()}var t=this._ganttChartClone.getShapeSchemes().find(function(t){return!t.getPrimary()});if(t){this._ganttChartClone.expand(t.getKey(),this._getOriginalGanttChart()._aExpandedIndices)}return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)};Q.prototype._onResize=function(){var t=this._oHTMLDialogPreview.getDomRef();t.style.overflow="hidden";this._resizePrintingPreviewPage();t.style.overflow="visible"};function et(t){return t*3.78}function it(t){return t/3.78}function at(t){return t/.01042}function nt(t){return t*.01042}Q.prototype._convertUnitToPx=function(t){var e=this._oModel.getProperty("/unit");if(!e){return undefined}switch(e){case"mm":return et(t);case"cm":return et(t)*10;case"in":return at(t);default:return undefined}};Q.prototype._convertPxToUnit=function(t){var e=this._oModel.getProperty("/unit");if(!e){return undefined}switch(e){case"mm":return it(t);case"cm":return it(t)/10;case"in":return nt(t);default:return undefined}};Q.prototype._onChangeUnitComboBox=function(){this._updatePaperSizeInputs();this._updateMarginInputs()};Q.prototype._updatePaperSizeInputs=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(t,e)};Q.prototype._setPaperSizeInputs=function(t,e){if(this._oInputPaperWidth){this._oInputPaperWidth.setValue(this._convertPxToUnit(t))}if(this._oInputPaperHeight){this._oInputPaperHeight.setValue(this._convertPxToUnit(e))}};Q.prototype._setPaperSizesToModel=function(t,e){this._oModel.setProperty("/paperWidth",t);this._oModel.setProperty("/paperHeight",e)};Q.prototype._updatePaperSizeValues=function(t,e){var i=this._oModel.getProperty("/paperSize"),a=this._oModel.getProperty("/portrait"),n,o;if(!i||i==="Custom"){return}var r=Q._oPaperSizes[i];if(a){n=r.width;o=r.height}else{n=r.height;o=r.width}this._setPaperSizeInputs(n,o);this._setPaperSizesToModel(n,o);if(i==="Letter"||i==="Legal"||i==="Tabloid"){this._oComboBoxUnit.setSelectedKey("in")}else{this._oComboBoxUnit.setSelectedKey("mm")}this._onChangeUnitComboBox();if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Q.prototype._updatePaperOrientation=function(t){var e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/paperHeight");if(i>e){this._oModel.setProperty("/portrait",true);this._radioGroupOrientation.setSelectedIndex(0)}else{this._oModel.setProperty("/portrait",false);this._radioGroupOrientation.setSelectedIndex(1)}};Q.prototype._onChangePaperSizeInput=function(t,e){var i=e.getSource();var a=this._convertUnitToPx(n.getFloatInstance().parse(i.getValue()));if(i===this._oInputPaperWidth){this._oModel.setProperty("/paperWidth",a)}else{this._oModel.setProperty("/paperHeight",a)}this._oComboBoxPaperSizes.setSelectedKey("Custom");this._updatePaperOrientation();if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Q.prototype._onChangeCompressionSlider=function(t){var e=t.getSource();var i=e.getValue();this._setCompressionComboBoxItem(i)};Q.prototype._setCompressionComboBoxItem=function(t){if(t===100){this._oComboBoxCompression.setSelectedKey("maximum")}else if(t>=75){this._oComboBoxCompression.setSelectedKey("high")}else if(t>=50){this._oComboBoxCompression.setSelectedKey("medium")}else{this._oComboBoxCompression.setSelectedKey("low")}};Q.prototype._onChangeCompressionComboBox=function(t){var e=t.getSource().getSelectedKey();var i={maximum:100,high:75,medium:50,low:25};this._oModel.setProperty("/compressionQuality",i[e])};Q.prototype._onChangeOrientation=function(t,e){var i=this._oModel.getProperty("/paperWidth"),a=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(a,i);this._setPaperSizesToModel(a,i);if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Q.prototype._onChangeExportTypes=function(){this._updateDialogPreview()};Q.prototype._setMarginInputs=function(t,e,i,a){this._oInputMarginTop.setValue(this._convertPxToUnit(t));this._oInputMarginRight.setValue(this._convertPxToUnit(e));this._oInputMarginBottom.setValue(this._convertPxToUnit(i));this._oInputMarginLeft.setValue(this._convertPxToUnit(a))};Q.prototype._setMarginsToModel=function(t,e,i,a){if(t!==undefined){this._oModel.setProperty("/marginTop",t)}if(e!==undefined){this._oModel.setProperty("/marginRight",e)}if(i!==undefined){this._oModel.setProperty("/marginBottom",i)}if(a!==undefined){this._oModel.setProperty("/marginLeft",a)}};Q.prototype._onChangeMarginComboBox=function(t,e){var i=e.getSource().getSelectedKey();var a=et(5);if(i==="none"){a=0}this._setMarginsToModel(a,a,a,a);this._setMarginInputs(a,a,a,a);if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Q.prototype._updateModelFromMarginInputs=function(){var t,e,i,a;if(this._oInputMarginTop.getValueState()!=="Error"){t=this._convertUnitToPx(this._oInputMarginTop.getValue())}if(this._oInputMarginRight.getValueState()!=="Error"){e=this._convertUnitToPx(this._oInputMarginRight.getValue())}if(this._oInputMarginBottom.getValueState()!=="Error"){i=this._convertUnitToPx(this._oInputMarginBottom.getValue())}if(this._oInputMarginLeft.getValueState()!=="Error"){a=this._convertUnitToPx(this._oInputMarginLeft.getValue())}this._setMarginsToModel(t,e,i,a)};Q.prototype._updateMarginInputs=function(){var t=this._oModel.getProperty("/marginTop");var e=this._oModel.getProperty("/marginRight");var i=this._oModel.getProperty("/marginBottom");var a=this._oModel.getProperty("/marginLeft");this._setMarginInputs(t,e,i,a)};Q.prototype._updateCropMarksOffsetInput=function(){var t=this._oModel.getProperty("/cropMarksOffset");this._oInputCropMarksOffset.setValue(this._convertPxToUnit(t))};Q.prototype._onChangeMarginInput=function(t,e){var i=e.getSource();if(i.getValueState()==="Error"){return}if(this._oModel.getProperty("/marginLocked")){var a=this._convertUnitToPx(i.getValue());this._setMarginInputs(a,a,a,a);this._setMarginsToModel(a,a,a,a)}else{this._updateModelFromMarginInputs()}if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Q.prototype._onChangeCropMarksInput=function(t){var e=t.getSource();var i=this._convertUnitToPx(e.getValue());this._oInputCropMarksOffset.setValue(this._convertPxToUnit(i));this._oModel.setProperty("/cropMarksOffset",i)};Q.prototype._allRange=function(){this._oModel.setProperty("/startDate",this._oDatePickerFrom.getMinDate());this._oModel.setProperty("/endDate",this._oDatePickerTo.getMaxDate())};Q.prototype._getFirstDayOfNextWeek=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy().getFirstDayOfWeek();var i=(e+7-t.getDay())%7;return new Date(t.getFullYear(),t.getMonth(),t.getDate()+(i===0?7:i))};Q.prototype._nextWeekRange=function(){var t=new Date;var e=this._getFirstDayOfNextWeek(t);this._oModel.setProperty("/startDate",this._validateDate(e));this._oModel.setProperty("/endDate",this._validateDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+7)))};Q.prototype._getFirstDayOfNextMonth=function(t){return new Date(t.getFullYear(),t.getMonth()+1,1)};Q.prototype._nextMonthRange=function(){var t=new Date;this._oModel.setProperty("/startDate",this._validateDate(this._getFirstDayOfNextMonth(t)));this._oModel.setProperty("/endDate",this._validateDate(new Date(t.getFullYear(),t.getMonth()+2,1)))};Q.prototype._validateDate=function(t){var e=this._oDatePickerTo.getMaxDate(),i=this._oDatePickerFrom.getMinDate();if(t.getTime()>e.getTime()){return e}if(t.getTime()<i.getTime()){return i}return t};Q.prototype._onChangeDurationComboBox=function(t){var e=this._oModel.getProperty("/duration");switch(e){case"all":{this._allRange()}break;case"week":{this._nextWeekRange()}break;case"month":{this._nextMonthRange()}break;case"custom":default:return}if(t){this._updateGanttPdf()}else{this._updateGanttCanvas()}};Q.prototype._onChangeDurationDatePicker=function(t){this._oComboBoxDuration.setSelectedKey("custom");if(t){this._updateGanttPdf()}else{this._updateGanttCanvas()}};Q.prototype._setEnabledPreviousButtons=function(t){this._oButtonFirst.setEnabled(t);this._oButtonPrevious.setEnabled(t)};Q.prototype._setEnabledNextButtons=function(t){this._oButtonNext.setEnabled(t);this._oButtonLast.setEnabled(t)};Q.prototype._updatePageNumberButtons=function(){if(!this._oGanttCanvas){this._setEnabledNextButtons(false);this._setEnabledPreviousButtons(false);return}var t=this._oModel.getProperty("/previewPageNumber"),e=this._oModel.getProperty("/lastPageNumber");if(!e){e=Number.MAX_SAFE_INTEGER}if(t<=1){this._setEnabledPreviousButtons(false)}if(t>=e){this._setEnabledNextButtons(false)}if(t>1){this._setEnabledPreviousButtons(true)}if(t<e){this._setEnabledNextButtons(true)}};Q.prototype._getHeaderHeight=function(){var t=this._oModel.getProperty("/showHeaderText");if(t){return this._iHeaderAndFooterHeight}return 0};Q.prototype._isFooterMultiline=function(){if(!this._oModel.getProperty("/multiplePage")){return false}var t=this._oModel.getProperty("/showPageNumber"),e=this._oModel.getProperty("/showFooterText");if(!e||!t){return false}var i=this._oModel.getProperty("/footerText"),n=this._oModel.getProperty("/paperWidth"),o;var r=a.getConfiguration().getRTL();if(r){o=this._oModel.getProperty("/marginRight")}else{o=this._oModel.getProperty("/marginLeft")}var s=7;var h=this._oGanttCanvas.getContext("2d");h.font=Y;var l=h.measureText(i).width;if(n/2>o+et(4)+l+et(10)+s){return false}else{return true}};Q.prototype._getFooterHeight=function(){var t=this._oModel.getProperty("/showPageNumber"),e=this._oModel.getProperty("/showFooterText");if(e&&t){return this._isFooterMultiline()?2*this._iHeaderAndFooterHeight:this._iHeaderAndFooterHeight}if(e||t){return this._iHeaderAndFooterHeight}return 0};Q.prototype._isShrinkableToOnePageByWidth=function(){var t=this._getPaperContentWidth()/this._getPaperContentHeight(),e=this._oGanttCanvas.width/this._oGanttCanvas.height;return t<=e};Q.prototype._isDomShrinkableToOnePageByWidth=function(t,e){var i=this._getPaperContentWidth()/this._getPaperContentHeight(),a=e/t;return i<=a};Q.prototype._getPaperContentWidth=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/marginLeft"),i=this._oModel.getProperty("/marginRight");return t-e-i};Q.prototype._getPaperContentHeight=function(){var t=this._oModel.getProperty("/paperHeight"),e=this._oModel.getProperty("/marginTop"),i=this._oModel.getProperty("/marginBottom");return t-e-this._getHeaderHeight()-i-this._getFooterHeight()};Q.prototype._getScale=function(){return 100/this._oModel.getProperty("/scale")*2};Q.prototype._getCroppingWidth=function(){return this._getScale()*this._getPaperContentWidth()};Q.prototype._getCroppingHeight=function(){return this._getScale()*this._getPaperContentHeight()};Q.prototype._getPagesInARow=function(){return Math.ceil(this._oGanttCanvas.width/this._getCroppingWidth())};Q.prototype._getPagesInAColumn=function(){return Math.ceil(this._oGanttCanvas.height/this._getCroppingHeight())};Q.prototype._updateLastPageNumber=function(){if(!this._oGanttCanvas){return}var t=this._getPagesInARow()*this._getPagesInAColumn();this._oModel.setProperty("/lastPageNumber",t);var e=this._oModel.getProperty("/previewPageNumber");if(e>t){this._oModel.setProperty("/previewPageNumber",t)}};Q.prototype._onPressButtonFirst=function(){this._oModel.setProperty("/previewPageNumber",1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Q.prototype._onPressButtonPrevious=function(){var t=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",t-1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Q.prototype._onPressButtonNext=function(){var t=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",t+1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Q.prototype._onPressButtonLast=function(){var t=this._oModel.getProperty("/lastPageNumber");if(!t){return}this._oModel.setProperty("/previewPageNumber",t);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Q.prototype._getOriginalGanttChart=function(){return sap.ui.getCore().byId(this.getAssociation("ganttChart"))};Q.prototype._setGanttCloneDivWidth=function(t){var e=this._getOriginalGanttChart(),i=this._getHorizonDates(t),a=this._horizonWidthInSec(i),n=Math.ceil(this._fPixelsBySec*a);var o=e.getDisplayType()===q.Both?e.getTable().getDomRef().offsetWidth:0;this._oClonedGanttDiv.style.width=(o+n+10).toString()+"px"};Q.prototype._setGanttCloneDivHeight=function(){var t=this._getOriginalGanttChart().getTable();var e=t._getTotalRowCount(),i=t._aRowHeights;var a=i.reduce(function(t,e){return t+e});var n=Math.ceil(a/i.length*e);this._iGanttHeight=n+102;this._oClonedGanttDiv.style.height=this._iGanttHeight.toString()+"px"};Q.prototype._setCloneDivHeight=function(){var t=this.bFirst?document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value:0;var e=this._ganttChartClone.getTable().getVisibleRowCount();var i=0;var a=this.bLast?3:0;var n=this._ganttChartClone.getTable().getRows()[0].getIndex();var o=this._ganttChartClone.getTable().getFirstVisibleRow();var r=Math.abs(n-o);var s=this._ganttChartClone.getTable()._aRowHeights;for(var h=r;h<e+r;h++){i=i+s[h]}this._iContentHeight=i+"px";this._oClonedGanttDiv.style.height=(i+t+a).toString()+"px"};Q.prototype._setCloneDivHeightNonOptimised=function(){var t=document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value;var e=this._ganttChartClone.getTable()._getTotalRowCount();var i=1;var a=this._ganttChartClone.getTable()._aRowHeights;for(var n=0;n<e;n++){var o=a[n]?a[n]:0;i=i+o}this._iContentHeight=i.toString()+"px";this._oClonedGanttDiv.style.height=(i+t).toString()+"px"};Q.prototype._createImgElementsFromSvgImages=function(){var t=this._ganttChartClone.$().find("svg.sapGanttChartSvg");if(!t.length){return}var e=this._ganttChartClone.$().find(".sapGanttChartCnt")[0];if(!e){return}e.style.position="relative";var i=t.find("image");for(var a=0;a<i.length;a++){var n=i[a];var o=document.createElement("img");o.src=n.getAttribute("href");o.style.position="absolute";o.style.top=n.getAttribute("y")+"px";o.style.left=n.getAttribute("x")+"px";o.style.width=n.getAttribute("width")+"px";o.style.height=n.getAttribute("height")+"px";e.appendChild(o)}};Q.prototype._createGanttCanvas=function(){if(this._bCancel){return Promise.reject()}this._setStyleToGanttChartSvg(this._ganttChartClone);this._createImgElementsFromSvgImages();return V(this._oClonedGanttDiv,{allowTaint:true,scale:this.canvasScale,logging:false})};Q.prototype._createBatchList=function(){if(this._bCancel){return Promise.reject()}this._setStyleToGanttChartSvg(this._ganttChartClone);this._oDomToPrintHeight+=Number(this._oClonedGanttDiv.style.height.slice(0,-2));this._oDomToPrintWidth=Number(this._oClonedGanttDiv.style.width.slice(0,-2));return this._oClonedGanttDiv.cloneNode(true)};Q.prototype._updateGanttPdf=function(){if(this._initialDisplayType===q.Table){return}var t=this._oModel;var e=this._ganttChartClone.getAxisTimeStrategy();var i=e.getVisibleHorizon().clone();var a=e.getTotalHorizon().clone();i.setStartTime(t.getProperty("/startDate"));i.setEndTime(t.getProperty("/endDate"));a.setStartTime(t.getProperty("/startDate"));a.setEndTime(t.getProperty("/endDate"));this._bCancel=false;this._oDomToPrint=[];this._oDomToPrintHeight=0;this._oDomToPrintWidth=0;if(!this._bMultipleBatches){this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false)}this._setGanttCloneDivWidth(a);this._setGanttCloneDivHeight();e.setTotalHorizon(a);e.setVisibleHorizon(i);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate()}this._ganttChartClone._bRenderGanttClone=true;var n=this._getOriginalGanttChart();var o=Math.max(n.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(n.getPrintingBatchSize()/o),n.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);if(this._bMultipleBatches){this._openProgressDialog()}this._ganttChartClone._bRenderGanttClone=false;return this.generatePdfAsync(0)};Q.prototype._updateGanttCanvas=function(){if(this._initialDisplayType===q.Table){return}var t=this._oModel;var e=this._ganttChartClone.getAxisTimeStrategy();var i=e.getVisibleHorizon().clone();var a=e.getTotalHorizon().clone();i.setStartTime(t.getProperty("/startDate"));i.setEndTime(t.getProperty("/endDate"));a.setStartTime(t.getProperty("/startDate"));a.setEndTime(t.getProperty("/endDate"));this._bUpdateGanttCanvas=true;this._bCancel=false;if(!this._bMultipleBatches){this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false)}this._setGanttCloneDivWidth(a);this._setGanttCloneDivHeight();if(this._oClonedGanttDiv.offsetWidth*this.canvasScale>tt||this._oClonedGanttDiv.offsetHeight*this.canvasScale>tt){this._oClonedGanttDiv.style.height=this._oClonedGanttDiv.offsetHeight*this.canvasScale+"px";this._oClonedGanttDiv.style.width=this._oClonedGanttDiv.offsetWidth*this.canvasScale+"px";this._oGanttCanvas=undefined;this._updateDialogPreviewCanvas();this._oFlexBoxPreview.setBusy(false);return undefined}e.setTotalHorizon(a);e.setVisibleHorizon(i);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate()}this._ganttChartClone._bRenderGanttClone=true;if(this._ganttChartClone._enableOptimisation){var n=this._getOriginalGanttChart();var o=Math.max(n.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(n.getPrintingBatchSize()/o),n.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);if(this._bMultipleBatches){this._openProgressDialog()}this._ganttChartClone._bRenderGanttClone=false;return this.generateCanvasAsync(0)}else{this._oClonedGanttDiv.style.height=this._iGanttHeight*2+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes).then(function(){this._ganttChartClone._bRenderGanttClone=false;return this.renderGanttClone().then(function(){this._setCloneDivHeightNonOptimised();document.getElementById(this._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=this._iContentHeight;document.getElementById(this._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=this._iContentHeight;this._createGanttCanvas().then(function(t){this._oGanttCanvas=t;this._updateDialogPreview();this._oFlexBoxPreview.setBusy(false)}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false)}.bind(this))}.bind(this))}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false)}.bind(this))}};Q.prototype._drawClonedGantt=function(t){if(this._oClonedGanttDiv){return Promise.reject()}this._oClonedGanttDiv=document.createElement("div");this._oClonedGanttDiv.id="clonedGanttDiv";if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact")}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";document.body.appendChild(this._oClonedGanttDiv);this._setGanttCloneDivWidth(this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon());this._setGanttCloneDivHeight();var e=this._oModel;var i=this._ganttChartClone.getAxisTimeStrategy();i.getVisibleHorizon().setStartTime(e.getProperty("/startDate"));i.getVisibleHorizon().setEndTime(e.getProperty("/endDate"));if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv")}else{this._ganttChartContainer.placeAt("clonedGanttDiv")}this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart());if(!t&&(this._oClonedGanttDiv.offsetWidth*this.canvasScale>tt||this._oClonedGanttDiv.offsetHeight*this.canvasScale>tt)){this._oClonedGanttDiv.style.height=this._oClonedGanttDiv.offsetHeight*this.canvasScale+"px";this._oClonedGanttDiv.style.width=this._oClonedGanttDiv.offsetWidth*this.canvasScale+"px";return Promise.reject({bMaxCanvasSizeExceeded:true})}if(this._ganttChartClone._enableOptimisation){return Promise.resolve()}else{this._oClonedGanttDiv.style.height=this._iGanttHeight*2+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)}};Q.prototype._addBackOriginalGanttRowBinding=function(t,e){var i=t.getTable();if(i.getBindingInfo("rows").binding==null){t.oPropagatedProperties=e._getPropertiesToPropagate();t.propagateProperties(true)}if(t.getEnablePseudoShapesDisplay()){var a=i.getRowSettingsTemplate();if(a&&!a.getBindingInfo("tasks")){var n=X.prototype.clone.call(e.getTable().getRowSettingsTemplate());a.bindAggregation("tasks",n.getBindingInfo("tasks"))}}if(this._ganttChartClone._enableOptimisation){i.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);i.setVisibleRowCount(this.iThreshold);i.setThreshold(this.iThreshold)}var o=e.getTable().getBinding("rows"),r=i.getBinding("rows");if(o){if(o.sCustomParams){r.sCustomParams=o.sCustomParams}if(o.aFilters&&o.aFilters.length>0){r.filter(o.aFilters)}if(o.aApplicationFilters&&o.aApplicationFilters.length>0){r.filter(o.aApplicationFilters,sap.ui.model.FilterType.Application)}if(o.aSorters&&o.aSorters.length>0){r.sort(o.aSorters)}}};Q.prototype._resizePrintingPreviewPage=function(){var t=this._oHTMLDialogPreview.getDomRef(),e=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv")[0],i=t.offsetHeight,a=this._oModel.getProperty("/paperHeight"),n=this._oModel.getProperty("/paperWidth"),o=this._oModel.getProperty("/portrait"),r,s;if(o){r=i/a;s=n*r}else{r=i/n;s=i;i=a*r}e.style.width=s.toString()+"px";e.style.height=i.toString()+"px"};Q.prototype._updateSinglePageMessages=function(t,e){if(e>t){this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_PORTRAIT"))}else{this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"))}if(this._getPagesInARow()>3||this._getPagesInAColumn()>3){this._oModel.setProperty("/qualityWarning",true)}else{this._oModel.setProperty("/qualityWarning",false)}if(e>=t&&this._oModel.getProperty("/portrait")||e<=t&&!this._oModel.getProperty("/portrait")){this._oModel.setProperty("/showOrientationMessage",false)}else{this._oModel.setProperty("/showOrientationMessage",true)}};Q.prototype._getCanvasOfPageN=function(t,e){var i=this._oModel.getProperty("/lastPageNumber");if(t>i){return null}var n=document.createElement("canvas");var o=n.getContext("2d");o.imageSmoothingEnabled=false;var r=this._getCroppingWidth(),s=this._getCroppingHeight();var h=this._getPagesInARow();var l=this._oModel.getProperty("/paperWidth"),g=this._oModel.getProperty("/paperHeight");var p=this._oModel.getProperty("/marginTop"),_=this._oModel.getProperty("/marginRight"),d=this._oModel.getProperty("/marginBottom"),u=this._oModel.getProperty("/marginLeft");var c=(t-1)%h,C=Math.floor((t-1)/h);n.width=l;n.height=g;if(!e){n.style.height="100%";n.style.width="auto"}o.fillStyle="white";o.fillRect(0,0,n.width,n.height);o.fillStyle=k.get("sapUiBaseText");o.textBaseline="middle";o.font=Y;var P;var f=a.getConfiguration().getRTL();if(f){o.textAlign="right";P=l-_-et(4)}else{o.textAlign="left";P=u+et(4)}var m=this._oModel.getProperty("/showHeaderText");if(m){var y=this._oModel.getProperty("/headerText");o.fillText(y,P,p+this._iHeaderAndFooterHeight/2)}if(this._oModel.getProperty("/showFooterText")){o.fillText(this._oModel.getProperty("/footerText"),P,g-d-this._iHeaderAndFooterHeight/2-(this._isFooterMultiline()?this._iHeaderAndFooterHeight:0))}var v=this._oModel.getProperty("/showPageNumber"),T=this._oModel.getProperty("/multiplePage"),b;if(T&&v){o.font=Z;o.textAlign="center";o.fillText(t.toString(),l/2,g-d-this._iHeaderAndFooterHeight/2)}if(T){var w=c*r,x=C*s,G=0,S=0;var M=false;if(w+r>this._oGanttCanvas.width){M=true;r=this._oGanttCanvas.width-w;S=r/this._getScale()}var R=false;if(x+s>this._oGanttCanvas.height){R=true;s=this._oGanttCanvas.height-x;G=s/this._getScale()}b=(M?S:this._getPaperContentWidth())/r;if(b<.5&&e){var D=document.createElement("canvas");D.width=r;D.height=s;var N=D.getContext("2d");N.drawImage(this._oGanttCanvas,w,x,r,s,0,0,r,s);this._downScaleCanvas(D,o,b,0,0,D.width,D.height,u,p+this._getHeaderHeight())}else{o.drawImage(this._oGanttCanvas,w,x,r,s,u,p+this._getHeaderHeight(),M?S:this._getPaperContentWidth(),R?G:this._getPaperContentHeight())}}else{var B=this._getPaperContentWidth(),E=this._getPaperContentHeight();var I=this._isShrinkableToOnePageByWidth();var A;if(I){A=B/this._oGanttCanvas.width;E=this._oGanttCanvas.height*A}else{A=E/this._oGanttCanvas.height;B=this._oGanttCanvas.width*A}this._updateSinglePageMessages(B,E);b=B/this._oGanttCanvas.width;if(b<1&&e){this._downScaleCanvas(this._oGanttCanvas,o,b,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,u,p+this._getHeaderHeight())}else{o.drawImage(this._oGanttCanvas,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,u,p+this._getHeaderHeight(),B,E)}}return n};Q.prototype._getFXTextPosition=function(){var t;var e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/marginRight"),n=this._oModel.getProperty("/marginLeft");var o=a.getConfiguration().getRTL();if(o){t=e-i-et(4)}else{t=n+et(4)}return t};Q.prototype._downScaleCanvas=function(t,e,i,a,n,o,r,s,h){var l=document.createElement("canvas");l.width=o;l.height=r;var g=l.getContext("2d");g.drawImage(t,a,n,o,r,0,0,o,r);var p=i*i;var _=Math.floor(o*i);var d=Math.floor(r*i);var u=0,c=0,C=0;var P=0,f=0,m=0,y=0;var v=0,T=0;var b=0,w=0,x=0;var G=0,S=0,M=0;var R=false,D=false;var N=l.getContext("2d").getImageData(0,0,o,r).data;var B=new Float32Array(3*_*d);var E=0,I=0,A=0;for(c=0;c<r;c++){f=c*i;T=0|f;m=3*T*_;D=T!==(0|f+i);if(D){x=T+1-f;M=f+i-T-1}for(u=0;u<o;u++,C+=4){P=u*i;v=0|P;y=m+v*3;R=v!==(0|P+i);if(R){w=v+1-P;S=P+i-v-1}E=N[C];I=N[C+1];A=N[C+2];if(!R&&!D){B[y]+=E*p;B[y+1]+=I*p;B[y+2]+=A*p}else if(!R&&D){b=x*i;B[y]+=E*b;B[y+1]+=I*b;B[y+2]+=A*b;G=M*i;B[y+3*_]+=E*G;B[y+3*_+1]+=I*G;B[y+3*_+2]+=A*G}else if(R&&!D){b=w*i;B[y]+=E*b;B[y+1]+=I*b;B[y+2]+=A*b;G=S*i;B[y+3]+=E*G;B[y+4]+=I*G;B[y+5]+=A*G}else{b=w*x;B[y]+=E*b;B[y+1]+=I*b;B[y+2]+=A*b;G=S*x;B[y+3]+=E*G;B[y+4]+=I*G;B[y+5]+=A*G;G=w*M;B[y+3*_]+=E*G;B[y+3*_+1]+=I*G;B[y+3*_+2]+=A*G;G=S*M;B[y+3*_+3]+=E*G;B[y+3*_+4]+=I*G;B[y+3*_+5]+=A*G}}}var H=document.createElement("canvas");H.width=_;H.height=d;var F=H.getContext("2d");var O=F.getImageData(0,0,_,d);var L=O.data;var k=0;for(C=0,y=0;k<_*d;C+=3,y+=4,k++){L[y]=0|B[C];L[y+1]=0|B[C+1];L[y+2]=0|B[C+2];L[y+3]=255}e.putImageData(O,s,h);return};function ot(t){while(t.firstChild){t.removeChild(t.firstChild)}}Q.prototype._createPreviewErrorMessageStrip=function(t){return new x({text:this._oRb.getText(t?"GNT_PRNTG_ERROR_TOOHIGHCHART":"GNT_PRNTG_ERROR_BIGCHART"),showIcon:true,type:"Error"})};Q.prototype._updateDialogPreviewCanvas=function(){var t=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv");var e=t[0];if(this._oGanttCanvas){this._oButtonExport.setEnabled(true);var i=this._oModel.getProperty("/multiplePage");if(i){this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false)}var a=this._getCanvasOfPageN(i?this._oModel.getProperty("/previewPageNumber"):1,false);ot(e);this._resizePrintingPreviewPage();e.appendChild(a)}else if(!this._oGanttCanvas&&(this._oClonedGanttDiv.offsetWidth>tt||this._oClonedGanttDiv.offsetHeight>tt)){this._resizePrintingPreviewPage();this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false);if(!this._oHTMLDialogPreview.$().find("#"+this.getId()+"-previewErrorMessageStrip").length){ot(e);if(!this._oPreviewErrorMessageStrip){this._oPreviewErrorMessageStrip=this._createPreviewErrorMessageStrip(this._oClonedGanttDiv.offsetHeight>tt)}var n=document.createElement("div");n.id=this.getId()+"-previewErrorMessageStrip";n.style.width="80%";e.appendChild(n);this._oPreviewErrorMessageStrip.placeAt(this.getId()+"-previewErrorMessageStrip")}}else{throw new Error("Gantt chart canvas does not exist.")}t.addClass("sapGanttPrintingPreviewPageDivBorder")};Q.prototype._updateDialogPreview=function(){this._updateLastPageNumber();this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Q.prototype._setStylesToDom=function(t){function e(t){var e=getComputedStyle(t);var i,a,n,o;var r=["height","width","min-height","min-width"];var s="";for(i=0,a=e.length;i<a;i++){n=e[i];if(!(t instanceof SVGElement&&r.indexOf(n)>=0)){o=e.getPropertyValue(n);s+=n+":"+o+";"}}t.style=s}function i(t){e(t);i(t);function i(t){if(t&&t.hasChildNodes()){var a=t.firstChild;while(a){if(a.nodeType===1&&a.nodeName!="SCRIPT"){e(a);i(a)}a=a.nextSibling}}}}i(t)};Q.prototype._setStyleToGanttChartSvg=function(t){var e=t.$().find("svg.sapGanttChartSvg")[0];var i=t.$().find("svg.sapGanttChartHeaderSvg")[0];if(e){this._setStylesToDom(e)}if(i){this._setStylesToDom(i)}};Q.prototype._setStyleToGanttChartTable=function(t){var e=t.getElementsByClassName("sapUiTable")[0];if(e){this._setStylesToDom(e)}};Q.prototype._getHorizonDates=function(t){var e=t.getStartTime();var i=t.getEndTime();return{startTime:new Date(R.abapTimestampToDate(e)),endTime:new Date(R.abapTimestampToDate(i))}};Q.prototype._horizonWidthInSec=function(t){if(t&&t.startTime&&t.endTime){return t.endTime.getTime()-t.startTime.getTime()}return 0};Q.prototype._pageToBeExported=function(){if(!this._oModel.getProperty("/multiplePage")){return[1]}var t=this._oModel.getProperty("/lastPageNumber"),e=this._oModel.getProperty("/exportAll"),i=[];if(e){for(var a=1;a<=t;a++){i.push(a)}return i}else{var o=this._oModel.getProperty("/exportRange");o=o.replace(/\s/g,"");var r=n.getIntegerInstance();var s=o.split(",");s.forEach(function(t){if(t.indexOf("-")!==-1){var e=t.split("-");var a=r.parse(e[0]);var n=r.parse(e[1]);for(var o=a;o<=n;o++){i.push(o)}}else{i.push(r.parse(t))}});return i}};Q.prototype._validateFields=function(){var t=true;t&=this._validateExportRangeInput();t&=this._oInputMarginTop.getValueState()!=="Error";t&=this._oInputMarginRight.getValueState()!=="Error";t&=this._oInputMarginBottom.getValueState()!=="Error";t&=this._oInputMarginLeft.getValueState()!=="Error";return t};Q.prototype._updatePdfPreview=function(t){if(!this._oPdfPreview){var e=this._oPdfDialogPreview.getParent().getDomRef().offsetHeight-100;this._oPdfPreview=new K({source:t,width:"94%",height:e.toString()+"px",showDownloadButton:false});jQuery.sap.addUrlWhitelist("blob");this._oPdfPreview.placeAt("sapGanttPdfPreviewDiv")}else{this._oPdfPreview.setSource(t)}this._oDialog.getContent()[0].setBusy(false);this._oFlexBoxPreview.setBusy(false);this._oButtonExport.setEnabled(true)};Q.prototype._generateSvgToPdf=function(){if(!this._validateFields()){return}this._oDialog.getContent()[0].setBusy(true);this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false);var t=this;var e=this._oModel.getProperty("/portrait")?"p":"l",i=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/paperHeight"),o=this._oModel.getProperty("/marginTop"),r=this._oModel.getProperty("/marginRight"),s=this._oModel.getProperty("/marginBottom"),h=this._oModel.getProperty("/marginLeft"),l=this._oModel.getProperty("/paperSize");var g=this._ganttChartClone;var p=g.getDisplayType()===q.Both?g.getTable().getDomRef().offsetWidth:0;var _=new z({orientation:e,unit:"px",format:l==="Custom"?[i*.75,n*.75]:l.toLowerCase()});function d(){var e=document.createElement("svg");e.setAttribute("id","mergedSvg");var i=Number(this._oDomToPrint[0].style.width.slice(0,-2))-32;if(u===0){var a=this._oDomToPrint[u].getElementsByClassName("sapGanttChartHeaderSvg")[0].cloneNode(true);a.children[0].setAttribute("style","fill: "+k.get("sapUiListHeaderBackground")+";width: "+i);var n=a.height.baseVal.value}var o=this._oDomToPrint[u].getElementsByClassName("sapGanttChartSvg")[0].cloneNode(true);var s=this._oDomToPrint[u].getElementsByClassName("sapGanttChartSvgDefs")[0].cloneNode(true);if(u===0&&o.getElementsByClassName("sapGanttChartVerticalLine")&&o.getElementsByClassName("sapGanttChartVerticalLine").length){var h=this._generateVerticalLines(this._ganttChartClone);if(h){o.getElementsByClassName("sapGanttChartVerticalLine")[0].setAttribute("d",h);o.getElementsByClassName("sapGanttChartVerticalLine")[0].removeAttribute("style")}else{return}}o.removeAttribute("style");if(u===0){Array.prototype.slice.call(a.getElementsByTagName("path")).forEach(function(t){t.removeAttribute("style")})}Array.prototype.slice.call(o.getElementsByClassName("sapGanttChartShapes")[0].getElementsByTagName("path")).forEach(function(t){t.removeAttribute("style")});Array.prototype.slice.call(o.getElementsByClassName("sapGanttChartRls")[0].getElementsByTagName("path")).forEach(function(t){t.removeAttribute("style")});if(o.getElementsByClassName("sapGanttBackgroundSVGRowBorder").length){Array.prototype.slice.call(o.getElementsByClassName("sapGanttBackgroundSVGRowBorder")).forEach(function(t){t.setAttribute("x2",i);t.setAttribute("y1",t.getAttribute("y1"));t.setAttribute("y2",t.getAttribute("y2"))})}if(o.getElementsByClassName("sapGanttBackgroundSVGRow").length){Array.prototype.slice.call(o.getElementsByClassName("sapGanttBackgroundSVGRow")).forEach(function(t){t.setAttribute("style","fill: "+k.get("sapUiListBackground")+";width: "+i)})}if(u===0){this._setLinesHeight(o);this._setCalenderDefsPosition(s,T,p);e.appendChild(a);o.setAttribute("y",n)}else{o.setAttribute("y",0)}e.appendChild(o);e.appendChild(s);var l=document.createElement("div");var g=this._oDomToPrint[u].getElementsByTagName("section")[0].cloneNode(true);l.appendChild(g);if(u===0){var c=this._oDomToPrint[u].getElementsByClassName("sapUiLoSplitterBar")[0].cloneNode(true);c.setAttribute("style","color: #346187;background-color: #c9d8e7;width: 1rem;display: inline-block; height: "+this._iGanttHeight+"px");c.style.transform="translate("+p+"px, -"+this._oDomToPrint[u].style.height+")";l.appendChild(c)}_.html(l,{callback:function(i){U(e,i,{xOffset:(p+16)*T+r,yOffset:b,scale:T});u++;if(u>=t._oDomToPrint.length){t.oSinglePagePdf=i;t._updatePdfPreview(i.output("bloburl"))}else{b=b+Number(t._oDomToPrint[u-1].style.height.slice(0,-2))*T;d.call(t)}},html2canvas:{scale:T,allowTaint:true},x:r,y:b})}var u=0;var c=0;var C=this._oDomToPrintHeight*2;var P=this._oDomToPrintWidth*2;var f=this._oModel.getProperty("/showHeaderText");if(f){var m=this._oModel.getProperty("/headerText");c=c+this._iHeaderAndFooterHeight;_.text(m,this._getFXTextPosition(),o+this._iHeaderAndFooterHeight/2)}if(this._oModel.getProperty("/showFooterText")){var y=this._oModel.getProperty("/footerText");c=c+this._iHeaderAndFooterHeight;_.text(y,this._getFXTextPosition(),_.getPageHeight()-s-this._iHeaderAndFooterHeight/2-(this._isFooterMultiline()?this._iHeaderAndFooterHeight:0))}var v=this._isDomShrinkableToOnePageByWidth(C,P);var T=v?(i-r-h)/P:(n-o-s-c)/C;var b=o+t._getHeaderHeight();if(this.sFont){_.addFileToVFS("SAP-icons.ttf",this.sFont);_.addFont("SAP-icons.ttf","SAP-icons","normal");_.setFont("SAP-icons");_.setFontSize(9);d.call(this)}else{var w=a.getConfiguration().getTheme(),x="base";if(w.indexOf("sap_horizon")>-1){x=w}var G=sap.ui.require.toUrl("sap/ui/core/themes/"+x+"/fonts/SAP-icons.ttf");this._fetchFontAndGeneratePdf(G,_,d)}};Q.prototype._fetchFontAndGeneratePdf=function(t,e,i){var a=this;fetch(t).then(function(t){return t.blob()}).then(function(t){var n=new FileReader;n.onload=function(){if(n.readyState===n.DONE){a.sFont=n.result;e.addFileToVFS("SAP-icons.ttf",a.sFont);e.addFont("SAP-icons.ttf","SAP-icons","normal");e.setFont("SAP-icons");e.setFontSize(9);i.call(a)}};n.readAsBinaryString(t)}).catch(function(t){})};Q.prototype._setLinesHeight=function(t){var e=this;if(t.getElementsByClassName("sapGanttNowLineBodySvgLine").length){t.getElementsByClassName("sapGanttNowLineBodySvgLine")[0].getElementsByTagName("line")[0].setAttribute("y2",this._oDomToPrintHeight)}if(t.getElementsByClassName("sapGanttChartAdhocLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartAdhocLine")[0].getElementsByTagName("line")).forEach(function(t){t.setAttribute("y2",e._oDomToPrintHeight)})}if(t.getElementsByClassName("sapGanttChartDeltaLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartDeltaLine")[0].getElementsByTagName("line")).forEach(function(t){t.setAttribute("y2",e._oDomToPrintHeight)})}if(t.getElementsByClassName("sapGanttChartAreaDeltaLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartAreaDeltaLine")[0].getElementsByTagName("rect")).forEach(function(t){t.setAttribute("height",e._oDomToPrintHeight)})}};Q.prototype._setCalenderDefsPosition=function(t,e,i){var a=this._oModel.getProperty("/marginRight"),n=this._oModel.getProperty("/marginLeft");Array.prototype.slice.call(t.getElementsByTagName("rect")).forEach(function(t){t.setAttribute("x",(Number(t.getAttribute("x"))+i)*e+(a+n)+32);t.setAttribute("width",Number(t.getAttribute("width"))*e)})};Q.prototype._savePdf=function(){if(!this._validateFields()){return}var t=this._oModel.getProperty("/portrait")?"p":"l",e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/paperHeight"),a=this._oModel.getProperty("/exportAsJPEG"),n=this._oModel.getProperty("/compressionQuality")/100,o=this._oModel.getProperty("/paperSize");var r=new z({orientation:t,unit:"px",format:o==="Custom"?[e*.75,i*.75]:o.toLowerCase()});var s=this._pageToBeExported();for(var h=0;h<s.length;h++){var l=this._getCanvasOfPageN(s[h],true);if(!l){continue}if(h!==0){r.addPage()}if(a){r.addImage(l.toDataURL("image/jpeg",n),"JPEG",0,0)}else{r.addImage(l.toDataURL("image/png"),"PNG",0,0)}}var g=new Date;r.save("GanttChartExport-"+g.toISOString()+".pdf")};Q.prototype._generateVerticalLines=function(t){var e=Number(this._oDomToPrint[0].style.width.slice(0,-2)),i=t.getAxisTime();var a="";if(i){var n=i.getZoomStrategy();var o=i.getTickTimeIntervalLabel(n.getTimeLineOption(),null,[0,e]);var r=o[1];for(var s=0;s<r.length;s++){a+=" M"+" "+(r[s].value-1/2)+" 0"+" v "+this._oDomToPrintHeight}}return a};Q.prototype._createPaperComboBox=function(t){this._oComboBoxPaperSizes=new C({selectedKey:"{setting>/paperSize}",change:this._updatePaperSizeValues.bind(this,t),items:[new E({key:"A5",text:"A5"}),new E({key:"A4",text:"A4"}),new E({key:"A3",text:"A3"}),new E({key:"A2",text:"A2"}),new E({key:"A1",text:"A1"}),new E({key:"A0",text:"A0"}),new E({key:"Letter",text:"Letter"}),new E({key:"Legal",text:"Legal"}),new E({key:"Tabloid",text:"Tabloid"}),new E({key:"Custom",text:"Custom"})]});return this._oComboBoxPaperSizes};Q.prototype._createPaperSizeFields=function(t){this._oInputPaperWidth=new p({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this,t)});this._oInputPaperHeight=new p({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this,t)});this._updatePaperSizeInputs();return new _({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oInputPaperWidth,new r({text:"×"}),this._oInputPaperHeight,this._oComboBoxUnit=new C({width:"50%",selectedKey:"{setting>/unit}",change:this._onChangeUnitComboBox.bind(this),items:[new E({key:"mm",text:this._oRb.getText("GNT_PRNTG_MILLIMETERS")}),new E({key:"cm",text:this._oRb.getText("GNT_PRNTG_CENTIMETERS")}),new E({key:"in",text:this._oRb.getText("GNT_PRNTG_INCHES")})]})]})};Q.prototype._createDurationComboBox=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy(),i=e.getTotalHorizon(),a=new Date(R.abapTimestampToDate(i.getEndTime())),n=new Date;this._oComboBoxDuration=new C({selectedKey:"{setting>/duration}",change:this._onChangeDurationComboBox.bind(this,t),items:[new E({key:"all",text:this._oRb.getText("GNT_PRNTG_DURATION_ALL")}),new E({key:"week",enabled:this._getFirstDayOfNextWeek(n).getTime()<a.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_WEEK")}),new E({key:"month",enabled:this._getFirstDayOfNextMonth(n).getTime()<a.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_MONTH")}),new E({key:"custom",text:this._oRb.getText("GNT_PRNTG_DURATION_CUSTOM")})]});return this._oComboBoxDuration};Q.prototype._createDatePicker=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy();var i=e.getTotalHorizon();var a=new Date(R.abapTimestampToDate(i.getStartTime()));var n=new Date(R.abapTimestampToDate(i.getEndTime()));this._oModel.setProperty("/startDate",a);this._oModel.setProperty("/endDate",n);this._oDatePickerFrom=new b({width:"47%",minDate:a,maxDate:"{setting>/endDate}",dateValue:"{setting>/startDate}",change:this._onChangeDurationDatePicker.bind(this,t),enabled:true});this._oDatePickerTo=new b({width:"47%",minDate:"{setting>/startDate}",maxDate:n,dateValue:"{setting>/endDate}",change:this._onChangeDurationDatePicker.bind(this,t),enabled:true});return new _({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oDatePickerFrom,new r({text:"~"}),this._oDatePickerTo]})};Q.prototype._createScale=function(){return new y({min:50,max:200,step:1,width:"25rem",value:"{setting>/scale}",visible:"{setting>/multiplePage}",liveChange:this._updateDialogPreview.bind(this),showAdvancedTooltip:true,inputsAsTooltips:true})};Q.prototype._validateExportRangeInput=function(){if(this._oModel.getProperty("/exportAll")){return true}var t=this._oModel.getProperty("/exportRange").replace(/\s/g,"");if(/^((\d+),|(\d+-\d+),)*((\d+)|(\d+-\d+))+$/.test(t)){this._oInputRange.setValueState("None");return true}this._oInputRange.setValueState("Error");this._oInputRange.setValueStateText(this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ERROR"));return false};Q.prototype._createPageRange=function(){var t=function(t){var e=t.getSource().getSelectedIndex();if(e===0){this._oButtonExport.setEnabled(true);this._oInputRange.setValueState("None")}};return new _({renderType:"Bare",alignItems:"Center",visible:"{setting>/multiplePage}",justifyContent:"SpaceBetween",items:[new f({layoutData:new u({shrinkFactor:0,growFactor:1}),selectedIndex:this._oModel.getProperty("/exportAll")?0:1,columns:2,select:t.bind(this),buttons:[new P({id:"all",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ALL"),selected:"{setting>/exportAll}"}),new P({id:"range",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_RANGE")+" "})]}),this._oInputRange=new p({layoutData:new u({growFactor:1}),value:"{setting>/exportRange}",change:this._validateExportRangeInput.bind(this),enabled:{path:"setting>/exportAll",formatter:function(t){return!t}}}).addStyleClass("sapGanttPrintingPageRangeInput")]})};Q.prototype._createLabelWithSwitch=function(t,e){return new _({renderType:"Bare",visible:"{setting>/multiplePage}",alignItems:"Center",items:[new o({text:t}),new G({state:e,change:this._updateDialogPreview.bind(this)}).addStyleClass("sapGanttPrintingSwitchPadding")]})};Q.prototype._createCheckBoxWithInput=function(t,e,i,a){var n=a?this._generateSvgToPdf:this._updateDialogPreview;return new _({renderType:"Bare",alignItems:"Start",justifyContent:"SpaceBetween",items:[new m({selected:e,text:t,select:n.bind(this)}),new p({width:"65%",value:i,enabled:e,change:n.bind(this)})]})};Q.prototype._createPanel=function(t,e){return new S({expandable:true,expanded:false,headerText:t,content:[new _({renderType:"Bare",direction:$.Column,items:[e]})]})};Q.prototype._createCompressionSlider=function(){return new y({min:1,max:100,step:1,change:this._onChangeCompressionSlider.bind(this),value:{path:"setting>/compressionQuality",type:"sap.ui.model.type.Integer"},visible:"{setting>/exportAsJPEG}",showAdvancedTooltip:true,inputsAsTooltips:true})};Q.prototype._createCompressionComboBox=function(){this._oComboBoxCompression=new C({visible:"{setting>/exportAsJPEG}",change:this._onChangeCompressionComboBox.bind(this),items:[new E({key:"maximum",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MAXIMUM")}),new E({key:"high",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_HIGH")}),new E({key:"medium",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MEDIUM")}),new E({key:"low",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_LOW")})]});var t=this._oModel.getProperty("/compressionQuality");this._setCompressionComboBoxItem(t);return this._oComboBoxCompression};Q.prototype._updateInputsStep=function(t){var e=.1;if(t==="mm"){e=1}return e};Q.prototype._createMargin=function(t){function e(t){return Math.round(this._convertPxToUnit(t/3))}return[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN")+":"}),new C({change:this._onChangeMarginComboBox.bind(this,t),selectedKey:"{setting>/marginType}",items:[new E({key:"default",text:this._oRb.getText("GNT_PRNTG_MARGIN_DEFAULT")}),new E({key:"none",text:this._oRb.getText("GNT_PRNTG_MARGIN_NONE")}),new E({key:"custom",text:this._oRb.getText("GNT_PRNTG_MARGIN_CUSTOM")})]}),new _({renderType:"Bare",alignItems:"Center",visible:{path:"setting>/marginType",formatter:function(t){return t==="custom"}},items:[new _({direction:$.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_TOP")}),this._oInputMarginTop=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:this._convertPxToUnit(this._oModel.getProperty("/marginTop")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_LEFT")}),this._oInputMarginLeft=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:this._convertPxToUnit(this._oModel.getProperty("/marginLeft")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}"})]}),new _({direction:$.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_BOTTOM")}),this._oInputMarginBottom=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:this._convertPxToUnit(this._oModel.getProperty("/marginBottom")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_RIGHT")}),this._oInputMarginRight=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:this._convertPxToUnit(this._oModel.getProperty("/marginRight")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin"),new g({icon:{path:"setting>/marginLocked",formatter:function(t){if(t){return"sap-icon://chain-link"}return"sap-icon://broken-link"}},press:function(){var t=this._oModel.getProperty("/marginLocked");this._oModel.setProperty("/marginLocked",!t)}.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingLockButton sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingTopMargin")]};Q.prototype._createCropMarks=function(){return[new G({state:"{setting>/cropMarks}"}),new _({renderType:"Bare",visible:"{setting>/cropMarks}",items:[new _({direction:$.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:"Weight:"}),new T({min:0,step:.05,displayValuePrecision:2,value:"{setting>/cropMarksWeight}",fieldWidth:"7rem",description:"pt"})]}),new _({direction:$.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:"Offset:"}),this._oInputCropMarksOffset=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeCropMarksInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/cropMarksOffset")),fieldWidth:"7rem",description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin")]};Q.prototype._createCompression=function(){var t=this._oModel.getProperty("/exportAsJPEG");return[new o({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),new f({columns:2,selectedIndex:t?0:1,buttons:[new P({id:"jpeg",text:"JPEG",selected:"{setting>/exportAsJPEG}"}),new P({id:"png",text:"PNG"})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_QUALITY"),visible:"{setting>/exportAsJPEG}"}),this._createCompressionComboBox(),this._createCompressionSlider().addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingBottomMargin"),new x({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_PNG_WARNING"),showIcon:true,type:"Warning",visible:{path:"setting>/exportAsJPEG",type:"sap.ui.model.type.Boolean",formatter:function(t){return!t}}}).addStyleClass("sapGanttPrintingBottomMargin")]};Q.prototype._createOptionsForm=function(){return new _({renderType:"Bare",direction:$.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),this._radioGroupPage=new f({columns:2,selectedIndex:this._oModel.getProperty("/multiplePage")?0:1,select:this._onChangeExportTypes.bind(this),buttons:[new P({id:"Multiple",text:this._oRb.getText("GNT_PRNTG_MULTIPLE_PAGE"),selected:"{setting>/multiplePage}"}),new P({id:"Single",text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")}),this._radioGroupOrientation=new f({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this,false),buttons:[new P({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}"}),new P({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new x({text:"{setting>/orientationMessage}",type:"Information",showIcon:true,visible:"{setting>/showOrientationMessage}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new o({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")}),this._createPaperComboBox(false),this._createPaperSizeFields(false).addStyleClass("sapGanttPrintingBottomMargin"),new x({text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_QUALITY"),type:"Information",showIcon:true,visible:"{setting>/qualityWarning}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new o({text:this._oRb.getText("GNT_PRNTG_DURATION")}),this._createDurationComboBox(false),this._createDatePicker(false).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_SCALE"),visible:"{setting>/multiplePage}"}),this._createScale().addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE"),visible:"{setting>/multiplePage}"}),this._createPageRange().addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER")}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}"),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}").addStyleClass("sapGanttPrintingBottomMargin"),this._createLabelWithSwitch(this._oRb.getText("GNT_PRNTG_SHOW_PAGE_NUMBER"),"{setting>/showPageNumber}").addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin(false)),this._createPanel(this._oRb.getText("GNT_PRNTG_COMPRESSION"),this._createCompression())]})};Q.prototype._createSinglePageForm=function(){return new _({renderType:"Bare",direction:$.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")}),this._radioGroupOrientation=new f({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this,true),buttons:[new P({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}"}),new P({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")}),this._createPaperComboBox(true),this._createPaperSizeFields(true).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_DURATION")}),this._createDurationComboBox(true),this._createDatePicker(true).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER")}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}",true),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}",true).addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin(true))]})};Q.prototype._createDialogContent=function(t){var e;if(t){e=new _({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new _({renderType:"Bare",layoutData:new u({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:$.Column,items:[new _({renderType:"Bare",layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oPdfDialogPreview=new I({content:'<div class="sapGanttPdfPreviewContentDiv"><div id="sapGanttPdfPreviewDiv"class="sapGanttPdfPreviewPageDiv"></div></div>'})]}).addStyleClass("sapGanttPrintingPreviewContent"),new c({horizontal:false,vertical:true,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createSinglePageForm().addStyleClass("sapGanttPrintingDialogSettings")]})]})}else{e=new _({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new _({renderType:"Bare",layoutData:new u({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:$.Column,items:[new _({renderType:"Bare",layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oHTMLDialogPreview=new I({content:'<div class="sapGanttPrintingPreviewContentDiv"><div class="sapGanttPrintingPreviewPageDiv"></div></div>'}),new _({renderType:"Bare",justifyContent:"Center",alignItems:"Center",layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"6rem"}),items:[this._oButtonFirst=new g({icon:"sap-icon://close-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonFirst.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonPrevious=new g({icon:"sap-icon://navigation-left-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonPrevious.bind(this),type:"Transparent"}),new r({textAlign:"Center",visible:"{setting>/multiplePage}",width:"7.25rem",text:{parts:[{path:"setting>/previewPageNumber"},{path:"setting>/lastPageNumber"}],formatter:function(t,e){return e?this._oRb.getText("GNT_PRNTG_OF",[t,e]):t.toString()}.bind(this)}}).addStyleClass("sapGanttPrintingPreviewText"),this._oButtonNext=new g({icon:"sap-icon://navigation-right-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonNext.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonLast=new g({icon:"sap-icon://open-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonLast.bind(this),type:"Transparent"})]}).addStyleClass("sapGanttPrintingPreviewFooter")]}).addStyleClass("sapGanttPrintingPreviewContent"),new c({horizontal:false,vertical:true,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createOptionsForm().addStyleClass("sapGanttPrintingDialogSettings")]})]});this._updatePageNumberButtons()}return e};Q.prototype._createAndOpenDialog=function(t){var e=t?this.exportSinglePage:this.export;this._oDialog=new h({title:this._oRb.getText("GNT_PRNTG_PDF_EXPORT_TITLE"),contentWidth:"100%",contentHeight:"100%",horizontalScrolling:false,verticalScrolling:false,content:[this._createDialogContent(t)],buttons:[this._oButtonExport=new g({text:this._oRb.getText("GNT_PRNTG_EXPORT"),type:d.ButtonType.Emphasized,press:e.bind(this)}),this._oButtonClose=new g({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this.close()}.bind(this)})]}).addStyleClass("sapGanttPrintingDialog");this._oDialog.onsapescape=function(t){this.close();t.preventDefault();t.stopPropagation()}.bind(this);this._oDialog.setModel(this._oModel,"setting");this._oDialog.open();this._sResizeHandlerId=W.register(this._oDialog,this._onResize.bind(this))};Q.prototype._openProgressDialog=function(){this._oProgressIndicator=new l({state:"Information",percentValue:0});this._oProgressText=new r({text:this._oRb.getText("GNT_PRNTG_PDF_PREVIEW"),textAlign:"Center"}).addStyleClass("sapGanttPrintingProgressText");this._oProgressIndicatorBox=new _(this.getId()+"-progressFlexBox",{direction:"Column",alignItems:"Center",items:[this._oProgressText,this._oProgressIndicator],renderType:"Bare"}).addStyleClass("sapGanttPrintingProgressBox");this._oProgressDialog=new h(this.getId()+"-progressDialog",{contentWidth:"25%",showHeader:false,content:[this._oProgressIndicatorBox],buttons:[new g({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this._closeProgressIndicator()}.bind(this)})]});this._oProgressDialog.open()};return Q});
//# sourceMappingURL=GanttPrinting.js.map