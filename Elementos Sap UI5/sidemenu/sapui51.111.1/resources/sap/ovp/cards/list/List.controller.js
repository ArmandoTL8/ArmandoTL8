sap.ui.define(["sap/ovp/cards/generic/Card.controller","sap/ui/thirdparty/jquery","sap/ui/model/json/JSONModel","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/CommonUtils","sap/ovp/cards/AnnotationHelper","sap/ovp/app/OVPUtils","sap/ovp/app/OVPLogger","sap/ovp/filter/FilterUtils","sap/ui/core/Core","sap/ovp/cards/Integration/IntegrationCard","sap/m/MessageBox","sap/ovp/app/resources"],function(e,jQuery,t,a,i,n,s,o,r,d,l,h,p){"use strict";var c=new o("OVP.list.List");return e.extend("sap.ovp.cards.list.List",{counter:0,arrayLength:0,minMaxModel:{},bdataLoadedToEnableAddToInsight:false,onInit:function(){e.prototype.onInit.apply(this,arguments);this.counter=0;this.minMaxModel=new t;this.minMaxModel.setData({minValue:0,maxValue:0});this.getView().setModel(this.minMaxModel,"minMaxModel");var a=this;this.eventhandler=function(e,t,i){r.applyFiltersToV2Card(i,a)};this.GloabalEventBus=d.getEventBus();if(this.oMainComponent&&this.oMainComponent.isMacroFilterBar){this.GloabalEventBus.subscribe("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",a.eventhandler)}},onContactDetailsLinkPress:function(e){var t,a,i;a=e.getSource();t=a.getParent().getAggregation("items")[0];i=a.getBindingContext();if(!i){return}t.bindElement(i.getPath());t.openBy(a)},onAfterRendering:function(){e.prototype.onAfterRendering.apply(this,arguments);var t=this.getCardPropertiesModel().getProperty("/imageSupported");var i=this.getCardPropertiesModel().getProperty("/densityStyle");if(t){var n=this.byId("ovpList");n.attachUpdateFinished(function(){this._addImageCss(i)}.bind(this))}if(!a.checkIfAPIIsUsed(this)&&this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var s=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var o=Math.max(s.dashboardLayout.headerHeight,this.getHeaderHeight());var r=this.oDashboardLayoutUtil.getCardDomId(this.cardId);var d=document.getElementById(r);if(!s.dashboardLayout.autoSpan){d.getElementsByClassName("sapOvpWrapper")[0].style.height=s.dashboardLayout.rowSpan*this.oDashboardLayoutUtil.ROW_HEIGHT_PX-(o+2*this.oDashboardLayoutUtil.CARD_BORDER_PX)+"px"}if(s.dashboardLayout.showOnlyHeader){d.classList.add("sapOvpMinHeightContainer")}}var l=this.getCardItemsBinding();if(l&&l.getPath()){l.attachDataReceived(this.onDataReceived.bind(this))}},onDataReceived:function(){this.bdataLoadedToEnableAddToInsight=true},_addImageCss:function(e){var t=this.byId("ovpList");var a=t.getItems();var i=false;var n=t.getDomRef().getAttribute("class");if(e==="cozy"){n=n+" sapOvpListImageCozy"}else{n=n+" sapOvpListImageCompact"}t.getDomRef().setAttribute("class",n);a.forEach(function(e){if(e.getIcon().indexOf("icon")!=-1){i=true}});a.forEach(function(t){var a=t.getDomRef();var n;if(a&&a.children[0]&&a.children[0].children[0]){n=a.children[0].children[0]}var s=t.getDescription();var o=t.getIcon();var r=i;var d=t.getTitle();var l=d.split(" ").map(function(e){return e?e[0].toUpperCase():""}).join("").substring(0,2);if(o!=""&&o.indexOf("icon")==-1){i=false}if(i&&a.children[0]){jQuery(a.children[0]).addClass("sapOvpIconListItem")}else if(a.children[0]){jQuery(a.children[0]).addClass("sapOvpImageListItem")}if(n&&e==="cozy"&&i===false){if(n){var h=n.getAttribute("class");h=h+" sapOvpImageCozy";n.setAttribute("class",h)}}var p="";if(i===true&&s===""){p=e==="compact"?"sapOvpListWithIconNoDescCompact":"sapOvpListWithIconNoDescCozy"}else if(i===false&&s===""){p=e==="compact"?"sapOvpListWithImageNoDescCompact":"sapOvpListWithImageNoDescCozy"}else{p=e==="compact"?"sapOvpListWithImageIconCompact":"sapOvpListWithImageIconCozy"}t.addStyleClass(p);if(a&&a.children[0]&&o===""&&a.children[0].id!=="ovpIconImagePlaceHolder"){var c=document.createElement("div");c.innerText=l;c.setAttribute("id","ovpIconImagePlaceHolder");c.className=i===true?"sapOvpIconPlaceHolder":"sapOvpImagePlaceHolder";if(i===false&&e==="cozy"){c.className=c.className+" sapOvpImageCozy"}a.insertBefore(c,a.children[0])}i=r})},onListItemPress:function(e){var t=s.bCRTLPressed?s.constants.explace:s.constants.inplace;s.bCRTLPressed=false;if(a.checkIfAPIIsUsed(this)){if(this.checkAPINavigation()){i.onContentClicked(e)}}else{var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(e.getSource().getBindingContext(),n[0],t)}},getCardItemsBinding:function(){var e=this.getView().byId("ovpList");return e&&e.getBinding("items")},_getMinMaxObjectFromContext:function(e){this.counter++;var t=this.getEntityType(),a=this.getCardPropertiesModel().getProperty("/annotationPath"),i=t[a],s=this.getMetaModel().createBindingContext(t.$path+"/"+a),o={minValue:0,maxValue:0};if(n.isFirstDataPointPercentageUnit(s,i)){o.minValue=0;o.maxValue=100;o.isPercentage=true;return o}var r=n.getFirstDataPointValue(s,i),d=this.getView().byId("ovpList"),l=d.getBinding("items"),h=this.getModel(),p=l.getCurrentContexts();for(var c=0;e?c<e:c<p.length;c++){var g=h.getOriginalProperty(r,p[c]),m=parseFloat(g,10);if(m<o.minValue){o.minValue=m}else if(m>o.maxValue){o.maxValue=m}}return o},_updateMinMaxModel:function(e){var t=this._getMinMaxObjectFromContext(e);this.minMaxModel.setData({minValue:t.minValue,maxValue:t.maxValue,isPercentage:t.isPercentage||false});this.minMaxModel.refresh();return t},returnBarChartValue:function(e){this._updateMinMaxModel();var t=parseFloat(e,10);return t},getCardItemBindingInfo:function(){var e=this.getView().byId("ovpList");return e.getBindingInfo("items")},resizeCard:function(e,t){var a,i,n;try{var s=document.getElementById(this.oDashboardLayoutUtil.getCardDomId(this.cardId)),o=this.getCardItemBindingInfo(),r=this.getHeaderHeight(),d=this.getView().byId("ovpCardContentContainer").getDomRef();if(e.showOnlyHeader){d.classList.add("sapOvpContentHidden");a=0}else{d.classList.remove("sapOvpContentHidden");n=r+t.dropDownHeight;i=e.rowSpan*e.iRowHeightPx-n;a=Math.abs(Math.floor(i/t.itemHeight));s.style.height=e.rowSpan*e.iRowHeightPx+"px"}d.style.height=e.rowSpan*e.iRowHeightPx-(r+2*e.iCardBorderPx)+"px";if(a!==o.length){o.length=a;e.noOfItems=o.length;this._updateMinMaxModel(o.length);this.getCardItemsBinding().refresh()}else{this._handleCountHeader()}}catch(e){c.warning("OVP resize: "+this.cardId+" catch "+e.toString())}},onShowInsightCardPreview:function(){var e=this.getView();var t=e.getController();var a=t.oCardComponentData;var i=this;if(this.checkIBNNavigationExistsForCard()){l.showCard({entitySet:t.entitySet,entityType:t.entityType,cardComponentName:"List",cardComponentData:a,cardComponent:t.oCardComponent,itemBindingInfo:i.getCardItemBindingInfo(),view:e}).then(function(e){i.saveGeneratedCardManifest(e)})}else{h.error(p.getText("INT_IBN_NAVIGATION_NOT_FOUND_ERROR_MESSAGE_TEXT"))}}})});
//# sourceMappingURL=List.controller.js.map