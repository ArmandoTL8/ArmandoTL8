sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/v4/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/app/OVPLogger","sap/base/util/isEmptyObject","sap/ovp/helpers/V4/MetadataAnalyzer","sap/ovp/cards/Integration/Helpers/AnalyticalCard"],function(jQuery,e,t,a,r,i,n,o,s,l,u,f,c,v,p,g,m,A,d,h,P,y){"use strict";var E={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"$Type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut",V4_ANNOTATION:"annotations"};var C={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var _=["year","yearweek","yearmonth","yearquarter"];var T=[E.COLUMNSTACKED_CHARTTYPE,E.DONUT_CHARTTYPE,E.COLUMN_CHARTTYPE,E.BAR_CHARTTYPE,E.VERTICALBULLET_CHARTTYPE,E.LINE_CHARTTYPE,E.COMBINATION_CHARTTYPE,E.BUBBLE_CHARTTYPE];var I=[E.COLUMNSTACKED_CHARTTYPE];var N;var R=new d("OVP.charts.VizAnnotationManager");function D(e,t,a){var r=e.getMetaModel().getObject("/"+t+"/"+a+"@");return r["@com.sap.vocabularies.Common.v1.IsCalendarYear"]||r["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||r["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||r["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]}function b(t,r,i,n,o,s,l){var u="{";if(!t||!t.getSetting("ovpCardProperties")){R.error(C.ANALYTICAL_CONFIG_ERROR);u+="}";return u}var f=t.getSetting("dataModel");var c;if(l&&l.$EnumMember){c=l.$EnumMember.split("/");if(c&&c[1]!="Donut"&&o===undefined){return null}}var v=[];var p=[];var g=[];var d=[];var h=[];var y=[];var _=[];var T=[];var I=i&&i.Parameters;var N=n&&n.SortOrder;var D=n&&n.MaxItems,b=null;var V;var L;var Y;var x=null;var F=E.TEXT_KEY;var $=E.TEXT_KEY_V4;var U=E.UNIT_KEY;var K="@"+E.UNIT_KEY_V4_ISOCurrency;var w="@"+E.UNIT_KEY_V4_Unit;var B={};if(typeof D==="number"||typeof D==="string"&&!isNaN(D)){b=parseInt(D,10)}if(b){if(b==="0"){R.error("OVP-AC: Analytic card Error: maxItems is configured as "+b);u+="}";return u}if(!/^\d+$/.test(b)){R.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");u+="}";return u}}var k=t.getSetting("ovpCardProperties"),G=k.getProperty("/parameters");var j=k.getProperty("/metaModel");var W=k.getProperty("/measureAggregate");var X=P.getEntitySetName(j,r.$Type);I=I||!!G;if(I){var q=a.resolveParameterizedEntitySet(f,r,i,G);u+="path: '"+q+"'"}else{u+="path: '/"+X+"'"}var Q=[];x=t.getSetting("ovpCardProperties").getProperty("/entitySet");if(!f||!x){return u}var Z=ce(f,x);_e(f,Z,r.$Type);var J=t.getSetting("ovpCardProperties").getProperty("/cardLayout");var ee=1,te;var ae=z();var re;var ie;if(o&&J&&J.colSpan&&J.colSpan>1){te=J.colSpan-ee;for(var ne in ae){if((ie=ae[ne].reference)&&ae[ie]){var oe=A({},ae[ie]);ae[ne]=oe}if(ne===c[1]||ae[ne].time&&ae[ne].time.type===c[1].toLowerCase()){re=ae[ne];break}}var se=H(o,re,f,x);if(se){re=re.time}else{re=re.default}var le=t.getSetting("ovpCardProperties").getProperty("/dataStep");if(!le){if(re.resize&&re.resize.hasOwnProperty("dataStep")&&!isNaN(re.resize.dataStep)){le=re.resize.dataStep}}le=parseInt(le,10);if(te>0&&le&&!isNaN(le)){b=parseInt(b,10)+le*te}}if(i){var k=t.getSetting("ovpCardProperties");Q=a.getFilters(k,i)}var ue=t.getSetting("ovpCardProperties").getProperty("/entityType");m(s,function(e,t){V=t.Measure.$PropertyPath;if(t.DataPoint&&t.DataPoint.AnnotationPath){var a=ue[t.DataPoint.AnnotationPath.substring(1)];if(a.ForecastValue&&(a.ForecastValue.PropertyPath||a.ForecastValue.Path)){var r=a.ForecastValue.PropertyPath||a.ForecastValue.Path;h.push(a.ForecastValue.PropertyPath||a.ForecastValue.Path);if(Z&&Z[r]){var i;if(Z[r].annotations&&Z[r].annotations[K]){i=Z[r].annotations[K].$Path?Z[r].annotations[K].$Path:undefined}else if(Z[r].annotations&&Z[r].annotations[w]){i=Z[r].annotations[w].$Path?Z[r].annotations[w].$Path:undefined}else if(Z[r][U]){i=Z[r][U]}if(i){if((y?Array.prototype.indexOf.call(y,i):-1)===-1){y.push(i)}}}}if(a.TargetValue&&(a.TargetValue.PropertyPath||a.TargetValue.Path)){var n=a.TargetValue.PropertyPath||a.TargetValue.Path;h.push(a.TargetValue.PropertyPath||a.TargetValue.Path);if(Z&&Z[n]){var i;if(Z[n].annotations&&Z[n].annotations[K]){i=Z[n].annotations[K].$Path?Z[n].annotations[K].$Path:undefined}else if(Z[n].annotations&&Z[n].annotations[w]){i=Z[n].annotations[w].$Path?Z[n].annotations[w].$Path:undefined}else if(Z[n][U]){i=Z[n][U]}if(i){if((y?Array.prototype.indexOf.call(y,i):-1)===-1){y.push(i)}}}}}h.push(V);if(Z&&Z[V]){if(Z[V][$]){if(Z[V][$].String&&V!=Z[V][$].String){h.push(Z[V][$].String?Z[V][$].String:V)}else if(Z[V][$].Path&&V!=Z[V][$].Path){h.push(Z[V][$].Path?Z[V][$].Path:V)}}else if(Z[V][F]&&V!=Z[V][F]){h.push(Z[V][F]?Z[V][F]:V)}}if(Z&&Z[V]){var i;if(Z[V].annotations&&Z[V].annotations[K]){i=Z[V].annotations[K].$Path?Z[V].annotations[K].$Path:undefined}else if(Z[V].annotations&&Z[V].annotations[w]){i=Z[V].annotations[w].$Path?Z[V].annotations[w].$Path:undefined}else if(Z[V][U]){i=Z[V][U]}if(i){if((y?Array.prototype.indexOf.call(y,i):-1)===-1){y.push(i)}}}});m(o,function(e,t){V=t.Dimension.$PropertyPath;v.push(V);if(Z&&Z[V]){if(Z[V]["annotations"]&&Z[V]["annotations"]["@"+$]){if(typeof Z[V]["annotations"]["@"+$]==="string"&&Z[V]["annotations"]["@"+$]&&V!=Z[V]["annotations"]["@"+$]){v.push(Z[V]["annotations"]["@"+$])}else if(Z[V]["annotations"]["@"+$].$Path&&V!=Z[V]["annotations"]["@"+$].$Path){Y=Z[V]["annotations"]["@"+$].$Path;var a=Y.split("/");if(a.length>1){L=O(j,ue,Y);if(L!==""){v.push(Y);p.push(L);d=M(j,ue,Y);if(d.length>0){g=g.concat(d)}}}else{v.push(Y?Y:V)}}}else if(Z[V][F]&&V!=Z[V][F]){v.push(Z[V][F]?Z[V][F]:V)}}});if(g.length>0){var fe=0;while(fe<g.length){if(v.indexOf(g[fe])!==-1){g.splice(fe,1)}else{fe++}}}if(h.length>0){m(h,function(e,t){t+="Aggregate";B[t]=true})}if(v.length>0){m(v,function(e,t){B[t]=true})}if(N){var ve=n.SortOrder;if(!ve.length){ve=e.getSortAnnotationCollection(f,n,r)}if(ve.length<1){R.warning(C.CARD_WARNING+C.SORTORDER_WARNING)}else{var pe="";var ge;var me;var Ae;for(var de=0;de<ve.length;de++){ge=ve[de];Ae=ge.Property.$PropertyPath;if(h.includes(Ae)){Ae+="Aggregate"}T.push(Ae);if(typeof ge.Descending==="undefined"){me="true"}else{var he=ge.Descending.Bool||ge.Descending.Boolean;if(!he){R.warning(C.CARD_WARNING+C.BOOLEAN_ERROR);me="true"}else{me=he.toLowerCase()==="true"?"true":"false"}}pe=pe+"{path: '"+Ae+"',descending: "+me+"},"}u+=", sorter: ["+pe.substring(0,pe.length-1)+"]"}}var Pe=S(y,v);if(T.length>0){m(T,function(e,t){if(!B.hasOwnProperty(t)){Pe.push(t)}})}u+=", parameters: {$apply:'groupby(("+Pe.join(",")+"),";u+="aggregate(";var ye=[];h.forEach(function(e,t){var a=W&&W["Axis"+(t+1)];var r=a?a:"sum";var i=[e," with ",r," as ",e,"Aggregate"].join("");ye.push(i)});u+=ye.join(",");u+="))";var Ee=j.getObject("/"+r.$Type);if(Ee){var Ce=a.getRequestFields(n);if(Ce&&Ce.length>0){m(Ce,function(e,t){if(!B.hasOwnProperty(t)){B[t]=true;_.push(t)}});if(_.length>0){u+=","+_.join(",")}}}if(p.length>0){u+="'"+","+" expand:'"+p.join(",")}var Te=a.checkFilterPreference(t.getSetting("ovpCardProperties"));if(Te){u+="', custom: {cardId: '"+t.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}"}else{u+="'}"}if(c&&c[1]==="Donut"&&o===undefined){u+=", length: 1"}else if(c&&c[1]==="Donut"&&o&&b){u+=", length: "+(parseInt(b,10)+1)}else if(b){u+=", length: "+b}if(Q.length>0&&Pe.length>0){var Ie=Q.every(function(e){return Pe.indexOf(e.path)!==-1});var Ne=Ie?JSON.stringify(Q):"[]";u+=", filters: "+Ne}u+="}";return u}b.requiresIContext=true;function O(e,t,a){var r="";var i=a.split("/");if(i.length>1){for(var n=0;n<i.length-1;n++){var o=e.getODataAssociationEnd(t,i[n]);if(o){t=e.getODataEntityType(o.type);if(r){r=r+"/"}r=r+i[n]}else{return r}}}return r}function S(e,t){var a=e.length>0?t.concat(e):t;return a.filter(function(e,t){return a.indexOf(e)===t})}function M(e,t,a){var r=[];var i=[];var n;var o=a.split("/");if(o.length>1){for(var s=0;s<o.length-1;s++){var l=e.getODataAssociationEnd(t,o[s]);if(l){t=e.getODataEntityType(l.type);if(t){i=t&&t.key&&t.key.propertyRef;for(var u=0;u<i.length;u++){n=o[s]+"/"+i[u].name;r.push(n)}}}}}return r}function V(e,t){var a=false;var r;if(e.DataPoint&&e.DataPoint.AnnotationPath){var i=t[e.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){a=true;r=e}}if(a===true){return r}else{R.warning(C.CARD_WARNING+C.INVALID_FORECAST);return undefined}}function L(e,t){var a=false;var r;if(e.DataPoint&&e.DataPoint.AnnotationPath){var i=t[e.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){a=true;r=e}}if(a===true){return r}else{R.warning(C.CARD_WARNING+C.INVALID_TARGET);return undefined}}function Y(e,t){var a;m(t,function(t,r){if(r.name===e){if(r["com.sap.vocabularies.Common.v1.Label"]){a=r["com.sap.vocabularies.Common.v1.Label"].String?r["com.sap.vocabularies.Common.v1.Label"].String:r["com.sap.vocabularies.Common.v1.Label"].Path}else if(r["sap:label"]){a=r["sap:label"]}return false}});return a}function x(e,t){var a=true;if(t==="line"||t==="column"||t==="bar"){m(e,function(e,t){if(t.getUid()==="valueAxis"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){a=false;R.warning(C.CARD_WARNING+C.INVALID_DIMMEAS);return false}}})}else if(t==="vertical_bullet"){m(e,function(e,t){if(t.getUid()==="actualValues"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){a=false;R.warning(C.CARD_WARNING+C.INVALID_DIMMEAS);return false}}})}if(a===true){return true}}function F(e,t,a){var r=E.TYPE_KEY;if(!e||!e[t]||!e[t][r]){return a}var i=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var n=e[t][r];if((i?Array.prototype.indexOf.call(i,n):-1)!==-1){return Number(a)}return a}function $(e){if(e){return e}return""}function U(e){var t={locale:function(){},format:function(e,t){var a="";if(t){a=t.split("/")}if(a.length>0){var n,o;if(a.length===3){n=Number(a[1]);o=Number(a[2]);if(isNaN(n)){n=-1}if(isNaN(o)){o=0}}else{n=2;o=0}if(a[0]==="axisFormatter"||a[0]==="ShortFloat"){var l;l=r.getFloatInstance({style:"short",minFractionDigits:n,maxFractionDigits:n?n:1});if(a[0]==="ShortFloat"){l=r.getFloatInstance({style:"short",minFractionDigits:n,maxFractionDigits:n})}if(n===-1){l=r.getFloatInstance({style:"short"})}return l.format(Number(e))}else if(a[0]==="tooltipNoScaleFormatter"){var u=r.getFloatInstance({style:"short",currencyCode:false,shortRefNumber:o,showScale:false,minFractionDigits:n,maxFractionDigits:n});if(n===-1){u=r.getFloatInstance({minFractionDigits:0,currencyCode:false})}return u.format(Number(e))}else if(a[0]==="CURR"){var f=r.getCurrencyInstance({style:"short",currencyCode:false,minFractionDigits:n,maxFractionDigits:n});if(n===-1){f=r.getCurrencyInstance({style:"short",currencyCode:false})}return f.format(Number(e))}else if(a[0].search("%")!==-1){var c=r.getPercentInstance({style:"short",minFractionDigits:n,maxFractionDigits:n});if(n===-1){c=r.getPercentInstance({style:"short",minFractionDigits:1,maxFractionDigits:1})}e=c.format(Number(e));return e}}if(e.constructor===Date){var v=i.getDateTimeInstance({pattern:t});if(t==="YearMonthDay"){v=i.getDateInstance({style:"medium"})}if(t==="YearMonth"||t==="MMM"){v=i.getDateTimeInstance({format:"MMM"})}if(t==="YearQuarter"||t==="Quarter"){v=i.getDateTimeInstance({format:"QQQ"})}if(t==="YearWeek"||t==="Week"){v=i.getDateTimeInstance({format:"www"})}var p=s.getApp();var g=p&&p.bResetChartAxisFormatter;if(g&&t==="hh:mm"){var m=e.toLocaleTimeString();var A=m.split(":");e=A[0]+":"+A[1];return e}var d=g?false:true;e=v.format(new Date(e),d)}return e}};n.numericFormatter(t)}function K(e,t){var a=e.getModel();var r=e.getVizType();if(r!="line"&&r!="bubble"){return}if(!t){t=r==="line"?"categoryAxis":"valueAxis"}var i=e.getModel("ovpCardProperties").getProperty("/entitySet");if(!a||!i){return}var n=ce(a,i);var o=e.getFeeds();for(var s=0;s<o.length;s++){if(o[s].getUid()===t){var l=o[s].getValues();if(!l){return}for(var u=0;u<l.length;u++){if(n[l[u][E.TYPE_KEY]]!="Edm.DateTime"){return}}e.setVizProperties({categoryAxis:{title:{visible:false}}});var f=e&&e.getModel("ovpCardProperties");if(f&&f.getProperty("/bInsightEnabled")){var c=e&&e.getId();y.setVizPropertyMap(c,{categoryAxis:{title:{visible:false}}})}return}}}function w(e,t,a,r,i,n){r=typeof r==="undefined"?false:r;var o=false;var s;if(!e&&r){R.error(i+C.CARD_ERROR+a+C.IS_MANDATORY);return o}if(!e){R.warning(i+C.CARD_WARNING+a+C.IS_MISSING);o=true;return o}s=t["@"+e];if(!s||typeof s!=="object"){var l=r?R.error:R.warning;l(i+C.CARD_ERROR+"in "+a+". (@"+e+" "+C.NOT_WELL_FORMED);return o}if(n&&n==="sap.ovp.cards.v4.charts.analytical.analyticalChart"&&a==="Chart Annotation"&&(!s.ChartType||!s.ChartType.$EnumMember)){R.error(i+C.CARD_ERROR+C.MISSING_CHARTTYPE+C.CHART_ANNO);return o}o=true;return o}function B(e){var t=false;if(!e){return t}var a;var r;var i;var n;var o;var s;var l;var u="";var f;var c=e.getView();if(c){u="["+c.getId()+"] "}if(!(f=e.getCardPropertiesModel())){R.error(u+C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return t}l=f.getProperty("/entityType");var v=e.getMetaModel();var p=v.getData().$Annotations[l.$Type];if(!l||h(l)){R.error(u+C.CARD_ERROR+"in "+C.CARD_ANNO);return t}a=f.getProperty("/selectionAnnotationPath");r=f.getProperty("/chartAnnotationPath");n=f.getProperty("/presentationAnnotationPath");o=f.getProperty("/identificationAnnotationPath");s=f.getProperty("/dataPointAnnotationPath");i=f.getProperty("/contentFragment");t=w(a,p,"Selection Variant",false,u);t=w(r,p,"Chart Annotation",true,u,i)&&t;t=w(n,p,"Presentation Variant",false,u)&&t;t=w(o,p,"Identification Annotation",true,u)&&t;t=w(s,p,"Data Point",false,u)&&t;return t}function k(e,t,a){}function z(t){return e.getConfig(t)}function H(e,t,a,r){var i=false;var n;var o;var s;var l;var u;var f;if(!t.time||h(t.time)){return i}if(!e){return i}for(var c=0;c<e.length;c++){if(!e[c].Dimension||!(o=e[c].Dimension.$PropertyPath)){return i}n=ce(a,r);if(n&&n[o]){s=n[o][E.TYPE_KEY];l=n[o][E.DISPLAY_FORMAT_KEY];u=n[o][E.SEMANTICS_KEY];f=D(a,r,o)}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(l&&l.toLowerCase()==="date"){i=true}}else{i=true}}if(s==="Edm.String"&&(f||u&&_.indexOf(u)>-1)){i=true}if(i){e.unshift(e.splice(c,1)[0]);break}}return i}function G(e,t,a){var r="";var i=z(t);var n,o;if(!i){return r}r=i.default.type;n=e.getSetting("dataModel");o=e.getSetting("ovpCardProperties").getProperty("/entitySet");if(H(a,i,n,o)){r=i.time.type}return r}G.requiresIContext=true;function j(e,t,a){if(!e.length){return}var r=a==="dimension"?"Dimension":"Measure";var i=[];m(e,function(e,t){if(!t||!t[r]||!t[r].PropertyPath){R.error(C.INVALID_CHART_ANNO);return false}i.push(t[r].PropertyPath)});var n=jQuery.map(t.feeds,function(e){if(e.type===a){if(e.role){return e.role.split("|")}return[]}});n=jQuery.grep(n,function(e,t){return(n?Array.prototype.indexOf.call(n,e):-1)===t}).join(", ");R.error(C.CARD_ERROR+C.INVALID_REDUNDANT+a+"(s) "+i.join(", ")+". "+C.ALLOWED_ROLES+t.type+C.CHART_IS+n)}function W(e,t){var a;if(e){if(e.String){a=e.String}else if(e.Boolean||e.Bool){a=X(e)}else{a=q(e,t)}}return a}function X(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function q(e,t){var a;if(e){if(e.String){a=Number(e.String)}else if(e.Int){a=Number(e.Int)}else if(e.Decimal){a=Number(e.Decimal)}else if(e.Double){a=Number(e.Double)}else if(e.Single){a=Number(e.Single)}}if(t){var i=r.getFloatInstance({style:"short",minFractionDigits:2,maxFractionDigits:2});if(a){a=i.format(Number(a))}}return a}function Q(e,t){function r(e){if(e){if(e.Path){return"{path:'"+e.Path+"'}"}else{return W(e)}}else{return""}}var i=e[e.measureNames];if(t&&t.CriticalityCalculation&&t.CriticalityCalculation.ImprovementDirection){var n=t.CriticalityCalculation.ImprovementDirection.EnumMember;var o=r(t.CriticalityCalculation.DeviationRangeLowValue);var s=r(t.CriticalityCalculation.DeviationRangeHighValue);var l=r(t.CriticalityCalculation.ToleranceRangeLowValue);var u=r(t.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(i,n,o,s,l,u,a.criticalityConstants.StateValues)}else{var f=t.Criticality.EnumMember;var c=f?f.split("/"):[];if(c){return c[1]}}}function Z(e,t,a){var r,i;m(t,function(t,a){if(a["com.sap.vocabularies.Common.v1.Label"]&&a["com.sap.vocabularies.Common.v1.Label"].String===e.measureNames){r=a.name;return false}else if(a["com.sap.vocabularies.Common.v1.Label"]&&a["com.sap.vocabularies.Common.v1.Label"].Path===e.measureNames){r=a.name;return false}else if(a["sap:label"]===e.measureNames){r=a.name;return false}});m(a,function(e,t){if(t.Measure.PropertyPath===r){if(!t.DataPoint||!t.DataPoint.AnnotationPath){return false}i=t.DataPoint.AnnotationPath;return false}});return i}function J(e,t){if(e){if(e.Path){return e.Path}else{return W(e,t)}}else{return""}}function ee(e,t){function a(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var r=false;m(e,function(e,i){if(i.DataPoint&&i.DataPoint.AnnotationPath){var n=t[i.DataPoint.AnnotationPath.substring(1)];if(n&&n.CriticalityCalculation&&n.CriticalityCalculation.ImprovementDirection&&n.CriticalityCalculation.ImprovementDirection.EnumMember){var o=n.CriticalityCalculation.ImprovementDirection.EnumMember;var s=J(n.CriticalityCalculation.DeviationRangeLowValue);var l=J(n.CriticalityCalculation.DeviationRangeHighValue);var u=J(n.CriticalityCalculation.ToleranceRangeLowValue);var f=J(n.CriticalityCalculation.ToleranceRangeHighValue);if(a(o,"Minimize")||a(o,"Minimizing")){if(f&&l){r=true;return false}else{R.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}else if(a(o,"Maximize")||a(o,"Maximizing")){if(u&&s){r=true;return false}else{R.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}else if(a(o,"Target")){if(u&&s&&f&&l){r=true;return false}else{R.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}}else if(n&&n.Criticality){r=true;return false}else{R.warning(C.CARD_WARNING+C.INVALID_IMPROVEMENT_DIR)}}});if(r===true&&e.length>1){R.warning(C.CARD_WARNING+C.INVALID_SEMANTIC_MEASURES)}return r}function te(e,t,a,r){function i(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var n=[null,null];var o=true;var s=e.Measure.PropertyPath;if(a[s]){if(a[s][E.LABEL_KEY_V4]){s=fe(a[s][E.LABEL_KEY_V4].String?a[s][E.LABEL_KEY_V4].String:a[s][E.LABEL_KEY_V4].Path,r,a)}else if(a[s][E.LABEL_KEY]){s=a[s][E.LABEL_KEY]}else if(s){s=s}}var l=e.DataPoint.AnnotationPath;var u=t[l.substring(1)];if(!u.CriticalityCalculation||!u.CriticalityCalculation.ImprovementDirection||!u.CriticalityCalculation.ImprovementDirection.EnumMember){return n}var f=u.CriticalityCalculation.ImprovementDirection.EnumMember;var c=J(u.CriticalityCalculation.DeviationRangeLowValue,o);var v=J(u.CriticalityCalculation.DeviationRangeHighValue,o);var g=J(u.CriticalityCalculation.ToleranceRangeLowValue,o);var m=J(u.CriticalityCalculation.ToleranceRangeHighValue,o);if(i(f,"Minimize")||i(f,"Minimizing")){if(m&&v){n[0]=p.getText("MINIMIZING_LESS",[s,m]);n[1]=p.getText("MINIMIZING_MORE",[s,v]);n[2]=p.getText("MINIMIZING_CRITICAL",[m,s,v])}}else if(i(f,"Maximize")||i(f,"Maximizing")){if(g&&c){n[0]=p.getText("MAXIMISING_MORE",[s,g]);n[1]=p.getText("MAXIMISING_LESS",[s,c]);n[2]=p.getText("MAXIMIZING_CRITICAL",[c,s,g])}}else if(i(f,"Target")){if(g&&c&&m&&v){n[0]=p.getText("TARGET_BETWEEN",[g,s,m]);n[1]=p.getText("TARGET_AROUND",[s,c,v]);n[2]=p.getText("TARGET_CRITICAL",[c,s,g,m,v])}}return n}function ae(e,t,a){if(t&&t.DataPoint&&t.DataPoint.AnnotationPath){var r=a[t.DataPoint.AnnotationPath.substring(1)];var i,n;if(r&&r.ValueFormat){i=r.ValueFormat}else if(r&&r.NumberFormat){i=r.NumberFormat}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){n=i.NumberOfFractionalDigits.Int;if(e<Number(n)){e=Number(n)}}}return e}function re(e,t,a){if(t&&t.DataPoint&&t.DataPoint.AnnotationPath){var r=a[t.DataPoint.AnnotationPath.substring(1)];var i,n;if(r&&r.ValueFormat){i=r.ValueFormat}else if(r&&r.NumberFormat){i=r.NumberFormat}if(i){if(i.ScaleFactor&&i.ScaleFactor.Decimal){n=Number(i.ScaleFactor.Decimal)}else if(i.ScaleFactor&&i.ScaleFactor.Int){n=Number(i.ScaleFactor.Int)}if(!isNaN(n)){if(e===undefined){e=Number(n)}else if(e>Number(n)){e=Number(n)}}}}return e}function ie(e,t){if(e&&e[t]&&(e[t]["Org.OData.Measures.V1.ISOCurrency"]||e[t][E.SEMANTICS_KEY]&&e[t][E.SEMANTICS_KEY]===E.CURRENCY_CODE)){return true}return false}function ne(e,t,a){if(e[t[a].$PropertyPath].$Type===E.EDM_INT32){return true}return false}function oe(e,t,a){if(e[t[a].$PropertyPath].$Type===E.EDM_INT64){return true}return false}function se(e,t,r){var i,n,s,v,d;var h,P,_,b,O,S=false;var M;var F,$,U;var K,w=[],B=[];var k;var G;var W=r&&r.getView();var X,q;var J=W&&W.getModel("ui");var se=J&&J.getProperty("/chartSettings");i=e.getModel("ovpCardProperties");if(l.checkIfAPIIsUsed(r)){S=i&&i.getData()&&i.getData().showDataLabel}d=se?se.showDataLabel:S;h=e.getVizType();P=z();for(var ue in P){if((G=P[ue].reference)&&P[G]){var ge=A({},P[G]);P[ue]=ge}if(P[ue].default.type===h||P[ue].time&&P[ue].time.type===h){_=P[ue];break}}if(!_){R.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.CARD_CONFIG_ERROR+h+" "+C.CARD_CONFIG_JSON);return}if(!i){R.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return}var me=e.getModel();var Ae=i.getProperty("/entitySet");if(!me||!Ae){return}var de=i.getProperty("/entityType").$Type;var he=r.getMetaModel().getData().$Annotations[de];var Pe={property:r.getMetaModel().getObject("/"+de+"/")};n=g.merge(true,{},he,Pe);if(!n){R.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}var ye=ce(me,Ae);_e(me,ye,de);s=i.getProperty("/chartAnnotationPath");if(!s||!(v=n["@"+s])){R.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}var Ee="";if(n&&n["@"+s]&&n["@"+s].Title&&n["@"+s].Title.String){Ee=n["@"+s].Title.String;if(Ee.match(/{[@]?i18n>.+}/gi)||Ee.match(/{[@]?i18n&gt;.+}/gi)){var Ce=e.getModel("@i18n").getResourceBundle();var Re=Ee.indexOf(">")>-1?Ee.indexOf(">"):Ee.indexOf("&gt;")+3;var De=Ee.substring(Re+1,Ee.length-1);Ee=Ce.getText(De)}}if(!(b=v.DimensionAttributes)||!b.length){R.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.DIMENSIONS_MANDATORY);return}var be;if(!(O=v.MeasureAttributes)||!O.length){R.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return}else{var Oe=O[0].DataPoint?n[O[0].DataPoint.AnnotationPath.substring(1)]:null;var Se=Oe&&Oe.ValueFormat&&Oe.ValueFormat.NumberOfFractionalDigits&&Oe.ValueFormat.NumberOfFractionalDigits;be=Se?Se:0}k=H(b,_,me,Ae);if(k){_=_.time}else{_=_.default}var Me=i.getProperty("/ChartProperties")||i.getProperty("/chartProperties");if(i&&i.getProperty("/tabs")&&Me===undefined){X=W.byId("ovp_card_dropdown");q=parseInt(X.getSelectedKey(),10);Me=i.getProperty("/tabs")&&i.getProperty("/tabs")[q-1]&&(i.getProperty("/tabs")[q-1]["ChartProperties"]||i.getProperty("/tabs")[q-1]["chartProperties"])}var Ve=false;var Le=be>0?"tooltipNoScaleFormatter/"+be.toString()+"/":"tooltipNoScaleFormatter/-1/";var Ye=new o({formatString:Le});Ye.connect(e.getVizUid());Ye.connect(e.getVizUid());e._oOvpVizFrameTooltip=Ye;[_.dimensions,_.measures].forEach(function(e,t){var a=t?O:b;var r=t?"measure(s)":"dimension(s)";if(e.min&&a.length<e.min){R.error(C.CARD_ERROR+"in "+h+" "+C.CARD_LEAST+e.min+" "+r);Ve=true}if(e.max&&a.length>e.max){R.error(C.CARD_ERROR+"in "+h+C.CARD_MOST+e.max+" "+r);Ve=true}});if(Ve){return}var xe=true;if(_.properties&&_.properties.hasOwnProperty("hideLabel")&&!_.properties["hideLabel"]){xe=false}var Fe=true;var $e=false;if(h==="donut"){$e=true}e.removeAllAggregation();M={legend:{isScrollable:false},title:{visible:true},interaction:{noninteractiveMode:Fe?false:true,selectability:{legendSelection:$e?true:false,axisLabelSelection:false,mode:"EXCLUSIVE",plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:"disabled"}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"},dataLabel:{visible:d||$e?true:false,type:"value"},dataPoint:{invalidity:"ignore"},alignment:{vertical:"top"}},categoryAxis:{label:{truncatedLabelRatio:.15}},general:{groupData:false,showAsUTC:true}};if(_.properties&&_.properties.semanticColor===true&&ee(O,n)){var Ue=p.getText("GOOD");var Ke=p.getText("BAD");var we=p.getText("CRITICAL");var Be=p.getText("OTHERS");if(O.length===1){var ke=te(O[0],n,ye,e);var Ue=ke[0]||Ue,Ke=ke[1]||Ke,we=ke[2]||we,Be=p.getText("OTHERS")}M.plotArea.dataPointStyle={rules:[{callback:function(e){var t=Z(e,ye,O);if(!t){return false}var r=n[t.substring(1)];var i=Q(e,r);if(i===a.criticalityConstants.StateValues.Positive){return true}else if(i==="Positive"){return true}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:Ue},{callback:function(e){var t=Z(e,ye,O);if(!t){return false}var r=n[t.substring(1)];var i=Q(e,r);if(i===a.criticalityConstants.StateValues.Critical){return true}else if(i==="Critical"){return true}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},displayName:we},{callback:function(e){var t=Z(e,ye,O);if(!t){return false}var r=n[t.substring(1)];var i=Q(e,r);if(i===a.criticalityConstants.StateValues.Negative){return true}else if(i==="Negative"){return true}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:Ke},{callback:function(e){var t=Z(e,ye,O);if(!t){return false}var r=n[t.substring(1)];var i=Q(e,r);if(i===a.criticalityConstants.StateValues.None){return true}else if(i==="Neutral"){return true}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:Be}]}}var ze=i.getProperty("/bEnableStableColors");var He=i.getProperty("/colorPalette");var Ge;if(!ze&&T.indexOf(v.ChartType.$EnumMember)>=0&&He&&Object.keys(He).length>=2&&Object.keys(He).length<=4){m(b,function(e,t){if(t&&t.Role&&t.Role.$EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){Ge=t.Dimension&&t.Dimension.$PropertyPath;return}});var je;if(Ge){if(ye&&ye[Ge]){if(ye[Ge][E.LABEL_KEY_V4]){je=fe(ye[Ge][E.LABEL_KEY_V4]?ye[Ge][E.LABEL_KEY_V4]:ye[Ge][E.LABEL_KEY_V4].Path,e,ye)}else if(ye[Ge][E.LABEL_KEY]){je=ye[Ge][E.LABEL_KEY]}else if(Ge){je=Ge}}if(He instanceof Array){var We=He.map(function(e){return e.color});var Xe=He.map(function(e){return e.legendText});var qe=Xe[0]!=undefined?Xe[0]:p.getText("OTHERS");var Qe=Xe[1]!=undefined?Xe[1]:p.getText("BAD");var Ze=Xe[2]!=undefined?Xe[2]:p.getText("CRITICAL");var Je=Xe[3]!=undefined?Xe[3]:p.getText("GOOD")}M.plotArea.dataPointStyle={rules:[{callback:function(e){if(e&&(e[je]==="3"||e[je]===3)){if(He instanceof Array){if(He.length<4){return false}}else if(He&&!He.hasOwnProperty(3)){return false}return true}},properties:{color:He instanceof Array&&We.length?We[3]:He[3]&&He[3]["color"]},displayName:Je||He[3]&&He[3]["legendText"]},{callback:function(e){if(e&&(e[je]==="2"||e[je]===2)){if(He instanceof Array){if(He.length<3){return false}}else if(He&&!He.hasOwnProperty(2)){return false}return true}},properties:{color:He instanceof Array&&We.length?We[2]:He[2]&&He[2]["color"]},displayName:Ze||He[2]&&He[2]["legendText"]},{callback:function(e){if(e&&(e[je]==="1"||e[je]===1)){return true}},properties:{color:He instanceof Array&&We.length?We[1]:He[1]&&He[1]["color"]},displayName:Qe||He[1]&&He[1]["legendText"]},{callback:function(e){if(e&&(e[je]==="0"||e[je]===0)){return true}},properties:{color:He instanceof Array&&We.length?We[0]:He[0]&&He[0]["color"]},displayName:qe||He[0]&&He[0]["legendText"]}]};var et;if(i&&i.getProperty("/bInsightEnabled")){et=A({},M.plotArea.dataPointStyle);var tt=ye&&ye[Ge]&&ye[Ge][E.TYPE_KEY]||"";et.rules.forEach(function(e,t,a){delete e["callback"];e.dataContext={};if(tt){e.dataContext[je]=tt==="Edm.String"?a.length-1-t+"":a.length-1-t}else{e.dataContext[je]=a.length-1-t+""}})}}}var at=false;var rt=false;if(v.ChartType.$EnumMember===E.SCATTER_CHARTTYPE||v.ChartType.$EnumMember===E.BUBBLE_CHARTTYPE||v.ChartType.$EnumMember===E.LINE_CHARTTYPE){if(v&&v.AxisScaling&&v.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var it=v.AxisScaling;if(it.AutoScaleBehavior&&it.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var nt=it.AutoScaleBehavior;if(nt.ZeroAlwaysVisible&&nt.ZeroAlwaysVisible=="true"){M.plotArea.adjustScale=false;at=true}else if(nt.DataScope){M.plotArea.adjustScale=true;at=true}}else if(it.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&it.ScaleBehavior&&it.ScaleBehavior.$EnumMember){var ot=it.ScaleBehavior.$EnumMember;var st=ot.substring(ot.lastIndexOf("/")+1,ot.length);if(st=="FixedScale"){rt=true}}}else if(v&&v.AxisScaling&&v.AxisScaling.$EnumMember){var lt=v.AxisScaling.$EnumMember.substring(v.AxisScaling.$EnumMember.lastIndexOf("/")+1,v.AxisScaling.$EnumMember.length);switch(lt){case"AdjustToDataIncluding0":M.plotArea.adjustScale=false;at=true;break;case"AdjustToData":M.plotArea.adjustScale=true;at=true;break;case"MinMaxValues":rt=true;break;default:break}}if(rt){var ut=[];if(v["MeasureAttributes"][0]&&v["MeasureAttributes"][0].DataPoint&&v["MeasureAttributes"][0].DataPoint.AnnotationPath){var ft=v["MeasureAttributes"][0].DataPoint.AnnotationPath;var ct=ft.substring(ft.lastIndexOf("@")+1,ft.length);if(n&&n[ct]){var vt=n[ct];if(vt&&vt.MaximumValue&&vt.MaximumValue&&vt.MinimumValue&&vt.MinimumValue){ut.push({feed:"valueAxis",max:vt.MaximumValue,min:vt.MinimumValue});at=true}else{R.error(C.ERROR_MISSING_AXISSCALES)}}}if(v.ChartType.$EnumMember!==E.LINE_CHARTTYPE&&v["MeasureAttributes"][1]&&v["MeasureAttributes"][1].DataPoint&&v["MeasureAttributes"][1].DataPoint.AnnotationPath){var ft=v["MeasureAttributes"][1].DataPoint.AnnotationPath;var ct=ft.substring(ft.lastIndexOf("@")+1,ft.length);if(n&&n[ct]){var vt=n[ct];if(vt&&vt.MaximumValue&&vt.MaximumValue&&vt.MinimumValue&&vt.MinimumValue){ut.push({feed:"valueAxis2",max:vt.MaximumValue,min:vt.MinimumValue});at=true}else{R.error(C.ERROR_MISSING_AXISSCALES)}}}e.setVizScales(ut)}}$=b.slice();U=O.slice();var pt=0;var gt=0;var mt;var At;var dt=false;var ht=false;var Pt;var yt=[];var Et=[],Ct=[];if((h==="column"||h==="bar"||h==="vertical_bullet")&&_.feeds&&_.feeds.length>0){var _t;for(_t=0;_t<_.feeds.length;_t++){if(_.feeds[_t].uid==="color"){_.feeds.splice(_t,1);break}}for(_t=0;_t<_.feeds.length;_t++){if(_.feeds[_t].uid==="categoryAxis"){delete _.feeds[_t].role;break}}if(i.getProperty("/colorPalette")){for(_t=0;_t<_.feeds.length;_t++){if(_.feeds[_t].uid==="categoryAxis"){_.feeds[_t].role="Category";break}}_.feeds.push({uid:"color",min:1,type:"dimension",role:"Series"})}}m(_.feeds,function(t,a){var r=a.uid;var o=[];if(a.type){var s,l,v;if(a.type==="dimension"){s=b.length;l="Dimension";v="dimensions";F=$;K=w}else{s=O.length;l="Measure";v="measures";F=U;K=B}var p=0,g=s;if(a.min){p=p>a.min?p:a.min}if(a.max){g=g<a.max?g:a.max}if(!a.role){var A=F.length;for(var d=0;d<A&&o.length<g;++d){var P=F[d];F.splice(d,1);--A;--d;o.push(P);if(ye[P[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){Pt=ye[P[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path?ye[P[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(ye[P[l].$PropertyPath][E.UNIT_KEY_V4_Unit]){Pt=ye[P[l].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path?ye[P[l].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path:undefined}else if(ye[P[l].$PropertyPath][E.UNIT_KEY]){Pt=ye[P[l].$PropertyPath][E.UNIT_KEY]}if(ie(ye,Pt)){dt=true}else{ht=true}if(!dt){pt=ae(pt,P,n);mt=re(mt,P,n)}else{gt=ae(gt,P,n);At=re(At,P,n)}}}else{var T=a.role.split("|");m(T,function(e,t){if(o.length===g){return false}var a=F.length;for(var r=0;r<a&&o.length<g;++r){var i=F[r];if(i&&i.Role&&i.Role.$EnumMember&&i.Role.$EnumMember.split("/")&&i.Role.$EnumMember.split("/")[1]){var s=i.Role.$EnumMember.split("/")[1];if(s===t){F.splice(r,1);--a;--r;o.push(i);if(ye[i[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){Pt=ye[i[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path?ye[i[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(ye[i[l].$PropertyPath][E.UNIT_KEY_V4_Unit]){Pt=ye[i[l].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path?ye[i[l].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path:undefined}else if(ye[i[l].$PropertyPath][E.UNIT_KEY]){Pt=ye[i[l].$PropertyPath][E.UNIT_KEY]}if(ie(ye,Pt)){dt=true}else{ht=true}if(!dt){pt=ae(pt,i,n);mt=re(mt,i,n)}else{gt=ae(gt,i,n);At=re(At,i,n)}}}else if((K?Array.prototype.indexOf.call(K,i):-1)===-1){K.push(i)}}});if(o.length<g){m(K,function(e,t){var a;var r;if((a=_[v].defaultRole)&&(T?Array.prototype.indexOf.call(T,a):-1)!==-1&&(r=(F?Array.prototype.indexOf.call(F,t):-1)!==-1)){F.splice(r,1);o.push(t);if(ye[t[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){Pt=ye[t[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path?ye[t[l].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(ye[t[l].$PropertyPath][E.UNIT_KEY_V4_Unit]){Pt=ye[t[l].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path?ye[t[l].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path:undefined}else if(ye[t[l].$PropertyPath][E.UNIT_KEY]){Pt=ye[t[l].$PropertyPath][E.UNIT_KEY]}if(ie(ye,Pt)){dt=true}else{ht=true}if(!dt){pt=ae(pt,t,n);mt=re(mt,t,n)}else{gt=ae(gt,t,n);At=re(At,t,n)}if(o.length===g){return false}}})}if(o.length<p){R.error(C.CARD_ERROR+C.MIN_FEEDS+h+" "+C.FEEDS_OBTAINED+o.length+" "+C.FEEDS_REQUIRED+p+" "+C.FEEDS);return false}}if(o.length){var I=[];var S;if(!(S=e.getDataset())){R.error(C.NO_DATASET);return false}N=n;m(o,function(t,a){if(!a||!a[l]||!a[l].$PropertyPath){R.error(C.INVALID_CHART_ANNO);return false}var n=a[l].$PropertyPath;var o=n;var s=n;var c=null;if(ye&&ye[n]){if(ye[n]["annotations"]){if(ye[n]["annotations"]["@"+E.LABEL_KEY_V4]){if(ye[n]["annotations"]["@"+E.LABEL_KEY_V4]instanceof String&&ye[n]["annotations"]["@"+E.LABEL_KEY_V4]){o=fe(ye[n]["annotations"]["@"+E.LABEL_KEY_V4],e,ye)}else if(ye[n]["annotations"]["@"+E.LABEL_KEY_V4].$Path){o=ye[n]["annotations"]["@"+E.LABEL_KEY_V4].$Path}else{o=ye[n]["annotations"]["@"+E.LABEL_KEY_V4]}}else if(ye[n]["annotations"]["@"+E.LABEL_KEY]){o=ye[n]["annotations"]["@"+E.LABEL_KEY]}else if(n){o=n}if(ye[n]["annotations"]["@"+E.TEXT_KEY_V4]){s=ye[n]["annotations"]["@"+E.TEXT_KEY_V4].$String?ye[n]["annotations"]["@"+E.TEXT_KEY_V4].$String:ye[n]["annotations"]["@"+E.TEXT_KEY_V4].$Path}else if(ye[n]["annotations"]["@"+E.TEXT_KEY]){s=ye[n]["annotations"]["@"+E.TEXT_KEY]}}else if(n){s=n}c=ye[n].$Type||null}var v;if((c==="Edm.DateTime"||c==="Edm.DateTimeOffset")&&s===n){v="{path:'"+n+"', formatter: 'sap.ovp.cards.v4.charts.VizAnnotationManager.returnDateFormat'}"}else{if(ye[n]&&ye[n]["annotations"]&&ye[n]["annotations"]["@"+E.TEXT_KEY_V4]&&ye[n]["annotations"]["@"+E.TEXT_KEY_V4+"@"+E.TEXT_ARRANGEMENT_ANNO]){var p,g;p=ye[n]["annotations"]["@"+E.TEXT_KEY_V4+"@"+E.TEXT_ARRANGEMENT_ANNO];g=p&&p.$EnumMember;if(!g){p=ye[n]["annotations"]["@"+E.TEXT_KEY_V4]["@"+E.TEXT_ARRANGEMENT_ANNO];g=p&&p.$EnumMember}if(!g){var m=N;p=m&&m["@"+E.TEXT_ARRANGEMENT_ANNO];g=p&&p.$EnumMember}switch(g){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":v="{"+s+"}"+" "+"("+"{"+n+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":v="{"+n+"}"+" "+"("+"{"+s+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":v="{"+s+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":v="{"+n+"}"+" "+"("+"{"+s+"}"+")";break;default:v="{"+n+"}";break}}else{v="{"+s+"}"}if(i&&i.getProperty("/bInsightEnabled")){y.setDimensionPath(i.getData().cardId,n,v)}}I.push(o);if(l==="Dimension"){if(r==="waterfallType"){var A=new u({name:o,value:"{"+n+"}"})}else{var A=new u({name:o,value:"{"+n+"}",displayValue:v})}var d=ye[n][E.SEMANTICS_KEY];var h=D(e.getModel(),Ae,n);if(k&&(c==="Edm.DateTime"||h||c==="Edm.DateTimeOffset"||d&&d.lastIndexOf("year",0)===0)){A.setDataType("date")}S.addDimension(A);if((Ct?Array.prototype.indexOf.call(Ct,o):-1)===-1){Ct.push(o)}}else{S.addMeasure(new f({name:o,value:"{"+n+"}"}));if((Et?Array.prototype.indexOf.call(Et,o):-1)===-1&&r!="bubbleWidth"){Et.push(o)}}});e.addFeed(new c({uid:r,type:l,values:I}));if(r==="categoryAxis"){M[r]={title:{visible:xe?false:true,text:I.join(", ")},label:{formatString:dt?"CURR":"axisFormatter",truncatedLabelRatio:.15}}}else{M[r]={title:{visible:xe?false:true,text:I.join(", ")},label:{formatString:dt?"CURR":"axisFormatter"}}}yt.push(M[r]);if(_.hasOwnProperty("vizProperties")){var V=0;var L=_.vizProperties.length;var Y;var x;for(;V<L;V++){if(_.vizProperties[V].hasOwnProperty("value")){x=_.vizProperties[V].value}if(_.vizProperties[V].hasOwnProperty("path")){Y=_.vizProperties[V].path.split(".");var z=Y.length;var H,G;var j;for(var W=0,j=Y[0],H=M,G=Me;W<z;++W){if(W===z-1){if(G&&G.hasOwnProperty(j)){if(h==="donut"&&(G[j]==="value"||G[j]==="percentage")){x=G[j]}else if(h!="donut"){x=G[j]}}if(at&&j!="adjustScale"||!at&&j==="adjustScale"||!at&&j!="adjustScale"){H[j]=x}break}H[j]=H[j]||{};H=H[j];if(G){G[j]=G[j]||{};G=G[j]}j=Y[W+1]}}}}if(a.hasOwnProperty("vizProperties")){var t=0;var X=a.vizProperties.length;var q;var Q;var Z;for(;t<X;t++){if(a.vizProperties[t].hasOwnProperty("method")){Q=a.vizProperties[t].method;switch(Q){case"count":q=I.length;if(a.vizProperties[t].hasOwnProperty("min")&&q<=a.vizProperties[t].min){q=a.vizProperties[t].min}else if(a.vizProperties[t].hasOwnProperty("max")&&q>=a.vizProperties[t].max){q=a.vizProperties[t].max}break;default:break}}else if(a.vizProperties[t].hasOwnProperty("value")){q=a.vizProperties[t].value}if(a.vizProperties[t].hasOwnProperty("path")){Z=a.vizProperties[t].path.split(".");var J=Z.length;for(var d=0,ee=Z[0],te=M;d<J;++d){if(d===J-1){te[ee]=q;break}te[ee]=te[ee]||{};te=te[ee];ee=Z[d+1]}}}}}}});var Tt=e.getFeeds();if(_.properties&&_.properties.semanticPattern===true&&x(Tt,h)){m(Tt,function(t,a){if(Tt[t].getType()==="Measure"&&(Tt[t].getUid()==="valueAxis"||Tt[t].getUid()==="actualValues")){var r;m(O,function(e,a){var i=Y(a.Measure.$PropertyPath,ye);if(i===Tt[t].getValues()[0]){r=V(a,n);return false}});if(r){var i=Y(r.Measure.$PropertyPath,ye);var o=n[r.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||n[r.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path;var s=Y(o,ye);var l=p.getText("ACTUAL",[i]);var u=p.getText("FORECAST",[s]);M.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:i},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:l},{dataContext:{MeasureNamesDimension:s},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:u}]};e.getDataset().addMeasure(new f({name:s,value:"{"+o+"}"}));var c=Tt[t].getValues();c.push(s);Tt[t].setValues(c)}return false}})}var It=false;if(He&&He.dimensionSettings&&Object.keys(He.dimensionSettings).length>0){var Nt=Object.keys(He.dimensionSettings);for(var Rt=0;Rt<Nt.length;Rt++){var Dt=Nt[Rt];var bt=He.dimensionSettings[Dt];if(Object.keys(bt).length>10){It=true;break}}}if(ze&&I.indexOf(v.ChartType.$EnumMember)>=0&&!Boolean(It)){var Ot=[];var St=true;for(var Rt=0;Rt<b.length;Rt++){var Mt=b[Rt].Dimension.$PropertyPath;Ot.push(Mt)}for(var Rt=0;Rt<Ot.length;Rt++){var Dt=Ot[Rt];if(Nt.indexOf(Dt)>-1){var Vt=He.dimensionSettings[Dt];var Lt=Object.keys(Vt);var Yt=[];for(var Rt=0;Rt<Lt.length;Rt++){var xt=Vt[Lt[Rt]];Yt.push(xt)}St=St&&Yt.every(Ie)}}if(St){var Ft=[];for(var Rt=0;Rt<Ot.length;Rt++){var Dt=Ot[Rt];if(Nt.indexOf(Dt)>-1){var Vt=He.dimensionSettings[Dt];var Lt=Object.keys(Vt);var Yt=[];for(var Rt=0;Rt<Lt.length;Rt++){var xt=Vt[Lt[Rt]];Yt.push(xt)}Te(Yt);for(var $t=0;$t<Yt.length;$t++){var Ut=Yt[$t].dimensionValue;var Kt=Yt[$t].color;var xt={properties:{color:Kt}};xt.dataContext={};var wt=le(ye,e,Dt);xt.dataContext[wt]=Ut;xt.displayName=Ut;Ft.push(xt)}}}M.plotArea.dataPointStyle=M.plotArea.dataPointStyle||{};M.plotArea.dataPointStyle["rules"]=Ft}else{var Ft=[];for(var Rt=0;Rt<Ot.length;Rt++){var Dt=Ot[Rt];if(Nt.indexOf(Dt)>-1){var Vt=He.dimensionSettings[Dt];var Lt=Object.keys(Vt);var Yt=[];for(var Rt=0;Rt<Lt.length;Rt++){var xt=Vt[Lt[Rt]];Yt.push(xt)}Te(Yt);var Bt=Yt.map(Ne)}}M.legend.order=function(e,t){var a=Bt.indexOf(e);var r=Bt.indexOf(t);return a>r?1:-1}}}if(_.properties&&_.properties.semanticPattern===true&&x(Tt,h)&&e.getVizType()==="vertical_bullet"){m(Tt,function(t,a){if(Tt[t].getType()==="Measure"&&(Tt[t].getUid()==="valueAxis"||Tt[t].getUid()==="actualValues")){var r;m(O,function(e,a){var i=Y(a.Measure.PropertyPath,ye);if(i===Tt[t].getValues()[0]){r=L(a,n);return false}});if(r){var i=n[r.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||n[r.DataPoint.AnnotationPath.substring(1)].TargetValue.Path;var o=Y(i,ye);e.getDataset().addMeasure(new f({name:o,value:"{"+i+"}"}));e.addFeed(new c({uid:"targetValues",type:"Measure",values:[o]}))}return false}})}if(dt&&ht){R.warning(p.getText("Currency_non_currency_measure"))}m(Tt,function(e,t){var a=t.getProperty("type");if(a==="Measure"){var r=t.getProperty("values");var i=true;var n=v.MeasureAttributes.filter(function(e){var t=e[a].$PropertyPath;var i=ye[t];return Object.keys(i).length>0&&r.indexOf(t)>=0});m(n,function(e,t){if(ne(ye,t,a)||oe(ye,t,a)){i=false}else{i=true;return false}});if(!i){M[t.getProperty("uid")]["label"]["allowDecimals"]=false}}});var kt;if(At===undefined){At=""}if(mt===undefined){mt=""}if(dt){kt=pe(At,dt)}else{kt=pe(mt,dt)}if(t){t.setScale(kt)}var zt=ve(Et,Ct,Ee);var Ht="";m(Tt,function(e,t){var a="-1";var r=t.getProperty("type");if(r==="Measure"){var i=yt.filter(function(e){var a=e["title"]["text"].split(",").filter(function(e){if(t.getValues().indexOf(e.trim())>=0){return true}else{return false}});if(a.length>0){return true}else{return false}});if(i&&i.length){var o=t.getValues();if(o&&o.length){m(o,function(e,t){var i=t.trim();var o=O.filter(function(e){if(e["Measure"]&&e["Measure"]["PropertyPath"]){var t=e["Measure"]["PropertyPath"];if(ye[t]&&ye[t][E.LABEL_KEY]===i||ye[t]&&ye[t][E.LABEL_KEY_V4]===i){return true}else{return false}}});if(o&&o.length){var s=o[0];if(!ne(ye,s,r)&&!oe(ye,s,r)){var l="";if(s&&s["DataPoint"]&&s["DataPoint"]["AnnotationPath"]&&s["DataPoint"]["AnnotationPath"]){l=s["DataPoint"]["AnnotationPath"]&&s["DataPoint"]["AnnotationPath"].substring(1);if(l!=""){var u;u=n[l]&&n[l]["ValueFormat"]&&n[l]["ValueFormat"]["NumberOfFractionalDigits"]&&n[l]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];a=u>a?u:a}}}else{a=a<"0"?"0":a}}})}}if(i&&i[0]&&i[0].label&&i[0].label.formatString){var s=i[0].label.formatString}Ht="";if(dt){if(s==="CURR"){Ht="CURR/"+a.toString()+"/"}else{Ht="axisFormatter/"+a.toString()+"/"}}else{Ht="axisFormatter/"+a.toString()+"/"}if(i&&i[0]){i[0].label.formatString=Ht}}});if(h==="vertical_bullet"){M["valueAxis"]={title:{visible:xe?false:true},label:{formatString:Ht}}}var Gt="";var jt="";if(dt){Gt=gt.toString();jt="CURR/"+gt.toString()+"/"}else{Gt=pt.toString();jt="axisFormatter/"+pt.toString()+"/"}if(h==="donut"||d){M.plotArea.dataLabel.formatString=jt;if(M.plotArea.dataLabel.type==="percentage"){M.plotArea.dataLabel.formatString="0.0%/"+Gt+"/"}}j($,_,"dimension");j(U,_,"measure");if(k){var Wt=b[0].Dimension.$PropertyPath;var Xt=e.getModel().getMetaModel().getObject("/"+Ae+"/"+Wt+"@");if(Xt["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){M.timeAxis.levels=["year","month"]}else if(Xt["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){M.timeAxis.levels=["year","quarter"]}else if(Xt["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){M.timeAxis.levels=["year","week"]}else if(Xt["@com.sap.vocabularies.Common.v1.IsCalendarYear"]){M.timeAxis.levels=["year"]}}M.title={text:Ee?Ee:zt,alignment:"left",layout:{respectPlotPosition:false},style:{fontFamily:"72, 72full, Arial, Helvetica, sans-serif !important",fontSize:".875rem",fontWeight:"normal"}};e.setVizProperties(M);if(i&&i.getProperty("/bInsightEnabled")){var qt=e&&e.getId();var Qt=A({},M);if(et!==undefined){Qt.plotArea.dataPointStyle=et}y.setVizPropertyMap(qt,Qt)}}function le(e,t,a){var r="";if(e&&e[a]){if(e[a].annotations&&e[a].annotations["@"+E.LABEL_KEY_V4]){r=fe(e[a].annotations["@"+E.LABEL_KEY_V4],t,e)}else if(e[a][E.LABEL_KEY]){r=e[a][E.LABEL_KEY]}else if(a){r=a}}return r}function ue(e,t,a){if(e&&(e.getVizType()==="bubble"||e.getVizType()==="scatter")){return}var r,i,n,o;var s;var l=E.UNIT_KEY;var u="@"+E.UNIT_KEY_V4_ISOCurrency;var f="@"+E.UNIT_KEY_V4_Unit;var c;var v=[];if(!(r=e.getModel("ovpCardProperties"))){R.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return}var g=e.getModel();var A=r.getProperty("/entitySet");if(!g||!A){return}i=a[r.getProperty("/entityType").$Type];if(!i){R.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}var d=ce(g,A);n=r.getProperty("/chartAnnotationPath");if(!n||!(o=i["@"+n])){R.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}if(!(s=o.MeasureAttributes)||!s.length){R.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return}m(s,function(e,t){c=t.Measure.$PropertyPath;if(t.DataPoint&&t.DataPoint.AnnotationPath){var a=i[t.DataPoint.AnnotationPath.substring(1)];if(a.ForecastValue&&(a.ForecastValue.PropertyPath||a.ForecastValue.Path)){v.push(a.ForecastValue.PropertyPath||a.ForecastValue.Path)}}v.push(c)});var h=t?t:null;var P="";var y=true;var _=[];var T=e.getFeeds();m(T,function(e,t){if(t.getType()==="Measure"){_=_.concat(t.getValues())}});if(h){m(v,function(t,a){var r=le(d,e,a);if((_?Array.prototype.indexOf.call(_,r):-1)!=-1){if(d&&d[a]){var i;if(d[a].annotations[u]){i=d[a].annotations[u].$Path?d[a].annotations[u].$Path:d[a].annotations[u].$String}else if(d[a].annotations[f]){i=d[a].annotations[f].$Path?d[a].annotations[f].$Path:d[a].annotations[f].$String}else if(d[a][l]){i=d[a][l]}if(!i){y=false;return false}if(i&&d[i]){for(var t=0;t<h.length;t++){var n=h[t];if(y){if(P&&n[i]&&n[i]!=""&&P!=""&&P!=n[i]){y=false;break}}P=n[i];if(!P){y=false;break}}}}}})}var I="";if(y){if(P!=""){I=p.getText("IN_NO_SCALE",[P]);I=" "+I}var N=e.data("aria-label");if(N&&I&&N.indexOf(I)===-1){var D=N+I;e.data("aria-label",D,true)}var b=e.getVizProperties().title&&e.getVizProperties().title.text;if(b){var O=b.indexOf("|");if(O!==-1){var S=b.slice(O+2);if(S!==P){b=b.slice(0,O-1)}}var M={title:{visible:true,text:S===P?b:b+I,alignment:"left",layout:{respectPlotPosition:false},style:{fontFamily:"72, 72full, Arial, Helvetica, sans-serif !important",fontSize:".875rem",fontWeight:"normal"}}};e.setVizProperties(M)}}}function fe(e,t,a){var r;var i;var n;if(e&&e.indexOf("{")===0){e=e.slice(1,-1);if(e.indexOf(">")!=-1){n=e.split(">");r=n[0];i=n[1]}else if(e.indexOf("&gt;")!=-1){n=e.split("&gt;");r=n[0];i=n[1]}try{e=t.getModel(r).getProperty(i)}catch(t){e=a[e][E.LABEL_KEY_V4].String;R.error("Unable to read labels from resource file",t)}}return e}function ce(t,a){var r=e.cacheODataMetadata(t);if(!r){return undefined}return r[a]}function ve(e,t,a){var r="",i="",n="";if(a){r=a}if(e&&e.length>1){for(var o=0;o<e.length-1;o++){if(i!=""){i+=", "}i+=e[o]}i=p.getText("MEAS_DIM_TITLE",[i,e[o]])}else if(e){i=e[0]}if(t&&t.length>1){for(var o=0;o<t.length-1;o++){if(n!=""){n+=", "}n+=t[o]}n=p.getText("MEAS_DIM_TITLE",[n,t[o]])}else if(t){n=t[0]}if(r===""){a=p.getText("NO_CHART_TITLE",[i,n])}return a}function pe(e,t){var a=1;var i;if(t){var n=r.getCurrencyInstance({style:"short",currencyCode:false,shortRefNumber:e});i=n.format(Number(a))}else{var o=r.getFloatInstance({style:"short",shortRefNumber:e});i=o.format(Number(a))}var s=i.slice(-1);return s}function ge(e,t){e.attachSelectData(function(r){var n=g.bCRTLPressed?g.constants.explace:g.constants.inplace;g.bCRTLPressed=false;var o=e.getModel("ovpCardProperties");var u=e.getModel();var f=o.getProperty("/entitySet");var c=ce(u,f);var v=[],p=[];var A={},d={};var h=e.getDataset().getDimensions();var P;var y=o.getProperty("/entityType");var C=t.getMetaModel().getData()["$Annotations"];for(var _=0;_<h.length;_++){v.push(h[_].getName())}var T=e.getDataset().getBinding("data").getCurrentContexts().map(function(e){return e.getObject()});if(r.getParameter("data")&&r.getParameter("data")[0]&&r.getParameter("data")[0].data){p=Object.keys(r.getParameter("data")[0].data);P=r.getParameter("data")[0].data._context_row_number;var I=e.getDataset().getBinding("data").getContexts()[P];var N=t.getEntityNavigationEntries(I)[0];if(T[P].$isOthers&&T[P].$isOthers===true){var R={},D=[];for(var b=0;b<v.length;b++){for(var O=0;O<p.length;O++){if(v[b]===p[O]){for(var S in c){if(c.hasOwnProperty(S)){var M=c[S][E.LABEL_KEY]||c[S][E.NAME_KEY]||c[S][E.NAME_CAP_KEY];if(M===p[O]){D.push(S)}}}}}}for(var _=0;_<D.length;_++){R[D[_]]=[];for(var b=0;b<T.length-1;b++){if(b!=P){R[D[_]].push(T[b][D[_]])}}}var V={$isOthers:true};var L={getObject:function(){return V},getOtherNavigationDimensions:function(){return R}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(L)}}else{if(N){t.doNavigation(L,N,n)}}}else{for(var b=0;b<v.length;b++){for(var O=0;O<p.length;O++){if(v[b]===p[O]){for(var S in c){if(C[y.$Type+"/"+S]){var M=typeof C[y.$Type+"/"+S]["@"+E.LABEL_KEY_V4]==="string"&&C[y.$Type+"/"+S]["@"+E.LABEL_KEY_V4]||C[y.$Type+"/"+S][E.LABEL_KEY]||C[y.$Type+"/"+S][E.NAME_KEY]||C[y.$Type+"/"+S][E.NAME_CAP_KEY]||S;if(M.match(/{@i18n>.+}/gi)){var Y=this.getModel("@i18n").getResourceBundle();M=Y.getText(M.substring(M.indexOf(">")+1,M.length-1))}if(M===p[O]){A[S]=T[P][S]}}}}for(var S in T[P]){if(c.hasOwnProperty(S)){d[S]=T[P][S]}}}}if(A){m(Object.keys(A),function(e,t){var a=c[t]&&c[t]["annotations"];if(c[t]["$Type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearquarter"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearweek"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(A[t]):A[t]}else if(c[t]["@com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]){var r=A[t];if(r.includes(".")){A[t]=r.split(".").reverse().join("")}else if(r.includes("/")){A[t]=r.split("/").reverse().join("")}}}})}if(d){m(Object.keys(d),function(e,t){var a=c[t]&&c[t]["annotations"];if(c[t]["$Type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearquarter"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearweek"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(d[t]):d[t]}else if(c[t]["@com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]){var r=d[t];if(r.includes(".")){d[t]=r.split(".").reverse().join("")}else if(r.includes("/")){d[t]=r.split("/").reverse().join("")}}}})}var x=y[o.getProperty("/presentationAnnotationPath")];if(y){var F=a.getRequestFields(x);if(F&&F.length>0){m(F,function(e,t){if(!A.hasOwnProperty(t)){A[t]=T[P][t]}})}}var L={getObject:function(){return A},getAllData:function(){return d}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(L)}}else{if(N){t.doNavigation(L,N,n)}}}}})}function me(e){if(e.$EnumMember.endsWith("Bubble")){return true}else{return false}}function Ae(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Dimension||!e[0].Dimension.$PropertyPath){R.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.DIMENSIONS_MANDATORY);return t}t=true;return t}function de(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Measure||!e[0].Measure.$PropertyPath){R.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return t}t=true;return t}function he(e){e=e["$Type"];return e}function Pe(e){if(e&&e.indexOf("#")!=-1){var t=e.split("#");if(t.length>1){return t[1]}}return""}function ye(e,t){var a=t.getModel("ovpCardProperties");var r=Ee(t);var i=+r.itemsLength;var n=+a.getProperty("/dataStep");if(i&&n){var o=e.colSpan-1;if(o>=0){i+=n*o;Ce(t,i)}}}function Ee(e){var t=e.getModel("ovpCardProperties");var a=t.getProperty("/entityType");var r=t.getProperty("/presentationAnnotationPath");var i=a.hasOwnProperty(r)&&a[r];var n=i&&i.MaxItems;if(typeof n==="number"||typeof n==="string"&&!isNaN(n)){var o=parseInt(n,10);return{itemsLength:+o,dataStep:+t.getProperty("/dataStep")}}}function Ce(e,t){var a,r={},i=[];var n=e.getVizType();var o=e.getModel("ovpCardProperties");var s=o.getProperty("/entityType");var l=o.getProperty("/chartAnnotationPath");var u=s[l];var f=e.getParent();var c=f.getBinding("data");r.path=c.getPath();r.parameters={};if(c.mParameters&&c.mParameters.select){r.parameters.select=c.mParameters.select}r.parameters.custom=r.parameters.custom||{};r.parameters.custom._requestFrom="ovp_internal";r.filters=c.aApplicationFilters;r.sorter=c.aSorters;r.length=n==="donut"?t+1:t;r.template=new v;f.bindAggregation("data",r);if(n==="donut"){m(u.MeasureAttributes,function(e,t){i.push(t.Measure.PropertyPath)});a={};a.path=c.getPath();a.parameters={};a.parameters.select=i.join(",");a.filters=c.aApplicationFilters;a.sorter=c.aSorters;a.length=1;a.template=new v;f.bindAggregation("aggregateData",a)}f.updateBindingContext()}function _e(e,t,a){var r=e.getMetaModel().getData().$Annotations;for(var i in t){if(r[a+"/"+i]&&!t[i]["annotations"]){t[i]["annotations"]=r[a+"/"+i]}}}function Te(e){e.sort(function(e,t){if(e.index<t.index){return-1}if(e.index>t.index){return 1}return 0})}function Ie(e){return e.color!==undefined}function Ne(e){return e.dimensionValue}return{constants:E,errorMessages:C,formatItems:b,formatByType:F,returnDateFormat:$,formatChartAxes:U,hideDateTimeAxis:K,checkExists:w,validateCardConfiguration:B,checkNoData:k,getConfig:z,hasTimeSemantics:H,getChartType:G,getPrimitiveValue:W,formThePathForCriticalityStateCalculation:Q,checkFlag:ee,buildVizAttributes:se,setChartUoMTitle:ue,getMetadata:ce,getSelectedDataPoint:ge,checkBubbleChart:me,dimensionAttrCheck:Ae,measureAttrCheck:de,getEntitySet:he,getAnnotationQualifier:Pe,reprioritizeContent:ye,getMaxItems:Ee,getLabelFromAnnotationPath:fe,formGroupByList:S}},true);
//# sourceMappingURL=VizAnnotationManager.js.map