sap.ui.define(["sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/ovp/cards/CommonUtils","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/analytics/odata4analytics","sap/fe/navigation/SelectionVariant","sap/ovp/app/resources","sap/base/strings/formatMessage","sap/base/util/isPlainObject","sap/base/util/each","sap/ovp/cards/MetadataAnalyser","sap/base/security/encodeURL","sap/base/util/merge","sap/ovp/app/OVPLogger","sap/base/util/isEmptyObject","sap/ovp/app/OVPUtils","sap/ovp/helpers/V4/MetadataAnalyzer"],function(e,t,r,a,i,n,o,u,l,s,f,c,p,g,v,m,h,y,P){"use strict";var d={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};var C={TEXT:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT:"com.sap.vocabularies.UI.v1.TextArrangement",UOM:"Org.OData.Measures.V1.Unit",ISO_CURRENCY:"Org.OData.Measures.V1.ISOCurrency"};var T={TEXT_LAST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast",TEXT_FIRST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst",TEXT_ONLY:"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly",TEXT_SEPARATE:"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"};var b={List_condensed:{phone:5,tablet:5,desktop:5},List_extended:{phone:3,tablet:3,desktop:3},List_condensed_bar:{phone:5,tablet:5,desktop:5},List_extended_bar:{phone:3,tablet:3,desktop:3},Table:{phone:5,tablet:5,desktop:5},Stack_simple:{phone:20,tablet:20,desktop:20},Stack_complex:{phone:5,tablet:5,desktop:5}};var V=new m("OVP.cards.V4AnnotationHelper");function D(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/showLabelText");if(a==="true"){var i=t.Address[0];if(typeof i.country!=="undefined"){return"{path:'"+i.country.Path+"'}"}else if(typeof i.locality!=="undefined"){return"{path:'"+i.locality.Path+"'}"}else if(typeof i.street!=="undefined"){return"{path:'"+i.street.Path+"'}"}else if(typeof i.code!=="undefined"){return"{path:'"+i.code.Path+"'}"}}else{return null}}D.requiresIContext=true;function I(e,t){if(!t){return""}if(t.Label){return t.Label}var r=e.getSetting&&e.getSetting("ovpCardProperties");var a=r&&r.getProperty("/metaModel");var i=r&&r.getProperty("/entityType");if(!a||!i){return""}var n;if(t.Value){n=t.Value.$Path}if(t.Target){var o="/"+q(i.$Type,t);var u=o&&a.getProperty(o);n=u&&u.Value.$Path}if(!n||!n.length>0||n===" "){return""}var l=a.getData()["$Annotations"][i.$Type+"/"+n];if(!l){return""}var s=l["sap:label"]||l["@com.sap.vocabularies.Common.v1.Label"]||""||"";return s}I.requiresIContext=true;function $(e){if(e.EdmType==="Edm.DateTime"||e.EdmType==="Edm.DateTimeOffset"){return"Right"}return"Left"}$.requiresContext=true;function F(e,t){if(e.getSetting){var r=e.getSetting("_ovpCache");if(r){return r[t]}}return undefined}function S(e,t,r){if(e.getSetting){var a=e.getSetting("_ovpCache");if(a){a[t]=r}}}function O(e,t){var r;if(t){r=t.None;if(e&&e.$EnumMember){var a=e.$EnumMember;if(x(a,"Negative")){r=t.Negative}else if(x(a,"Critical")){r=t.Critical}else if(x(a,"Positive")){r=t.Positive}}}return r}function N(e){if(e=="Error"){e=1}else if(e=="Warning"){e=2}else if(e=="Success"){e=3}else{e=0}return e}function x(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}function E(t,r,a,i,n,o,u){if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}var l={};l.$EnumMember="None";var s=Number.NEGATIVE_INFINITY;var f=Number.POSITIVE_INFINITY;if(!n&&n!==0&&(a||a===0)){n=a}if(!o&&o!==0&&(i||i===0)){o=i}if(!a&&a!==0){a=s}if(!i&&i!==0){i=f}if(t!==undefined){t=Number(t);if(x(r,"Minimize")||x(r,"Minimizing")){if((o||o===0)&&(i||i===0)){if(t<=parseFloat(o)){l.$EnumMember="Positive"}else if(t>parseFloat(i)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}else if(x(r,"Maximize")||x(r,"Maximizing")){if((n||n===0)&&(a||a===0)){if(t>=parseFloat(n)){l.$EnumMember="Positive"}else if(t<parseFloat(a)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}else if(x(r,"Target")){if((o||o===0)&&(i||i===0)&&(n||n===0)&&(a||a===0)){if(t>=parseFloat(n)&&t<=parseFloat(o)){l.$EnumMember="Positive"}else if(t<parseFloat(a)||t>parseFloat(i)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}}return O(l,u)}function A(t,r,a,i){if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(!t||!r){return}t=Number(t);if(!i&&t-r>=0){return"Up"}if(!a&&t-r<=0){return"Down"}if(r&&i&&t-r>=i){return"Up"}if(r&&a&&t-r<=a){return"Down"}}function M(e,t){var r=e.getPath(0)+"-DataFields-Sorted";var a=F(e,r);if(!a){var i=R(e,t);var n=i.map(function(e){return e.Value.$Path});n=n.filter(function(e){return!!e});a=t.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"&&n.indexOf(e.Value.$Path)===-1){return true}return false});a=_(a);S(e,r,a)}return a}M.requiresIContext=true;function R(e,t,r){var a=e.getPath(0)+"-DataPoints-Sorted";var i=F(e,a);if(!i){if(r){i=t.filter(w)}else{i=t.filter(U)}i=_(i);var n;for(var o=0;o<i.length;o++){n=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);i[o]=e.getModel(0).getProperty(q(n,i[o]));n=""}S(e,a,i)}return i}R.requiresIContext=true;function U(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true}return false}function w(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.Communication.v1.Contact.*/)){return true}return false}function q(e,t){return e+t.Target.$AnnotationPath}function L(e){var t,r;if(e["@com.sap.vocabularies.UI.v1.Importance"]){t=e["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember;switch(t){case"com.sap.vocabularies.UI.v1.ImportanceType/High":r=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":r=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":r=3;break}}else{r=4}return r}function _(e){if(e.length<2){return e}var t=parseInt(e.length/2,10);var r=e.slice(0,t);var a=e.slice(t,e.length);return B(_(r),_(a))}function B(e,t){var r=[];while(e.length&&t.length){var a=L(e[0]),i=L(t[0]);if(a<=i){r.push(e.shift())}else{r.push(t.shift())}}while(e.length){r.push(e.shift())}while(t.length){r.push(t.shift())}return r}function H(e,t,r){var a=M(e,t)[r];if(a){return Q(e,a)}return""}function j(e,t,r){var a=M(e,t)[r];return I(e,a)}function k(e,t,r){var a=R(e,t)[r];if(a&&a.Title){return a.Title.String}return""}function G(e,t,r){var a=t.filter(U);a=_(a);if(!a||!a.length||!a.length>0){return""}return I(e,a[0])}function X(e,t,r,a){var i=R(e,t)[r];if(!i){return""}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");return J(e,i,o,u,a)}function Y(e,t,r){var a=R(e,t)[r];if(a&&a.Criticality){return true}}function z(e,t,r){var a=R(e,t)[r];var i=a.Criticality.Path;return"{path:'"+i+"'}"}function J(e,t,r,a,i){if(!t||!t.Value){return""}var n=e.getSetting("ovpCardProperties");var o=false;if(n){var u=n.getProperty("/ignoreSapText");o=u==undefined?o:u}var l=a.getData()["$Annotations"][r.$Type+"/"+t.Value.$Path];var s=false;if(o==true){if(l&&(l["@com.sap.vocabularies.Analytics.v1.Measure"]||l["sap:aggregation-role"]=="measure")){s=true}}if(!s&&l){var f;if(l[C.TEXT]){f=l[C.TEXT]?l[C.TEXT]:l[C.TEXT].$Path}else if(l["sap:text"]){f=l["sap:text"]}if(f){t={Value:{$Path:f}}}}return Q(e,t,i)}function Q(e,t,r,i){if(t.Value.Apply){return a.format(e,t.Value)}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");return K(e,t,o,u,r,i)}Q.requiresIContext=true;function W(e,t,r,i){var e=!e.getPath()?e.getInterface(0):e;if(!r||typeof i!=="string"){return i}var n=r.annotations&&r.annotations["@"+C.TEXT];var o=Object.keys(t.$NavigationPropertyBinding);if(!n||o&&o.indexOf(n&&n.$Path&&n.$Path.split("/")[0])===-1){return i}var u,l;u=r.annotations["@"+C.TEXT+"@"+C.TEXT_ARRANGEMENT];l=u&&u.$EnumMember;if(!l){u=n&&n["@"+C.TEXT_ARRANGEMENT];l=u&&u.$EnumMember}if(!l){u=t&&t[C.TEXT_ARRANGEMENT];l=u&&u.$EnumMember}var s=a.format(n,{context:e});if(!s||s===" "){return i}if(!l){return i+" ("+s+")"}var f;switch(l){case T.TEXT_FIRST:f=s+" ("+i+")";break;case T.TEXT_LAST:f=i+" ("+s+")";break;case T.TEXT_ONLY:f=s;break;case T.TEXT_SEPARATE:f=i+" ("+s+")";break;default:f=i;break}return f}function K(e,t,r,i,n,o,u){if(t.Value.Apply){return a.format(e,t.Value)}var l=t.Value.$Path||t.Value.String;var s=P.getODataPropertyFromV4Metadata(i,r.$Type,l),f="",c,p;var g=e.getSetting("ovpCardProperties");var v=g&&g.getProperty("/contentFragment");if(!o){if(t.Value.$Path&&t.Value.$Path.split("/").length>1){s=ne(i,r,t.Value.$Path)}if(!s){return""}if(s.$Type==="Edm.DateTime"||s.$Type==="Edm.DateTimeOffset"){var m={relative:true,relativeScale:"auto"},h=g&&g.getProperty("/showDateInRelativeFormat");if(h!==undefined&&!h){m={style:"medium"}}p={dateFormat:m,bUTC:s.$Type==="Edm.DateTime"?true:false};c="sap.ovp.cards.AnnotationHelper.formatDate";f=te([t.Value.$Path||l.split("/")[l.split("/").length-1]],c,p)}else if(t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits>=0||s["scale"]){var y=t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits||0,d=t.ValueFormat&&t.ValueFormat.ScaleFactor&&t.ValueFormat.ScaleFactor.$Decimal,T;if(s.annotations&&s.annotations["@"+C.ISO_CURRENCY]){T=s.annotations["@"+C.ISO_CURRENCY].$Path||s.annotations["@"+C.ISO_CURRENCY]}else if(s.annotations&&s.annotations["@"+C.UOM]){T=s.annotations["@"+C.UOM].$Path||s.annotations["@"+C.UOM]}else if(s.annotations&&s.annotations["@sap:unit"]){T=s.annotations["@sap:unit"]}var b=P.getODataPropertyFromV4Metadata(i,r.$Type,T),V=[t.Value.$Path||l.split("/")[l.split("/").length-1]];if(y>2){y=2}p={numberOfFractionalDigits:y,scaleFactor:d};if(s.annotations&&s.annotations["@"+C.ISO_CURRENCY]){var D=s.annotations["@"+C.ISO_CURRENCY];if(D.$Path){c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency";V.push(D.$Path)}else if(D.String){p.currencyString=D.String;c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency"}}else if(b&&(b[C.ISO_CURRENCY]||b["sap:semantics"]==="currency-code")){c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency";V.push(T)}else{c="sap.ovp.cards.v4.V4AnnotationHelper.formatNumberCalculation"}f=te(V,c,p)}else{if(u){f=a.format(t.Value,{context:e})}else{var I=a.format(t.Value,e.getModel()?{context:e}:{context:e.getInterface(0)});var $=I.split(",");var F=[];if($.length>1){for(var S=0;S<$.length;S++){if($[S].indexOf("path:")>=0||$[S].indexOf("type:")>=0){F.push($[S])}}if(F.length>0){f=f+F.join(",");if(f.substring(f.length-1)!=="}"){f=f+"}"}}}else{f=I}}}if(v){f=W(e,r,s,f)}if(s.annotations&&s.annotations["@"+C.UOM]){var O=s.annotations["@"+C.UOM];if(O.$Path){f+=" "+te([O.$Path]);f+=" "+Z(O.$Path,i,r)}else if(O.String){if(O.String!=="%"){f+=" "}f+=O.String}}}if(!n){if(s.annotations&&s.annotations["@"+C.ISO_CURRENCY]){var D=s.annotations["@"+C.ISO_CURRENCY];if(D){if(D.$Path){f+=" "+te([D.$Path])}else{f+=" "+D}f+=" "+Z(D.$Path,i,r)}}}if(f[0]===" "){f=f.substring(1)}f=f.replace("\\","");f=f.replace("\\","");f=f.replace("Unsupported: ","");f=f.replace("$P","p");return f}function Z(e,t,r){if(e){var a,i,n;if(e.split("/").length>1){a=ne(t,r,e);i=he(t,r,e)}else{a=ee(t,r,e)}if(a){n=a["@"+C.TEXT]&&a["@"+C.TEXT].$Path}if(n&&i){n=i+"/"+n}if(n){return" ({"+n+"})"}return""}}function ee(e,t,r){var a=e.getData().$Annotations[t.$Type+"/"+r];var i=P.getEntitySetName(e,t.$Type);var n=e.getObject("/"+i+"/"+r);var o=y.merge(true,{},a,n);return o}function te(e,t,r,a){var i="",n=e.length;if(n>1||r){i="{parts:[";for(var o=0;o<n;o++){if(a){i+="{path: '"+e[o]+"',type:'sap.ui.model.odata.type.String'}"+(o===n-1&&!r?"]":", ")}else{i+="{path: '"+e[o]+"'}"+(o===n-1&&!r?"]":", ")}}if(r){var u="{value:"+JSON.stringify(r)+", model: 'ovpCardProperties'}";i+=u+"]"}}else{i="{path: '"+e[0]+"'"}i+=(t?", formatter: '"+t+"'":"")+"}";return i}function re(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"){r=e.getIntegerInstance().parse(r)}return a.format(Number(r))}function ae(){var e=arguments[arguments.length-1],r=arguments[0];var a=t.getInstance(e.dateFormat);if(!r){r="";return r}return a.format(new Date(r),e.bUTC)}function ie(){var t=arguments[arguments.length-1],r=Number(arguments[0]),a=arguments[1];var i="";var n=e.getCurrencyInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"){r=e.getIntegerInstance().parse(r)}if(a){i=n.format(r,a)}else{i=t.currencyString?n.format(r,t.currencyString):n.format(r)}return i}function ne(e,t,r){var a=r.split("/");if(a.length>1){for(var i=0;i<a.length-1;i++){t=e.getProperty("/"+t.$Type)[a[i]]}return ee(e,t,a[a.length-1])}}function oe(e,t,r){var a=R(e,t);var i=d.StateValues;var n=a[r];if(!n){return i.None}if(n.Criticality){return fe(e,n,i)}return pe(e,n,i)}function ue(e,t,r){var a=R(e,t);if(a&&a.length){var i=a[0];if(i&&(i.Criticality||i.CriticalityCalculation)){return true}}return false}function le(e,t,r){if(ue(e,t,r)){return""}return"sapUiChartPaletteQualitativeHue1"}le.requiresIContext=true;function se(e,t,r){var a=R(e,t),i=d.ColorValues;var n=i.None;if(a.length>r){var o=a[r];if(o&&o.Criticality){n=fe(e,o,i)}else{n=pe(e,o,i)}}return n}function fe(e,t,r){var i=r.None;var n;var o=t.Criticality;if(o){n="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+r.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+r.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+r.Positive+"'' : "+"''"+r.None+"'' '}'";if(o.$Path){var u="$"+a.format(o,{context:e});i=s(n,u)}else if(o.$EnumMember){var l="'"+o.$EnumMember+"'";i=s(n,l)}else{V.warning("Case not supported, returning the default Neutral state")}}else{V.warning("Case not supported, returning the default Neutral state")}return i}function ce(e,t,r){var a=R(e,t);var i="None";if(a.length>r){var n=a[r];if(n&&n.Criticality&&n.Criticality.Path){i=z(e,t,r)}else{i=pe(e,n,d.StateValues);i=N(i)}}return i}function pe(e,t,r,a){var i=r.None;if(t.Criticality){i=O(t.Criticality,r)}else if(t.CriticalityCalculation&&t.Value&&t.Value&&t.Value.$Path){i=ge(e,t,r,a)}return i}function ge(e,t,r,a){var i=Oe(t.Value,a);var n=t.CriticalityCalculation.ImprovementDirection.$EnumMember;var o=Oe(t.CriticalityCalculation.DeviationRangeLowValue,a);var u=Oe(t.CriticalityCalculation.DeviationRangeHighValue,a);var l=Oe(t.CriticalityCalculation.ToleranceRangeLowValue,a);var s=Oe(t.CriticalityCalculation.ToleranceRangeHighValue,a);var f=me(o);var c=me(u);var p=me(l);var g=me(s);var v={deviationLow:o,deviationHigh:u,toleranceLow:l,toleranceHigh:s,bIsDeviationLowBinding:f,bIsDeviationHighBinding:c,bIsToleranceLowBinding:p,bIsToleranceHighBinding:g,sImprovementDirection:n,oCriticalityConfigValues:r};var m="{value:"+JSON.stringify(v)+", model: 'ovpCardProperties'}";var h="parts: ["+i;h+=f?","+o:"";h+=c?","+u:"";h+=p?","+l:"";h+=g?","+s:"";h+=","+m;h+="]";var y="sap.ovp.cards.v4.V4AnnotationHelper.formatColor";return"{"+h+", formatter: '"+y+"'}"}function ve(){var e=arguments[arguments.length-1];var t=1;return E(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationLow,e.bIsDeviationHighBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationHigh,e.bIsToleranceLowBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceLow,e.bIsToleranceHighBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceHigh,e.oCriticalityConfigValues)}function me(e){return typeof e==="string"&&e.charAt(0)==="{"}function he(e,t,r){var a="";var i=r.split("/");if(i.length>1){i.pop();a=i.join("/")}return a}function ye(e){var t;if(e&&typeof e.getData==="function"){var r=e.getData();if(r.tabs){var a=0;var i=r.selectedKey;if(i&&r.tabs.length>=i){a=i-1}t=r.tabs[a].mFilterPreference}else{t=r.mFilterPreference}}return!!t}function Pe(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/metaModel");var i=a.getData();var n=t;var o,u,l,s;if(r.getProperty("/selectionAnnotationPath")){o="@"+r.getProperty("/selectionAnnotationPath");u=i["$Annotations"][n.$Type][o]}if(r.getProperty("/presentationAnnotationPath")){l=r.getProperty("/presentationAnnotationPath");l="@"+l;s=i["$Annotations"][n.$Type][l]}var f="/"+r.getProperty("/entitySet");var c=Array.prototype.slice.call(arguments,2);var p=e.getSetting("ovpCardProperties"),g=p.getProperty("/parameters");if(u||!!g){if(u&&u.Parameters&&u.Parameters.length>0||!!g){f=$t(e.getSetting("dataModel"),t,u,g)}}if(r.getProperty("/cardLayout")&&r.getProperty("/cardLayout/noOfItems")){var v="{path: '"+f+"', length: "+ +r.getProperty("/cardLayout/noOfItems")}else{var v="{path: '"+f+"', length: "+Ne(r)}var m=de(a,n.$Type,c);var h=ye(r);if(h||m.length>0){v=v+", parameters: {"}if(m.length>0){if(m.length>0){v=v+"$expand: '"+m.join(",")+"'"}if(h){v=v+", "}}if(h){v=v+"custom: {cardId: '"+r.getProperty("/cardId")+"'}"}if(h||m.length>0){v=v+", $count: true}"}else{v=v+", parameters: {$count:true}"}var y=Ce(r,s);if(y.length>0){v=v+", sorter:"+JSON.stringify(y)}var P=Ie(r,u);if(P.length>0){v=v+", filters:"+JSON.stringify(P)}v=v+"}";return v}Pe.requiresIContext=true;function de(e,t,r){var a=[];var i,n;for(var o=0;o<r.length;o++){if(!r[o]){continue}i=e.getData()["$Annotations"][t]["@"+r[o]];i=i?i:[];for(var u=0;u<i.length;u++){if(i[u].Value&&i[u].Value.$Path){n=he(e,t,i[u].Value.$Path);if(n&&a.indexOf(n)===-1){a.push(n)}}}}return a}function Ce(e,t){var r=[];var a,i;var n=e.getProperty("/sortBy");if(n){var o=e.getProperty("/sortOrder");if(o&&o.toLowerCase()!=="descending"){i=false}else{i=true}a={path:n,descending:i};r.push(a)}var u=t&&t.SortOrder||undefined;var l,n;if(u){for(var s=0;s<u.length;s++){l=u[s];n=l.Property.$PropertyPath;i=$e(l.Descending,true);a={path:n,descending:i};r.push(a)}}return r}function Te(e){var t=[];var r=e&&e.RequestAtLeast||undefined;if(r){for(var a=0;a<r.length;a++){if(r[a].PropertyPath){t.push(r[a].PropertyPath)}}}return t}function be(e){var t=e.getProperty("/entityType");var r=t[e.getProperty("/selectionAnnotationPath")];return{filters:Ie(e,r),parameters:De(r)}}function Ve(e){if(!e){return}var t=e.getProperty("/entityType");var r=t[e.getProperty("/presentationAnnotationPath")];var a=Ce(e,r);var i=[];var n,o=a.length;for(n=0;n<o;n++){if(!a[n].path){continue}i.push({Property:a[n].path,Descending:a[n].descending})}if(i.length>0){return{SortOrder:i}}}function De(e){var t,r=[];if(!e||!e.Parameters){return r}var a=e.Parameters.length;for(var i=0;i<a;i++){t=e.Parameters[i];if(!t.PropertyName||!t.PropertyName.PropertyPath){continue}if(!t.PropertyValue){V.error("Missing value for parameter "+t.PropertyName.PropertyPath);continue}r[r.length]={path:t.PropertyName.PropertyPath,value:Se(t.PropertyValue)}}return r}function Ie(e,t){var r=[];var a;var n=e.getProperty("/filters");if(n){r=r.concat(n)}if(t&&t.SelectOptions){a=t.SelectOptions}else{a=t}var o,u,l;if(a){for(var s=0;s<a.length;s++){o=a[s];u=o.PropertyName.$PropertyPath;for(var f=0;f<o.Ranges.length;f++){l=o.Ranges[f];if(l.Sign.$EnumMember){var c={path:u,operator:l.Option.$EnumMember.split("/")[1],value1:Se(l.Low),value2:Se(l.High),sign:l.Sign.$EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(c.sign==="E"&&c.operator!==i.EQ){V.error("Exclude sign is supported only with EQ operator");continue}if(c.sign==="E"&&c.operator===i.EQ){c.operator=i.NE;c.sign="I"}if(c.operator==="CP"&&c.sign==="I"){var p=i.Contains;var g=c.value1;if(g){var v=g.indexOf("*");var m=g.lastIndexOf("*");if(v>-1){if(v===0&&m!==g.length-1){p=i.EndsWith;g=g.substring(1,g.length)}else if(v!==0&&m===g.length-1){p=i.StartsWith;g=g.substring(0,g.length-1)}else{g=g.substring(1,g.length-1)}}}c.operator=p;c.value1=g}r.push(c)}}}}return r}function $e(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function Fe(e){var t;if(e){if(e.String){t=Number(e.String)}else if(e.Int){t=Number(e.Int)}else if(e.$Decimal){t=Number(e.$Decimal)}else if(e.Double){t=Number(e.Double)}else if(e.Single){t=Number(e.Single)}else if(typeof e==="number"){return e}}return t}function Se(e){var t;if(e){if(e.String||e.String===""){t=e.String}else if(typeof e=="string"){t=e}else if(e.Boolean||e.Bool){t=$e(e)}else if(e.DateTime){t=e.DateTime}else if(e.DateTimeOffset){t=e.DateTimeOffset}else{t=Fe(e)}}return t}function Oe(e,t){if(e){if(e.$Path){return t?"{path:'"+e.$Path+"Agg"+"', type:'sap.ui.model.odata.type.Decimal'}":"{path:'"+e.$Path+"'}"}else{return Se(e)}}else{return""}}function Ne(e){var t=e.getProperty("/contentFragment");var r=e.getProperty("/listType");var a=e.getProperty("/listFlavor");var i;var o="desktop";if(n.system.phone){o="phone"}else if(n.system.tablet){o="tablet"}if(t=="sap.ovp.cards.list.List"){if(r=="extended"){if(a=="bar"){i=b["List_extended_bar"]}else{i=b["List_extended"]}}else if(a=="bar"){i=b["List_condensed_bar"]}else{i=b["List_condensed"]}}else if(t=="sap.ovp.cards.table.Table"){i=b["Table"]}else if(t=="sap.ovp.cards.stack.Stack"){if(e.getProperty("/objectStreamCardsNavigationProperty")){i=b["Stack_complex"]}else{i=b["Stack_simple"]}}if(i){return i[o]}return 5}function xe(e){var t=e.getObject();var r=R(e,t,true);var a=r.map(function(e){if(e&&e.Value&&e.Value.$Path){return e.Value.$Path}else if(e&&e.fn&&e.fn.$Path){return e.fn.$Path}});t.filter(function(e,r){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"&&a.indexOf(e.Value.$Path)>-1){t.splice(r,1)}});return e.sPath}xe.requiresIContext=true;function Ee(e,t){if(t.charAt(0)==="/"||t.indexOf("http")===0){return t}var r=e.getModel(0).getProperty("/baseUrl");if(r){return r+"/"+t}return t}Ee.requiresIContext=true;function Ae(e,t){var r=R(e,t);return r.length}Ae.requiresIContext=true;function Me(e,t){return Ue(e,t,0)}Me.requiresIContext=true;function Re(e,t){return Ue(e,t,1)}Re.requiresIContext=true;function Ue(e,t,r){var a=R(e,t),i=a[r];if(i&&i.Value&&i.Value.$Path){return i.Value.$Path}return""}function we(e,t){return j(e,t,0)}we.requiresIContext=true;function qe(e,t){return j(e,t,1)}qe.requiresIContext=true;function Le(e,t){return j(e,t,2)}Le.requiresIContext=true;function _e(e,t){return j(e,t,3)}_e.requiresIContext=true;function Be(e,t){return j(e,t,4)}Be.requiresIContext=true;function He(e,t,r){return H(e,t,r)}He.requiresIContext=true;function je(e,t,r){return X(e,t,r)}je.requiresIContext=true;function ke(e,t,r,a){var i=Ae(e,t);if(i>0){return je(e,t,r)}else{return He(e,t,a)}}ke.requiresIContext=true;function Ge(e,t,r){return pt(e,t,r)}Ge.requiresIContext=true;function Xe(e,t){return k(e,t,0)}Xe.requiresIContext=true;function Ye(e,t){return k(e,t,1)}Ye.requiresIContext=true;function ze(e,t){return k(e,t,2)}ze.requiresIContext=true;function Je(e,t){return G(e,t,0)}Je.requiresIContext=true;function Qe(e,t){for(var r=0;r<t.length;r++){var i=t[r];if(i.$Type==="com.sap.vocabularies.UI.v1.DataField"){if(i.IconUrl&&i.IconUrl.String){return i.IconUrl.String}if(i.IconUrl&&i.IconUrl.$Path){return a.format(i.IconUrl,{context:e})}}}}Qe.requiresIContext=true;function We(e,t,r){var a="";var i;if(Array.isArray(t)){i=R(e,t)[r]}else{var n=Object.assign({},t);var o=Object.assign({},e);i=ft(o,n)}if(!i||!i.Value){return a}var u=e.getSetting("ovpCardProperties");var l=u&&u.getProperty("/entityType");var s=u&&u.getProperty("/metaModel");var f=s&&s.getData()["$Annotations"][l.$Type+"/"+i.Value.$Path];var c=f&&f["@"+C.ISO_CURRENCY];if(c){if(c.$Path){a+=" "+te([c.$Path])}else{a+=" "+c}a+=" "+Z(c.$Path,s,l)}return a}We.requiresIContext=true;function Ke(e,t,r,a){return X(e,t,r,a)}Ke.requiresIContext=true;function Ze(e,t){return oe(e,t,0)}Ze.requiresIContext=true;function et(e,t){return se(e,t,0)}et.requiresIContext=true;function tt(e,t){return oe(e,t,1)}tt.requiresIContext=true;function rt(e,t){return oe(e,t,2)}rt.requiresIContext=true;function at(e,t){return ce(e,t,0)}at.requiresIContext=true;function it(e){var t={};t.$EnumMember="None";if(Number(e)===1){t.$EnumMember="Negative"}else if(Number(e)===2){t.$EnumMember="Critical"}else if(Number(e)===3){t.$EnumMember="Positive"}return O(t,d.ColorValues)}function nt(e,t){if(t&&t.Criticality&&t.Criticality.$Path){return"{parts: [{path:'"+t.Criticality.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.kpiValueCriticality'}"}else{return pe(e,t,d.ColorValues,true)}}nt.requiresIContext=true;function ot(e,t){return Y(e,t,0)}ot.requiresIContext=true;function ut(e,t){var r=R(e,t)[0];if(r&&(r.Criticality||r.CriticalityCalculation)){return true}return false}ut.requiresIContext=true;function lt(e,t){return Y(e,t,1)}lt.requiresIContext=true;function st(e,t){return Y(e,t,2)}st.requiresIContext=true;function ft(e,t){var r=e.getPath(0);var a=r.slice(0,r.lastIndexOf("/"));a=a.slice(0,a.lastIndexOf("/"));var i=q(a,t);t=e.getModel(0).getProperty(i);return t}function ct(e,t){if(!t){return""}return Q(e,t)}ct.requiresIContext=true;function pt(e,t,r,i){var n;var o=i==undefined?r:M(e,r)[i];var u=e.getSetting("ovpCardProperties");var l=u.getProperty("/metaModel");var s=t.$Type;var f=l.getData()["$Annotations"][s+"/"+o.Value.$Path];if(f){n=f["@com.sap.vocabularies.Common.v1.SemanticObject"];if(n){return a.format(n,e.getModel()?{context:e}:{context:e.getInterface(0)})}else{return""}}}function gt(e,t,r){var a=r===undefined?t.Value.$Path:t[r].Value.$Path;var i=a.indexOf("/")!=-1?a.split("/")[0]:"";return i}gt.requiresIContext=true;function vt(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/metaModel");var i=a.getData()["$Annotations"][t.$Type];if(i["@com.sap.vocabularies.Communication.v1.Contact"]){return true}return false}vt.requiresIContext=true;function mt(e,t,r){if(!t){return""}var a=e.getSetting("ovpCardProperties");var i=a.getProperty("/entityType");var n=a.getProperty("/metaModel");var o=Object.assign({},t);var u=Object.assign({},e);t=ft(u,o);return J(e,t,i,n,r)}mt.requiresIContext=true;function ht(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i="None",n=d.StateValues;t=ft(a,r);if(t&&t.Criticality){i=fe(e,t,n)}else{i=pe(e,t,n)}return i}ht.requiresIContext=true;function yt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=ft(a,r);if(t&&t.Criticality){return true}}yt.requiresIContext=true;function Pt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/entityType");var o=i.getProperty("/metaModel");t=ft(a,r);if(!t){return}var u=o.getProperty("/"+n.$Type)[t.Value.$Path];if(t&&u&&u.$Type=="Edm.String"&&(t.Criticality||t.CriticalityCalculation)){return"Center"}if(u&&(u.$Type=="Edm.DateTime"||u.$Type=="Edm.DateTimeOffset")){return"Right"}}Pt.requiresIContext=true;function dt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=ft(a,r);var i="None";if(t&&t.Criticality&&t.Criticality.Path){i="{path:'"+t.Criticality.Path+"'}"}else{i=pe(e,t,d.StateValues);i=N(i)}return i}dt.requiresIContext=true;function Ct(e,t){var r;for(var a=0;a<t.length;a++){r=t[a];if(r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1}}return 0}Ct.requiresIContext=true;function Tt(e,t){var r=R(e,t)[0];if(r&&r.Value&&r.Value.$Path){var a=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);var i=e.getModel(0);var n=i.getData(r.Value.$Path);var o=a.substr(1,a.length-2);if(n&&n[o][r.Value.$Path][C.UOM]){return n[C.UOM].String==="%"}}return false}Tt.requiresIContext=true;function bt(e){var t=e.getObject();var r=e.getModel();var a=r.getProperty("/metaModel");var i="/"+r.getProperty("/entitySet");var n=a.getObject(i);t="/"+n.$Type+"/@"+t;return a.createBindingContext(t)}function Vt(e,t){if(e==="Edm.String"){var r=t.PropertyValue.String;return r}return t.PropertyValue.String}function Dt(e,t,r,a){var i="";var n=[];if(a&&a.Parameters){e.parameters.forEach(function(r){a.Parameters.forEach(function(a){var i=a.PropertyName.PropertyPath.split("/");i=i[i.length-1];if(i===r){var o=Vt(e["parameterType"][r],a);o=g(t.formatValue(o,e["parameterType"][r]));n.push(i+"="+o)}})})}else{i="/"+r.name;V.error("SelectionParameters","There are no parameters to resolve");return i}try{i="/"+e.entitySetName+"("+n.join(",")+")/"+e.navPropertyName}catch(e){i="/"+r.name;V.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return i}function It(e,t,r,a,i){var n="";var l=new o.Model(o.Model.ReferenceByModel(e));var s=l.findQueryResultByName(t.name);var f=new o.QueryResultRequest(s);var p=s.getParameterization();if(!p){n="/"+t.name;return n}if(i){var g=i.getAnalyticalParameters()}if(p){var v;f.setParameterizationRequest(new o.ParameterizationRequest(p));if(r&&r.Parameters){c(r.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){v=this.PropertyNameFrom.PropertyPath.split("/");f.getParameterizationRequest().setParameterValue(v[v.length-1],this.PropertyValueFrom.String,this.PropertyValueTo.String)}else{v=this.PropertyName.PropertyPath.split("/");f.getParameterizationRequest().setParameterValue(v[v.length-1],this.PropertyValue.String)}})}else if(a){c(a,function(){f.getParameterizationRequest().setParameterValue(this.path,this.value)})}else if(g&&g.length>0){var m=i&&i.getUiState({allFilters:false});var h=m?JSON.stringify(m.getSelectionVariant()):"{}";var r=new u(h);for(var y in p.getAllParameters()){for(var P=0;P<g.length;P++){if(g[P]&&g[P].name==y){var d=g[P].name;var C=r.getParameter(d);if(!C){var T=r.getSelectOption(d);C=T&&T[0]&&T[0].Low}f.getParameterizationRequest().setParameterValue(y,C)}}}}else{n="/"+t.name;V.error("SelectionParameters","There are no parameters to resolve");return n}}try{n=f.getURIToQueryResultEntitySet()}catch(e){s=f.getQueryResult();n="/"+s.getEntitySet().getQName();V.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return n}function $t(e,t,r,a,i){var n="";if(p.checkAnalyticalParameterisedEntitySet(e,t.name)){n=It(e,t,r,a,i)}else{var o=p.getParametersByEntitySet(e,t.name);var u=p.getPropertyOfEntitySet(e,t.name);var l={};if(o){o["parameters"].forEach(function(e){u.forEach(function(t){if(t["name"]==e){l[e]=t["type"]}})});o["parameterType"]=l;n=Dt(o,e,t,r)}else{n="/"+t.name}}return n}function Ft(e,t,r){var a=e.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<a.length;i++){if(r+"."+a[i].name===t){return a[i]}}}function St(e,t){var r=e.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"){return true}return false});var a=_(r);if(a){return a[t]}return}function Ot(e,t,r){if(!r||!r.length||r.length===0){return false}r=St(r,0);return pt(e,t,r)}Ot.requiresIContext=true;function Nt(e,t,r){if(!r||!r.length||r.length===0){return false}r=St(r,1);return pt(e,t,r)}Nt.requiresIContext=true;function xt(e,t){var r=e.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.Communication.v1.Contact")!==-1){return true}return false});var a=_(r);if(a){return a[t]}return}function Et(e){if(!e||!e.length||e.length===0){return false}var t=xt(e,0);if(t){return true}return false}function At(e,t,a,i){var n;if(a&&a.Value&&a.Value.$Path){n=a.Value.$Path}else if(a&&a.Description&&a.Description.Value&&a.Description.Value.$Path){n=a.Description.Value.$Path}var o="";var u=i&&i.Parameters;var l="";var s=e.getSetting("ovpCardProperties"),f=s.getProperty("/parameters");u=u||!!f;var c=e.getSetting("dataModel");var p=e.getModel(0);var g=P.getEntitySetName(p,t.$Type);if(u){var v=$t(c,t,i,f);o+="{path: '"+v+"'"}else{o+="{path: '/"+g+"'"}o+=", length: 1";var m=e.getSetting("ovpCardProperties");var h=m.getProperty("/entityType");var y=p.getObject("/"+g+"/");var d,C;for(d in y){if(d.startsWith("$")){continue}C=h.$Type.concat("/",d);y[d].annotations=p.getData(d).$Annotations[C]}var T=Ie(m,i);if(T.length>0){l+=", filters: "+JSON.stringify(T)}var b=[];var V=c.oMetaModel.getData().$Annotations;var D;var I=m.getProperty("/measureAggregate");if(I&&I.hasOwnProperty(n)){D=I[n]}else{D=Mt(n,V,t.$Type)}b.push("'"+n+"Agg' : { 'name' : '"+n+"', 'with' : '"+D+"'}");if(a&&a.Criticality&&a.Criticality.$Path){D=Mt(a.Criticality.$Path,V,t.$Type);b.push("'"+a.Criticality.$Path+"Agg' : { 'name' : '"+a.Criticality.$Path+"', 'with' : '"+D+"'}")}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.DeviationRangeLowValue&&a.CriticalityCalculation.DeviationRangeLowValue.$Path){D=Mt(a.CriticalityCalculation.DeviationRangeLowValue.$Path,V,t.$Type);b.push("'"+a.CriticalityCalculation.DeviationRangeLowValue.$Path+"Agg' : { 'name' : '"+a.CriticalityCalculation.DeviationRangeLowValue.$Path+"', 'with' : '"+D+"'}")}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ToleranceRangeLowValue&&a.CriticalityCalculation.ToleranceRangeLowValue.$Path){var D=Mt(a.CriticalityCalculation.ToleranceRangeLowValue.$Path,V,t.$Type);b.push("'"+a.CriticalityCalculation.ToleranceRangeLowValue.$Path+"Agg' : { 'name' : '"+a.CriticalityCalculation.ToleranceRangeLowValue.$Path+"', 'with' : '"+D+"'}")}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.DeviationRangeHighValue&&a.CriticalityCalculation.DeviationRangeHighValue.$Path){var D=Mt(a.CriticalityCalculation.DeviationRangeHighValue.$Path,V,t.$Type);b.push("'"+a.CriticalityCalculation.DeviationRangeHighValue.$Path+"Agg' : { 'name' : '"+a.CriticalityCalculation.DeviationRangeHighValue.$Path+"', 'with' : '"+D+"'}")}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ToleranceRangeHighValue&&a.CriticalityCalculation.ToleranceRangeHighValue.$Path){var D=Mt(a.CriticalityCalculation.ToleranceRangeHighValue.$Path,V,t.$Type);b.push("'"+a.CriticalityCalculation.ToleranceRangeHighValue.$Path+"Agg' : { 'name' : '"+a.CriticalityCalculation.ToleranceRangeHighValue.$Path+"', 'with' : '"+D+"'}")}if(a&&a.TrendCalculation&&a.TrendCalculation.ReferenceValue&&a.TrendCalculation.ReferenceValue.$Path){var D=Mt(a.TrendCalculation.ReferenceValue.$Path,V,t.$Type);b.push("'"+a.TrendCalculation.ReferenceValue.$Path+"Agg' : { 'name' : '"+a.TrendCalculation.ReferenceValue.$Path+"', 'with' : '"+D+"'}")}var $=ye(s);var F=$?", custom: {cardId: '"+s.getProperty("/cardId")+"'}":"";var S=r.getUnitColumnForODataV4(n,p,g);var O=S?", group: {"+S+": {}}":"";var N="parameters:{'$$aggregation' : {'aggregate' : {"+b.join(",")+"}"+O+"}"+F+"}";return o+", "+N+l+"}"}At.requiresIContext=true;function Mt(e,t,r){var a=t[r+"/"+e];if(a["@Org.OData.Aggregation.V1.default"]){return a["@Org.OData.Aggregation.V1.default"].$EnumMember.split("/")[1].toLowerCase()}return"sum"}function Rt(e){if(!e||!e.Value||!e.Value.$Path){return""}var t=this.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/metaModel");var i=ee(a,r,e.Value.$Path);if(i[C.UOM]){var n=i[C.UOM];if(n.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailable=true}}if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=e.ValueFormat.NumberOfFractionalDigits}var o={NumberOfFractionalDigits:this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits?this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits:0,percentageAvailable:this.getModel("ovpCardProperties").oData.percentageAvailable?this.getModel("ovpCardProperties").oData.percentageAvailable:false};var u="sap.ovp.cards.v4.V4AnnotationHelper.KpiValueFormatter";var l=[e.Value.$Path+"Agg"];return te(l,u,o,true)}function Ut(){var t=arguments[arguments.length-1],r=arguments[0];r=Number(r);var a=e.getFloatInstance({minFractionDigits:t.NumberOfFractionalDigits,maxFractionDigits:t.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:r});if(t.percentageAvailable){return a.format(Number(r))+" %"}else{return a.format(Number(r))}}function wt(e,t){if(!t||!t.Value||!t.Value.$Path||!t.TrendCalculation){return""}var r=Oe(t.Value,true);var a=Oe(t.TrendCalculation.ReferenceValue,true);var i=Oe(t.TrendCalculation.DownDifference,true);var n=Oe(t.TrendCalculation.UpDifference,true);var o=me(a);var u=me(i);var l=me(n);var s={referenceValue:a,downDifference:i,upDifference:n,bIsRefValBinding:o,bIsDownDiffBinding:u,bIsUpDiffBinding:l};var f="{value:"+JSON.stringify(s)+", model: 'ovpCardProperties'}";var c="parts: ["+r;c+=o?","+a:"";c+=u?","+i:"";c+=l?","+n:"";c+=","+f;c+="]";var p="sap.ovp.cards.v4.V4AnnotationHelper.formatTrendIcon";return"{"+c+", formatter: '"+p+"'}"}wt.requiresIContext=true;function qt(){var e=arguments[arguments.length-1];var t=1;return A(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference)}function Lt(e){if(!e||!e.TrendCalculation||!e.TrendCalculation.ReferenceValue){return""}if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=e.ValueFormat.NumberOfFractionalDigits}if(e.TrendCalculation.ReferenceValue.$Path){return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}, {path:'"+e.TrendCalculation.ReferenceValue.$Path+"'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.returnPercentageChange'}"}else{return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.returnPercentageChange'}"}}function _t(t,r){var a,i,n,o,u=false;if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(isNaN(+t)){return""}if(t==0){o=r}else{o=t}i=this.getModel("ovpCardProperties");if(i.getProperty("/iNumberOfFractionalDigits")){n=+i.getProperty("/iNumberOfFractionalDigits")}if(i.getProperty("/bPercentageAvailableForTarget")){u=true}if(r){a=r}else{if(i.getProperty("/sManifestTargetValue")){a=i.getProperty("/sManifestTargetValue")}}if(!n||n<0){n=0}else if(n>2){n=2}if(a){var l=e.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:o});if(u){return l.format(+a)+" %"}else{return l.format(+a)}}}function Bt(e){if(!e||!e.TrendCalculation||!e.TrendCalculation.ReferenceValue){return""}if(!e||!e.Value||!e.Value.$Path){return""}var t=this.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/metaModel");if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){t.setProperty("/iNumberOfFractionalDigits",e.ValueFormat.NumberOfFractionalDigits)}if(e.TrendCalculation.ReferenceValue){if(e.TrendCalculation.ReferenceValue.$Path){var i=ee(a,r,e.TrendCalculation.ReferenceValue.$Path);if(i[C.UOM]){var n=i[C.UOM];if(n.String=="%"){t.setProperty("/bPercentageAvailableForTarget",true)}}return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'},{path:'"+e.TrendCalculation.ReferenceValue.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.TargetValueFormatter'}"}if(e.TrendCalculation.ReferenceValue){t.setProperty("/sManifestTargetValue",e.TrendCalculation.ReferenceValue);return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.TargetValueFormatter'}"}}}function Ht(t,r){var a,i,n;if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(isNaN(+t)){return""}t=+t;n=this.getModel("ovpCardProperties");if(n.getProperty("/iNumberOfFractionalDigits")){a=+n.getProperty("/iNumberOfFractionalDigits")}if(r){i=+r}else{if(n.getProperty("/sManifestTargetValue")){i=+n.getProperty("/sManifestTargetValue")}}if(!a||a<0){a=0}else if(a>2){a=2}if(i){var o=(t-i)/i;var u=e.getPercentInstance({style:"short",minFractionDigits:a,maxFractionDigits:a,showScale:true});return u.format(o)}}function jt(e){if(e&&e.GroupBy&&!h(e.GroupBy)&&e.GroupBy[0].hasOwnProperty("$PropertyPath")){return true}else{return false}}function kt(e,t){var r;for(var a=0;e&&a<e.length;a++){if(e[a].value==t){r=e[a];break}}return r?r.name:null}function Gt(e,t){return kt(e,t)}function Xt(e,t){var r=kt(e,t);return r?r:l.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION")}function Yt(e){var t="";var r=e&&e.GroupBy;if(!r){return t}var a=this.getModel("ovpCardProperties").getProperty("/metaModel");var i=this.getModel("ovpCardProperties").getProperty("/entityType");var n;if(e.GroupBy.constructor===Array){n=e.GroupBy}else if(!e.GroupBy.Collection){return t}else{n=e.GroupBy.Collection}var o;c(n,function(){o=er(a,i,this.$PropertyPath);if(!o){return}t+=o;t+=", "});if(t[t.length-1]===" "&&t[t.length-2]===","){t=t.substring(0,t.length-2)}return t==""?"":l.getText("By",[t])}function zt(e,t,r){var a=true;var i=r["SelectOptions"].length-1;if(t.PropertyName.PropertyPath===r["SelectOptions"][i].PropertyName.PropertyPath){a=false}t=[t];var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");var l=Ie(n,t);if(l.length==0){return""}var s;var f;s=l[0].path;f=tr(u,o,s);if(f!==s){return""}var c=u.getODataProperty(o,t[0].PropertyName.PropertyPath)["type"];var p=Kt(l,c);if(a===true){return p+", "}return p}zt.requiresIContext=true;function Jt(e,t,r){var a=!(t.index===r.length-1);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/metaModel");var o=i.getProperty("/entityType");var u=n.getODataProperty(o,r[t.index].path)["type"];var l=Kt([r[t.index]],u);if(a===true){return l+", "}return l}Jt.requiresIContext=true;function Qt(e){return e.id}function Wt(e){return e.id}function Kt(e,t){var r=[];for(var a=0;a<e.length;a++){r.push(Zt(e[a],t))}return r.join(", ")}function Zt(e,r){var a=false;var i,n=t.getInstance({style:"medium"});if(r==="Edm.DateTime"){i=n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i=n.format(new Date(e.value1),true)}else{i=e.value1}if(e.operator[0]==="N"){a=true}if(e.value2){if(r==="Edm.DateTime"){i+=" - "+n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i+=" - "+n.format(new Date(e.value1),true)}else{i+=" - "+e.value1}}if(a){i=l.getText("kpiHeader_Filter_NotOperator",[i])}return i}function er(e,t,r){return rr(e,t,r,"com.sap.vocabularies.Common.v1.Label")}function tr(e,t,r){return rr(e,t,r,"sap:text")}function rr(e,t,r,a){var i={};i[r]=ee(e,t,r);if(!i){V.error("No Property Found for with Name '"+r+" For Entity-Type '"+t.name+"'");return}if(i[r].annotations){var n=i[r].annotations["@"+a]}if(n){return n}return Object.keys(i)[0]}function ar(e){if(!e||!e.Value||!e.Value.$Path){return""}var t={NumberOfFractionalDigits:this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits?this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits:0,percentageAvailable:this.getModel("ovpCardProperties").oData.percentageAvailable?this.getModel("ovpCardProperties").oData.percentageAvailable:false};var r="sap.ovp.cards.v4.V4AnnotationHelper.KpiValueFormatter";var a=[e.Value.$Path];return te(a,r,t)}function ir(e,t){if(t.hasOwnProperty(e)){return true}return false}function nr(e,t){var r;if(t[e].customDateRangeImplementation){return t[e].customDateRangeImplementation}else if(t[e].filter){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:t[e].filter}};return JSON.stringify(r)}else if(t[e].selectedValues){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:[{path:"key",contains:t[e].selectedValues,exclude:t[e].exclude}]}};return JSON.stringify(r)}else if(t[e].defaultValue){r={module:"sap.ui.comp.config.condition.DateRangeType"};return JSON.stringify(r)}}function or(e){if(e){return undefined}return"_BASIC"}function ur(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("ContactInformationType/work")>=0){var i=a.format(t[r].address,{context:e});return i}}return""}ur.requiresIContext=true;function lr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/work")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}lr.requiresIContext=true;function sr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/cell")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}sr.requiresIContext=true;function fr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/fax")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}fr.requiresIContext=true;return{getGroupID:or,getConditionTypeForDateProperties:nr,isDateRangeType:ir,criticalityConstants:d,TextArrangementType:T,getLabelForDataItem:I,colorPaletteForComparisonMicroChart:le,formatField:Q,checkFilterPreference:ye,formatItems:Pe,getCardSelections:be,getCardSorters:Ve,getFilters:Ie,getPrimitiveValue:Se,getAnnotationLabel:Gt,getApplicationName:Xt,removeDuplicateDataField:xe,formatUrl:Ee,getDataPointsCount:Ae,getFirstDataPointValue:Me,getFirstDataFieldName:we,getSecondDataFieldName:qe,getRequestFields:Te,getThirdDataFieldName:Le,formatDataFieldValueOnIndex:He,formatDataPointValueOnIndex:je,formatDataPointOrField:ke,formatsemanticObjectOfDataFieldGeneric:Ge,getLabelForFirstDataPoint:Je,formatImageUrl:Qe,formatUnit:We,formatObjectNumber:Ke,formatFirstDataPointState:Ze,formatFirstDataPointColor:et,formatSecondDataPointState:tt,formatThirdDataPointState:rt,formatFirstDataPointStateForSmartField:at,formatKPIHeaderState:nt,isFirstDataPointCriticality:ot,isFirstDataPointCriticalityForTableStatus:ut,getSortedDataFields:M,getSortedDataPoints:R,formatDataFieldValueGeneric:ct,formatDataPointValue:mt,formatDataPointStateGeneric:ht,checkCriticalityGeneric:yt,checkCriticalityGenericForTableStatus:Pt,formatDataPointStateForSmartFieldGeneric:dt,hasActions:Ct,isFirstDataPointPercentageUnit:Tt,resolveEntityTypePath:bt,resolveParameterizedEntitySet:$t,getAssociationObject:Ft,semanticObjectOfFirstDataField:Ot,semanticObjectOfSecondDataField:Nt,isFirstContactAnnotation:Et,getAggregateNumber:At,KpiValueFormatter:Ut,kpiValueCriticality:it,formThePathForAggregateNumber:Rt,formThePathForTrendIcon:wt,formPathForPercentageChange:Lt,TargetValueFormatter:_t,formPathForTargetValue:Bt,returnPercentageChange:Ht,isPresentationVarientPresent:jt,listGroupBy:Yt,formTheFilterByString:zt,formTheFilterByStringNotFromSelVar:Jt,formTheIdForFilter:Qt,formTheIdForFilterNotFromSelVar:Wt,_criticality2state:O,_calculateCriticalityState:E,_calculateTrendDirection:A,sortCollectionByImportance:_,checkNavTargetForContactAnno:gt,checkForContactAnnotation:vt,getKPIHeaderAggregateNumber:ar,formatColor:ve,formatTrendIcon:qt,formatNumberCalculation:re,formatCurrency:ie,formatDate:ae,getSapTextPathForUOM:Z,getEmail:ur,getPhone:lr,getDevice:sr,getPhoneType:fr,generatePathForField:te}},true);
//# sourceMappingURL=V4AnnotationHelper.js.map