sap.ui.define(["sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ovp/cards/CommonUtils","sap/ui/Device","sap/ui/model/resource/ResourceModel","sap/ui/core/mvc/ViewType","sap/base/util/merge","sap/ovp/app/OVPUtils","sap/ui/core/mvc/XMLView","sap/ui/core/Core"],function(t,e,a,n,i,o,r,s,l,p){"use strict";return t.extend("sap.ovp.cards.v4.generic.Component",{metadata:{properties:{contentFragment:{type:"string"},controllerName:{type:"string",defaultValue:"sap.ovp.cards.v4.generic.Card"},headerExtensionFragment:{type:"string"},contentPosition:{type:"string",defaultValue:"Middle"},headerFragment:{type:"string",defaultValue:"sap.ovp.cards.v4.generic.Header"},footerFragment:{type:"string"},identificationAnnotationPath:{type:"string",defaultValue:"com.sap.vocabularies.UI.v1.Identification"},selectionAnnotationPath:{type:"string"},filters:{type:"object"},parameters:{type:"object"},addODataSelect:{type:"boolean",defaultValue:false},enableAddToInsights:{type:"boolean",defaultValue:false}},version:"1.111.0",library:"sap.ovp",includes:[],dependencies:{libs:[],components:[]},config:{}},setSelectionVariant:function(t,e){if(/^@/.test(t)){t=t.slice(1)}e.selectionAnnotationPath=t},setPresentationVariant:function(t,e,a){if(/^@/.test(t)){t=t.slice(1)}e.presentationAnnotationPath=t;var n=t.split("/");var i=n.length===1?a[t].Visualizations:a[n[0]][n[1]][n[2]].Visualizations;var o;for(o=0;o<i.length;o++){var r=i[o].AnnotationPath;if(r){if(/^@/.test(r)){r=r.slice(1)}if(/.LineItem/.test(r)){e.annotationPath=r;break}}}for(o=0;o<i.length;o++){var r=i[o].AnnotationPath;if(r){if(/^@/.test(r)){r=r.slice(1)}if(/.Chart/.test(r)){e.chartAnnotationPath=r;break}}}},setDataPointAnnotationPath:function(t,e){if(/^@/.test(t)){t=t.slice(1)}e.dataPointAnnotationPath=t},getCustomPreprocessor:function(){},getPreprocessors:function(t){var i=this.getComponentData(),o=i.settings,l=i.model,p,d,c,u;if(o.description&&!o.subTitle){o.subTitle=o.description}p=l&&l.getMetaModel();if(l&&l.getODataVersion){var v="/"+o.entitySet;var d=p.getObject(v);u=p.createBindingContext(v);if(d&&d["$Type"]){c=p.createBindingContext("/"+d["$Type"])}}else{if(o.entitySet){var f=p.getODataEntitySet(o.entitySet);var h=p.getODataEntitySet(o.entitySet,true);d=p.getODataEntityType(f.entityType);u=p.createBindingContext(h);c=p.createBindingContext(d.$path)}}var g=this._getCardPropertyDefaults();var y=this._completeLayoutDefaults(g,o);var m,C;if(i.appComponent&&i.appComponent.getModel("ui")&&i.appComponent.getModel("ui").oData){var P=i.appComponent.getModel("ui").oData;m=P.showDateInRelativeFormat;C=P.disableTableCardFlexibility}else{if(i.showDateInRelativeFormat){m=i.showDateInRelativeFormat}if(i.disableTableCardFlexibility){C=i.disableTableCardFlexibility}}if(i.ovpCardsAsApi){i.settings.enableAddToInsights=false}var b=i&&i.appComponent&&i.appComponent.ovpConfig||{};var D={metaModel:p,entityType:d,webkitSupport:n.browser.webkit,layoutDetail:y&&y.cardLayout?y.cardLayout.containerLayout:"fixed",bInsightDTEnabled:b.bInsightDTEnabled||false,bInsightRTEnabled:b.bInsightRTEnabled||false,bInsightEnabled:b.bInsightDTEnabled||b.bInsightRTEnabled||false,showDateInRelativeFormat:m,disableTableCardFlexibility:C,cardId:i.cardId};if(!!i&&!!i.cardId){var I=i.mainComponent;var T=null;if(!!I){T=I._getCardFromManifest(i.cardId)?I._getCardFromManifest(i.cardId).template:null}else{T=i.template}if(!!T){D.template=T}}g.densityStyle=a._setCardpropertyDensityAttribute();if(i.errorReason){var V=i.errorReason;var A=V.getParameters?V.getParameters():V.mParameters;var S="sap-icon://message-error";if(A&&A.response){g.errorStatusCode=A.response.statusCode;g.errorStatusText=A.response.statusText;g.responseText=A.response.responseText;g.sMessageIcon=A.response.sIcon?A.response.sIcon:S}}if(y){D.cardLayout=y.cardLayout}if(g.state!=="Error"){if(o&&o.kpiAnnotationPath){var M=d[o.kpiAnnotationPath];var x=g.contentFragment;if(M&&(x==="sap.ovp.cards.v4.charts.analytical.analyticalChart"||x==="sap.ovp.cards.v4.charts.smart.analyticalChart")){var R=M.SelectionVariant&&M.SelectionVariant.Path?M.SelectionVariant.Path:o.kpiAnnotationPath+"/SelectionVariant";if(R){this.setSelectionVariant(R,o)}var L=M.Detail&&M.Detail.DefaultPresentationVariant&&M.Detail.DefaultPresentationVariant.Path?M.Detail.DefaultPresentationVariant.Path:o.kpiAnnotationPath+"/Detail/DefaultPresentationVariant";if(L){this.setPresentationVariant(L,o,d)}var F=M.DataPoint&&M.DataPoint.Path?M.DataPoint.Path:o.kpiAnnotationPath+"/DataPoint";if(F){this.setDataPointAnnotationPath(F,o)}}}else if(o&&o.selectionPresentationAnnotationPath){var B=d[o.selectionPresentationAnnotationPath];if(B){var R=B.SelectionVariant&&B.SelectionVariant.Path;if(R){this.setSelectionVariant(R,o)}var L=B.PresentationVariant&&B.PresentationVariant.Path;if(L){this.setPresentationVariant(L,o,d)}}}}if(i.ovpCardsAsApi&&o.ignoreSelectionVariant){o.selectionAnnotationPath="";var O=[];for(var w=0;!!o.filters&&w<o.filters.length;w++){O.push({id:"headerFilterText--"+(w+1),index:w})}o.idForExternalFilters=O}if(!!D.entityType&&!!o.selectionAnnotationPath&&!!D.entityType[o.selectionAnnotationPath]){var _=D.entityType[o.selectionAnnotationPath].SelectOptions;for(var k=0;!!_&&k<_.length;k++){_[k].id="headerFilterText--"+(k+1)}D.entityType[o.selectionAnnotationPath].SelectOptions=_}if(D.template==="sap.ovp.cards.v4.linklist"&&!!o.staticContent){for(var E=0;E<o.staticContent.length;E++){o.staticContent[E].id="linkListItem--"+(E+1)}}else if(D.template==="sap.ovp.cards.v4.charts.analytical"){o.dataStep=o.dataStep?o.dataStep:10}g=s.merge(true,{},D,g,o);var U=new e(g);var H={xml:{bindingContexts:{entityType:c,entitySet:u},models:{device:a.deviceModel,entityType:p,entitySet:p,ovpMeta:p,ovpCardProperties:U,ovplibResourceBundle:t,ovpConstants:a.ovpConstantModel},ovpCardProperties:U,dataModel:l,_ovpCache:{}}};return r({},this.getCustomPreprocessor(),H)},_completeLayoutDefaults:function(t,e){var a={},n=this.getComponentData(),i=null,o=null;if(n.appComponent){i=n.appComponent.getOvpConfig()}if(!i){return null}if(i.containerLayout==="resizable"&&n.cardId&&t.contentFragment!=="sap.ovp.cards.quickview.Quickview"){o=n.appComponent.getDashboardLayoutUtil();var r=n.cardId;var s=o.aCards.filter(function(t){return t.id===r});a.cardLayout=s[0].dashboardLayout;a.cardLayout.containerLayout=i.containerLayout;a.cardLayout.iRowHeightPx=o.ROW_HEIGHT_PX;a.cardLayout.iCardBorderPx=o.CARD_BORDER_PX;a.cardLayout.headerHeight=s[0].dashboardLayout.headerHeight}return a},_getCardPropertyDefaults:function(){var t={};var e=this.getMetadata().getAllProperties();var a;for(var n in e){a=e[n];if(a.defaultValue!==undefined){t[a.name]=a.defaultValue}}return t},getOvplibResourceBundle:function(){if(!this.ovplibResourceBundle){var t=p.getLibraryResourceBundle("sap.ovp");this.ovplibResourceBundle=t?new i({bundleUrl:t.oUrlInfo.url}):null}return this.ovplibResourceBundle},_getCacheKeys:function(){},createContent:function(){var t=this.getComponentData&&this.getComponentData();var e=t.model;var a;var n;var i=t&&t.mainComponent;var r=i&&i.oModelViewMap;var s=t&&t.modelName;var p=function(){if(e&&s){e.bIncludeInCurrentBatch=false;if(r&&s&&r[s]&&r[s][t.cardId]){delete r[s][t.cardId];if(Object.keys(r[s]).length>0){e.bIncludeInCurrentBatch=true}}}};if(t&&t.mainComponent){a=t.mainComponent._getOvplibResourceBundle()}else{a=this.getOvplibResourceBundle()}n=this.getPreprocessors(a);var d={preprocessors:n,type:o.XML,viewName:"sap.ovp.cards.v4.generic.Card"};var c=this._getCacheKeys();if(c&&c.length&&c.length>0){d.async=true;d.cache={keys:c}}var u=this._getCardPropertyDefaults().state;var v=t.cardId+(u?u:"Original");if(!u){v=v+(t.settings.selectedKey?"_Tab"+t.settings.selectedKey:"")}if(e&&e.bUseBatch&&!d.async){p()}var f=new l(t.containerId==="dialogCard"?undefined:v,d);if(d.async){var h=f.onControllerConnected;f.onControllerConnected=function(){if(e&&e.bUseBatch){p()}h.apply(f,arguments)}}f.setModel(e);if(t.i18n){f.setModel(t.i18n,"@i18n")}f.setModel(n.xml.ovpCardProperties,"ovpCardProperties");f.setModel(a,"ovplibResourceBundle");return f}})});
//# sourceMappingURL=Component.js.map