sap.ui.define(["sap/ovp/cards/v4/generic/Card.controller","sap/ui/thirdparty/jquery","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/CommonUtils","sap/ovp/app/OVPUtils","sap/ovp/app/OVPLogger","sap/ovp/cards/Filterhelper","sap/ovp/filter/FilterUtils","sap/ui/core/Core"],function(t,jQuery,e,i,a,o,n,s,r){"use strict";var d=new o("OVP.table.Table");return t.extend("sap.ovp.cards.v4.table.Table",{bdataLoadedToEnableAddToInsight:false,onInit:function(){t.prototype.onInit.apply(this,arguments);var e=this;this.eventhandler=function(t,i,a){s.applyFiltersToV4Card(a,e)};this.GloabalEventBus=r.getEventBus();if(this.oMainComponent&&(this.oMainComponent.isMacroFilterBar||this.oMainComponent.oGlobalFilter)){this.GloabalEventBus.subscribe("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",e.eventhandler)}},onColumnListItemPress:function(t){var o=a.bCRTLPressed?a.constants.explace:a.constants.inplace;a.bCRTLPressed=false;if(e.checkIfAPIIsUsed(this)){if(this.checkAPINavigation()){i.onContentClicked(t)}}else{var n=this.getEntityNavigationEntries(t.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(t.getSource().getBindingContext(),n[0],o)}},onContactDetailsLinkPress:function(t){if(this.oPopover){this.oPopover.setVisible(false)}var e,i;e=t.getSource();this.oPopover=e.getParent().getAggregation("items")[0];i=e.getBindingContext();if(!i){return}this.oPopover.bindElement(i.getPath());this.oPopover.setVisible(true);this.oPopover.openBy(e)},getCardItemsBinding:function(){var t=this.getView().byId("ovpTable");return t.getBinding("items")},onAfterRendering:function(){t.prototype.onAfterRendering.apply(this,arguments);var i=this.getOwnerComponent().getComponentData();var a=this.getCardPropertiesModel();if(!e.checkIfAPIIsUsed(this)&&a.getProperty("/layoutDetail")==="resizable"){var o=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(i.cardId);var s=Math.max(this.getHeaderHeight(),o.dashboardLayout.headerHeight);var r=this.oDashboardLayoutUtil.getCardDomId(i.cardId);var d=document.getElementById(r);if(!o.dashboardLayout.autoSpan){d.getElementsByClassName("sapOvpWrapper")[0].style.height=o.dashboardLayout.rowSpan*this.oDashboardLayoutUtil.ROW_HEIGHT_PX+1-(s+2*this.oDashboardLayoutUtil.CARD_BORDER_PX)+"px";o.dashboardLayout.autoSpan=true}if(o.dashboardLayout.showOnlyHeader){d.classList.add("sapOvpMinHeightContainer")}this.addColumnInTable(jQuery(d),{colSpan:o.dashboardLayout.colSpan})}else{var l=this.getView().byId("ovpTable");var h=l.getAggregation("columns");for(var g=0;g<3;g++){if(h[g]){h[g].setStyleClass("sapTableColumnShow").setVisible(true)}}}if(!e.checkIfAPIIsUsed(this)){var a=this.getCardPropertiesModel();var p=this.getOwnerComponent().getModel("ui").getData().cards;var c=[];var v=this.getEntitySet()&&this.getEntitySet()["$Type"];var f=v&&this.getMetaModel().getContext("/"+v);if(f){var u=f.getObject();this.selectionVaraintFilter=n.getSelectionVariantFilters(p,a,this.getEntityType())}var C=this.oCardComponentData.mainComponent;if(C.getGlobalFilter()){c=n._getEntityRelevantFilters(u,C.oGlobalFilter.getFilters())}if(C.getMacroFilterBar()){var b=C.aFilters;c=n._getEntityRelevantFilters(u,b)}c=n.mergeFilters(c,this.selectionVaraintFilter);if(this.getCardItemsBinding()){this.getCardItemsBinding().filter(c)}if(this.getKPIBinding()){this.getKPIBinding().filter(c)}}var y=this.getCardItemsBinding();if(y&&y.getPath()){y.attachDataReceived(this.onDataReceived.bind(this))}},onDataReceived:function(){this.bdataLoadedToEnableAddToInsight=true},getCardItemBindingInfo:function(){var t=this.getView().byId("ovpTable");return t.getBindingInfo("items")},addColumnInTable:function(t,e){if(e.colSpan>=1){if(jQuery(t).find("tr").length!=0){var i=r.byId(jQuery(t).find(".sapMList").attr("id"));var a=i.getAggregation("columns");var o=e.colSpan;var n=o+1;for(var s=0;s<6;s++){if(a[s]){if(s<=n){a[s].setStyleClass("sapTableColumnShow").setVisible(true)}else{a[s].setStyleClass("sapTableColumnHide").setVisible(false)}}}}}},resizeCard:function(t,e){var i,a,o,a;try{var n=document.getElementById(this.oDashboardLayoutUtil.getCardDomId(this.cardId)),s=this.getCardItemBindingInfo(),r=this.getHeaderHeight(),l=this.getView().byId("ovpCardContentContainer").getDomRef();if(t.showOnlyHeader){l.classList.add("sapOvpContentHidden");i=0}else{l.classList.remove("sapOvpContentHidden");o=r+e.dropDownHeight;a=t.rowSpan*t.iRowHeightPx-o-e.itemHeight;i=Math.abs(Math.floor(a/e.itemHeight));n.style.height=t.rowSpan*t.iRowHeightPx+"px"}l.style.height=t.rowSpan*t.iRowHeightPx-(r+2*t.iCardBorderPx)+"px";this.addColumnInTable(this.getView().getDomRef(),t);if(i!==s.length){s.length=i;t.noOfItems=s.length;this.getCardItemsBinding().refresh()}else{this._handleCountHeader()}}catch(t){d.warning("OVP resize: "+this.cardId+" catch "+t.toString())}},onExit:function(){t.prototype.onExit.apply(this,arguments)}})});
//# sourceMappingURL=Table.controller.js.map