sap.ui.define(["sap/ovp/cards/v4/generic/Card.controller","sap/ui/thirdparty/jquery","sap/ui/model/json/JSONModel","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/CommonUtils","sap/ovp/cards/v4/V4AnnotationHelper","sap/ovp/app/OVPUtils","sap/ovp/app/OVPLogger","sap/ovp/cards/Filterhelper","sap/ovp/filter/FilterUtils","sap/ui/core/Core"],function(t,jQuery,e,a,i,n,s,r,o,d,l){"use strict";var h=new r("OVP.v4.list.List");return t.extend("sap.ovp.cards.v4.list.List",{counter:0,arrayLength:0,minMaxModel:{},bdataLoadedToEnableAddToInsight:false,onInit:function(){t.prototype.onInit.apply(this,arguments);this.counter=0;this.minMaxModel=new e;this.minMaxModel.setData({minValue:0,maxValue:0});this.getView().setModel(this.minMaxModel,"minMaxModel");var a=this;this.eventhandler=function(t,e,i){d.applyFiltersToV4Card(i,a)};this.GloabalEventBus=l.getEventBus();if(this.oMainComponent&&(this.oMainComponent.isMacroFilterBar||this.oMainComponent.oGlobalFilter)){this.GloabalEventBus.subscribe("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",a.eventhandler)}},onContactDetailsLinkPress:function(t){var e,a,i;a=t.getSource();e=a.getParent().getAggregation("items")[0];i=a.getBindingContext();if(!i){return}e.bindElement(i.getPath());e.openBy(a)},onAfterRendering:function(){t.prototype.onAfterRendering.apply(this,arguments);var e=this.getCardPropertiesModel().getProperty("/imageSupported");var i=this.getCardPropertiesModel().getProperty("/densityStyle");if(e){var n=this.byId("ovpList");n.attachUpdateFinished(function(){this._addImageCss(i)}.bind(this))}if(!a.checkIfAPIIsUsed(this)&&this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var s=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var r=Math.max(this.getHeaderHeight(),s.dashboardLayout.headerHeight);var d=this.oDashboardLayoutUtil.getCardDomId(this.cardId);var l=document.getElementById(d);if(!s.dashboardLayout.autoSpan){l.getElementsByClassName("sapOvpWrapper")[0].style.height=s.dashboardLayout.rowSpan*this.oDashboardLayoutUtil.ROW_HEIGHT_PX-(r+2*this.oDashboardLayoutUtil.CARD_BORDER_PX)+"px";s.dashboardLayout.autoSpan=true}if(s.dashboardLayout.showOnlyHeader){l.classList.add("sapOvpMinHeightContainer")}}if(!a.checkIfAPIIsUsed(this)){var h=this.getCardPropertiesModel();var g=this.getOwnerComponent().getModel("ui").getData().cards;var p=[];var c=this.getEntitySet()&&this.getEntitySet()["$Type"];var v=c&&this.getMetaModel().getContext("/"+c);if(v){var u=v.getObject();this.selectionVaraintFilter=o.getSelectionVariantFilters(g,h,this.getEntityType())}var m=this.oCardComponentData.mainComponent;if(m.getGlobalFilter()){p=o._getEntityRelevantFilters(u,m.oGlobalFilter.getFilters())}if(m.getMacroFilterBar()){var f=m.aFilters;p=o._getEntityRelevantFilters(u,f)}p=o.mergeFilters(p,this.selectionVaraintFilter);if(this.getCardItemsBinding()){this.getCardItemsBinding().filter(p)}if(this.getKPIBinding()){this.getKPIBinding().filter(p)}}var I=this.getCardItemsBinding();if(I&&I.getPath()){I.attachDataReceived(this.onDataReceived.bind(this))}},onDataReceived:function(){this.bdataLoadedToEnableAddToInsight=true},_addImageCss:function(t){var e=this.byId("ovpList");var a=e.getItems();var i=false;var n=e.getDomRef().getAttribute("class");if(t==="cozy"){n=n+" sapOvpListImageCozy"}else{n=n+" sapOvpListImageCompact"}e.getDomRef().setAttribute("class",n);a.forEach(function(t){if(t.getIcon().indexOf("icon")!=-1){i=true}});a.forEach(function(e){var a=e.getDomRef();var n;if(a&&a.children[0]&&a.children[0].children[0]){n=a.children[0].children[0]}var s=e.getDescription();var r=e.getIcon();var o=i;var d=e.getTitle();var l=d.split(" ").map(function(t){return t?t[0].toUpperCase():""}).join("").substring(0,2);if(r!=""&&r.indexOf("icon")==-1){i=false}if(i&&a.children[0]){jQuery(a.children[0]).addClass("sapOvpIconListItem")}else if(a.children[0]){jQuery(a.children[0]).addClass("sapOvpImageListItem")}if(n&&t==="cozy"&&i===false){if(n){var h=n.getAttribute("class");h=h+" sapOvpImageCozy";n.setAttribute("class",h)}}var g="";if(i===true&&s===""){g=t==="compact"?"sapOvpListWithIconNoDescCompact":"sapOvpListWithIconNoDescCozy"}else if(i===false&&s===""){g=t==="compact"?"sapOvpListWithImageNoDescCompact":"sapOvpListWithImageNoDescCozy"}else{g=t==="compact"?"sapOvpListWithImageIconCompact":"sapOvpListWithImageIconCozy"}e.addStyleClass(g);if(a&&a.children[0]&&r===""&&a.children[0].id!=="ovpIconImagePlaceHolder"){var p=document.createElement("div");p.innerText=l;p.setAttribute("id","ovpIconImagePlaceHolder");p.className=i===true?"sapOvpIconPlaceHolder":"sapOvpImagePlaceHolder";if(i===false&&t==="cozy"){p.className=p.className+" sapOvpImageCozy"}a.insertBefore(p,a.children[0])}i=o})},onListItemPress:function(t){var e=s.bCRTLPressed?s.constants.explace:s.constants.inplace;s.bCRTLPressed=false;if(a.checkIfAPIIsUsed(this)){if(this.checkAPINavigation()){i.onContentClicked(t)}}else{var n=this.getEntityNavigationEntries(t.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(t.getSource().getBindingContext(),n[0],e)}},getCardItemsBinding:function(){var t=this.getView().byId("ovpList");return t&&t.getBinding("items")},_getMinMaxObjectFromContext:function(t){this.counter++;var e=this.getEntitySet(),a=this.getCardPropertiesModel().getProperty("/annotationPath");a="@"+a;var i=this.getMetaModel().getData(a).$Annotations[e.$Type][a];var s="/"+e.$Type+"/@"+a;var r=this.getMetaModel().createBindingContext(s),o={minValue:0,maxValue:0};if(n.isFirstDataPointPercentageUnit(r,i)){o.minValue=0;o.maxValue=100;return o}var d=n.getFirstDataPointValue(r,i),l=this.getView().byId("ovpList"),h=l.getBinding("items"),g=h.getCurrentContexts();for(var p=0;t?p<t:p<g.length;p++){var c=g[p].getValue(d);var v=parseFloat(c,10);if(v<o.minValue){o.minValue=v}else if(v>o.maxValue){o.maxValue=v}}return o},_updateMinMaxModel:function(t){var e=this._getMinMaxObjectFromContext(t);this.minMaxModel.setData({minValue:e.minValue,maxValue:e.maxValue});this.minMaxModel.refresh();return e},returnBarChartValue:function(t){this._updateMinMaxModel();var e=parseFloat(t,10);return e},getCardItemBindingInfo:function(){var t=this.getView().byId("ovpList");return t.getBindingInfo("items")},resizeCard:function(t,e){var a,i,n;try{var s=document.getElementById(this.oDashboardLayoutUtil.getCardDomId(this.cardId)),r=this.getCardItemBindingInfo(),o=this.getHeaderHeight(),d=this.getView().byId("ovpCardContentContainer").getDomRef();if(t.showOnlyHeader){d.classList.add("sapOvpContentHidden");a=0}else{d.classList.remove("sapOvpContentHidden");n=o+e.dropDownHeight;i=t.rowSpan*t.iRowHeightPx-n;a=Math.abs(Math.floor(i/e.itemHeight));s.style.height=t.rowSpan*t.iRowHeightPx+"px"}d.style.height=t.rowSpan*t.iRowHeightPx-(o+2*t.iCardBorderPx)+"px";if(a!==r.length){r.length=a;t.noOfItems=r.length;this.getCardItemsBinding().refresh()}else{this._handleCountHeader()}}catch(t){h.warning("OVP resize: "+this.cardId+" catch "+t.toString())}},onExit:function(){t.prototype.onExit.apply(this,arguments)}})});
//# sourceMappingURL=List.controller.js.map