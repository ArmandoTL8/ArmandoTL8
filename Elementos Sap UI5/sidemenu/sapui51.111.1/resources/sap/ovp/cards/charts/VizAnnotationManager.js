sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/app/OVPLogger","sap/base/util/isEmptyObject","sap/ovp/cards/Integration/Helpers/AnalyticalCard"],function(jQuery,e,t,r,a,i,n,o,s,l,u,f,c,v,p,m,g,A,d,h,P){"use strict";var E={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut"};var C={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var y=["year","yearweek","yearmonth","yearquarter"];var _=[E.COLUMNSTACKED_CHARTTYPE,E.DONUT_CHARTTYPE,E.COLUMN_CHARTTYPE,E.BAR_CHARTTYPE,E.VERTICALBULLET_CHARTTYPE,E.LINE_CHARTTYPE,E.COMBINATION_CHARTTYPE,E.BUBBLE_CHARTTYPE];var I=[E.COLUMNSTACKED_CHARTTYPE];var T;var N=new d("OVP.charts.VizAnnotationManager");function R(a,i,n,o,s,l,u){var f="{";if(!a||!a.getSetting("ovpCardProperties")){N.error(C.ANALYTICAL_CONFIG_ERROR);f+="}";return f}var c=a.getSetting("dataModel");var v;if(u&&u.EnumMember){v=u.EnumMember.split("/");if(v&&v[1]==="Donut"){c.setDefaultCountMode(t.Inline)}if(v&&v[1]!="Donut"&&s===undefined){return null}}var p=[];var m=[];var d=[];var h=[];var P=[];var y=[];var _=[];var I=n&&n.Parameters;var T=o&&o.SortOrder;var R=o&&o.MaxItems,S=null;var O;var M;var L;var V=null;var Y=E.TEXT_KEY;var x=E.TEXT_KEY_V4;var F=E.UNIT_KEY;var U=E.UNIT_KEY_V4_ISOCurrency;var K=E.UNIT_KEY_V4_Unit;var B={};if(R){S=R.Int32?R.Int32:R.Int}if(S){if(S==="0"){N.error("OVP-AC: Analytic card Error: maxItems is configured as "+S);f+="}";return f}if(!/^\d+$/.test(S)){N.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");f+="}";return f}}var z=a.getSetting("ovpCardProperties"),H=z.getProperty("/parameters"),G=z.getProperty("/metaModel");I=I||!!H;if(I){var j=r.resolveParameterizedEntitySet(c,i,n,H);f+="path: '"+j+"'"}else{f+="path: '/"+i.name+"'"}var W=[];V=a.getSetting("ovpCardProperties").getProperty("/entitySet");if(!c||!V){return f}var X=le(c,V);var q=a.getSetting("ovpCardProperties").getProperty("/cardLayout");var Q=1,Z;var J=w();var $;var ee;if(s&&q&&q.colSpan&&q.colSpan>1){Z=q.colSpan-Q;for(var te in J){if((ee=J[te].reference)&&J[ee]){var re=A({},J[ee]);J[te]=re}if(te===v[1]||J[te].time&&J[te].time.type===v[1].toLowerCase()){$=J[te];break}}var ae=k(s,$,c,V);if(ae){$=$.time}else{$=$.default}var ie=a.getSetting("ovpCardProperties").getProperty("/dataStep");if(!ie){if($.resize&&$.resize.hasOwnProperty("dataStep")&&!isNaN($.resize.dataStep)){ie=$.resize.dataStep}}ie=parseInt(ie,10);if(Z>0&&ie&&!isNaN(ie)){S=parseInt(S,10)+ie*Z}}if(n){var z=a.getSetting("ovpCardProperties");W=r.getFilters(z,n)}if(W.length>0){f+=", filters: "+JSON.stringify(W)}if(T){var ne=o.SortOrder;if(!ne.length){ne=e.getSortAnnotationCollection(c,o,i)}if(ne.length<1){N.warning(C.CARD_WARNING+C.SORTORDER_WARNING)}else{var oe="";var se;var ue;var fe;for(var ce=0;ce<ne.length;ce++){se=ne[ce];fe=se.Property.PropertyPath;_.push(fe);if(typeof se.Descending==="undefined"){ue="true"}else{var ve=se.Descending.Bool||se.Descending.Boolean;if(!ve){N.warning(C.CARD_WARNING+C.BOOLEAN_ERROR);ue="true"}else{ue=ve.toLowerCase()==="true"?"true":"false"}}oe=oe+"{path: '"+fe+"',descending: "+ue+"},"}f+=", sorter: ["+oe.substring(0,oe.length-1)+"]"}}var pe=a.getSetting("ovpCardProperties").getProperty("/entityType");g(l,function(e,t){O=t.Measure.PropertyPath;if(t.DataPoint&&t.DataPoint.AnnotationPath){var r=pe[t.DataPoint.AnnotationPath.substring(1)];if(r.ForecastValue&&(r.ForecastValue.PropertyPath||r.ForecastValue.Path)){var a=r.ForecastValue.PropertyPath||r.ForecastValue.Path;P.push(a);if(X&&X[a]){var i;if(X[a][U]){i=X[a][U].Path?X[a][U].Path:undefined}else if(X[a][K]){i=X[a][K].Path?X[a][K].Path:undefined}else if(X[a][F]){i=X[a][F]}if(i){if((P?Array.prototype.indexOf.call(P,i):-1)===-1){P.push(i)}}}}if(r.TargetValue&&(r.TargetValue.PropertyPath||r.TargetValue.Path)){var n=r.TargetValue.PropertyPath||r.TargetValue.Path;P.push(n);if(X&&X[n]){var i;if(X[n][U]){i=X[n][U].Path?X[n][U].Path:undefined}else if(X[n][K]){i=X[n][K].Path?X[n][K].Path:undefined}else if(X[n][F]){i=X[n][F]}if(i){if((P?Array.prototype.indexOf.call(P,i):-1)===-1){P.push(i)}}}}}P.push(O);if(X&&X[O]){if(X[O][x]){if(X[O][x].String&&O!=X[O][x].String){P.push(X[O][x].String?X[O][x].String:O)}else if(X[O][x].Path&&O!=X[O][x].Path){P.push(X[O][x].Path?X[O][x].Path:O)}}else if(X[O][Y]&&O!=X[O][Y]){P.push(X[O][Y]?X[O][Y]:O)}}if(X&&X[O]){var i;if(X[O][U]){i=X[O][U].Path?X[O][U].Path:undefined}else if(X[O][K]){i=X[O][K].Path?X[O][K].Path:undefined}else if(X[O][F]){i=X[O][F]}if(i){if((P?Array.prototype.indexOf.call(P,i):-1)===-1){P.push(i)}}}});g(s,function(e,t){O=t.Dimension.PropertyPath;p.push(O);if(X&&X[O]){if(X[O][x]){if(X[O][x].String&&O!=X[O][x].String){p.push(X[O][x].String?X[O][x].String:O)}else if(X[O][x].Path&&O!=X[O][x].Path){L=X[O][x].Path;var r=L.split("/");if(r.length>1){M=D(G,pe,L);if(M!==""){p.push(L);m.push(M);h=b(G,pe,L);if(h.length>0){d=d.concat(h)}}}else{p.push(L?L:O)}}}else if(X[O][Y]&&O!=X[O][Y]){p.push(X[O][Y]?X[O][Y]:O)}}});if(d.length>0){var me=0;while(me<d.length){if(p.indexOf(d[me])!==-1){d.splice(me,1)}else{me++}}}if(P.length>0){g(P,function(e,t){B[t]=true})}if(p.length>0){g(p,function(e,t){B[t]=true})}f+=", parameters: {select:'"+[].concat(p,P).join(",");var ge=G.getODataEntityType(i.entityType);if(ge){var Ae=r.getRequestFields(o);if(Ae&&Ae.length>0){g(Ae,function(e,t){if(!B.hasOwnProperty(t)){B[t]=true;y.push(t)}});if(y.length>0){f+=","+y.join(",")}}}if(_.length>0){var de=[];g(_,function(e,t){if(!B.hasOwnProperty(t)){de.push(t)}});if(de.length>0){f+=","+de.join(",")}}if(m.length>0){f+="'"+","+" expand:'"+m.join(",")}var he=r.checkFilterPreference(a.getSetting("ovpCardProperties"));if(he){f+="', custom: {cardId: '"+a.getSetting("ovpCardProperties").getProperty("/cardId")+"', _requestFrom: 'ovp_internal'}}"}else{f+="', custom: {_requestFrom: 'ovp_internal'}}"}if(v&&v[1]==="Donut"&&s===undefined){f+=", length: 1"}else if(v&&v[1]==="Donut"&&s&&S){f+=", length: "+(parseInt(S,10)+1)}else if(S){f+=", length: "+S}f+="}";return f}R.requiresIContext=true;function D(e,t,r){var a="";var i=r.split("/");if(i.length>1){for(var n=0;n<i.length-1;n++){var o=e.getODataAssociationEnd(t,i[n]);if(o){t=e.getODataEntityType(o.type);if(a){a=a+"/"}a=a+i[n]}else{return a}}}return a}function b(e,t,r){var a=[];var i=[];var n;var o=r.split("/");if(o.length>1){for(var s=0;s<o.length-1;s++){var l=e.getODataAssociationEnd(t,o[s]);if(l){t=e.getODataEntityType(l.type);if(t){i=t&&t.key&&t.key.propertyRef;for(var u=0;u<i.length;u++){n=o[s]+"/"+i[u].name;a.push(n)}}}}}return a}function S(e,t){var r=false;var a;if(e.DataPoint&&e.DataPoint.AnnotationPath){var i=t[e.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){r=true;a=e}}if(r===true){return a}else{N.warning(C.CARD_WARNING+C.INVALID_FORECAST);return undefined}}function O(e,t){var r=false;var a;if(e.DataPoint&&e.DataPoint.AnnotationPath){var i=t[e.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){r=true;a=e}}if(r===true){return a}else{N.warning(C.CARD_WARNING+C.INVALID_TARGET);return undefined}}function M(e,t){var r;g(t,function(t,a){if(a.name===e){if(a["com.sap.vocabularies.Common.v1.Label"]){r=a["com.sap.vocabularies.Common.v1.Label"].String?a["com.sap.vocabularies.Common.v1.Label"].String:a["com.sap.vocabularies.Common.v1.Label"].Path}else if(a["sap:label"]){r=a["sap:label"]}return false}});return r}function L(e,t){var r=true;if(t==="line"||t==="column"||t==="bar"){g(e,function(e,t){if(t.getUid()==="valueAxis"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){r=false;N.warning(C.CARD_WARNING+C.INVALID_DIMMEAS);return false}}})}else if(t==="vertical_bullet"){g(e,function(e,t){if(t.getUid()==="actualValues"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){r=false;N.warning(C.CARD_WARNING+C.INVALID_DIMMEAS);return false}}})}if(r===true){return true}}function V(e,t,r){var a=E.TYPE_KEY;if(!e||!e[t]||!e[t][a]){return r}var i=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var n=e[t][a];if((i?Array.prototype.indexOf.call(i,n):-1)!==-1){return Number(r)}return r}function Y(e){if(e){return e}return""}function x(){var e={locale:function(){},format:function(e,t){var r="";if(t){r=t.split("/")}if(r.length>0){var n,o;if(r.length===3){n=Number(r[1]);o=Number(r[2]);if(isNaN(n)){n=-1}if(isNaN(o)){o=0}}else{n=2;o=0}if(r[0]==="axisFormatter"||r[0]==="ShortFloat"){var l;l=a.getFloatInstance({style:"short",minFractionDigits:n,maxFractionDigits:n?n:1});if(r[0]==="ShortFloat"){l=a.getFloatInstance({style:"short",minFractionDigits:n,maxFractionDigits:n})}if(n===-1){l=a.getFloatInstance({style:"short"})}return l.format(Number(e))}else if(r[0]==="tooltipNoScaleFormatter"){var u=a.getFloatInstance({style:"short",currencyCode:false,shortRefNumber:o,showScale:false,minFractionDigits:n,maxFractionDigits:n});if(n===-1){u=a.getFloatInstance({minFractionDigits:0,currencyCode:false})}return u.format(Number(e))}else if(r[0]==="CURR"){var f=a.getCurrencyInstance({style:"short",currencyCode:false,minFractionDigits:n,maxFractionDigits:n});if(n===-1){f=a.getCurrencyInstance({style:"short",currencyCode:false})}return f.format(Number(e))}else if(r[0].search("%")!==-1){var c=a.getPercentInstance({style:"short",minFractionDigits:n,maxFractionDigits:n});if(n===-1){c=a.getPercentInstance({style:"short",minFractionDigits:1,maxFractionDigits:1})}e=c.format(Number(e));return e}}if(e.constructor===Date){var v=i.getDateTimeInstance({pattern:t});if(t==="YearMonthDay"){v=i.getDateInstance({style:"medium"})}if(t==="YearMonth"||t==="MMM"){v=i.getDateTimeInstance({format:"MMM"})}if(t==="YearQuarter"||t==="Quarter"){v=i.getDateTimeInstance({format:"QQQ"})}if(t==="YearWeek"||t==="Week"){v=i.getDateTimeInstance({format:"www"})}var p=s.getApp();var m=p&&p.bResetChartAxisFormatter;if(m&&t==="hh:mm"){var g=e.toLocaleTimeString();var A=g.split(":");e=A[0]+":"+A[1];return e}var d=m?false:true;e=v.format(new Date(e),d)}return e}};n.numericFormatter(e)}function F(e,t){var r=e.getModel();var a=e.getVizType();if(a!="line"&&a!="bubble"){return}if(!t){t=a==="line"?"categoryAxis":"valueAxis"}var i=e.getModel("ovpCardProperties").getProperty("/entitySet");if(!r||!i){return}var n=le(r,i);var o=e.getFeeds();for(var s=0;s<o.length;s++){if(o[s].getUid()===t){var l=o[s].getValues();if(!l){return}for(var u=0;u<l.length;u++){if(n[l[u][E.TYPE_KEY]]!="Edm.DateTime"){return}}e.setVizProperties({categoryAxis:{title:{visible:false}}});var f=e&&e.getModel("ovpCardProperties");if(f&&f.getProperty("/bInsightEnabled")){var c=e&&e.getId();P.setVizPropertyMap(c,{categoryAxis:{title:{visible:false}}})}return}}}function U(e,t,r,a,i,n){a=typeof a==="undefined"?false:a;var o=false;var s;if(!e&&a){N.error(i+C.CARD_ERROR+r+C.IS_MANDATORY);return o}if(!e){N.warning(i+C.CARD_WARNING+r+C.IS_MISSING);o=true;return o}s=t[e];if(!s||typeof s!=="object"){var l=a?N.error:N.warning;l(i+C.CARD_ERROR+"in "+r+". ("+e+" "+C.NOT_WELL_FORMED);return o}if(n&&n==="sap.ovp.cards.charts.analytical.analyticalChart"&&r==="Chart Annotation"&&(!s.ChartType||!s.ChartType.EnumMember)){N.error(i+C.CARD_ERROR+C.MISSING_CHARTTYPE+C.CHART_ANNO);return o}o=true;return o}function K(e){var t=false;if(!e){return t}var r;var a;var i;var n;var o;var s;var l;var u="";var f;var c=e.getView();if(c){u="["+c.getId()+"] "}if(!(f=e.getCardPropertiesModel())){N.error(u+C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return t}l=f.getProperty("/entityType");if(!l||h(l)){N.error(u+C.CARD_ERROR+"in "+C.CARD_ANNO);return t}r=f.getProperty("/selectionAnnotationPath");a=f.getProperty("/chartAnnotationPath");n=f.getProperty("/presentationAnnotationPath");o=f.getProperty("/identificationAnnotationPath");s=f.getProperty("/dataPointAnnotationPath");i=f.getProperty("/contentFragment");t=U(r,l,"Selection Variant",false,u);t=U(a,l,"Chart Annotation",true,u,i)&&t;t=U(n,l,"Presentation Variant",false,u)&&t;t=U(o,l,"Identification Annotation",true,u)&&t;t=U(s,l,"Data Point",false,u)&&t;return t}function B(e,t,r){}function w(t){return e.getConfig(t)}function k(e,t,r,a){var i=false;var n;var o;var s;var l;var u;var f;if(!t.time||h(t.time)){return i}if(!e){return i}for(var c=0;c<e.length;c++){if(!e[c].Dimension||!(o=e[c].Dimension.PropertyPath)){return i}n=le(r,a);if(n&&n[o]){s=n[o][E.TYPE_KEY];l=n[o][E.DISPLAY_FORMAT_KEY];u=n[o][E.SEMANTICS_KEY];f=n[o]["com.sap.vocabularies.Common.v1.IsCalendarYear"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(l&&l.toLowerCase()==="date"){i=true}}else{i=true}}if(s==="Edm.String"&&(f||u&&y.indexOf(u)>-1)){i=true}if(i){e.unshift(e.splice(c,1)[0]);break}}return i}function z(e,t,r){var a="";var i=w(t);var n,o;if(!i){return a}a=i.default.type;n=e.getSetting("dataModel");o=e.getSetting("ovpCardProperties").getProperty("/entitySet");if(k(r,i,n,o)){a=i.time.type}return a}z.requiresIContext=true;function H(e,t,r){if(!e.length){return}var a=r==="dimension"?"Dimension":"Measure";var i=[];g(e,function(e,t){if(!t||!t[a]||!t[a].PropertyPath){N.error(C.INVALID_CHART_ANNO);return false}i.push(t[a].PropertyPath)});var n=jQuery.map(t.feeds,function(e){if(e.type===r){if(e.role){return e.role.split("|")}return[]}});n=jQuery.grep(n,function(e,t){return(n?Array.prototype.indexOf.call(n,e):-1)===t}).join(", ");N.error(C.CARD_ERROR+C.INVALID_REDUNDANT+r+"(s) "+i.join(", ")+". "+C.ALLOWED_ROLES+t.type+C.CHART_IS+n)}function G(e,t){var r;if(e){if(e.String){r=e.String}else if(e.Boolean||e.Bool){r=j(e)}else{r=W(e,t)}}return r}function j(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function W(e,t){var r;if(e){if(e.String){r=Number(e.String)}else if(e.Int){r=Number(e.Int)}else if(e.Decimal){r=Number(e.Decimal)}else if(e.Double){r=Number(e.Double)}else if(e.Single){r=Number(e.Single)}}if(t){var i=a.getFloatInstance({style:"short",minFractionDigits:2,maxFractionDigits:2});if(r){r=i.format(Number(r))}}return r}function X(e,t){function a(e){if(e){if(e.Path){return"{path:'"+e.Path+"'}"}else{return G(e)}}else{return""}}var i=e[e.measureNames];if(t&&t.CriticalityCalculation&&t.CriticalityCalculation.ImprovementDirection){var n=t.CriticalityCalculation.ImprovementDirection.EnumMember;var o=a(t.CriticalityCalculation.DeviationRangeLowValue);var s=a(t.CriticalityCalculation.DeviationRangeHighValue);var l=a(t.CriticalityCalculation.ToleranceRangeLowValue);var u=a(t.CriticalityCalculation.ToleranceRangeHighValue);return r._calculateCriticalityState(i,n,o,s,l,u,r.criticalityConstants.StateValues)}else{var f=t.Criticality.EnumMember;var c=f?f.split("/"):[];if(c){return c[1]}}}function q(e,t,r){var a,i;g(t,function(t,r){if(r["com.sap.vocabularies.Common.v1.Label"]&&r["com.sap.vocabularies.Common.v1.Label"].String===e.measureNames){a=r.name;return false}else if(r["com.sap.vocabularies.Common.v1.Label"]&&r["com.sap.vocabularies.Common.v1.Label"].Path===e.measureNames){a=r.name;return false}else if(r["sap:label"]===e.measureNames){a=r.name;return false}});g(r,function(e,t){if(t.Measure.PropertyPath===a){if(!t.DataPoint||!t.DataPoint.AnnotationPath){return false}i=t.DataPoint.AnnotationPath;return false}});return i}function Q(e,t){if(e){if(e.Path){return e.Path}else{return G(e,t)}}else{return""}}function Z(e,t){function r(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var a=false;g(e,function(e,i){if(i.DataPoint&&i.DataPoint.AnnotationPath){var n=t[i.DataPoint.AnnotationPath.substring(1)];if(n&&n.CriticalityCalculation&&n.CriticalityCalculation.ImprovementDirection&&n.CriticalityCalculation.ImprovementDirection.EnumMember){var o=n.CriticalityCalculation.ImprovementDirection.EnumMember;var s=Q(n.CriticalityCalculation.DeviationRangeLowValue);var l=Q(n.CriticalityCalculation.DeviationRangeHighValue);var u=Q(n.CriticalityCalculation.ToleranceRangeLowValue);var f=Q(n.CriticalityCalculation.ToleranceRangeHighValue);if(r(o,"Minimize")||r(o,"Minimizing")){if(f&&l){a=true;return false}else{N.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}else if(r(o,"Maximize")||r(o,"Maximizing")){if(u&&s){a=true;return false}else{N.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}else if(r(o,"Target")){if(u&&s&&f&&l){a=true;return false}else{N.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}}else if(n&&n.Criticality){a=true;return false}else{N.warning(C.CARD_WARNING+C.INVALID_IMPROVEMENT_DIR)}}});if(a===true&&e.length>1){N.warning(C.CARD_WARNING+C.INVALID_SEMANTIC_MEASURES)}return a}function J(e,t,r,a){function i(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var n=[null,null];var o=true;var s=e.Measure.PropertyPath;if(r[s]){if(r[s][E.LABEL_KEY_V4]){s=se(r[s][E.LABEL_KEY_V4].String?r[s][E.LABEL_KEY_V4].String:r[s][E.LABEL_KEY_V4].Path,a,r)}else if(r[s][E.LABEL_KEY]){s=r[s][E.LABEL_KEY]}else if(s){s=s}}var l=e.DataPoint.AnnotationPath;var u=t[l.substring(1)];if(!u.CriticalityCalculation||!u.CriticalityCalculation.ImprovementDirection||!u.CriticalityCalculation.ImprovementDirection.EnumMember){return n}var f=u.CriticalityCalculation.ImprovementDirection.EnumMember;var c=Q(u.CriticalityCalculation.DeviationRangeLowValue,o);var v=Q(u.CriticalityCalculation.DeviationRangeHighValue,o);var m=Q(u.CriticalityCalculation.ToleranceRangeLowValue,o);var g=Q(u.CriticalityCalculation.ToleranceRangeHighValue,o);if(i(f,"Minimize")||i(f,"Minimizing")){if(g&&v){n[0]=p.getText("MINIMIZING_LESS",[s,g]);n[1]=p.getText("MINIMIZING_MORE",[s,v]);n[2]=p.getText("MINIMIZING_CRITICAL",[g,s,v])}}else if(i(f,"Maximize")||i(f,"Maximizing")){if(m&&c){n[0]=p.getText("MAXIMISING_MORE",[s,m]);n[1]=p.getText("MAXIMISING_LESS",[s,c]);n[2]=p.getText("MAXIMIZING_CRITICAL",[c,s,m])}}else if(i(f,"Target")){if(m&&c&&g&&v){n[0]=p.getText("TARGET_BETWEEN",[m,s,g]);n[1]=p.getText("TARGET_AROUND",[s,c,v]);n[2]=p.getText("TARGET_CRITICAL",[c,s,m,g,v])}}return n}function $(e,t,r){if(t&&t.DataPoint&&t.DataPoint.AnnotationPath){var a=r[t.DataPoint.AnnotationPath.substring(1)];var i,n;if(a&&a.ValueFormat){i=a.ValueFormat}else if(a&&a.NumberFormat){i=a.NumberFormat}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){n=i.NumberOfFractionalDigits.Int;if(e<Number(n)){e=Number(n)}}}return e}function ee(e,t,r){if(t&&t.DataPoint&&t.DataPoint.AnnotationPath){var a=r[t.DataPoint.AnnotationPath.substring(1)];var i,n;if(a&&a.ValueFormat){i=a.ValueFormat}else if(a&&a.NumberFormat){i=a.NumberFormat}if(i){if(i.ScaleFactor&&i.ScaleFactor.Decimal){n=Number(i.ScaleFactor.Decimal)}else if(i.ScaleFactor&&i.ScaleFactor.Int){n=Number(i.ScaleFactor.Int)}if(!isNaN(n)){if(e===undefined){e=Number(n)}else if(e>Number(n)){e=Number(n)}}}}return e}function te(e,t){if(e&&e[t]&&(e[t]["Org.OData.Measures.V1.ISOCurrency"]||e[t][E.SEMANTICS_KEY]&&e[t][E.SEMANTICS_KEY]===E.CURRENCY_CODE)){return true}return false}function re(e,t,r){if(e[t[r].PropertyPath][E.EDM_TYPE]===E.EDM_INT32){return true}return false}function ae(e,t,r){if(e[t[r].PropertyPath][E.EDM_TYPE]===E.EDM_INT64){return true}return false}function ie(e,t,a){var i,n,s,v,m;var d,h,y,R,D,b=false;var V;var Y,x,F;var U,K=[],B=[];var z;var G;var j=a&&a.getView();var W,Q;var ie=j&&j.getModel("ui");var oe=ie&&ie.getProperty("/chartSettings");i=e.getModel("ovpCardProperties");if(l.checkIfAPIIsUsed(a)){b=i&&i.getData()&&i.getData().showDataLabel}m=oe?oe.showDataLabel:b;d=e.getVizType();h=w();for(var ce in h){if((G=h[ce].reference)&&h[G]){var ve=A({},h[G]);h[ce]=ve}if(h[ce].default.type===d||h[ce].time&&h[ce].time.type===d){y=h[ce];break}}if(!y){N.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.CARD_CONFIG_ERROR+d+" "+C.CARD_CONFIG_JSON);return}if(!i){N.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return}var pe=e.getModel();var me=i.getProperty("/entitySet");if(!pe||!me){return}n=i.getProperty("/entityType");if(!n){N.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}var ge=le(pe,me);s=i.getProperty("/chartAnnotationPath");if(!s||!(v=n[s])){N.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}var Ae="";if(n&&n[s]&&n[s].Title&&n[s].Title.String){Ae=n[s].Title.String;if(Ae.match(/{[@]?i18n>.+}/gi)||Ae.match(/{[@]?i18n&gt;.+}/gi)){var de=e.getModel("@i18n").getResourceBundle();var he=Ae.indexOf(">")>-1?Ae.indexOf(">"):Ae.indexOf("&gt;")+3;var Pe=Ae.substring(he+1,Ae.length-1);Ae=de.getText(Pe)}}if(!(R=v.DimensionAttributes)||!R.length){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.DIMENSIONS_MANDATORY);return}var _e;if(!(D=v.MeasureAttributes)||!D.length){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return}else{var Ie=D[0].DataPoint?n[D[0].DataPoint.AnnotationPath.substring(1)]:null;var Te=Ie&&Ie.ValueFormat&&Ie.ValueFormat.NumberOfFractionalDigits&&Ie.ValueFormat.NumberOfFractionalDigits.Int;_e=Te?Te:0}z=k(R,y,pe,me);if(z){y=y.time}else{y=y.default}var Ne=i.getProperty("/ChartProperties")||i.getProperty("/chartProperties");if(i&&i.getProperty("/tabs")&&Ne===undefined){W=j.byId("ovp_card_dropdown");Q=parseInt(W.getSelectedKey(),10);Ne=i.getProperty("/tabs")&&i.getProperty("/tabs")[Q-1]&&(i.getProperty("/tabs")[Q-1]["ChartProperties"]||i.getProperty("/tabs")[Q-1]["chartProperties"])}var Re=false;var De=_e>0?"tooltipNoScaleFormatter/"+_e.toString()+"/":"tooltipNoScaleFormatter/-1/";var be=new o({formatString:De});be.connect(e.getVizUid());be.connect(e.getVizUid());e._oOvpVizFrameTooltip=be;[y.dimensions,y.measures].forEach(function(e,t){var r=t?D:R;var a=t?"measure(s)":"dimension(s)";if(e.min&&r.length<e.min){N.error(C.CARD_ERROR+"in "+d+" "+C.CARD_LEAST+e.min+" "+a);Re=true}if(e.max&&r.length>e.max){N.error(C.CARD_ERROR+"in "+d+C.CARD_MOST+e.max+" "+a);Re=true}});if(Re){return}var Se=true;if(y.properties&&y.properties.hasOwnProperty("hideLabel")&&!y.properties["hideLabel"]){Se=false}var Oe=true;var Me=false;if(d==="donut"){Me=true}e.removeAllAggregation();V={legend:{isScrollable:false},title:{visible:true},interaction:{noninteractiveMode:Oe?false:true,selectability:{legendSelection:Me?true:false,axisLabelSelection:false,mode:"EXCLUSIVE",plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:"disabled"}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"},dataLabel:{visible:m||Me?true:false,type:"value"},dataPoint:{invalidity:"ignore"},alignment:{vertical:"top"}},categoryAxis:{label:{truncatedLabelRatio:.15}},general:{groupData:false,showAsUTC:true}};if(y.properties&&y.properties.semanticColor===true&&Z(D,n)){var Le=p.getText("GOOD");var Ve=p.getText("BAD");var Ye=p.getText("CRITICAL");var xe=p.getText("OTHERS");if(D.length===1){var Fe=J(D[0],n,ge,e);var Le=Fe[0]||Le,Ve=Fe[1]||Ve,Ye=Fe[2]||Ye,xe=p.getText("OTHERS")}V.plotArea.dataPointStyle={rules:[{callback:function(e){var t=q(e,ge,D);if(!t){return false}var a=n[t.substring(1)];var i=X(e,a);if(i===r.criticalityConstants.StateValues.Positive){return true}else if(i==="Positive"){return true}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:Le},{callback:function(e){var t=q(e,ge,D);if(!t){return false}var a=n[t.substring(1)];var i=X(e,a);if(i===r.criticalityConstants.StateValues.Critical){return true}else if(i==="Critical"){return true}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},displayName:Ye},{callback:function(e){var t=q(e,ge,D);if(!t){return false}var a=n[t.substring(1)];var i=X(e,a);if(i===r.criticalityConstants.StateValues.Negative){return true}else if(i==="Negative"){return true}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:Ve},{callback:function(e){var t=q(e,ge,D);if(!t){return false}var a=n[t.substring(1)];var i=X(e,a);if(i===r.criticalityConstants.StateValues.None){return true}else if(i==="Neutral"){return true}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:xe}]}}var Ue=i.getProperty("/bEnableStableColors");var Ke=i.getProperty("/colorPalette");var Be;if(!Ue&&_.indexOf(v.ChartType.EnumMember)>=0&&Ke&&Object.keys(Ke).length>=2&&Object.keys(Ke).length<=4){g(R,function(e,t){if(t&&t.Role&&t.Role.EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){Be=t.Dimension&&t.Dimension.PropertyPath;return}});var we;if(Be){if(ge&&ge[Be]){if(ge[Be][E.LABEL_KEY_V4]){we=se(ge[Be][E.LABEL_KEY_V4].String?ge[Be][E.LABEL_KEY_V4].String:ge[Be][E.LABEL_KEY_V4].Path,e,ge)}else if(ge[Be][E.LABEL_KEY]){we=ge[Be][E.LABEL_KEY]}else if(Be){we=Be}}if(Ke instanceof Array){var ke=Ke.map(function(e){return e.color});var ze=Ke.map(function(e){return e.legendText});var He=ze[0]!=undefined?ze[0]:p.getText("OTHERS");var Ge=ze[1]!=undefined?ze[1]:p.getText("BAD");var je=ze[2]!=undefined?ze[2]:p.getText("CRITICAL");var We=ze[3]!=undefined?ze[3]:p.getText("GOOD")}V.plotArea.dataPointStyle={rules:[{callback:function(e){if(e&&(e[we]==="3"||e[we]===3)){if(Ke instanceof Array){if(Ke.length<4){return false}}else if(Ke&&!Ke.hasOwnProperty(3)){return false}return true}},properties:{color:Ke instanceof Array&&ke.length?ke[3]:Ke[3]&&Ke[3]["color"]},displayName:We||Ke[3]&&Ke[3]["legendText"]},{callback:function(e){if(e&&(e[we]==="2"||e[we]===2)){if(Ke instanceof Array){if(Ke.length<3){return false}}else if(Ke&&!Ke.hasOwnProperty(2)){return false}return true}},properties:{color:Ke instanceof Array&&ke.length?ke[2]:Ke[2]&&Ke[2]["color"]},displayName:je||Ke[2]&&Ke[2]["legendText"]},{callback:function(e){if(e&&(e[we]==="1"||e[we]===1)){return true}},properties:{color:Ke instanceof Array&&ke.length?ke[1]:Ke[1]&&Ke[1]["color"]},displayName:Ge||Ke[1]&&Ke[1]["legendText"]},{callback:function(e){if(e&&(e[we]==="0"||e[we]===0)){return true}},properties:{color:Ke instanceof Array&&ke.length?ke[0]:Ke[0]&&Ke[0]["color"]},displayName:He||Ke[0]&&Ke[0]["legendText"]}]};var Xe;if(i&&i.getProperty("/bInsightEnabled")){Xe=A({},V.plotArea.dataPointStyle);var qe=ge&&ge[Be]&&ge[Be].type||"";Xe.rules.forEach(function(e,t,r){delete e["callback"];e.dataContext={};if(qe){e.dataContext[we]=qe==="Edm.String"?r.length-1-t+"":r.length-1-t}else{e.dataContext[we]=r.length-1-t+""}})}}}var Qe=false;var Ze=false;if(v.ChartType.EnumMember===E.SCATTER_CHARTTYPE||v.ChartType.EnumMember===E.BUBBLE_CHARTTYPE||v.ChartType.EnumMember===E.LINE_CHARTTYPE){if(v&&v.AxisScaling&&v.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var Je=v.AxisScaling;if(Je.AutoScaleBehavior&&Je.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var $e=Je.AutoScaleBehavior;if($e.ZeroAlwaysVisible&&$e.ZeroAlwaysVisible.Bool=="true"){V.plotArea.adjustScale=false;Qe=true}else if($e.DataScope){V.plotArea.adjustScale=true;Qe=true}}else if(Je.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&Je.ScaleBehavior&&Je.ScaleBehavior.EnumMember){var et=Je.ScaleBehavior.EnumMember;var tt=et.substring(et.lastIndexOf("/")+1,et.length);if(tt=="FixedScale"){Ze=true}}}else if(v&&v.AxisScaling&&v.AxisScaling.EnumMember){var rt=v.AxisScaling.EnumMember.substring(v.AxisScaling.EnumMember.lastIndexOf("/")+1,v.AxisScaling.EnumMember.length);switch(rt){case"AdjustToDataIncluding0":V.plotArea.adjustScale=false;Qe=true;break;case"AdjustToData":V.plotArea.adjustScale=true;Qe=true;break;case"MinMaxValues":Ze=true;break;default:break}}if(Ze){var at=[];if(v["MeasureAttributes"][0]&&v["MeasureAttributes"][0].DataPoint&&v["MeasureAttributes"][0].DataPoint.AnnotationPath){var it=v["MeasureAttributes"][0].DataPoint.AnnotationPath;var nt=it.substring(it.lastIndexOf("@")+1,it.length);if(n&&n[nt]){var ot=n[nt];if(ot&&ot.MaximumValue&&ot.MaximumValue.Decimal&&ot.MinimumValue&&ot.MinimumValue.Decimal){at.push({feed:"valueAxis",max:ot.MaximumValue.Decimal,min:ot.MinimumValue.Decimal});Qe=true}else{N.error(C.ERROR_MISSING_AXISSCALES)}}}if(v.ChartType.EnumMember!==E.LINE_CHARTTYPE&&v["MeasureAttributes"][1]&&v["MeasureAttributes"][1].DataPoint&&v["MeasureAttributes"][1].DataPoint.AnnotationPath){var it=v["MeasureAttributes"][1].DataPoint.AnnotationPath;var nt=it.substring(it.lastIndexOf("@")+1,it.length);if(n&&n[nt]){var ot=n[nt];if(ot&&ot.MaximumValue&&ot.MaximumValue.Decimal&&ot.MinimumValue&&ot.MinimumValue.Decimal){at.push({feed:"valueAxis2",max:ot.MaximumValue.Decimal,min:ot.MinimumValue.Decimal});Qe=true}else{N.error(C.ERROR_MISSING_AXISSCALES)}}}e.setVizScales(at)}}x=R.slice();F=D.slice();var st=0;var lt=0;var ut;var ft;var ct=false;var vt=false;var pt;var mt=[];var gt=[],At=[];if((d==="column"||d==="bar"||d==="vertical_bullet")&&y.feeds&&y.feeds.length>0){var dt;for(dt=0;dt<y.feeds.length;dt++){if(y.feeds[dt].uid==="color"){y.feeds.splice(dt,1);break}}for(dt=0;dt<y.feeds.length;dt++){if(y.feeds[dt].uid==="categoryAxis"){delete y.feeds[dt].role;break}}if(i.getProperty("/colorPalette")){for(dt=0;dt<y.feeds.length;dt++){if(y.feeds[dt].uid==="categoryAxis"){y.feeds[dt].role="Category";break}}y.feeds.push({uid:"color",min:1,type:"dimension",role:"Series"})}}g(y.feeds,function(t,r){var a=r.uid;var o=[];if(r.type){var s,l,v;if(r.type==="dimension"){s=R.length;l="Dimension";v="dimensions";Y=x;U=K}else{s=D.length;l="Measure";v="measures";Y=F;U=B}var p=0,m=s;if(r.min){p=p>r.min?p:r.min}if(r.max){m=m<r.max?m:r.max}if(!r.role){var A=Y.length;for(var h=0;h<A&&o.length<m;++h){var _=Y[h];Y.splice(h,1);--A;--h;o.push(_);if(ge[_[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){pt=ge[_[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path?ge[_[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(ge[_[l].PropertyPath][E.UNIT_KEY_V4_Unit]){pt=ge[_[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path?ge[_[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path:undefined}else if(ge[_[l].PropertyPath][E.UNIT_KEY]){pt=ge[_[l].PropertyPath][E.UNIT_KEY]}if(te(ge,pt)){ct=true}else{vt=true}if(!ct){st=$(st,_,n);ut=ee(ut,_,n)}else{lt=$(lt,_,n);ft=ee(ft,_,n)}}}else{var I=r.role.split("|");g(I,function(e,t){if(o.length===m){return false}var r=Y.length;for(var a=0;a<r&&o.length<m;++a){var i=Y[a];if(i&&i.Role&&i.Role.EnumMember&&i.Role.EnumMember.split("/")&&i.Role.EnumMember.split("/")[1]){var s=i.Role.EnumMember.split("/")[1];if(s===t){Y.splice(a,1);--r;--a;o.push(i);if(ge[i[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){pt=ge[i[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path?ge[i[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(ge[i[l].PropertyPath][E.UNIT_KEY_V4_Unit]){pt=ge[i[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path?ge[i[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path:undefined}else if(ge[i[l].PropertyPath][E.UNIT_KEY]){pt=ge[i[l].PropertyPath][E.UNIT_KEY]}if(te(ge,pt)){ct=true}else{vt=true}if(!ct){st=$(st,i,n);ut=ee(ut,i,n)}else{lt=$(lt,i,n);ft=ee(ft,i,n)}}}else if((U?Array.prototype.indexOf.call(U,i):-1)===-1){U.push(i)}}});if(o.length<m){g(U,function(e,t){var r;var a;if((r=y[v].defaultRole)&&(I?Array.prototype.indexOf.call(I,r):-1)!==-1&&(a=(Y?Array.prototype.indexOf.call(Y,t):-1)!==-1)){Y.splice(a,1);o.push(t);if(ge[t[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){pt=ge[t[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path?ge[t[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(ge[t[l].PropertyPath][E.UNIT_KEY_V4_Unit]){pt=ge[t[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path?ge[t[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path:undefined}else if(ge[t[l].PropertyPath][E.UNIT_KEY]){pt=ge[t[l].PropertyPath][E.UNIT_KEY]}if(te(ge,pt)){ct=true}else{vt=true}if(!ct){st=$(st,t,n);ut=ee(ut,t,n)}else{lt=$(lt,t,n);ft=ee(ft,t,n)}if(o.length===m){return false}}})}if(o.length<p){N.error(C.CARD_ERROR+C.MIN_FEEDS+d+" "+C.FEEDS_OBTAINED+o.length+" "+C.FEEDS_REQUIRED+p+" "+C.FEEDS);return false}}if(o.length){var b=[];var S;if(!(S=e.getDataset())){N.error(C.NO_DATASET);return false}T=n;g(o,function(t,r){if(!r||!r[l]||!r[l].PropertyPath){N.error(C.INVALID_CHART_ANNO);return false}var n=r[l].PropertyPath;var o=n;var s=n;var c=null;if(ge&&ge[n]){if(ge[n][E.LABEL_KEY_V4]){if(ge[n][E.LABEL_KEY_V4].String){o=se(ge[n][E.LABEL_KEY_V4].String,e,ge)}else if(ge[n][E.LABEL_KEY_V4].Path){o=ge[n][E.LABEL_KEY_V4].Path}else{o=n}}else if(ge[n][E.LABEL_KEY]){o=ge[n][E.LABEL_KEY]}else if(n){o=n}if(ge[n][E.TEXT_KEY_V4]){s=ge[n][E.TEXT_KEY_V4].String?ge[n][E.TEXT_KEY_V4].String:ge[n][E.TEXT_KEY_V4].Path}else if(ge[n][E.TEXT_KEY]){s=ge[n][E.TEXT_KEY]}else if(n){s=n}c=ge[n][E.TYPE_KEY]||null}var v,p={};p[n]=s;if((c==="Edm.DateTime"||c==="Edm.DateTimeOffset")&&s===n){v="{path:'"+n+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}"}else{if(ge[n]&&ge[n][E.TEXT_KEY_V4]&&ge[n][E.TEXT_KEY_V4][E.TEXT_ARRANGEMENT_ANNO]){var m,g;m=ge[n][E.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember;if(!g){m=ge[n][E.TEXT_KEY_V4][E.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember}if(!g){var A=T;m=A&&A[E.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember}switch(g){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":v="{"+s+"}"+" "+"("+"{"+n+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":v="{"+n+"}"+" "+"("+"{"+s+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":v="{"+s+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":v="{"+n+"}"+" "+"("+"{"+s+"}"+")";break;default:v="{"+n+"}";p[n]=n;break}}else{v="{"+s+"}"}if(i&&i.getProperty("/bInsightEnabled")){P.setDimensionPath(i.getData().cardId,n,v)}}b.push(o);if(l==="Dimension"){if(a==="waterfallType"){var d=new u({name:o,value:"{"+n+"}"})}else{var d=new u({name:o,value:"{"+n+"}",displayValue:v})}var h=ge[n][E.SEMANTICS_KEY];var y=ge[n]["com.sap.vocabularies.Common.v1.IsCalendarYear"]&&ge[n]["com.sap.vocabularies.Common.v1.IsCalendarYear"].Bool||ge[n]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]&&ge[n]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"].Bool||ge[n]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]&&ge[n]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"].Bool||ge[n]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]&&ge[n]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"].Bool;if(z&&(c==="Edm.DateTime"||y||c==="Edm.DateTimeOffset"||h&&h.lastIndexOf("year",0)===0)){d.setDataType("date")}S.addDimension(d);if((At?Array.prototype.indexOf.call(At,o):-1)===-1){At.push(o)}}else{S.addMeasure(new f({name:o,value:"{"+n+"}"}));if((gt?Array.prototype.indexOf.call(gt,o):-1)===-1&&a!="bubbleWidth"){gt.push(o)}}});e.addFeed(new c({uid:a,type:l,values:b}));if(a==="categoryAxis"){V[a]={title:{visible:Se?false:true,text:b.join(", ")},label:{formatString:ct?"CURR":"axisFormatter",truncatedLabelRatio:.15}}}else{V[a]={title:{visible:Se?false:true,text:b.join(", ")},label:{formatString:ct?"CURR":"axisFormatter"}}}mt.push(V[a]);if(y.hasOwnProperty("vizProperties")){var O=0;var M=y.vizProperties.length;var L;var w;for(;O<M;O++){if(y.vizProperties[O].hasOwnProperty("value")){w=y.vizProperties[O].value}if(y.vizProperties[O].hasOwnProperty("path")){L=y.vizProperties[O].path.split(".");var k=L.length;var H,G;var j;for(var W=0,j=L[0],H=V,G=Ne;W<k;++W){if(W===k-1){if(G&&G.hasOwnProperty(j)){if(d==="donut"&&(G[j]==="value"||G[j]==="percentage")){w=G[j]}else if(d!="donut"){w=G[j]}}if(Qe&&j!="adjustScale"||!Qe&&j==="adjustScale"||!Qe&&j!="adjustScale"){H[j]=w}break}H[j]=H[j]||{};H=H[j];if(G){G[j]=G[j]||{};G=G[j]}j=L[W+1]}}}}if(r.hasOwnProperty("vizProperties")){var t=0;var X=r.vizProperties.length;var q;var Q;var Z;for(;t<X;t++){if(r.vizProperties[t].hasOwnProperty("method")){Q=r.vizProperties[t].method;switch(Q){case"count":q=b.length;if(r.vizProperties[t].hasOwnProperty("min")&&q<=r.vizProperties[t].min){q=r.vizProperties[t].min}else if(r.vizProperties[t].hasOwnProperty("max")&&q>=r.vizProperties[t].max){q=r.vizProperties[t].max}break;default:break}}else if(r.vizProperties[t].hasOwnProperty("value")){q=r.vizProperties[t].value}if(r.vizProperties[t].hasOwnProperty("path")){Z=r.vizProperties[t].path.split(".");var J=Z.length;for(var h=0,re=Z[0],ae=V;h<J;++h){if(h===J-1){ae[re]=q;break}ae[re]=ae[re]||{};ae=ae[re];re=Z[h+1]}}}}}}});var ht=e.getFeeds();if(y.properties&&y.properties.semanticPattern===true&&L(ht,d)){g(ht,function(t,r){if(ht[t].getType()==="Measure"&&(ht[t].getUid()==="valueAxis"||ht[t].getUid()==="actualValues")){var a;g(D,function(e,r){var i=M(r.Measure.PropertyPath,ge);if(i===ht[t].getValues()[0]){a=S(r,n);return false}});if(a){var i=M(a.Measure.PropertyPath,ge);var o=n[a.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||n[a.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path;var s=M(o,ge);var l=p.getText("ACTUAL",[i]);var u=p.getText("FORECAST",[s]);V.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:i},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:l},{dataContext:{MeasureNamesDimension:s},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:u}]};e.getDataset().addMeasure(new f({name:s,value:"{"+o+"}"}));var c=ht[t].getValues();c.push(s);ht[t].setValues(c)}return false}})}var Pt=false;if(Ke&&Ke.dimensionSettings&&Object.keys(Ke.dimensionSettings).length>0){var Et=Object.keys(Ke.dimensionSettings);for(var Ct=0;Ct<Et.length;Ct++){var yt=Et[Ct];var _t=Ke.dimensionSettings[yt];if(Object.keys(_t).length>10){Pt=true;break}}}if(Ue&&I.indexOf(v.ChartType.EnumMember)>=0&&!Pt){var It=[];var Tt=true;for(var Ct=0;Ct<R.length;Ct++){var Nt=R[Ct].Dimension.PropertyPath;It.push(Nt)}for(var Ct=0;Ct<It.length;Ct++){var yt=It[Ct];if(Et.indexOf(yt)>-1){var Rt=Ke.dimensionSettings[yt];var Dt=Object.keys(Rt);var bt=[];for(var Ct=0;Ct<Dt.length;Ct++){var St=Rt[Dt[Ct]];bt.push(St)}Tt=Tt&&bt.every(Ce)}}if(Tt){var Ot=[];for(var Ct=0;Ct<It.length;Ct++){var yt=It[Ct];if(Et.indexOf(yt)>-1){var Rt=Ke.dimensionSettings[yt];var Dt=Object.keys(Rt);var bt=[];for(var Ct=0;Ct<Dt.length;Ct++){var St=Rt[Dt[Ct]];bt.push(St)}Ee(bt);for(var Mt=0;Mt<bt.length;Mt++){var Lt=bt[Mt].dimensionValue;var Vt=bt[Mt].color;var St={properties:{color:Vt}};St.dataContext={};var Yt=ne(ge,e,yt);St.dataContext[Yt]=Lt;St.displayName=Lt;Ot.push(St)}}}V.plotArea.dataPointStyle=V.plotArea.dataPointStyle||{};V.plotArea.dataPointStyle["rules"]=Ot}else{var Ot=[];for(var Ct=0;Ct<It.length;Ct++){var yt=It[Ct];if(Et.indexOf(yt)>-1){var Rt=Ke.dimensionSettings[yt];var Dt=Object.keys(Rt);var bt=[];for(var Ct=0;Ct<Dt.length;Ct++){var St=Rt[Dt[Ct]];bt.push(St)}Ee(bt);var xt=bt.map(ye)}}V.legend.order=function(e,t){var r=xt.indexOf(e);var a=xt.indexOf(t);return r>a?1:-1}}}if(y.properties&&y.properties.semanticPattern===true&&L(ht,d)&&e.getVizType()==="vertical_bullet"){g(ht,function(t,r){if(ht[t].getType()==="Measure"&&(ht[t].getUid()==="valueAxis"||ht[t].getUid()==="actualValues")){var a;g(D,function(e,r){var i=M(r.Measure.PropertyPath,ge);if(i===ht[t].getValues()[0]){a=O(r,n);return false}});if(a){var i=n[a.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||n[a.DataPoint.AnnotationPath.substring(1)].TargetValue.Path;var o=M(i,ge);e.getDataset().addMeasure(new f({name:o,value:"{"+i+"}"}));e.addFeed(new c({uid:"targetValues",type:"Measure",values:[o]}))}return false}})}if(ct&&vt){N.warning(p.getText("Currency_non_currency_measure"))}g(ht,function(e,t){var r=t.getProperty("type");if(r==="Measure"){var a=t.getProperty("values");var i=true;var n=v.MeasureAttributes.filter(function(e){return a.indexOf(ge[e[r]["PropertyPath"]][E.LABEL_KEY])>=0||a.indexOf(ge[e[r]["PropertyPath"]][E.LABEL_KEY_V4])>=0});g(n,function(e,t){if(re(ge,t,r)||ae(ge,t,r)){i=false}else{i=true;return false}});if(!i){V[t.getProperty("uid")]["label"]["allowDecimals"]=false}}});var Ft;if(ft===undefined){ft=""}if(ut===undefined){ut=""}if(ct){Ft=fe(ft,ct)}else{Ft=fe(ut,ct)}if(t){t.setScale(Ft)}var Ut=ue(gt,At,Ae);var Kt="";g(ht,function(e,t){var r="-1";var a=t.getProperty("type");if(a==="Measure"){var i=mt.filter(function(e){var r=e["title"]["text"].split(",").filter(function(e){if(t.getValues().indexOf(e.trim())>=0){return true}else{return false}});if(r.length>0){return true}else{return false}});if(i&&i.length){var o=t.getValues();if(o&&o.length){g(o,function(e,t){var i=t.trim();var o=D.filter(function(e){if(e["Measure"]&&e["Measure"]["PropertyPath"]){var t=e["Measure"]["PropertyPath"];if(ge[t]&&ge[t][E.LABEL_KEY]===i||ge[t]&&ge[t][E.LABEL_KEY_V4]===i){return true}else{return false}}});if(o&&o.length){var s=o[0];if(!re(ge,s,a)&&!ae(ge,s,a)){var l="";if(s&&s["DataPoint"]&&s["DataPoint"]["AnnotationPath"]&&s["DataPoint"]["AnnotationPath"]){l=s["DataPoint"]["AnnotationPath"]&&s["DataPoint"]["AnnotationPath"].substring(1);if(l!=""){var u;u=n[l]&&n[l]["ValueFormat"]&&n[l]["ValueFormat"]["NumberOfFractionalDigits"]&&n[l]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];r=u>r?u:r}}}else{r=r<"0"?"0":r}}})}}if(i&&i[0]&&i[0].label&&i[0].label.formatString){var s=i[0].label.formatString}Kt="";if(ct){if(s==="CURR"){Kt="CURR/"+r.toString()+"/"}else{Kt="axisFormatter/"+r.toString()+"/"}}else{Kt="axisFormatter/"+r.toString()+"/"}if(i&&i[0]){i[0].label.formatString=Kt}}});if(d==="vertical_bullet"){V["valueAxis"]={title:{visible:Se?false:true},label:{formatString:Kt}}}var Bt="";var wt="";if(ct){Bt=lt.toString();wt="CURR/"+lt.toString()+"/"}else{Bt=st.toString();wt="axisFormatter/"+st.toString()+"/"}if(d==="donut"||m){V.plotArea.dataLabel.formatString=wt;if(V.plotArea.dataLabel.type==="percentage"){V.plotArea.dataLabel.formatString="0.0%/"+Bt+"/"}}H(x,y,"dimension");H(F,y,"measure");if(z){var kt=R[0].Dimension.PropertyPath;if(ge[kt][E.SEMANTICS_KEY]==="yearmonth"||ge[kt]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){V.timeAxis.levels=["year","month"]}else if(ge[kt][E.SEMANTICS_KEY]==="yearquarter"||ge[kt]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){V.timeAxis.levels=["year","quarter"]}else if(ge[kt][E.SEMANTICS_KEY]==="yearweek"||ge[kt]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){V.timeAxis.levels=["year","week"]}else if(ge[kt][E.SEMANTICS_KEY]==="year"||ge[kt]["com.sap.vocabularies.Common.v1.IsCalendarYear"]){V.timeAxis.levels=["year"]}}V.title={text:Ae?Ae:Ut,alignment:"left",layout:{respectPlotPosition:false},style:{fontFamily:"72, 72full, Arial, Helvetica, sans-serif !important",fontSize:".875rem",fontWeight:"normal"}};e.setVizProperties(V);if(i&&i.getProperty("/bInsightEnabled")){var zt=e&&e.getId();var Ht=A({},V);if(Xe!==undefined){Ht.plotArea.dataPointStyle=Xe}P.setVizPropertyMap(zt,Ht)}}function ne(e,t,r){var a="";if(e&&e[r]){if(e[r][E.LABEL_KEY_V4]){a=se(e[r][E.LABEL_KEY_V4].String?e[r][E.LABEL_KEY_V4].String:e[r][E.LABEL_KEY_V4].Path,t,e)}else if(e[r][E.LABEL_KEY]){a=e[r][E.LABEL_KEY]}else if(r){a=r}}return a}function oe(e,t){if(e&&(e.getVizType()==="bubble"||e.getVizType()==="scatter")){return}var r,a,i,n;var o;var s=E.UNIT_KEY;var l=E.UNIT_KEY_V4_ISOCurrency;var u=E.UNIT_KEY_V4_Unit;var f;var c=[];if(!(r=e.getModel("ovpCardProperties"))){N.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return}var v=e.getModel();var m=r.getProperty("/entitySet");if(!v||!m){return}a=r.getProperty("/entityType");if(!a){N.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}var A=le(v,m);i=r.getProperty("/chartAnnotationPath");if(!i||!(n=a[i])){N.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}if(!(o=n.MeasureAttributes)||!o.length){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return}g(o,function(e,t){f=t.Measure.PropertyPath;if(t.DataPoint&&t.DataPoint.AnnotationPath){var r=a[t.DataPoint.AnnotationPath.substring(1)];if(r.ForecastValue&&(r.ForecastValue.PropertyPath||r.ForecastValue.Path)){c.push(r.ForecastValue.PropertyPath||r.ForecastValue.Path)}}c.push(f)});var d=t?t.results:null;var h="";var P=true;var y=[];var _=e.getFeeds();g(_,function(e,t){if(t.getType()==="Measure"){y=y.concat(t.getValues())}});if(d){g(c,function(t,r){var a=ne(A,e,r);if((y?Array.prototype.indexOf.call(y,a):-1)!=-1){if(A&&A[r]){var i;if(A[r][l]){i=A[r][l].Path?A[r][l].Path:A[r][l].String}else if(A[r][u]){i=A[r][u].Path?A[r][u].Path:A[r][u].String}else if(A[r][s]){i=A[r][s]}if(!i){P=false;return false}if(i&&A[i]){for(var t=0;t<d.length;t++){var n=d[t];if(P){if(h&&n[i]&&n[i]!=""&&h!=""&&h!=n[i]){P=false;break}}h=n[i];if(!h){P=false;break}}}}}})}var I="";if(P){if(h!=""){I=p.getText("IN_NO_SCALE",[h]);I=" "+I}var T=e.data("aria-label");if(T&&I&&T.indexOf(I)===-1){var R=T+I;e.data("aria-label",R,true)}var D=e.getVizProperties().title&&e.getVizProperties().title.text;if(D){var b=D.indexOf("|");if(b!==-1){var S=D.slice(b+2);if(S!==h){D=D.slice(0,b-1)}}var O={title:{visible:true,text:S===h?D:D+I,alignment:"left",layout:{respectPlotPosition:false},style:{fontFamily:"72, 72full, Arial, Helvetica, sans-serif !important",fontSize:".875rem",fontWeight:"normal"}}};e.setVizProperties(O)}}}function se(e,t,r){var a;var i;var n;if(e&&e.indexOf("{")===0){e=e.slice(1,-1);if(e.indexOf(">")!=-1){n=e.split(">");a=n[0];i=n[1]}else if(e.indexOf("&gt;")!=-1){n=e.split("&gt;");a=n[0];i=n[1]}try{e=t.getModel(a).getProperty(i)}catch(t){e=r[e][E.LABEL_KEY_V4].String;N.error("Unable to read labels from resource file",t)}}return e}function le(t,r){var a=e.cacheODataMetadata(t);if(!a){return undefined}return a[r]}function ue(e,t,r){var a="",i="",n="";if(r){a=r}if(e&&e.length>1){for(var o=0;o<e.length-1;o++){if(i!=""){i+=", "}i+=e[o]}i=p.getText("MEAS_DIM_TITLE",[i,e[o]])}else if(e){i=e[0]}if(t&&t.length>1){for(var o=0;o<t.length-1;o++){if(n!=""){n+=", "}n+=t[o]}n=p.getText("MEAS_DIM_TITLE",[n,t[o]])}else if(t){n=t[0]}if(a===""){r=p.getText("NO_CHART_TITLE",[i,n])}return r}function fe(e,t){var r=1;var i;if(t){var n=a.getCurrencyInstance({style:"short",currencyCode:false,shortRefNumber:e});i=n.format(Number(r))}else{var o=a.getFloatInstance({style:"short",shortRefNumber:e});i=o.format(Number(r))}var s=i.slice(-1);return s}function ce(e,t){e.attachSelectData(function(a){var n=m.bCRTLPressed?m.constants.explace:m.constants.inplace;m.bCRTLPressed=false;var o=e.getModel("ovpCardProperties");var u=e.getModel();var f=o.getProperty("/entitySet");var c=le(u,f);var v=[],p=[];var A={},d={};var h=e.getDataset().getDimensions();var P;for(var C=0;C<h.length;C++){v.push(h[C].getName())}var y=e.getDataset().getBinding("data").getCurrentContexts().map(function(e){return e.getObject()});if(a.getParameter("data")&&a.getParameter("data")[0]&&a.getParameter("data")[0].data){p=Object.keys(a.getParameter("data")[0].data);P=a.getParameter("data")[0].data._context_row_number;var _=e.getDataset().getBinding("data").getContexts()[P];var I=t.getEntityNavigationEntries(_)[0];if(y[P].$isOthers&&y[P].$isOthers===true){var T={},N=[];for(var R=0;R<v.length;R++){for(var D=0;D<p.length;D++){if(v[R]===p[D]){for(var b in c){if(c.hasOwnProperty(b)){var S=c[b][E.LABEL_KEY]||c[b][E.NAME_KEY]||c[b][E.NAME_CAP_KEY];if(S===p[D]){N.push(b)}}}}}}for(var C=0;C<N.length;C++){T[N[C]]=[];for(var R=0;R<y.length-1;R++){if(R!=P){T[N[C]].push(y[R][N[C]])}}}var O={$isOthers:true};var M={getObject:function(){return O},getOtherNavigationDimensions:function(){return T}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(M)}}else{if(I){t.doNavigation(M,I,n)}}}else{for(var R=0;R<v.length;R++){for(var D=0;D<p.length;D++){if(v[R]===p[D]){for(var b in c){if(c.hasOwnProperty(b)){var S=c[b][E.LABEL_KEY_V4]&&c[b][E.LABEL_KEY_V4].String||c[b][E.LABEL_KEY]||c[b][E.NAME_KEY]||c[b][E.NAME_CAP_KEY];if(S.match(/{@i18n>.+}/gi)){var L=this.getModel("@i18n").getResourceBundle();S=L.getText(S.substring(S.indexOf(">")+1,S.length-1))}if(S===p[D]){A[b]=y[P][b]}}}}for(var b in y[P]){if(c.hasOwnProperty(b)){d[b]=y[P][b]}}}}if(A){g(Object.keys(A),function(e,t){if(c[t]["type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearquarter"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearweek"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(A[t]):A[t]}else if(c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]&&c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"].Bool){var r=A[t];if(r.includes(".")){A[t]=r.split(".").reverse().join("")}else if(r.includes("/")){A[t]=r.split("/").reverse().join("")}}}})}if(d){g(Object.keys(d),function(e,t){if(c[t]["type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearquarter"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearweek"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(d[t]):d[t]}else if(c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]&&c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"].Bool){var r=d[t];if(r.includes(".")){d[t]=r.split(".").reverse().join("")}else if(r.includes("/")){d[t]=r.split("/").reverse().join("")}}}})}var V=o.getProperty("/entityType"),Y=V[o.getProperty("/presentationAnnotationPath")];if(V){var x=r.getRequestFields(Y);if(x&&x.length>0){g(x,function(e,t){if(!A.hasOwnProperty(t)){A[t]=y[P][t]}})}}var M={getObject:function(){return A},getAllData:function(){return d}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(M)}}else{if(I){t.doNavigation(M,I,n)}}}}})}function ve(e){if(e.EnumMember.endsWith("Bubble")){return true}else{return false}}function pe(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Dimension||!e[0].Dimension.PropertyPath){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.DIMENSIONS_MANDATORY);return t}t=true;return t}function me(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Measure||!e[0].Measure.PropertyPath){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return t}t=true;return t}function ge(e){return e.name}function Ae(e){if(e&&e.indexOf("#")!=-1){var t=e.split("#");if(t.length>1){return t[1]}}return""}function de(e,t){var r=t.getModel("ovpCardProperties");var a=he(t);var i=+a.itemsLength;var n=+r.getProperty("/dataStep");if(i&&n){var o=e.colSpan-1;if(o>=0){i+=n*o;Pe(t,i)}}}function he(e){var t=e.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/presentationAnnotationPath");var i=r.hasOwnProperty(a)&&r[a];var n=i&&i.MaxItems;if(n){var o=n.Int32?n.Int32:n.Int;return{itemsLength:+o,dataStep:+t.getProperty("/dataStep")}}}function Pe(e,t){var r,a={},i=[];var n=e.getVizType();var o=e.getModel("ovpCardProperties");var s=o.getProperty("/entityType");var l=o.getProperty("/chartAnnotationPath");var u=s[l];var f=e.getParent();var c=f.getBinding("data");a.path=c.getPath();a.parameters={};if(c.mParameters&&c.mParameters.select){a.parameters.select=c.mParameters.select}a.parameters.custom=a.parameters.custom||{};a.parameters.custom._requestFrom="ovp_internal";a.filters=c.aApplicationFilters;a.sorter=c.aSorters;a.length=n==="donut"?t+1:t;a.template=new v;f.bindAggregation("data",a);if(n==="donut"){g(u.MeasureAttributes,function(e,t){i.push(t.Measure.PropertyPath)});r={};r.path=c.getPath();r.parameters={};r.parameters.select=i.join(",");r.filters=c.aApplicationFilters;r.sorter=c.aSorters;r.length=1;r.template=new v;f.bindAggregation("aggregateData",r)}f.updateBindingContext()}function Ee(e){e.sort(function(e,t){if(e.index<t.index){return-1}if(e.index>t.index){return 1}return 0})}function Ce(e){return e.color!==undefined}function ye(e){return e.dimensionValue}return{constants:E,errorMessages:C,formatItems:R,formatByType:V,returnDateFormat:Y,formatChartAxes:x,hideDateTimeAxis:F,checkExists:U,validateCardConfiguration:K,checkNoData:B,getConfig:w,hasTimeSemantics:k,getChartType:z,getPrimitiveValue:G,formThePathForCriticalityStateCalculation:X,checkFlag:Z,buildVizAttributes:ie,setChartUoMTitle:oe,getMetadata:le,getSelectedDataPoint:ce,checkBubbleChart:ve,dimensionAttrCheck:pe,measureAttrCheck:me,getEntitySet:ge,getAnnotationQualifier:Ae,reprioritizeContent:de,getMaxItems:he,getLabelFromAnnotationPath:se}},true);
//# sourceMappingURL=VizAnnotationManager.js.map